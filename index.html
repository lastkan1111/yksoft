<!DOCTYPE html>

<html lang="ko">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1,viewport-fit=cover,user-scalable=no" name="viewport"/>
<title>가로형 RPG - 자동사냥 + 토끼 전투 (v3)</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Gowun+Batang:wght@400;700;800&family=Black+Han+Sans&display=swap');
  html,body{margin:0;padding:0;width:100%;height:100%;background:#000;overflow:hidden;touch-action:none;}
  

/* ✅ 텍스트 드래그(파란 하이라이트) 방지: 게임 UI 전체 선택 금지 */
body, canvas, button, .ui, #statPanel, #invPanel, #statHud, #twChatHud, #chatToggleBtn, #titleOverlay{
  -webkit-user-select: none;
  -moz-user-select: none;
  -ms-user-select: none;
  user-select: none;
}
/* 드래그 선택/롱탭 하이라이트(모바일)도 최소화 */
*{ -webkit-tap-highlight-color: transparent; }
/* 입력창이 생기면 거긴 선택 허용 */
input, textarea{
  -webkit-user-select: text;
  -moz-user-select: text;
  -ms-user-select: text;
  user-select: text;
}

  canvas{display:block;width:100vw;height:100vh;image-rendering:pixelated;image-rendering:crisp-edges;}

  /* === TITLE OVERLAY === */
  .titleOverlay{
    position:fixed; inset:0;
    background:rgba(0,0,0,0.92); /* 불투명에 가깝게 */
    display:flex; align-items:center; justify-content:center;
    z-index:9999;
  }
  .titleCard{
    width:min(520px, 92vw);
    display:flex; flex-direction:column; align-items:center; gap:18px;
    padding:24px 18px;
  }
  .gameTitle{
    color:#fff;
    font:800 clamp(34px, 6vw, 56px)/1.05 system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
    letter-spacing:-0.02em;
    text-shadow:0 6px 24px rgba(0,0,0,.55);
  }
  .startBtn{
    appearance:none; border:none; cursor:pointer;
    padding:14px 22px;
    width:min(320px, 78vw);
    border-radius:16px;
    color:#fff;
    font:700 18px/1 system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
    background:rgba(255,255,255,0.08);
    outline:2px solid rgba(255,255,255,0.16);
    box-shadow:0 10px 30px rgba(0,0,0,.35);
    transition:transform .08s ease, outline-color .12s ease, background .12s ease;
  }
  .startBtn:hover{
    background:rgba(255,255,255,0.12);
    outline-color:rgba(255,255,255,0.28);
  }
  .startBtn:active{ transform:translateY(1px) scale(0.99); }
  .startBtn:focus-visible{
    outline-color:rgba(120,220,255,0.75);
    box-shadow:0 0 0 4px rgba(120,220,255,0.25), 0 10px 30px rgba(0,0,0,.35);
  }
  .hint{
    color:rgba(255,255,255,0.65);
    font:500 13px/1.35 system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
    text-align:center;
  }

  
/* === TITLE IMAGE (MAX SIZE) === */
.titleImage{
  width: min(92vw, 1100px);   /* 데스크탑에서도 크게 */
  max-height: 70vh;           /* 화면을 넘지 않게 */
  height: auto;
  display: block;
  margin-bottom: 14px;
  image-rendering: auto;
  object-fit: contain;        /* 비율 유지 */
}
@media (max-width: 520px){
  .titleImage{
    width: 100vw;        /* 모바일 가로 꽉 채움 */
    height: auto;
    max-height: 88vh;    /* 세로 기준 최대 */
    margin: 0 auto 12px;
    object-fit: contain;
  }
}
.ui{
    position:fixed;left:12px;top:10px;color:#eee;font:14px system-ui,sans-serif;
    background:rgba(0,0,0,.45);padding:8px 10px;border-radius:10px;user-select:none;
  }

    

  /* === TWITCH CHAT HUD (semi-transparent) === */
  #twChatHud{
    position:fixed;
    left:12px;
    bottom:12px;
    width:220px;
    height:360px;
    background:transparent;
    z-index:9000;
    pointer-events:auto;
    border-radius:12px;
    overflow:hidden;
  }
  #twChatHud iframe{
    width:100%;
    height:100%;
    border:0;
    background:transparent;
    opacity:0.85;            /* ✅ 대표님 요청: 최대한 반투명 */
  }
  

  /* ✅ UNUSED legacy twitch iframe (click-block bug fix) */
  .twitchChatIframe{
    display:none !important;
    position:fixed !important;
    left:-9999px !important;
    top:-9999px !important;
    width:0 !important;
    height:0 !important;
    border:0 !important;
    pointer-events:none !important;
  }

@media (max-width: 520px){
    #twChatHud{ left:10px; bottom:10px; width:200px; height:320px; }
  }

  /* ✅ TWITCH CHAT RESIZE HANDLE */
  #twChatHud{ box-sizing:border-box; }
  #twResizeHandle{
    position:absolute;
    right:32px;  top:6px;
    width:18px; height:18px;
    border-radius:6px;
    background:rgba(255,255,255,0.14);
    outline:1px solid rgba(255,255,255,0.22);
    box-shadow:0 6px 16px rgba(0,0,0,0.35);
    cursor:nwse-resize;
    pointer-events:auto;
    touch-action:none;
  }
  #twResizeHandle::before{
    content:"";
    position:absolute;
    right:4px;  top:4px;
    width:10px; height:10px;
    border-right:2px solid rgba(255,255,255,0.45);
    border-top:2px solid rgba(255,255,255,0.45);
    border-radius:2px;
    opacity:0.9;
  }


/* === VIRTUAL JOYSTICK (touch + mouse) === */
#joy{
  position:fixed; left:0; top:0; width:100%; height:100%;
  z-index:9500; pointer-events:none;
}
#joyBase, #joyKnob{
  position:absolute; border-radius:999px;
  transform:translate(-50%,-50%);
  display:none;
}
#joyBase{
  width:120px; height:120px;
  background:rgba(0,0,0,0.30);
  outline:2px solid rgba(255,255,255,0.18);
  backdrop-filter: blur(1px);
}
#joyKnob{
  width:58px; height:58px;
  background:rgba(255,255,255,0.10);
  outline:2px solid rgba(255,255,255,0.22);
}
@media (max-width: 520px){
  #joyBase{ width:108px; height:108px; }
  #joyKnob{ width:52px; height:52px; }
}


/* === CHAT TOGGLE BUTTON (always top-left-bottom over canvas) === */
#chatToggleBtn{
  position:fixed;
  left:12px;
  bottom:12px;
  z-index:9500;
  pointer-events:auto;
  appearance:none;
  border:none;
  cursor:pointer;
  padding:10px 12px;
  border-radius:14px;
  color:rgba(255,255,255,0.92);
  font:700 13px/1 system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", sans-serif;
  background:rgba(0,0,0,0.40);
  outline:1px solid rgba(255,255,255,0.18);
  box-shadow:0 10px 24px rgba(0,0,0,0.40);
  backdrop-filter: blur(2px);
  -webkit-tap-highlight-color: transparent;
}
#chatToggleBtn:active{ transform: translateY(1px) scale(0.99); }
@media (max-width: 520px){
  #chatToggleBtn{ left:10px; bottom:10px; padding:9px 11px; font-size:12px; }
}

/* === CHAT COLLAPSE / EXPAND ANIMATION === */
#twChatHud{
  transform-origin: left bottom;
  transition: transform 260ms ease, opacity 260ms ease;
  will-change: transform, opacity;
}
#twChatHud.collapsed{
  opacity:0;
  transform: translate(-14px, 14px) scale(0.08);
  pointer-events:none; /* ✅ 접히면 클릭 안됨 */
}
#twChatHud.collapsed #twResizeHandle{ display:none; }


/* === TOP-LEFT HP/MP HUD === */
#statHud{
  position:fixed;
  left:12px;
  top:16px; 
  z-index:9000;
  display:flex;
  flex-direction:column;
  gap:8px;
  pointer-events:none;
  user-select:none;
}
.hudBar{
  width:110px;
  height:11px;
  border-radius:8px;
  background:rgba(0,0,0,0.38);
  
  box-shadow:0 10px 22px rgba(0,0,0,0.35);
  overflow:hidden;backdrop-filter:blur(2px);
}
.hudFill{height:100%;width:100%;border-radius:8px;transform-origin:left center;}
.hudFill.hp{background:linear-gradient(90deg, rgba(255,70,70,0.92), rgba(255,120,120,0.85));}
.hudFill.mp{background:linear-gradient(90deg, rgba(80,150,255,0.92), rgba(130,190,255,0.85));}

.hudFill.exp{background:linear-gradient(90deg, rgba(255,210,80,0.95), rgba(255,235,150,0.9));}
.hudText{
  position:absolute; inset:0;
  color:rgba(255,255,255,0.92);
  font:700 9px/1 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  letter-spacing:0.02em;
  text-shadow:0 2px 10px rgba(0,0,0,0.45);
}
.hudText .label{
  position:absolute; left:6px; top:50%; transform:translateY(-50%);
  white-space:nowrap;
}
.hudText .value{
  position:absolute; left:50%; top:50%; transform:translate(-50%,-50%);
  white-space:nowrap;
  font-variant-numeric: tabular-nums;
}

.hudBar.hp{ border:1px solid rgba(255,90,90,0.95); }
.hudBar.mp{ border:1px solid rgba(90,150,255,0.95); }
.hudBar.exp{ border:1px solid rgba(255,215,90,0.95); }

/* === WELCOME TEXT (below EXP) === */
#welcomeMsg{
  width:110px;
  color:
#3DFF92;
  font:700 12px/1.25 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  text-shadow: 0 2px 10px rgba(0,0,0,0.55);
  pointer-events:none;
  user-select:none;
  white-space:nowrap;
}



/* 스탯 버튼/패널 CSS (복붙) */
#statBtn {
  position: fixed;
  top: 10px;
  right: 12px;
  z-index: 1200;
  /* 스르륵 효과 */
  transition: transform 0.55s cubic-bezier(.5,2,.4,1), opacity 0.25s;
  background: rgba(34, 36, 40, 0.55);
  color: #fff;
  font-size: 16px;
  font-family: 'Pretendard', 'GmarketSans', Arial, sans-serif;
  font-weight: bold;
  padding: 4px 16px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  box-shadow: 0 2px 8px #1115;
  letter-spacing: 0.5px;
  display: flex;
  align-items: center;
  gap: 7px;
  opacity: 1;
  transform: translateY(0); /* ✅ 항상 보이게 */
}

#statBtn.show {
  opacity: 1;
  transform: translateY(0);     /* ★★ 아래로 스르륵 나타남 */
}

#statBtn:hover {
  filter: brightness(1.08);
  background: #53ac48;
}
#statBtn:active {
  filter: brightness(0.92);
}
#statBtn .icon {
  font-size: 20px;
  margin-right: 2px;
}
#statBtn .statText {
  color: #fff;
  font-weight: bold;
  font-size: 1em;
  letter-spacing: 0.5px;
}

/* 스탯패널 디자인 */
#statPanel {
  position: fixed;
  top: 14px; 
  left: 14px; 
  transform: none; /* 중앙정렬 해제 */
  width: 340px; height: 420px;
  background: linear-gradient(145deg, #263c25 80%, #1c2a1b 100%);
  border-radius: 18px;
  box-shadow: 0 4px 20px #111a;
  border: 2.5px solid #2a4b22;
  padding: 16px 18px 16px 18px;
  z-index: 10050;
  display: flex; flex-direction: column;
  font-family: 'Pretendard', 'GmarketSans', Arial, sans-serif;
  cursor: default;
  transition: box-shadow 0.15s, background 0.2s;

  /* ✅ 중앙 고정 + 드래그 비활성 */
/* 채팅/조이스틱보다 위 */
}

/* #statPanel.dragging {  (drag disabled) */
/*
  cursor: grabbing;
  box-shadow: 0 8px 36px #0a09;
  opacity: 0.97;
*/
#statPanel.hide {
  display: none !important;
}
.statHeader {
  display: flex; align-items: center; justify-content: space-between;
  margin-bottom: 11px;
}
.statPoint {
  color: #3ff8e5;
  font-size: 1.28em;
  font-weight: bold;
  letter-spacing: 1px;
}
.btn {
  font-size: 1em; font-weight: bold;
  padding: 5px 16px; border-radius: 6px; margin-left: 8px; border: none; cursor: pointer;
  box-shadow: 0 2px 8px #1115;
  transition: filter 0.1s;
}
.btn.close { background: #a3413d; color: #fff; }
.btn:active { filter: brightness(0.92); }
.statList {
  flex: 1; overflow-y: auto; background: #2228; border-radius: 10px; padding: 9px 6px 6px 6px;
  scrollbar-width: thin; scrollbar-color: #383 #181d16;
  user-select: none;
  cursor: default;
}
.statList::-webkit-scrollbar { width: 7px; background: #222; }
.statList::-webkit-scrollbar-thumb { background: #2a4b22; border-radius: 8px; }
.statRow {
  display: flex; align-items: center; justify-content: space-between;
  margin: 0 0 8px 0; background: #191f16da;
  border-radius: 7px; padding: 11px 10px 7px 12px;
  box-shadow: 0 1px 7px #2223;
  font-size: 1.18em;
}
.statInfo { flex: 1 1 65%; }
.statName { font-weight: bold; color: #f8ea6b; font-size: 1.13em; }
.statDesc { font-size: 0.93em; color: #7cff66; margin-top: 2px;}
.statCtrl { display: flex; align-items: center; gap: 6px;}
.statCtrl button {
  width: 40px; height: 38px; font-size: 1.22em; font-weight: bold; border-radius: 7px;
  border: none; background: #406d3a; color: #fff; cursor: pointer;
  margin: 0 2px;
  box-shadow: 0 2px 8px #2235;
  transition: filter 0.12s, background 0.16s;
}
.statCtrl button.plus { background: #38a058; }

.statCtrl button:active { filter: brightness(0.88);}

.statValue {
  width: 26px; text-align: center; font-weight: bold; color: #fff;
  background: #1a1f1e; border-radius: 4px; margin: 0 2px; font-size: 1.09em;
  pointer-events: none;
}


/* === 인벤 버튼 (스탯 버튼과 동일 스타일) === */
#invBtn {
  position: fixed;
  top: 52px;              /* ✅ 스탯버튼 바로 아래 */
  right: 12px;
  z-index: 1200;
  transition: transform 0.55s cubic-bezier(.5,2,.4,1), opacity 0.25s;
  background: rgba(34, 36, 40, 0.55);
  color: #fff;
  font-size: 16px;
  font-family: 'Pretendard', 'GmarketSans', Arial, sans-serif;
  font-weight: bold;
  padding: 4px 16px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  box-shadow: 0 2px 8px #1115;
  letter-spacing: 0.5px;
  display: flex;
  align-items: center;
  gap: 7px;
  opacity: 1;
  transform: translateY(0);
}
#invBtn:hover { filter: brightness(1.08); background: #53ac48; }
#invBtn:active { filter: brightness(0.92); }
#invBtn .icon { font-size: 20px; margin-right: 2px; }

/* === 장비상태 버튼 (인벤 버튼과 동일 스타일) === */
#equipStatusBtn {
  position: fixed;
  top: 94px;              /* ✅ 인벤토리 버튼 바로 아래 */
  right: 12px;
  z-index: 1200;
  transition: transform 0.55s cubic-bezier(.5,2,.4,1), opacity 0.25s;
  background: rgba(34, 36, 40, 0.55);
  color: #fff;
  font-size: 16px;
  font-family: 'Pretendard', 'GmarketSans', Arial, sans-serif;
  font-weight: bold;
  padding: 4px 16px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  box-shadow: 0 2px 8px #1115;
  letter-spacing: 0.5px;
  display: flex;
  align-items: center;
  gap: 7px;
  opacity: 1;
  transform: translateY(0);
}
#equipStatusBtn:hover { filter: brightness(1.08); background: #53ac48; }
#equipStatusBtn:active { filter: brightness(0.92); }
#equipStatusBtn .icon { font-size: 20px; margin-right: 2px; }

/* === 장비 상태 패널 (인벤 패널 크기 동일) === */
#equipPanel{
  position: fixed;
  top: 14px;
  left: 14px;
  width: 340px;
  height: 420px;
  background: linear-gradient(145deg, #263c25 80%, #1c2a1b 100%);
  border-radius: 18px;
  box-shadow: 0 4px 20px #111a;
  border: 2.5px solid #2a4b22;
  padding: 16px 18px 16px 18px;
  z-index: 12100 !important; /* ✅ invPanel보다 위 */
  display: flex;
  flex-direction: column;
  font-family: 'Pretendard', 'GmarketSans', Arial, sans-serif;
  pointer-events: auto; /* ✅ statHud(pointer-events:none) 영향 차단 */
}
#equipPanel.hide{display:none !important;}

.equipGrid{
  flex:1;
  margin-top: 10px;
  background: #2228;
  border-radius: 12px;
  padding: 12px;
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  grid-template-rows: repeat(4, 1fr);
  gap: 10px;
  box-shadow: inset 0 0 0 1px rgba(0,0,0,0.25);
  user-select:none;
}
.equipSlot{
  background: rgba(25,31,22,0.85);
  border-radius: 10px;
  border: 1.5px solid rgba(60,110,58,0.55);
  box-shadow: 0 2px 8px rgba(0,0,0,0.18);
  display:flex;
  align-items:center;
  justify-content:center;
  color: rgba(255,255,255,0.90);
  font-weight: 900;
  letter-spacing: 0.4px;
  font-size: 13px;
  position: relative;
  overflow: hidden;
  text-align:center;
  padding: 0 6px;
}
.equipSlot .sub{
  position:absolute;
  bottom:6px;
  left:6px;
  right:6px;
  font-size: 11px;
  font-weight: 800;
  color: rgba(200,255,200,0.88);
  text-shadow: 0 2px 10px rgba(0,0,0,0.45);
}
.equipSlot .badge{
  position:absolute;
  right:8px;
  top:6px;
  font-size: 12px;
  font-weight: 1000;
  padding: 2px 6px;
  border-radius: 999px;
  background: rgba(60,160,120,0.72);
  border: 1px solid rgba(255,255,255,0.15);
  color: rgba(255,255,255,0.95);
  text-shadow: 0 2px 10px rgba(0,0,0,0.45);
}

/* ✅ EQUIP SLOT ICON (keep slot layout, show only icon) */
.equipSlot.hasIcon .main,
.equipSlot.hasIcon .sub{ display:none !important; }
.equipSlot.hasIcon img.eqIcon{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
  display:block;
  pointer-events:none; /* 클릭은 슬롯이 받음 */
}

.equipFooter{
  margin-top: 10px;
  background: rgba(25,31,22,0.78);
  border: 1.5px solid rgba(60,110,58,0.45);
  border-radius: 12px;
  padding: 10px 12px;
  box-shadow: inset 0 0 0 1px rgba(0,0,0,0.18);
}
.equipFooter .line{
  display:flex;
  align-items:center;
  justify-content:space-between;
  gap:10px;
  font-weight: 900;
  letter-spacing: 0.2px;
  margin: 2px 0;
}
.equipFooter .k{ color: rgba(255,230,140,0.95); }
.equipFooter .v{ color: rgba(255,255,255,0.95); font-variant-numeric: tabular-nums; }
.equipFooterGrid{
  display:grid;
  grid-template-columns: 1fr 1fr;
  gap: 10px;
}
.equipFooterGrid .col{
  display:flex;
  flex-direction:column;
  gap: 2px;
}
@media (max-width: 520px){
  /* 모바일에서도 좌/우 2컬럼 유지 (PC처럼) */
  .equipFooter{ padding: 8px 10px; }
  .equipFooterGrid{ grid-template-columns: 1fr 1fr; gap: 8px; }
  .equipFooter .line{ gap: 8px; font-size: 12px; }
  .equipFooter .k{ font-size: 12px; }
  .equipFooter .v{ font-size: 12px; }
}


/* === 인벤 패널 (스탯패널 감성 그대로) === */
#invPanel {
  position: fixed;
  top: 14px;
  left: 14px;
  width: 340px;
  height: 420px;
  background: linear-gradient(145deg, #263c25 80%, #1c2a1b 100%);
  border-radius: 18px;
  box-shadow: 0 4px 20px #111a;
  border: 2.5px solid #2a4b22;
  padding: 16px 18px 16px 18px;
  z-index: 12000 !important; /* 채팅/조이스틱보다 위 */
  display: flex;
  flex-direction: column;
  font-family: 'Pretendard', 'GmarketSans', Arial, sans-serif;
}
#invPanel.hide { display:none !important; }



/* === SHOP BUTTON (next to Close) === */
/* === SELL BUTTON (left of Shop) === */
.btn.sell{
  background: rgba(255,210,120,0.10);
  color:#fff;
}
.btn.sell:hover{ filter: brightness(1.08); background: rgba(255,190,70,0.30); }
.btn.sell:active{ filter: brightness(0.92); }

.invHeaderBtns{ display:flex; align-items:center; gap:8px; }
.btn.shop{
  background: rgba(255,255,255,0.10);
  color:#fff;
}
.btn.shop:hover{ filter: brightness(1.08); background: rgba(120,220,255,0.35); }
.btn.shop:active{ filter: brightness(0.92); }

/* === SHOP PANEL (simple + pretty) === */
#shopPanel{
  position: fixed;
  top: 14px;
  left: 14px;
  width: 340px;
  height: 420px;
  background: radial-gradient(120% 140% at 30% 20%, rgba(120,220,255,0.10), rgba(0,0,0,0) 55%),
              linear-gradient(145deg, #24352a 80%, #1c2a1b 100%);
  border-radius: 18px;
  box-shadow: 0 4px 20px #111a;
  border: 2.5px solid rgba(70,150,120,0.45);
  padding: 16px 18px 16px 18px;
  z-index: 12200 !important; /* invPanel보다 위 */
  display:flex;
  flex-direction:column;
  font-family: 'Pretendard','GmarketSans', Arial, sans-serif;
  pointer-events:auto;
}
#shopPanel.hide{ display:none !important; }

/* === SELL PANEL (inventory-like + simple) === */
#sellPanel{
  position: fixed;
  top: 14px;
  left: 14px;
  width: 340px;
  height: 420px;
  background: radial-gradient(120% 140% at 30% 20%, rgba(255,210,120,0.10), rgba(0,0,0,0) 55%),
              linear-gradient(145deg, #263c25 80%, #1c2a1b 100%);
  border-radius: 18px;
  box-shadow: 0 4px 20px #111a;
  border: 2.5px solid rgba(255,210,120,0.35);
  padding: 16px 18px 16px 18px;
  z-index: 12300 !important; /* shopPanel보다 위 */
  display:flex;
  flex-direction:column;
  font-family: 'Pretendard','GmarketSans', Arial, sans-serif;
  pointer-events:auto;
}
#sellPanel.hide{ display:none !important; }

/* 드래그 핸들(헤더) */
#sellPanel .statHeader{
  cursor: grab;
  touch-action: none;
}
#sellPanel.dragging .statHeader{ cursor: grabbing; }

.sellList{
  flex:1;
  margin-top: 10px;
  background: #2228;
  border-radius: 12px;
  padding: 10px;
  overflow-y:auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: thin;
  scrollbar-color: rgba(255,210,120,0.75) rgba(0,0,0,0.15);
}
.sellList::-webkit-scrollbar{ width:7px; background: rgba(0,0,0,0.15); }
.sellList::-webkit-scrollbar-thumb{ background: rgba(255,210,120,0.70); border-radius: 8px; }

.sellItem{
  display:flex;
  gap:10px;
  align-items:center;
  padding: 10px 10px;
  margin-bottom: 10px;
  border-radius: 12px;
  background: rgba(25,31,22,0.85);
  border: 1.5px solid rgba(255,210,120,0.26);
  box-shadow: 0 2px 8px rgba(0,0,0,0.18);
}
.sellItem:last-child{ margin-bottom:0; }

.sellIcon{
  width:52px;
  height:52px;
  border-radius: 12px;
  background: rgba(255,255,255,0.08);
  outline: 1px solid rgba(255,255,255,0.14);
  overflow:hidden;
  flex: 0 0 auto;
  display:flex;
  align-items:center;
  justify-content:center;
}
.sellIcon img{ width:100%; height:100%; object-fit:cover; display:block; }
.sellMeta{ flex:1; min-width:0; }
.sellName{
  font-weight: 1000;
  color: rgba(255,235,210,0.95);
  letter-spacing: 0.2px;
  font-size: 14px;
}
.sellDesc{
  margin-top: 3px;
  font-weight: 800;
  color: rgba(160,255,200,0.86);
  font-size: 12px;
  line-height: 1.25;
  white-space: pre-line;
}
.sellBtns{
  display:flex;
  flex-direction:column;
  gap:4px;
  flex: 0 0 auto;
  align-items:flex-end;
}
.sellQtyBox{
  display:flex;
  align-items:center;
  justify-content:center;
  gap:2px;
  margin-top:2px;
  padding: 2px 3px;
  border-radius: 8px;
  background: rgba(0,0,0,0.18);
  border: 1px solid rgba(255,210,120,0.22);
}
.sellQtyBtn{
  appearance:none;
  border:none;
  cursor:pointer;
  width:16px;
  height:16px;
  border-radius: 6px;
  background: linear-gradient(180deg, rgba(255,215,120,0.16), rgba(0,0,0,0.10));
  color: rgba(255,225,150,0.95);
  font: 1000 10px/1 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  padding:0;
}
.sellQtyBtn:active{ transform: translateY(1px); }
.sellQtyNum{
  min-width: 12px;
  text-align:center;
  color: rgba(255,230,170,0.95);
  font: 1000 10px/1 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
}
.sellQtyBox.disabled{ opacity:0.45; pointer-events:none; }
.sellBtn{
  appearance:none;
  border:none;
  cursor:pointer;
  padding: 10px 12px;
  border-radius: 12px;
  font: 1000 12px/1 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  color: rgba(255,255,255,0.96);
  background: rgba(255,190,70,0.92);
  outline: 1px solid rgba(255,255,255,0.18);
  box-shadow: 0 10px 20px rgba(0,0,0,0.30);
  white-space:nowrap;
}
.sellBtn:active{ transform: translateY(1px) scale(0.99); filter:brightness(0.95); }
.sellBtn.disabled{
  opacity:0.45;
  pointer-events:none;
  filter:saturate(0.6);
}


/* === SELL BULK HINT (bottom message) === */
.sellHint{
  margin-top:10px;
  padding:10px 12px;
  border-radius:12px;
  background: rgba(0,0,0,0.32);
  outline: 1px solid rgba(255,210,120,0.22);
  color: rgba(255,235,210,0.92);
  font: 900 12px/1.25 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  text-align:center;
  letter-spacing: 0.02em;
  box-shadow: inset 0 0 0 1px rgba(0,0,0,0.18);
  user-select:none;
}
.sellHint.hide{ display:none !important; }

/* bulk mode: click anywhere on row to sell */
#sellPanel.bulk .sellItem{ cursor:pointer; }
#sellPanel.bulk .sellItem:hover{
  filter: brightness(1.06);
  outline: 1px solid rgba(255,210,120,0.25);
}
#sellPanel.bulk #sellAllBtn{
  background: rgba(255,190,70,0.36);
  outline: 1px solid rgba(255,210,120,0.28);
}
@media (max-width: 520px){
  #sellPanel{ width: min(92vw, 340px); height: min(70vh, 420px); }
  .sellIcon{ width:48px; height:48px; border-radius: 12px; }
}
/* ✅ SHOP PANEL DRAG HANDLE */
#shopPanel .statHeader{
  cursor: grab;
  touch-action: none;
}
#shopPanel.dragging .statHeader{ cursor: grabbing; }


.shopList{
  flex:1;
  margin-top: 10px;
  background: #2228;
  border-radius: 12px;
  padding: 10px;
  overflow-y:auto;
  -webkit-overflow-scrolling: touch;
  scrollbar-width: thin;
  scrollbar-color: rgba(70,150,120,0.8) rgba(0,0,0,0.15);
}
.shopList::-webkit-scrollbar{ width:7px; background: rgba(0,0,0,0.15); }
.shopList::-webkit-scrollbar-thumb{ background: rgba(70,150,120,0.75); border-radius: 8px; }

.shopItem{
  display:flex;
  gap:10px;
  align-items:center;
  padding: 10px 10px;
  margin-bottom: 10px;
  border-radius: 12px;
  background: rgba(25,31,22,0.85);
  border: 1.5px solid rgba(70,150,120,0.35);
  box-shadow: 0 2px 8px rgba(0,0,0,0.18);
}
.shopItem:last-child{ margin-bottom:0; }
.shopIcon{
  width:52px;
  height:52px;
  border-radius: 12px;
  background: rgba(255,255,255,0.08);
  outline: 1px solid rgba(255,255,255,0.14);
  overflow:hidden;
  flex: 0 0 auto;
  display:flex;
  align-items:center;
  justify-content:center;
}
.shopIcon img{ width:100%; height:100%; object-fit:cover; display:block; }
.shopMeta{ flex:1; min-width:0; }
.shopName{
  font-weight: 1000;
  color: rgba(255,235,210,0.95);
  letter-spacing: 0.2px;
  font-size: 14px;
}
.shopDesc{
  margin-top: 3px;
  font-weight: 800;
  color: rgba(160,255,200,0.86);
  font-size: 12px;
  line-height: 1.25;
}
.shopPrice{
  margin-top: 6px;
  font-weight: 1000;
  color: rgba(255,210,120,0.95);
  font-size: 12px;
}
.shopBuy{
  appearance:none;
  border:none;
  cursor:pointer;
  padding: 10px 12px;
  border-radius: 12px;
  font: 1000 12px/1 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  color: rgba(255,255,255,0.96);
  background: rgba(83,172,72,0.92);
  outline: 1px solid rgba(255,255,255,0.18);
  box-shadow: 0 10px 20px rgba(0,0,0,0.30);
  flex: 0 0 auto;
  white-space:nowrap;
}
.shopBuy:active{ transform: translateY(1px) scale(0.99); filter:brightness(0.95); }

@media (max-width: 520px){
  #shopPanel{ width: min(92vw, 340px); height: min(70vh, 420px); }
  .shopIcon{ width:48px; height:48px; border-radius: 12px; }
}

.invGrid{
  flex: 1;
  margin-top: 10px;
  background: #2228;
  border-radius: 12px;
  padding: 12px;
  display: grid;
  grid-template-columns: repeat(5, 1fr);
  grid-template-rows: repeat(5, 1fr);
  gap: 10px;
  box-shadow: inset 0 0 0 1px rgba(0,0,0,0.25);
  user-select:none;
}
.invSlot{
  background: rgba(25,31,22,0.85);
  border-radius: 10px;
  border: 1.5px solid rgba(60,110,58,0.55);
  box-shadow: 0 2px 8px rgba(0,0,0,0.18);
  display:flex;
  align-items:center;
  justify-content:center;
  color: rgba(255,255,255,0.78);
  font-weight: 800;
  letter-spacing: 0.5px;
  font-size: 13px;
  position: relative;
  overflow: visible;
  text-align:center;
  padding: 0px;
}
.invSlot img{width:100%;height:100%;object-fit:cover;display:block;}
.invSlot.empty::after{
  content:"";
  position:absolute; inset:0;
  background: radial-gradient(circle at 30% 25%, rgba(255,255,255,0.08), transparent 55%);
  opacity: 0.85;
  pointer-events:none;
}
.invSlot .qty{
  position:absolute;
  right:8px;
  bottom:6px;
  font-size: 12px;
  font-weight: 900;
  color: rgba(255,255,255,0.92);
  text-shadow: 0 2px 10px rgba(0,0,0,0.55);
}



.invSlot .itemTip{
  position:absolute;
  left:50%;
  top:-8px;
  transform: translate(-50%, -100%);
  min-width: 110px;
  max-width: 180px;
  padding: 8px 10px;
  border-radius: 12px;

  font: 800 12px/1.25 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  color: rgba(255,255,255,0.95);

  background: rgba(0,0,0,0.72);
  outline: 1px solid rgba(255,255,255,0.14);
  box-shadow: 0 12px 24px rgba(0,0,0,0.45);
  backdrop-filter: blur(3px);

  pointer-events:none;
  z-index: 9999;
  white-space: pre-line;
}
.equipSlot .itemTip{
  position:absolute;
  left:50%;
  top:-8px;
  transform: translate(-50%, -100%);
  min-width: 110px;
  max-width: 180px;
  padding: 8px 10px;
  border-radius: 12px;

  font: 800 12px/1.25 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  color: rgba(255,255,255,0.95);

  background: rgba(0,0,0,0.72);
  outline: 1px solid rgba(255,255,255,0.14);
  box-shadow: 0 12px 24px rgba(0,0,0,0.45);
  backdrop-filter: blur(3px);

  pointer-events:none;
  z-index: 9999;
  white-space: pre-line;
}
.invPager{
  margin-top: 10px;
  display:flex;
  align-items:center;
  justify-content:center;
  gap: 12px;
  user-select:none;
}
.invArrow{
  width: 34px;
  height: 28px;
  border-radius: 8px;
  border: none;
  cursor: pointer;
  background: rgba(255,255,255,0.08);
  outline: 1px solid rgba(255,255,255,0.14);
  box-shadow: 0 2px 10px rgba(0,0,0,0.28);
  color: rgba(255,255,255,0.9);
  font-weight: 900;
}
.invArrow:active{ transform: translateY(1px) scale(0.99); }
.invPageText{
  min-width: 88px;
  text-align:center;
  color: rgba(255,255,255,0.80);
  font-weight: 800;
  letter-spacing: 0.8px;
  font-size: 12px;
}

@media (max-width: 520px){
  #invPanel{ width: min(92vw, 340px); height: min(70vh, 420px); }
#invBtn{ top: 48px; right: 10px; }
}


/* === SKILL SLOTS HUD (3x3, bottom-right) === */
#skillHud{
  position:fixed;
  right:12px;
  bottom:12px;
  z-index:9200;
  display:grid;
  grid-template-columns: repeat(3, 70px);
  grid-template-rows: repeat(3, 70px);
  gap:8px;
  padding:0;               /* ✅ 바탕 제거 */
  border-radius:0;         /* ✅ 바탕 제거 */
  background: transparent; /* ✅ 바탕 제거 */
  outline:none;            /* ✅ 바탕 제거 */
  box-shadow:none;         /* ✅ 바탕 제거 */
  backdrop-filter:none;    /* ✅ 바탕 제거 */
  -webkit-tap-highlight-color: transparent;
  user-select:none;
  pointer-events:auto;
}
.skillSlot{
  width:70px; height:70px;          /* ✅ 아담하게 */
  border-radius: 18px;              /* ✅ 모서리 둥근 정사각형 */
  background: transparent;         /* ✅ 알맹이만 (바탕 제거) */
  outline: 3px solid rgba(255,255,255,0.42);
  box-shadow: inset 0 0 0 1px rgba(0,0,0,0.16), inset 0 0 0 2px rgba(255,255,255,0.08), 0 0 0 1px rgba(120,220,255,0.18), 0 10px 22px rgba(0,0,0,0.18);
  position:relative;
  overflow:hidden;
  cursor:pointer;
  transition: transform .08s ease, outline-color .12s ease, filter .12s ease;
}
.skillSlot:hover{ outline-color: rgba(120,220,255,0.70); }
.skillSlot:active{ transform: translateY(1px) scale(0.99); filter: brightness(0.95); }

.skillSlot .icon{
  position:absolute; inset:0;
  display:flex; align-items:center; justify-content:center;
  font:900 22px/1 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  color: rgba(255,255,255,0.90);
  text-shadow: 0 2px 10px rgba(0,0,0,0.55);
  letter-spacing: 0.02em;
}
.skillSlot .key{
  position:absolute;
  left: 6px;
  top: 6px;
  font:900 9px/1 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  color: rgba(255,255,255,0.85);
  background: transparent;          /* ✅ 키 바탕 제거 */
  padding:0;
  border-radius:0;
  outline:none;
  box-shadow:none;
  text-shadow: 0 2px 10px rgba(0,0,0,0.65);
}
.skillSlot .cd{
  position:absolute; inset:0;
  background: rgba(200, 220, 255, 0.34);
  transform: translateY(100%);
  transition: transform .10s linear;
}
.skillSlot.onCooldown .cd{ transform: translateY(0%); }

.skillSlot .cdText{
  position:absolute;
  right:6px;
  bottom:6px;
  font:900 10px/1 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  color: rgba(255,255,255,0.92);
  text-shadow: 0 2px 10px rgba(0,0,0,0.65);
}

/* 모바일에서 약간 작게 */
@media (max-width: 520px){
  #skillHud{
    right:10px; bottom:10px;
    grid-template-columns: repeat(3, 64px);
    grid-template-rows: repeat(3, 64px);
    gap:7px;
  }
  .skillSlot{ width:64px; height:64px; border-radius:16px; }
}


/* === EQUIP MARK / BUTTON (dagger) === */
.invSlot .equipMark{
  position:absolute;
  left:6px;
  top:6px;
  width:22px;
  height:22px;
  border-radius:8px;
  display:flex;
  align-items:center;
  justify-content:center;
  font:900 12px/1 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  color:rgba(255,255,255,0.95);
  background:rgba(80,160,255,0.22);
  outline:1px solid rgba(120,220,255,0.35);
  box-shadow:0 8px 18px rgba(0,0,0,0.30);
  pointer-events:none;
}
.invSlot .equipBtn{
  position:absolute;
  left:50%;
  bottom:6px;
  transform:translateX(-50%);
  appearance:none;
  border:none;
  cursor:pointer;
  padding:6px 10px;
  border-radius:10px;
  font:900 12px/1 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  color:rgba(255,255,255,0.95);
  background:rgba(83,172,72,0.85);
  outline:1px solid rgba(255,255,255,0.18);
  box-shadow:0 10px 20px rgba(0,0,0,0.35);
}
.invSlot .equipBtn:active{ transform:translateX(-50%) translateY(1px) scale(0.99); filter:brightness(0.95); }


/* === ENHANCE BADGE (+n) === */
.invSlot .enhBadge{
  position:absolute;
  right:6px;
  top:6px;
  min-width:22px;
  height:22px;
  padding:0 6px;
  border-radius:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  font:900 11px/1 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  color:rgba(255,255,255,0.96);
  background:rgba(255,190,70,0.22);
  outline:1px solid rgba(255,220,140,0.42);
  box-shadow:0 8px 18px rgba(0,0,0,0.30);
  pointer-events:none;
}




/* === ENHANCE SLOT BADGE (+n) for Enhance Panel === */
.enhWSlot .enhBadge{
  position:absolute;
  right:6px;
  bottom:6px;               /* ✅ 아래단에 표시 */
  min-width:22px;
  height:22px;
  padding:0 6px;
  border-radius:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  font:900 11px/1 "Black Han Sans","Noto Sans KR",system-ui,sans-serif;
  color:rgba(255,255,255,0.96);
  background:rgba(0,0,0,0.55);
  outline:1px solid rgba(255,255,255,0.18);
  box-shadow:0 8px 18px rgba(0,0,0,0.30);
  pointer-events:none;
}
/* === /ENHANCE SLOT BADGE === */

/* === WEAPON ENHANCE MODAL (MOBILE OPTIMIZED 2x4) === */
#enhanceModal{
  position:fixed; inset:0;
  display:none;
  align-items:center; justify-content:center;
  z-index: 20050;
  background: rgba(0,0,0,0.50);
  backdrop-filter: blur(2px);
}
#enhanceModal.show{ display:flex; }

#enhanceBox{
  width: min(520px, calc(100vw - 16px));
  max-height: min(64vh, 560px);
  background: rgba(20,24,28,0.94);
  outline:2px solid rgba(255,255,255,0.14);
  border-radius: 18px;
  box-shadow: 0 20px 70px rgba(0,0,0,0.60);
  overflow:hidden;
  display:flex;
  flex-direction:column;
}

#enhanceHead{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding: 14px 16px;
  background: linear-gradient(180deg, rgba(255,255,255,0.10), rgba(0,0,0,0));
}
#enhanceTitle{
  font:900 18px/1.1 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  color: rgba(255,255,255,0.94);
  letter-spacing: .02em;
}
#enhanceClose{
  appearance:none;
  border:none;
  cursor:pointer;
  padding:12px 14px;
  border-radius: 14px;
  font:900 15px/1 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  color: rgba(255,255,255,0.92);
  background: rgba(255,255,255,0.12);
  outline: 2px solid rgba(255,255,255,0.16);
}
#enhanceClose:active{ transform: translateY(1px) scale(0.99); }

#enhanceBody{
  padding: 14px 14px 16px;
  overflow:auto;
  -webkit-overflow-scrolling: touch;
}

#enhanceGrid{
  display:grid;
  grid-template-columns: repeat(4, minmax(0, 1fr)); /* ✅ 2 x 4 */
  gap: 12px;                                       /* ✅ 터치 여유 */
}

.enhWSlot{
  position:relative;
  width:100%;
  aspect-ratio: 1 / 1;
  border-radius: 18px;
  overflow:hidden;
  background: rgba(255,255,255,0.08);
  outline: 2px solid rgba(255,255,255,0.14);
  box-shadow: 0 12px 28px rgba(0,0,0,0.40);
  cursor:pointer;
  touch-action: manipulation;
}
.enhWSlot.sel{
  outline: 3px solid rgba(120,220,255,0.75);
  box-shadow: 0 16px 38px rgba(0,0,0,0.50), 0 0 0 3px rgba(120,220,255,0.14);
}
.enhWSlot:active{ transform: translateY(1px) scale(0.99); }

.enhWSlot img{
  width:100%; height:100%;
  object-fit: cover;
  filter: drop-shadow(0 8px 14px rgba(0,0,0,0.35));
}

.enhWSlot .wName{
  position:absolute;
  left:8px; right:8px;
  bottom:8px;
  padding: 6px 8px;
  border-radius: 14px;
  font:900 13px/1.15 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  color: rgba(255,255,255,0.96);
  background: rgba(0,0,0,0.42);
  text-shadow: 0 2px 10px rgba(0,0,0,0.55);
}

#enhanceConfirm{
  margin-top: 14px;
  padding-top: 14px;
  border-top: 1px solid rgba(255,255,255,0.12);
  display:none;
  flex-direction:column;        /* ✅ 모바일: 세로로 크게 */
  gap: 12px;
  align-items:stretch;
}
#enhanceConfirm.show{ display:flex; }

#enhanceQuestion{
  font: 900 16px/1.25 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  color: rgba(255,255,255,0.94);
  letter-spacing: -0.01em;
}

.enhBtn{
  appearance:none;
  border:none;
  cursor:pointer;
  padding: 14px 16px;
  border-radius: 16px;
  font: 900 16px/1 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  color: rgba(255,255,255,0.96);
  outline: 2px solid rgba(255,255,255,0.18);
  box-shadow: 0 12px 26px rgba(0,0,0,0.40);
  touch-action: manipulation;
}
.enhBtn:active{ transform: translateY(1px) scale(0.99); filter: brightness(0.98); }
#enhYes{ background: rgba(83,172,72,0.92); }
#enhNo{ background: rgba(255,255,255,0.12); }

@media (max-width: 520px){
  #enhanceBox{
    width: calc(100vw - 14px);
    max-height: 70vh;
    border-radius: 18px;
  }
  #enhanceHead{ padding: 14px 14px; }
  #enhanceTitle{ font-size: 18px; }
  #enhanceClose{ padding: 12px 14px; font-size: 15px; }
  #enhanceBody{ padding: 14px 12px 16px; }
  #enhanceGrid{ gap: 12px; }
  .enhWSlot{ border-radius: 18px; }
  .enhWSlot .wName{ font-size: 13px; }
  #enhanceQuestion{ font-size: 16px; }
  .enhBtn{ font-size: 16px; padding: 14px 16px; }
}




/* === BLACKSMITH UI THEME (mobile-first) === */
#enhanceHead{
  gap:10px;
}
#enhanceHead .enhHeadLeft{
  display:flex;
  flex-direction:column;
  gap:3px;
  min-width:0;
}
#enhanceSub{
  font:800 11px/1.15 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  color: rgba(255,255,255,0.68);
  letter-spacing: .01em;
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
}
#enhanceHint{
  font:900 13px/1.2 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  color: rgba(255,255,255,0.88);
  margin: 4px 2px 10px;
  letter-spacing:.01em;
}

/* 패널 톤: 대장장이(따뜻한 금속/화로 느낌) */
#enhanceBox{
  background: radial-gradient(120% 120% at 30% 20%, rgba(255,190,90,0.10), rgba(20,24,28,0.92) 55%),
              radial-gradient(120% 140% at 70% 80%, rgba(120,220,255,0.06), rgba(20,24,28,0) 60%),
              rgba(20,24,28,0.92);
  outline:1px solid rgba(255,220,160,0.14);
}
#enhanceHead{
  background: linear-gradient(180deg, rgba(255,210,120,0.14), rgba(0,0,0,0));
}
#enhanceClose{
  background: rgba(255,255,255,0.10);
  outline: 1px solid rgba(255,220,160,0.18);
}
#enhanceTitle{
  font: 1000 15px/1.1 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
}

/* 2x4 크게: 슬롯 크기 키우고 간격 넓힘 */
#enhanceGrid{
  display:grid;
  grid-template-columns: repeat(4, 1fr);
  gap: 12px;
}
.enhWSlot{
  border-radius: 16px;
  outline: 2px solid rgba(255,255,255,0.12);
  background: rgba(255,255,255,0.07);
}
.enhWSlot.sel{
  outline: 3px solid rgba(255,210,120,0.55);
  box-shadow: 0 14px 34px rgba(0,0,0,0.42), 0 0 0 2px rgba(255,210,120,0.16);
}
.enhWSlot .wName{
  font:900 11px/1.15 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  padding: 6px 8px;
  background: rgba(0,0,0,0.42);
}

/* 하단 대사/버튼: 엄지영역에 크게 */
#enhanceConfirm{
  margin-top: 14px;
  padding-top: 14px;
  border-top: 1px solid rgba(255,255,255,0.10);
  background: linear-gradient(180deg, rgba(255,255,255,0.05), rgba(0,0,0,0));
  border-radius: 14px;
  padding-left: 10px;
  padding-right: 10px;
  padding-bottom: 12px;
}
#enhanceQuestion{
  font: 1000 14px/1.25 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  color: rgba(255,255,255,0.94);
  margin: 4px 0 12px;
  letter-spacing: .01em;
}
#enhanceConfirm .enhActions{
  display:flex;
  gap: 10px;
  width:100%;
}
#enhYes, #enhNo{
  flex:1 1 0;
  padding: 14px 14px;
  border-radius: 16px;
  font: 1000 14px/1 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
}
#enhYes{
  background: linear-gradient(180deg, rgba(255,180,80,0.95), rgba(255,120,40,0.88));
  outline: 1px solid rgba(255,220,160,0.35);
}
#enhNo{
  background: rgba(255,255,255,0.10);
  outline: 1px solid rgba(255,255,255,0.16);
}

/* 모바일에서 더 크게 */
@media (max-width: 520px){
  #enhanceBox{
    width: min(420px, calc(100vw - 20px));
    max-height: min(56vh, 520px);
  }
  #enhanceGrid{ gap: 12px; }
  #enhanceHint{ font-size: 14px; }
  #enhanceQuestion{ font-size: 15px; }
  #enhYes, #enhNo{ padding: 16px 14px; font-size: 15px; }
}

/* === AUTO HUNT BUTTON (above skill slots) === */
#autoBtn{
  position:fixed;
  right:170px;
  /* skillHud height: 70*3 + gap(8*2)=226. Put button 14px above that */
  bottom: calc(12px + 226px + 14px);
  z-index: 9300;
  pointer-events:auto;
  appearance:none;
  border:none;
  cursor:pointer;

  padding: 10px 14px;
  border-radius: 16px;

  /* 기본 상태(OFF): 유리 느낌 + 얇은 외곽선 */
  background: linear-gradient(180deg, rgba(255,255,255,0.12), rgba(255,255,255,0.06));
  outline: 2px solid rgba(255,255,255,0.18);
  box-shadow:
    0 14px 32px rgba(0,0,0,0.38),
    0 0 0 2px rgba(120,220,255,0.12),
    inset 0 0 0 1px rgba(0,0,0,0.12);

  backdrop-filter: blur(3px);
  -webkit-tap-highlight-color: transparent;

  display:flex;
  align-items:center;
  justify-content:center;

  transition: outline-color .12s ease, outline-width .12s ease, box-shadow .12s ease, filter .12s ease, transform .08s ease;
}

/* 텍스트(OFF) */
#autoBtn .autoIcon{
  display:inline-block;
  font: 900 12px/1 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  letter-spacing: 0.18em;
  text-transform: uppercase;
  color: rgba(255,255,255,0.92);
  text-shadow: 0 2px 10px rgba(0,0,0,0.45);
}

/* ✅ ON: 외곽선 강조 + 글씨 색을 외곽선 색과 동일하게 */
#autoBtn.on{
  outline-width: 3px; /* 조금 더 굵게 */
  outline-color: rgba(120,220,255,0.72);
  box-shadow:
    0 14px 34px rgba(0,0,0,0.42),
    0 0 0 2px rgba(120,220,255,0.30),
    0 0 26px rgba(120,220,255,0.22),
    inset 0 0 0 1px rgba(0,0,0,0.10);
}
#autoBtn.on .autoIcon{
  color: rgba(120,220,255,0.92); /* 외곽선과 동일 톤 */
  text-shadow:
    0 2px 10px rgba(0,0,0,0.45),
    0 0 18px rgba(120,220,255,0.35);
}

/* 클릭 피드백 */
#autoBtn:active{
  transform: translateY(1px) scale(0.99);
  filter: brightness(0.98);
}
#autoBtn:focus-visible{
  outline-color: rgba(120,220,255,0.85);
  box-shadow: 0 0 0 4px rgba(120,220,255,0.18), 0 14px 34px rgba(0,0,0,0.42);
}


/* 모바일 스킬 슬롯 크기(64px, gap7*2=14) => 높이 64*3+14=206 */
@media (max-width: 520px){
  #autoBtn{
    right:10px;
    bottom: calc(10px + 206px + 12px);
    padding: 9px 12px;
    border-radius: 14px;
  }
  #autoBtn .label .t{ font-size:11px; }
  #autoBtn .label .s{ font-size:9px; }
}


/* === MAP NAME FX (particle title) === */
#mapNameFx{
  position:fixed;
  left:0;
  top:6vh;                 /* ⬅️ 화면 맨 위가 아니라 중앙-상단 */
  width:100vw;
  height:220px;            /* ⬅️ 중앙 연출용으로 여유 */
  z-index:9050;
  pointer-events:none;
}
@media (max-width:520px){
  #mapNameFx{ height:104px; }
}



/* === WEAPON ENHANCE PANEL (WOOD UI like sample) === */
#enhanceModal{
  z-index: 30000;
  background: rgba(0,0,0,0.35);
  backdrop-filter: blur(1px);
}

/* ✅ 모바일 세로 기준: 인벤 패널/슬롯과 비슷한 덩치로 축소 */
#enhanceBox{
  width: min(420px, calc(100vw - 18px));
  max-height: min(74vh, 520px);
  border-radius: 14px;
  overflow:hidden;

  /* wood-ish */
  background:
    radial-gradient(140% 120% at 30% 20%, rgba(255,235,200,0.14), rgba(0,0,0,0) 55%),
    repeating-linear-gradient(90deg,
      rgba(90,55,26,0.92) 0px,
      rgba(90,55,26,0.92) 14px,
      rgba(82,48,22,0.92) 14px,
      rgba(82,48,22,0.92) 28px),
    linear-gradient(180deg, rgba(255,255,255,0.10), rgba(0,0,0,0.10));
  outline: 2px solid rgba(25,12,4,0.75);
  box-shadow: 0 22px 70px rgba(0,0,0,0.65), inset 0 0 0 2px rgba(255,210,150,0.08);
}

#enhanceHead{
  padding: 12px 14px 10px;
  background: linear-gradient(180deg, rgba(0,0,0,0.18), rgba(0,0,0,0));
  border-bottom: 2px solid rgba(0,0,0,0.25);
}
#enhanceTitle{
  font: 1000 15px/1.1 "Black Han Sans","Noto Sans KR",system-ui,sans-serif;
  color: rgba(255,235,210,0.98);
  text-shadow: 0 2px 0 rgba(0,0,0,0.35);
  letter-spacing: -0.01em;
}
#enhanceClose{
  display:none; /* 샘플 UI처럼 하단 버튼으로만 종료 */
}

#enhanceBody{
  padding: 10px 10px 12px;
}
#enhanceHint{
  margin: 0 0 8px;
  font: 800 12px/1.2 "Gowun Batang","Noto Sans KR",system-ui,serif;
  color: rgba(255,255,255,0.78);
  text-shadow: 0 1px 0 rgba(0,0,0,0.35);
}

/* 4x3 slot grid (like sample) */
#enhanceGrid{
  grid-template-columns: repeat(4, 1fr);
  gap: 8px;                  /* ✅ 인벤 슬롯 느낌으로 간격 축소 */
}
.enhWSlot{
  border-radius: 10px;       /* ✅ 인벤 슬롯처럼 */
  background: rgba(25,31,22,0.75);
  outline: 1.5px solid rgba(35,18,6,0.70);
  box-shadow:
    inset 0 2px 0 rgba(255,230,190,0.08),
    inset 0 -8px 18px rgba(0,0,0,0.35),
    0 6px 14px rgba(0,0,0,0.26);
}
.enhWSlot img{
  border-radius: 10px;
  opacity: 0.98;
}
.enhWSlot .wName{
  left:6px; right:6px; bottom:6px;
  border-radius: 10px;
  padding: 6px 8px;

  /* ✅ 감성 폰트 */
  font: 800 12px/1.12 "Gowun Batang","Noto Sans KR",system-ui,serif;
  letter-spacing: 0.02em;

  color: rgba(255,245,230,0.96);
  background: rgba(0,0,0,0.44);
  text-shadow: 0 2px 10px rgba(0,0,0,0.55);
}
.enhWSlot.sel{
  outline: 3px solid rgba(255,210,120,0.75);
  box-shadow:
    inset 0 2px 0 rgba(255,230,190,0.10),
    inset 0 -10px 22px rgba(0,0,0,0.40),
    0 10px 22px rgba(0,0,0,0.38),
    0 0 0 2px rgba(255,210,120,0.18);
}

/* bottom confirm bar */
#enhanceConfirm{
  margin-top: 10px;
  padding-top: 10px;
  border-top: 2px solid rgba(0,0,0,0.25);
  background: linear-gradient(180deg, rgba(0,0,0,0.12), rgba(0,0,0,0.00));
  border-radius: 12px;
}
#enhanceQuestion{
  font: 900 13px/1.25 "Gowun Batang","Noto Sans KR",system-ui,serif;
  color: rgba(255,235,210,0.96);
  text-shadow: 0 1px 0 rgba(0,0,0,0.35);
}

#enhYes, #enhNo{
  border-radius: 10px;
  outline: 2px solid rgba(25,12,4,0.55) !important;
  box-shadow: inset 0 2px 0 rgba(255,255,255,0.10), 0 10px 18px rgba(0,0,0,0.30);
  font: 1000 13px/1 "Black Han Sans","Noto Sans KR",system-ui,sans-serif;
  padding: 12px 10px;
}
#enhYes{
  background: linear-gradient(180deg, rgba(255,170,70,0.95), rgba(210,110,38,0.92)) !important;
}
#enhNo{
  background: linear-gradient(180deg, rgba(170,105,48,0.90), rgba(120,70,30,0.90)) !important;
  color: rgba(255,235,210,0.92);
}

/* ✅ 모바일 세로 최적화: 인벤 패널 크기/슬롯 체감으로 더 축소 */
@media (max-width: 520px){
  #enhanceBox{
    width: min(92vw, 340px);          /* 인벤 패널과 동일 감각 */
    max-height: min(78vh, 520px);
  }
  #enhanceHead{ padding: 11px 12px 9px; }
  #enhanceTitle{ font-size: 14px; }
  #enhanceBody{ padding: 9px 9px 11px; }
  #enhanceGrid{ gap: 7px; }
  .enhWSlot{ border-radius: 10px; }
  .enhWSlot .wName{ font-size: 11px; padding: 5px 7px; }
  #enhanceQuestion{ font-size: 12px; }
  #enhYes, #enhNo{ padding: 12px 10px; font-size: 13px; }
}
/* === /WEAPON ENHANCE PANEL (WOOD UI) === */

/* === ENHANCE PANEL: DRAG + 4x3 + ICON SCALE (2026-01-04) === */
#enhanceBox{
  position: fixed;            /* allow drag */
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
}
#enhanceBox.dragging{ transition:none !important; }
#enhanceHead{
  cursor: grab;
  touch-action: none;
}
#enhanceBox.dragging #enhanceHead{ cursor: grabbing; }

/* top question bigger */
#enhanceTitle{
  font-size: 18px !important;
  letter-spacing: -0.02em;
}

/* grid: 4 columns x 3 rows */
#enhanceGrid{
  grid-template-columns: repeat(4, 1fr) !important;
  grid-auto-rows: 1fr;
}

/* slot icon scale down ~30% */
.enhWSlot{
  position: relative;
  display:flex;
  align-items:center;
  justify-content:center;
}
.enhWSlot img{
  width: 70% !important;
  height: 70% !important;
  object-fit: contain !important;
}

/* keep name readable */
.enhWSlot .wName{
  font-size: 11px !important;
}

/* empty placeholder slots */
.enhWSlot.empty{
  cursor: default;
  opacity: 0.55;
}
.enhWSlot.empty::after{
  content:"";
  position:absolute; inset:0;
  background: radial-gradient(circle at 30% 25%, rgba(255,255,255,0.10), transparent 55%);
  pointer-events:none;
}


/* === ENHANCE PANEL OVERRIDES: MATCH INVENTORY SIZE/SLOTS (2026-01-04) === */
#enhanceBox{
  width: 340px !important;
  height: 420px !important;
  max-height: none !important;
}
@media (max-width: 520px){
  #enhanceBox{
    width: min(92vw, 340px) !important;
    height: min(70vh, 420px) !important;
  }
}

/* 인벤 슬롯 감각으로: 바디를 인벤 그리드 컨테이너처럼 */
#enhanceBody{
  flex: 1 1 auto !important;
  margin-top: 10px !important;
  background: rgba(34,34,34,0.50) !important;
  border-radius: 12px !important;
  padding: 12px !important;
  box-shadow: inset 0 0 0 1px rgba(0,0,0,0.25) !important;
}

/* 4x3 유지 */
#enhanceGrid{
  grid-template-columns: repeat(4, 1fr) !important;
  grid-template-rows: repeat(3, 1fr) !important;
  gap: 10px !important; /* 인벤 gap과 동일 */
}

/* 슬롯 크기/스타일 = 인벤 슬롯 */
.enhWSlot{
  border-radius: 10px !important;
  background: rgba(25,31,22,0.85) !important;
  border: 1.5px solid rgba(60,110,58,0.55) !important;
  box-shadow: 0 2px 8px rgba(0,0,0,0.18) !important;
  overflow: hidden !important;
  display:flex !important;
  align-items:center !important;
  justify-content:center !important;
  position:relative !important;
}

/* ✅ 무기 이미지는 줄이지 말고 슬롯에 딱 맞게 */
.enhWSlot img{
  width: 100% !important;
  height: 100% !important;
  object-fit: cover !important;
  display:block !important;
  border-radius: 0 !important;
  filter: none !important;
}

/* 선택 테두리 */
.enhWSlot.sel{
  outline: 3px solid rgba(120,220,255,0.75) !important;
  box-shadow: 0 10px 22px rgba(0,0,0,0.25), 0 0 0 2px rgba(120,220,255,0.14) !important;
}

/* 슬롯명 폰트 */
.enhWSlot .wName{
  font: 800 12px/1.12 "Gowun Batang","Noto Sans KR",system-ui,serif !important;
  left:6px !important; right:6px !important; bottom:6px !important;
  padding: 6px 8px !important;
  border-radius: 10px !important;
}

/* 서브 판넬: 처음부터 보이되, 선택 전엔 버튼 숨김 */
#enhanceConfirm{
  display:flex !important;
}
#enhanceConfirm .enhActions{
  display:none;
}
#enhanceConfirm.armed .enhActions{
  display:flex;
}
/* === /ENHANCE PANEL OVERRIDES === */


/* ✅ 대표님 요청: 하단 기본 문구(강화할 무기를 선택하세요) 숨기고, 선택 후에만 질문 표시 */
#enhanceConfirm:not(.armed) #enhanceQuestion{
  display:none !important;
}
/* ✅ 대표님 요청: 강화 슬롯 하단 무기명(+n 포함)은 굵게 하지 않기 */
.enhWSlot .wName{
  font-weight:400 !important;
}


/* === OVERRIDE: badges/text only (no panel background) === */
.invSlot .equipMark,
.invSlot .enhBadge,
.enhWSlot .enhBadge{
  background: transparent !important;
  outline: none !important;
  box-shadow: none !important;
  border-radius: 0 !important;
  padding: 0 !important;
  min-width: auto !important;
  width: auto !important;
  height: auto !important;
}
/* keep readable text over icons */
.invSlot .equipMark{
  left:6px !important;
  top:6px !important;
  font: 900 14px/1 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif !important;
  color: rgba(255,255,255,0.98) !important;
  text-shadow: 0 2px 10px rgba(0,0,0,0.65) !important;
}
.invSlot .enhBadge{
  right:6px !important;
  top:6px !important;
  font: 900 13px/1 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif !important;
  color: rgba(255,255,255,0.98) !important;
  text-shadow: 0 2px 10px rgba(0,0,0,0.65) !important;
}
.enhWSlot .enhBadge{
  right:6px !important;
  bottom:6px !important;
  font: 900 13px/1 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif !important;
  color: rgba(255,255,255,0.98) !important;
  text-shadow: 0 2px 10px rgba(0,0,0,0.65) !important;
}
/* === /OVERRIDE === */

/* === OVERRIDE: enhance slot name text only (no panel) === */
.enhWSlot .wName{
  background: transparent !important;
  box-shadow: none !important;
  outline: none !important;
  border-radius: 0 !important;
  padding: 0 !important;

  /* keep it readable */
  font-weight: 500 !important;
  color: rgba(255,245,230,0.96) !important;
  text-shadow: 0 2px 10px rgba(0,0,0,0.65) !important;

  left:6px !important;
  right:6px !important;
  bottom:6px !important;
  text-align: center !important;
}
/* === /OVERRIDE === */



/* === START BUTTON CENTER ON TITLE IMAGE === */
.titleImageWrap{
  position: relative;
  display: inline-block;
}
.startBtn.centerOnTitle{
  position: absolute;
  left: 50%;
  top: 50%;
  transform: translate(-50%, -50%);
  margin: 0;
}





/* === START BUTTON TUNING (EMOTIONAL, THICK) === */
.startBtn.centerOnTitle{
  /* 위치: 중앙보다 살짝 아래 */
  top: 60%;

  /* 감성 폰트(두껍게) */
  font-family: "Black Han Sans","Gowun Batang","Noto Sans KR",system-ui,sans-serif;
  font-size: 20px;
  letter-spacing: 0.06em;

  /* 감성 패널 디자인 */
  padding: 16px 26px;
  width: min(240px, 70vw);
  border-radius: 18px;

  background:
    radial-gradient(120% 140% at 30% 20%, rgba(255,240,210,0.35), rgba(0,0,0,0) 55%),
    linear-gradient(180deg, rgba(255,190,90,0.92), rgba(210,110,38,0.90));
  color: rgba(255,255,255,0.96);

  outline: 2px solid rgba(255,235,210,0.35);
  box-shadow:
    0 18px 44px rgba(0,0,0,0.55),
    0 0 22px rgba(255,190,90,0.22),
    inset 0 2px 0 rgba(255,255,255,0.18),
    inset 0 -10px 18px rgba(0,0,0,0.18);

  text-shadow:
    0 2px 0 rgba(0,0,0,0.30),
    0 0 14px rgba(255,220,160,0.22);

  transition: transform .10s ease, filter .12s ease, outline-color .12s ease, box-shadow .12s ease;
}
.startBtn.centerOnTitle:hover{
  filter: brightness(1.06);
  outline-color: rgba(255,245,230,0.55);
  box-shadow:
    0 18px 46px rgba(0,0,0,0.58),
    0 0 28px rgba(255,200,110,0.28),
    inset 0 2px 0 rgba(255,255,255,0.20),
    inset 0 -10px 18px rgba(0,0,0,0.18);
}
.startBtn.centerOnTitle:active{
  transform: translate(-50%, -50%) translateY(2px) scale(0.99);
  filter: brightness(0.98);
}
.startBtn.centerOnTitle:focus-visible{
  outline-color: rgba(120,220,255,0.80);
  box-shadow:
    0 0 0 4px rgba(120,220,255,0.22),
    0 18px 44px rgba(0,0,0,0.55),
    inset 0 2px 0 rgba(255,255,255,0.18),
    inset 0 -10px 18px rgba(0,0,0,0.18);
}


/* === START HINT UNDER BUTTON === */
.startHintUnderBtn{
  margin-top: 10px;
  font-family: "Gowun Batang","Noto Sans KR",system-ui,serif;
  font-size: 13px;
  letter-spacing: 0.02em;
  color: rgba(255,255,255,0.75);
  text-align: center;
  text-shadow: 0 2px 10px rgba(0,0,0,0.45);
}


/* === EQUIP PANEL DRAG HANDLE (match inventory feel) === */
#equipPanel .statHeader{ cursor: grab; touch-action: none; user-select:none; }
#equipPanel.dragging .statHeader{ cursor: grabbing; }


/* === DAGGER PICKUP TEXT COLOR SPLIT === */
.pickup-dagger{ color:#FFE650; }
.pickup-rest{ color:#FAFAD2; }



/* === INFO LOG PANEL (EXP / ITEM) === */
#infoLogPanel{
  position: fixed;
  left: 12px;
  bottom: 12px;
  width: 120px;
  height: 180px;
  /* 거의 안 보일 정도로 아주 옅은 검정 */
  background: rgba(0,0,0,0.18);
  border: 1px solid rgba(255,255,255,0.06);
  border-radius: 12px;
  box-shadow: 0 10px 18px rgba(0,0,0,0.16);
  z-index: 9300;          /* 트위치(#twChatHud) 위, 버튼(#chatToggleBtn) 아래로 의도 */
  pointer-events: none;   /* 클릭 방해 금지 */
  backdrop-filter: blur(1px);
}
#infoLogInner{
  position: absolute;
  left: 10px; right: 10px; top: 10px; bottom: 10px;
  overflow: hidden;                 /* 윗 라인에서 덮여서 사라짐 */
  display: flex;
  flex-direction: column;
  justify-content: flex-end;         /* 아래에서부터 차곡차곡 */
  gap: 6px;
}
#infoLogInner .infoLine{
  display: block;
  flex: 0 0 auto;
  flex-shrink: 0;
  font: 700 12px/1.25 system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR",sans-serif;
  color: #FAFAD2;
  text-shadow: 0 2px 10px rgba(0,0,0,0.55);
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;

  /* 새 문구가 들어오면 살짝 '밀려 올라오는' 느낌만 */
  opacity: 1;
  transform: translateY(6px);
  animation: infoEnter 0.22s ease-out forwards;
}
@keyframes infoEnter{
  from { opacity: 0.0; transform: translateY(10px); }
  to   { opacity: 1.0; transform: translateY(0px); }
}


/* === PWA INSTALL BUTTON (Android Chrome) === */
#pwaInstallBtn{
  position: fixed;
  top: 136px;              /* ✅ 장비상태 버튼 아래 */
  right: 12px;
  z-index: 1200;
  transition: transform 0.15s ease, opacity 0.25s ease, filter 0.12s ease;
  background: rgba(34, 36, 40, 0.55);
  color: rgba(255,255,255,0.96);
  font-size: 15px;
  font-family: 'Pretendard', 'GmarketSans', Arial, sans-serif;
  font-weight: 900;
  padding: 4px 14px;
  border-radius: 6px;
  border: none;
  cursor: pointer;
  box-shadow: 0 2px 8px #1115;
  letter-spacing: 0.5px;
  display: none;           /* ✅ 설치 가능할 때만 보이게 */
  align-items: center;
  gap: 7px;
  -webkit-tap-highlight-color: transparent;
}
#pwaInstallBtn:hover{ filter: brightness(1.08); background: rgba(120,220,255,0.35); }
#pwaInstallBtn:active{ transform: translateY(1px) scale(0.99); filter: brightness(0.95); }
#pwaInstallBtn .icon{ font-size: 18px; margin-right: 2px; }

@media (max-width: 520px){
  #pwaInstallBtn{ top: 132px; right: 10px; font-size: 14px; padding: 4px 12px; }
}

</style>
<meta content="frame-src https://www.twitch.tv https://player.twitch.tv; child-src https://www.twitch.tv https://player.twitch.tv;" http-equiv="Content-Security-Policy"/>

  <!-- ✅ PWA (Android 설치 버튼용) -->
  <link rel="manifest" href="./manifest.json">
  <meta name="theme-color" content="#000000">
  <link rel="apple-touch-icon" href="./icon-192.png">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">

</head>
<body>
<audio id="applySound" src="bb.ogg"></audio>
<audio id="statUpSound" src="bb.ogg"></audio>
<audio id="statBtnSound" src="bb.ogg"></audio>
<audio id="invBtnSound" src="ch.ogg"></audio>
<audio id="equipSound" src="jangkuy.ogg"></audio>
<audio id="statPlusSound" src="coh.ogg"></audio>
<audio id="enhanceSuccessSound" src="good.ogg"></audio>
<audio id="petDieSfx" preload="auto" src="acd.wav"></audio>
<audio id="enhanceBreakSound" src="silpea.ogg"></audio>
<audio id="enhanceResetSound" src="dop.ogg"></audio>
<audio id="levelUpSound" src="up.ogg"></audio>
<canvas id="game"></canvas>
<!-- ✅ MAP NAME FX (top center) -->
<canvas aria-hidden="true" id="mapNameFx"></canvas>
<!-- 스탯버튼 -->
<button id="statBtn"><span class="icon">📊</span> <span class="statText">스탯분배</span></button>
<div class="startHintUnderBtn" id="startHint">게임시작을 누르면 게임이 시작됩니다.</div>
<div class="startHintUnderBtn">게임시작을 누르면 게임이 시작됩니다.</div>
<button id="invBtn"><span class="icon">🎒</span> <span class="statText">인벤토리</span></button>
<button id="equipStatusBtn"><span class="icon">🛡️</span> <span class="statText">장비스탯</span></button>
<button id="pwaInstallBtn" title="홈 화면에 게임 아이콘 설치"><span class="icon">⬇️</span><span>설치</span></button>

<!-- 스탯 패널 -->
<div class="hide" id="statPanel">
<div class="statHeader">
<span class="statPoint">스탯포인트: <span id="statPoints">0</span></span>
<button class="btn close" type="button">Close</button>
</div>
<div class="statList" id="statList"></div>
</div>
<!-- 인벤토리 패널 -->
<div class="hide" id="invPanel">
<div class="statHeader">
<span class="statPoint">인벤토리</span>
<div class="invHeaderBtns">
<button class="btn sell" id="sellOpenBtn" type="button">Sell</button>
<button class="btn shop" id="shopOpenBtn" type="button">Shop</button>
<button class="btn close" type="button">Close</button>
</div>
</div>
<div class="invGrid" id="invGrid"></div>
<div class="invPager">
<button aria-label="이전 페이지" class="invArrow" id="invPrev" type="button">◀</button>
<div class="invPageText" id="invPageText">1 / 1</div>
<button aria-label="다음 페이지" class="invArrow" id="invNext" type="button">▶</button>
</div>
</div>
<!-- === SHOP PANEL === -->
<div class="hide" id="shopPanel">
<div class="statHeader">
<span class="statPoint">상점</span>
<button class="btn close" id="shopCloseBtn" type="button">Close</button>
</div>
<div class="shopList" id="shopList"></div>
</div>
<!-- === SELL PANEL === -->
<div class="hide" id="sellPanel">
<div class="statHeader">
<span class="statPoint">판매</span>
<div class="invHeaderBtns">
<button class="btn sell" id="sellAllBtn" type="button">일괄판매</button>
<button class="btn close" id="sellCloseBtn" type="button">Close</button>
</div>
</div>
<div class="sellList" id="sellList"></div>
<div class="sellHint hide" id="sellHint">일괄판매할 아이템을 클릭하세요.</div>
</div>
<!-- === /SHOP PANEL === -->
<!-- 장비 상태 패널 -->
<div class="hide" id="equipPanel">
<div class="statHeader">
<span class="statPoint">장비/스탯</span>
<button class="btn close" type="button">Close</button>
</div>
<div class="equipGrid" id="equipGrid"></div>
<div class="equipFooter" id="equipFooter">
<div class="equipFooterGrid">
<div class="col">
<div class="line"><span class="k">공격력</span><span class="v" id="eq_atk">0</span></div>
<div class="line"><span class="k">물리방어</span><span class="v" id="eq_pdef">0</span></div>
<div class="line"><span class="k">마법방어</span><span class="v" id="eq_mdef">0</span></div>
</div>
<div class="col">
<div class="line"><span class="k">치명확률</span><span class="v" id="eq_critChance">0%</span></div>
<div class="line"><span class="k">치명타</span><span class="v" id="eq_critMult">x1.50</span></div>
<div class="line"><span class="k">공격속도</span><span class="v" id="eq_aspd">0%</span></div>
</div>
</div>
</div>
</div>

<div id="statApplyAlert" style="
    display:none;
    position:fixed;
    left:50%; top:19%;
    transform:translate(-50%, 0);
    background:transparent;
    color:#bfff7f;
    font-weight:700;
    font-size:18px;
    padding:0;
    border-radius:0;
    box-shadow:none;
    z-index:10000;
    letter-spacing:2px;
    text-align:center;
    user-select:none;
    opacity:0.98;
  ">적용되었습니다.</div>
<div id="statHud">
<div class="hudBar hp" style="position:relative;">
<div class="hudFill hp" id="hpFill"></div>
<div class="hudText"><span class="label">HP:</span><span class="value" id="hpText">0/0</span></div>
</div>
<div class="hudBar mp" style="position:relative;">
<div class="hudFill mp" id="mpFill"></div>
<div class="hudText"><span class="label">MP:</span><span class="value" id="mpText">0/0</span></div>
</div>
<div class="hudBar exp" style="position:relative;">
<div class="hudFill exp" id="expFill"></div>
<div class="hudText"><span class="label">EXP:</span><span class="value" id="expText">0/0</span></div>
</div>
<div id="welcomeMsg">#전사키우기 rpg 접속을 환영합니다.</div>
<!-- === SKILL SLOTS HUD (3x3) === -->
<div aria-label="skill slots" id="skillHud">
<!-- data-skill: 1~9 -->
<div class="skillSlot" data-skill="1"><div class="cd"></div><div class="icon">⚡</div><div class="key">1</div><div class="cdText"></div></div>
<div class="skillSlot" data-skill="2"><div class="cd"></div><div class="icon">🔥</div><div class="key">2</div><div class="cdText"></div></div>
<div class="skillSlot" data-skill="3"><div class="cd"></div><div class="icon">🛡️</div><div class="key">3</div><div class="cdText"></div></div>
<div class="skillSlot" data-skill="4"><div class="cd"></div><div class="icon">💨</div><div class="key">4</div><div class="cdText"></div></div>
<div class="skillSlot" data-skill="5"><div class="cd"></div><div class="icon">✨</div><div class="key">5</div><div class="cdText"></div></div>
<div class="skillSlot" data-skill="6"><div class="cd"></div><div class="icon">❄️</div><div class="key">6</div><div class="cdText"></div></div>
<div class="skillSlot" data-skill="7"><div class="cd"></div><div class="icon">🗡️</div><div class="key">7</div><div class="cdText"></div></div>
<div class="skillSlot" data-skill="8"><div class="cd"></div><div class="icon">🌙</div><div class="key">8</div><div class="cdText"></div></div>
<div class="skillSlot" data-skill="9"><div class="cd"></div><div class="icon">🍀</div><div class="key">9</div><div class="cdText"></div></div>
</div>
</div>
<!-- === AUTO HUNT BUTTON (above skill slots) === -->
<button aria-label="자동사냥 토글" id="autoBtn" type="button">
<span class="autoIcon">AUTO</span>
</button>
<!-- ✅ 가상 조이스틱 (모바일/PC 공용: 터치/마우스 누르면 생성) -->
<div aria-hidden="true" id="joy">
<div id="joyBase"></div>
<div id="joyKnob"></div>
</div>
<!-- ✅ 채팅 접기/펼치기 버튼 (항상 최상단) -->
<button aria-label="채팅 접기/펼치기" aria-pressed="true" id="chatToggleBtn" type="button">채팅 접기</button>
<!-- ✅ Info Log Panel (between chat toggle and twitch chat, layered) -->
<div aria-hidden="true" id="infoLogPanel"><div id="infoLogInner"></div></div>
<!-- ✅ 트위치 채팅 HUD (좌측 하단 고정 / 반투명) -->
<div aria-label="twitch chat hud" id="twChatHud">
<iframe allow="autoplay" id="twChatFrame" loading="lazy"></iframe>
<div aria-label="resize chat" id="twResizeHandle" title="Resize chat"></div>
</div>
<iframe allow="autoplay" class="twitchChatIframe" id="twitchChatIframe" loading="lazy"></iframe>
<!-- ✅ 최초 진입 타이틀 화면 -->
<div aria-label="title screen" class="titleOverlay" id="titleOverlay">
<div class="titleCard">
<!-- ✅ 타이틀 이미지 -->
<div class="titleImageWrap">
<img alt="전사키우기 타이틀" class="titleImage" src="tt.png"/>
<button class="startBtn centerOnTitle" id="startBtn" type="button">게임시작</button>
</div>
</div>
</div>
<script>
// === MONSTER DIE SOUNDS ===
const sndRabbitDie = new Audio("rabbit.ogg");
sndRabbitDie.volume = 0.8;
const sndCatDie = new Audio("cat1.ogg");
sndCatDie.volume = 0.8;


/* =========================
   MAP NAME FX (top canvas)
   - fade in (0.55s) -> hold (2.0s) -> fade out (0.75s)
   - light particle drift + shimmer
========================= */
(function(){
  const fx = document.getElementById("mapNameFx");
  if(!fx) return;

  const fctx = fx.getContext("2d");
  let W=0,H=0,DPR=1;

  function resize(){
    DPR = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
    W = Math.floor(window.innerWidth * DPR);
    // height is controlled by CSS; use element's css px height
    const cssH = Math.max(80, Math.floor(fx.getBoundingClientRect().height || 120));
    H = Math.floor(cssH * DPR);
    fx.width = W;
    fx.height = H;
  }
  window.addEventListener("resize", resize, {passive:true});
  resize();

  // state
  let active = null; // {text, start, duration, fadeIn, hold, fadeOut, particles[]}
  let raf = 0;

  function makeParticles(text){
    const parts = [];
    const baseY = Math.floor(H*0.5);
    const cx = Math.floor(W*0.5);

    // offscreen measure
    fctx.save();
    fctx.font = `800 ${Math.floor(26*DPR)}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`;
    const tw = fctx.measureText(text).width;
    fctx.restore();

    const startX = cx - tw/2;

    // create particles per glyph segment
    // sample points along text by drawing into offscreen and scanning alpha
    const off = document.createElement("canvas");
    off.width = Math.floor(tw + 40*DPR);
    off.height = Math.floor(70*DPR);
    const octx = off.getContext("2d");
    octx.clearRect(0,0,off.width,off.height);
    octx.font = `800 ${Math.floor(28*DPR)}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`;
    octx.textBaseline = "alphabetic";
    octx.textAlign = "left";
    // glow shadow into offscreen
    octx.fillStyle = "rgba(255,255,255,1)";
    octx.shadowColor = "rgba(160,240,200,0.75)";
    octx.shadowBlur = 16*DPR;
    octx.fillText(text, 20*DPR, 48*DPR);

    const img = octx.getImageData(0,0,off.width,off.height);
    const data = img.data;

    // sample with stride for performance
    const stride = Math.max(2, Math.floor(2*DPR));
    for(let y=0;y<off.height;y+=stride){
      for(let x=0;x<off.width;x+=stride){
        const a = data[(y*off.width + x)*4 + 3];
        if(a > 80){
          // only take some points
          if((x+y) % (4*stride) !== 0) continue;
          parts.push({
            x: startX + (x-20*DPR),
            y: baseY - (off.height - y) + 18*DPR,
            vx: (Math.random()*0.6-0.3) * DPR,
            vy: (Math.random()*0.35-0.2) * DPR,
            r: (Math.random()*1.4+0.6) * DPR,
            a0: Math.random()*0.45+0.55,
            tw: Math.random()*Math.PI*2,
            life: Math.random()*0.9 + 0.9
          });
        }
      }
    }

    // a few extra sparkles around
    const sparkleN = 26;
    for(let i=0;i<sparkleN;i++){
      parts.push({
        x: cx + (Math.random()*220-110)*DPR,
        y: baseY + (Math.random()*36-40)*DPR,
        vx: (Math.random()*0.9-0.45) * DPR,
        vy: (Math.random()*0.65-0.5) * DPR,
        r: (Math.random()*2.2+1.1) * DPR,
        a0: Math.random()*0.25+0.12,
        tw: Math.random()*Math.PI*2,
        life: Math.random()*0.9 + 0.7,
        sparkle:true
      });
    }

    return parts;
  }

  function easeOutCubic(t){ return 1 - Math.pow(1-t, 3); }
  function easeInOutSine(t){ return -(Math.cos(Math.PI*t)-1)/2; }

  function clear(){
    fctx.clearRect(0,0,W,H);
  }

  function draw(now){
    if(!active){ raf=0; clear(); return; }
    const t = (now - active.start) / 1000;

    const fi = active.fadeIn;
    const hold = active.hold;
    const fo = active.fadeOut;

    let alpha = 0;
    if(t < 0) alpha = 0;
    else if(t < fi) alpha = easeOutCubic(t/fi);
    else if(t < fi + hold) alpha = 1;
    else if(t < fi + hold + fo) alpha = 1 - easeInOutSine((t - fi - hold)/fo);
    else { active = null; clear(); raf=0; return; }

    // background clear with slight trail for softness
    fctx.save();
    fctx.globalCompositeOperation = "source-over";
    fctx.fillStyle = "rgba(0,0,0,0.0)";
    fctx.clearRect(0,0,W,H);

    // subtle fog band
    const gy = Math.floor(H*0.5);
    const grad = fctx.createRadialGradient(W/2, gy, 10*DPR, W/2, gy, 340*DPR);
    grad.addColorStop(0, `rgba(20,28,24,${0.22*alpha})`);
    grad.addColorStop(0.6, `rgba(10,12,12,${0.08*alpha})`);
    grad.addColorStop(1, "rgba(0,0,0,0)");
    fctx.fillStyle = grad;
    fctx.fillRect(0,0,W,H);

    // particles
    const drift = Math.min(1.6, t*0.6);
    for(const p of active.particles){
      p.tw += 0.05;
      const wob = Math.sin(p.tw) * 0.35 * DPR;
      const px = p.x + p.vx * (t*60) * 0.02 + wob;
      const py = p.y + p.vy * (t*60) * 0.02 - drift*0.6*DPR;

      let pa = alpha * p.a0;
      if(p.sparkle){
        pa *= (0.55 + 0.45*Math.sin(p.tw*2.2 + t*3.2));
      }

      fctx.globalAlpha = Math.max(0, Math.min(1, pa));
      fctx.beginPath();
      fctx.arc(px, py, p.r, 0, Math.PI*2);
      fctx.fillStyle = p.sparkle ? "rgba(180,255,220,1)" : "rgba(210,255,240,1)";
      fctx.shadowColor = p.sparkle ? "rgba(120,255,220,0.9)" : "rgba(120,220,255,0.65)";
      fctx.shadowBlur = (p.sparkle ? 14 : 10) * DPR;
      fctx.fill();
    }

    // text layer (crisp)
    fctx.globalAlpha = alpha;
    fctx.shadowBlur = 18*DPR;
    fctx.shadowColor = "rgba(120,255,210,0.45)";
    fctx.fillStyle = "rgba(245,255,250,0.96)";
    fctx.textAlign = "center";
    fctx.textBaseline = "middle";
    fctx.font = `800 ${Math.floor(28*DPR)}px system-ui, -apple-system, Segoe UI, Roboto, sans-serif`;
    fctx.fillText(active.text, W/2, Math.floor(H*0.5));

    // underline shimmer
    const lineW = Math.min(W*0.56, 520*DPR);
    const lx = W/2 - lineW/2;
    const ly = Math.floor(H*0.5) + Math.floor(18*DPR);
    const lg = fctx.createLinearGradient(lx, ly, lx+lineW, ly);
    const wave = (Math.sin(t*2.3)+1)/2;
    lg.addColorStop(0, "rgba(255,255,255,0)");
    lg.addColorStop(Math.max(0, wave-0.18), `rgba(160,255,220,${0.05*alpha})`);
    lg.addColorStop(wave, `rgba(200,255,245,${0.28*alpha})`);
    lg.addColorStop(Math.min(1, wave+0.18), `rgba(160,255,220,${0.05*alpha})`);
    lg.addColorStop(1, "rgba(255,255,255,0)");
    fctx.globalAlpha = 1;
    fctx.fillStyle = lg;
    fctx.fillRect(lx, ly, lineW, Math.max(1, Math.floor(2*DPR)));

    fctx.restore();

    raf = requestAnimationFrame(draw);
  }

  // expose
  window.showMapName = function(text){
    try{
      resize();
      active = {
        text: String(text || "").trim(),
        start: performance.now(),
        fadeIn: 0.55,
        hold: 2.0,
        fadeOut: 0.75,
        particles: []
      };
      active.particles = makeParticles(active.text);
      if(raf){ cancelAnimationFrame(raf); raf=0; }
      raf = requestAnimationFrame(draw);
      }catch(e){
      console.error("showMapName error:", e);
    }
  };
})();

// (moved) map name is triggered after Start (player spawn)
// setTimeout(()=>{ try{ window.showMapName && window.showMapName(mapTitleFor(window.currentMapId || currentMapId)); }catch(_){ } }, 900);


  // ===== 스탯 분배 패널 =====
  const statBtn = document.getElementById('statBtn');
const statBtnSound = document.getElementById('statBtnSound');
const invBtnSound = document.getElementById('invBtnSound');
const equipSound = document.getElementById('equipSound');
function playEquipSound(){
  try{
    if(!equipSound) return;
    equipSound.currentTime = 0;
    equipSound.play().catch(()=>{});
  }catch(_){}
}

  const statPanel = document.getElementById('statPanel');
  const statList = document.getElementById('statList');
  const statPointsEl = document.getElementById('statPoints');
  const statApplyAlert = document.getElementById('statApplyAlert');
  const statUpSound = document.getElementById('statUpSound');
  const statPlusSound = document.getElementById('statPlusSound');
  const applySound = document.getElementById('applySound');

  
    const levelUpSound = document.getElementById('levelUpSound');
  // ✅ 간단 상단 알림(재사용: 강화 성공/실패 등)
  function showTopNotice(msg, ms=850, color=null, html=false){
    try{
      if(!statApplyAlert) return;

      // 기본 색상 기억(처음 1회)
      if(!showTopNotice._baseColor){
        try{ showTopNotice._baseColor = getComputedStyle(statApplyAlert).color; }catch(_){}
      }

      const _msg = (msg==null) ? "" : String(msg);

      if(html){
        statApplyAlert.innerHTML = _msg;
      }else{
        statApplyAlert.textContent = _msg;
      }

      // 색상 적용(옵션)
      try{
        statApplyAlert.style.color = (color ? color : (showTopNotice._baseColor || ""));
      }catch(_){}

      statApplyAlert.style.display = "block";
      statApplyAlert.style.opacity = "0.98";
      clearTimeout(showTopNotice._t);
      showTopNotice._t = setTimeout(()=>{
        try{ statApplyAlert.style.display = "none"; }catch(_){}
        // 다음 알림을 위해 기본 색으로 되돌림
        try{ statApplyAlert.style.color = (showTopNotice._baseColor || ""); }catch(_){}
      }, ms);
    }catch(_){}
  }
  window.showTopNotice = showTopNotice;


  // ===== INFO LOG (EXP / ITEM) =====
  const infoLogPanel = document.getElementById("infoLogPanel");
  const infoLogInner = document.getElementById("infoLogInner");

  function pushInfoLogLine(text){
    try{
      if(!infoLogInner) return;

      const line = document.createElement("div");
      line.className = "infoLine";
      line.textContent = (text==null) ? "" : String(text);
      infoLogInner.appendChild(line);

      // ✅ 차곡차곡 쌓이면서 위로 "밀림"
      // (패널 상단으로 밀려난 오래된 문구는 삭제)
      const MAX_LINES = 10;
      while(infoLogInner.children.length > MAX_LINES){
        infoLogInner.removeChild(infoLogInner.children[0]);
      }
    }catch(_){}
  }
  window.pushInfoLogLine = pushInfoLogLine;


// ===== SKILL HUD (3x3) =====
  const skillHud = document.getElementById("skillHud");
  const skillSlots = Array.from(document.querySelectorAll("#skillHud .skillSlot"));
  

// ===== AUTO HUNT BUTTON (UI) =====
  const autoBtn = document.getElementById("autoBtn");

  // 게임 코드가 이미 player.auto를 사용하고 있을 수 있으니,
  // 전역 플래그(window.autoHunt)도 같이 관리해서 호환되게 만듭니다.
  if (typeof window.autoHunt === "undefined") window.autoHunt = false;

  function setAutoHunt(on){
    const v = !!on;
    window.autoHunt = v;
    try{ if (window.player) window.player.auto = v; }catch(_){}
    updateAutoBtn();
  }

  function toggleAutoHunt(){
    const next = !((window.player && !!window.player.auto) || !!window.autoHunt);
    setAutoHunt(next);

    // 버튼 사운드(있으면) 살짝만
    try{
      const s = document.getElementById("statBtnSound") || document.getElementById("applySound");
      if (s){ s.currentTime = 0; s.play().catch(()=>{}); }
    }catch(_){}
  }

  function updateAutoBtn(){
    if (!autoBtn) return;
    const on = (window.player && !!window.player.auto) || !!window.autoHunt;
    autoBtn.classList.toggle("on", on);
    autoBtn.setAttribute("aria-pressed", on ? "true" : "false");
    const sub = autoBtn.querySelector(".label .s");
    if (sub) sub.textContent = on ? "on" : "off";
  }

  if (autoBtn){
    autoBtn.addEventListener("pointerdown", (e)=>{
      e.preventDefault();
      toggleAutoHunt();
    }, {passive:false});
  }

  // player가 나중에 생성될 수 있으니 루프 중에도 상태 유지
  setInterval(()=>{
    try{
      if (window.player && typeof window.player.auto === "boolean"){
        window.autoHunt = !!window.player.auto;
      } else if (window.player && typeof window.player.auto !== "boolean"){
        // player.auto가 없으면 만들어줌(기존 로직에 영향 최소)
        window.player.auto = !!window.autoHunt;
      }
    }catch(_){}
    updateAutoBtn();
  }, 250);
// ===== /AUTO HUNT BUTTON =====

// 간단 쿨다운(데모): 1~9 각각 쿨다운 시간(초). 실제 스킬 구현 시 여기만 바꾸면 됨.
  const SKILL_CD = { 1:1.8, 2:2.2, 3:3.0, 4:1.2, 5:4.0, 6:2.6, 7:0.9, 8:5.0, 9:2.0 };
  const skillCooldownUntil = {}; // id -> timeSec(절대시간)

  // 게임 루프 쪽에서 쓰는 time(초)을 모르므로, perf.now 기반 자체 타이머 사용
  const nowSec = ()=> performance.now() / 1000;

  function isSkillOnCooldown(id){
    return (skillCooldownUntil[id]||0) > nowSec();
  }
  function setSkillCooldown(id, cdSec){
    const until = nowSec() + Math.max(0, cdSec||0);
    skillCooldownUntil[id] = until;
    const el = skillSlots.find(s=> (s.dataset.skill|0) === (id|0));
    if(!el) return;
    el.classList.add("onCooldown");
  }

  function useSkill(id){
    id = id|0;
    // 패널 열린 상태면 스킬 클릭/키 입력 무시(오동작 방지)
    if (!statPanel.classList.contains("hide") || !invPanel.classList.contains("hide") || (typeof equipPanel!=="undefined" && equipPanel && !equipPanel.classList.contains("hide"))) return;
    try{ const sp = document.getElementById("shopPanel"); if (sp && !sp.classList.contains("hide")) return; }catch(_){ }

    if (isSkillOnCooldown(id)) return;

    // ✅ 여기에서 실제 스킬 효과를 구현하면 됩니다.
    // 지금은 "감성 연출" 용도로만: 아주 약한 화면 흔들림 + 사운드(있으면)
    try{
      // statPlusSound를 짧게 사용(원하면 별도 스킬 사운드 추가 가능)
      if (statPlusSound){
        statPlusSound.currentTime = 0;
        statPlusSound.play().catch(()=>{});
      }
    }catch(_){}

    // 쿨다운 부여
    setSkillCooldown(id, SKILL_CD[id] ?? 1.5);
  }

  // 클릭/터치
  skillSlots.forEach(el=>{
    el.addEventListener("pointerdown", (e)=>{
      e.preventDefault();
      useSkill(el.dataset.skill|0);
    }, {passive:false});
  });

  // 키보드 1~9
  window.addEventListener("keydown", (e)=>{
    if (e.repeat) return;
    const k = e.key;
    if (k >= "1" && k <= "9"){
      useSkill(parseInt(k,10));
    }
  });

  // 쿨다운 UI 갱신 루프(가벼운 requestAnimationFrame)
  (function cooldownLoop(){
    const t = nowSec();
    for (const el of skillSlots){
      const id = el.dataset.skill|0;
      const until = skillCooldownUntil[id]||0;
      const remain = until - t;
      const cdText = el.querySelector(".cdText");
      const cdLayer = el.querySelector(".cd");
      if (remain > 0){
        el.classList.add("onCooldown");
        // 남은 시간 표시(소수 1자리)
        if (cdText) cdText.textContent = remain.toFixed(1);
        // 간단한 채움(위에서 아래로): 남은 비율에 따라 translateY
        const total = SKILL_CD[id] ?? 1.5;
        const ratio = Math.max(0, Math.min(1, remain / total));
        if (cdLayer) cdLayer.style.transform = `translateY(${(1-ratio)*100}%)`;
      }else{
        el.classList.remove("onCooldown");
        if (cdText) cdText.textContent = "";
        if (cdLayer) cdLayer.style.transform = "translateY(100%)";
      }
    }
    requestAnimationFrame(cooldownLoop);
  })();

// ===== 인벤토리 UI =====
const invBtn = document.getElementById("invBtn");
const invPanel = document.getElementById("invPanel");

// ===== 장비상태 UI =====
const equipStatusBtn = document.getElementById("equipStatusBtn");
  // ✅ 버튼 클릭이 월드 입력(조이스틱)으로 흘러가지 않게 차단
  ["pointerdown","pointerup","click"].forEach(ev=>{
    equipStatusBtn.addEventListener(ev, (e)=>{ e.stopPropagation(); }, {passive:false});
  });

const equipPanel = document.getElementById("equipPanel");
  // ✅ 장비 패널 내부 클릭은 "UI 입력"으로 고정 (조이스틱/월드 입력 차단)
  ["pointerdown","click","dblclick","contextmenu"].forEach(ev=>{
    equipPanel.addEventListener(ev, (e)=>{ e.stopPropagation(); }, {passive:false});
  });

const equipGrid = document.getElementById("equipGrid");

// 3x4 슬롯 레이아웃(이미지 느낌대로)
const EQUIP_UI_SLOTS = [
  { key:"ear",    label:"귀걸이", bind:"ear" },
  { key:"helm",   label:"투구",   bind:"helm" },
  { key:"neck",   label:"목걸이", bind:"neck" },

  { key:"tee",    label:"티",     bind:"tee" },
  { key:"armor",  label:"갑옷",   bind:"armor" },
  { key:"cloak",  label:"망토",   bind:"cloak" },

  { key:"ring",   label:"반지",   bind:"ring" },
  { key:"belt",   label:"벨트",   bind:"belt" },
  { key:"shield", label:"방패",   bind:"shield" },

  { key:"weapon", label:"무기",   bind:"weapon" },
  { key:"glove",  label:"장갑",   bind:"glove" },
  { key:"shoe",   label:"신발",   bind:"shoe" },
];

function buildEquipGridOnce(){
  if (!equipGrid) return;
  if (equipGrid.dataset.built === "1") return;
  equipGrid.dataset.built = "1";

  for (const s of EQUIP_UI_SLOTS){
    const d = document.createElement("div");
    d.className = "equipSlot";
    d.dataset.key = s.key;
    d.dataset.bind = (s.bind || s.key);

    const main = document.createElement("div");
    main.className = "main";
    main.textContent = s.label;

    const sub = document.createElement("div");
    sub.className = "sub";
    sub.textContent = "";

    d.appendChild(main);
    d.appendChild(sub);

    // ✅ 장비 슬롯 클릭: 인벤처럼 툴팁 토글
    d.addEventListener("click", (ev)=>{
      try{ ev.preventDefault(); ev.stopPropagation(); }catch(_){ }
      const b = d.dataset.bind || "";
      equipSelectedKey = (equipSelectedKey === b) ? "" : b;
      try{ renderEquipPanel(); }catch(_){ }
    });

    equipGrid.appendChild(d);
  }
}

function isEquipPlaceholder(it, slotKey){
  if (!it) return true;
  const id = String(it.id||"");
  // uid 없으면 기본/빈 장비로 취급
  if (!it.uid){
    if (slotKey === "weapon") return (id === "fist" || id === "" || id === "none");
    if (slotKey === "armor")  return (id === "cloth" || id === "" || id === "none");
    return true;
  }
  // uid가 있어도 id가 none이면 빈 처리
  if (id === "none") return true;
  return false;
}

function renderEquipPanel(){
  try{ buildEquipGridOnce(); }catch(_){}

  const elAtk = document.getElementById("eq_atk");
  const elPdef = document.getElementById("eq_pdef");
  const elMdef = document.getElementById("eq_mdef");
  const elCritC = document.getElementById("eq_critChance");
  const elCritM = document.getElementById("eq_critMult");
  const elAspd = document.getElementById("eq_aspd");

  // equipment / player는 기존 코드의 전역(상단에 const로 정의)
  const eq = (typeof equipment !== "undefined" && equipment) ? equipment : null;
  const pl = (typeof player !== "undefined" && player) ? player : null;

  // 슬롯 텍스트 갱신
  if (equipGrid){
    equipGrid.querySelectorAll(".equipSlot").forEach(slot=>{
      const key = slot.dataset.key;
      const slotDef = EQUIP_UI_SLOTS.find(x=>x.key===key);
      const bind = slotDef?.bind;

      const main = slot.querySelector(".main");
      const sub = slot.querySelector(".sub");
      let badge = slot.querySelector(".badge");
      if (badge) badge.remove();

      if (bind && eq && eq[bind] && !isEquipPlaceholder(eq[bind], bind)){
        const it = eq[bind];
        // ✅ 무기 슬롯: 단검 아이콘을 슬롯에 꽉 차게 표시 (슬롯 레이아웃은 그대로)
        if (bind === "weapon"){
          let iconSrc = (it && (it.icon || it.iconSrc)) ? (it.icon || it.iconSrc) : "";
          // ✅ 맨손(fist) 상태에서는 아이콘/툴팁 없이 텍스트만
          const _isBareHand = !!it && (String(it.id||"") === "fist" || String(it.name||"") === "맨손");
          if (_isBareHand) iconSrc = "";
          if (!iconSrc && (String(it?.name||"").includes("단검"))) iconSrc = "dagger.PNG";
          let img = slot.querySelector("img.eqIcon");
          let cnv = slot.querySelector("canvas.eqCnv");
          if (iconSrc){
            slot.classList.add("hasIcon");

            // ✅ SPRITE 마커면 canvas로 렌더
            if (_isSpriteIcon(iconSrc)){
              if (img) img.remove();
              if (!cnv){
                cnv = document.createElement("canvas");
                cnv.className = "eqCnv";
                cnv.width = 32; cnv.height = 32;
                cnv.style.width = "100%";
                cnv.style.height = "100%";
                cnv.style.imageRendering = "pixelated";
                cnv.style.display = "block";
                slot.insertBefore(cnv, slot.firstChild);
              }
              _drawSpriteToCanvas(cnv, iconSrc);
            }else{
              if (cnv) cnv.remove();
              if (!img){
                img = document.createElement("img");
                img.className = "eqIcon";
                slot.insertBefore(img, slot.firstChild);
              }
              img.src = iconSrc;
            }
          }else{
            slot.classList.remove("hasIcon");
            if (img) img.remove();
          }
        }else{
          slot.classList.remove("hasIcon");
          const img = slot.querySelector("img.eqIcon");
          if (img) img.remove();
        }

        const enh = (it.enhance|0) || 0;
        const nm = (it.name || slotDef.label || "장비");
        if (main) main.textContent = enh>0 ? `${nm}(+${enh})` : nm;

        // 하단에 간단 스탯(무기는 ATK, 방어구는 DEF)
        if (sub){
          if (bind === "weapon"){
            
          }else if (bind === "armor"){
            const _isNoArmor = (String(it?.id||"") === "cloth" && (((it?.def|0)===0) && ((it?.atk|0)===0))) || String(it?.id||"") === "none" || String(it?.name||"") === "천옷" || (String(it?.name||"") === "갑옷" && ((it?.def|0)===0));
            sub.textContent = _isNoArmor ? "" : `DEF +${(it.def|0)||0}`;
          }else{
            sub.textContent = "";
          }
        }

        if (enh > 0){
          badge = document.createElement("div");
          badge.className = "badge";
          badge.textContent = `+${enh}`;
          slot.appendChild(badge);
        }

        // ✅ 장비 슬롯 클릭시 인벤토리처럼 툴팁 표시
        //    (요구사항) '맨손' / 방어구 미착용(기본값) 상태에서는 툴팁 표시 안 함
        //    (버그 fix) 기존 툴팁 누적 제거 + 툴팁 표시 시 overflow를 visible로
        const isBareHand = (bind === "weapon") && (String(it?.id||"") === "fist" || String(it?.name||"") === "맨손");
        const isNoArmor  = (bind === "armor") && (
          (String(it?.id||"") === "cloth" && (((it?.def|0)===0) && ((it?.atk|0)===0))) ||
          String(it?.id||"") === "none" ||
          String(it?.name||"") === "천옷" ||
          (String(it?.name||"") === "갑옷" && ((it?.def|0)===0))
        );

        slot.querySelectorAll(".itemTip").forEach(n => n.remove());
        slot.style.overflow = "hidden";
        if (equipSelectedKey === bind && !isBareHand && !isNoArmor){
          const tipText = (typeof getItemTipText === "function") ? getItemTipText(it) : "";
          if (tipText){
            const tip = document.createElement("div");
            tip.className = "itemTip";
            tip.textContent = tipText;
            slot.appendChild(tip);
            slot.style.overflow = "visible";
          }
        }
      }else{
        if (main) main.textContent = slotDef?.label || "-";
        // ✅ 빈 슬롯이면 아이콘 모드 해제
        slot.classList.remove("hasIcon");
        const _img = slot.querySelector("img.eqIcon");
        if (_img) _img.remove();

        if (sub) sub.textContent = "";
      }
    });
  }

  // 하단 요약(스탯/장비 연동)
  try{ if (typeof recalcCombatStats === "function") recalcCombatStats(); }catch(_){}

  const pl2 = (typeof player !== "undefined" && player) ? player : null;
  if (pl2){
    if (elAtk)  elAtk.textContent  = String((pl2.atk|0)||0);
    if (elPdef) elPdef.textContent = String((pl2.def|0)||0);
    if (elMdef) elMdef.textContent = String((pl2.mdef|0)||0);

    if (elCritC){
      const cc = Math.max(0, Math.min(0.95, +pl2.critChance || 0));
      elCritC.textContent = `${(cc*100).toFixed(1)}%`;
    }
    if (elCritM){
      const cm = Math.max(1.10, +pl2.critMult || 1.50);
      elCritM.textContent = `x${cm.toFixed(2)}`;
    }
    if (elAspd){
      const base = 0.55; // recalcCombatStats와 동일
      const itv  = Math.max(0.0001, +pl2.atkInterval || base);
      const pct  = (base / itv - 1) * 100;
      elAspd.textContent = `${pct.toFixed(1)}%`;
    }
  }else{
    if (elAtk) elAtk.textContent="0";
    if (elPdef) elPdef.textContent="0";
    if (elMdef) elMdef.textContent="0";
    if (elCritC) elCritC.textContent="0%";
    if (elCritM) elCritM.textContent="x1.50";
    if (elAspd) elAspd.textContent="0%";
  }
}

function openEquipPanel(){
  if(!equipPanel) return;
  // ✅ 혹시 드래그 바인딩이 누락되었을 경우를 대비해, 열 때 한 번 더 보장
  try{ makeDraggablePanel(equipPanel, { handleSelector: '.statHeader' }); }catch(_){ }

  // ✅ 열릴 때 '마우스에 붙는' 현상 방지(이전 드래그 상태 강제 해제)
  try{ equipPanel.__cancelDrag && equipPanel.__cancelDrag(); }catch(_){}

  // ✅ 처음 열 때는 중앙으로 배치(이미 위치가 있으면 유지)
  if(!equipPanel.style.left || !equipPanel.style.top){
    equipPanel.classList.remove("hide");
    // 레이아웃 확정(너비/높이 0 방지)
    try{ void equipPanel.offsetWidth; }catch(_){}
    try{ centerPanel(equipPanel); }catch(_){}
    equipPanel.classList.add("hide");
  }

  renderEquipPanel();
  equipPanel.classList.remove("hide");
}
function closeEquipPanel(){
  if(!equipPanel) return;
  try{ equipPanel.__cancelDrag && equipPanel.__cancelDrag(); }catch(_){}
  equipPanel.classList.add("hide");
}

// 버튼 바인딩 + 닫기 버튼
if (equipStatusBtn){
  equipStatusBtn.addEventListener("click", (e)=>{
    e.preventDefault();
    try{
      if (invBtnSound){
        invBtnSound.currentTime = 0;
        invBtnSound.play().catch(()=>{});
      }
    }catch(_){ }
    // ✅ 다른 패널이 열려있으면 닫고 장비패널을 최상단으로
    try{
      if (equipPanel && !equipPanel.classList.contains("hide")) closeEquipPanel();
      else openEquipPanel();
    }catch(_){ }
  });
}
if (equipPanel){
  const closeBtn = equipPanel.querySelector(".btn.close");
  if (closeBtn) closeBtn.addEventListener("click", (e)=>{
    e.preventDefault();
    try{
      if (invBtnSound){
        invBtnSound.currentTime = 0;
        invBtnSound.play().catch(()=>{});
      }
    }catch(_){ }
    closeEquipPanel();
  });

  // 패널 배경 클릭 시 선택효과 없음(단순 오동작 방지)
  equipPanel.addEventListener("pointerdown", (e)=>{
    // 인벤/스탯의 버튼 클릭 흐름 방해 금지
    e.stopPropagation();
  }, {passive:false});
}



// ✅ 인벤 패널 '빈 공간' 터치/클릭하면 (착용/해제 버튼 포함) 선택 취소해서 버튼 숨김
if (invPanel){
  invPanel.addEventListener("pointerdown", (e)=>{
    try{
      if (typeof invSelectedAbsIndex !== "undefined" && invSelectedAbsIndex !== -1){
        // 슬롯(아이템) 클릭은 기존 로직대로 처리하고, 패널 배경/여백 클릭만 취소 처리
        if (!e.target.closest(".equipBtn")){
          invSelectedAbsIndex = -1;
          if (typeof renderInventoryPage === "function") renderInventoryPage();
        }
      }
    }catch(_){}
  }, {passive:true});
}
const invGrid = document.getElementById("invGrid");
const invPrev = document.getElementById("invPrev");
const invNext = document.getElementById("invNext");
const invPageText = document.getElementById("invPageText");

// ✅ 인벤 데이터(25칸 1페이지 기준). 드랍/획득 시 window.inventory만 업데이트하면 됩니다.
// item: { name, qty }
if (!window.inventory) window.inventory = [];

// ===================== DAGGER / EQUIPMENT INVENTORY HELPERS =====================
// ✅ 장비류는 인벤에서 스택 금지(1칸=1장비), 소모품은 스택 허용
function addItemToInventory(item){
  if(!item) return;
  if(!window.inventory) window.inventory = [];

  const isEquipment =
    !!(item.isEquip || item.equipSlot || item.type === "equip") ||
    ("atk" in item) || ("def" in item) || ("hit" in item) || ("eva" in item) ||
    ("critChance" in item) || ("critMult" in item);

  const id   = item.id || item.name || "item";
  const name = item.name || "아이템";
  const icon = item.icon || null;

  if (isEquipment){
    const uid = (item && item.uid) ? item.uid : ((window.crypto && window.crypto.randomUUID)
      ? window.crypto.randomUUID()
      : ("eq_" + Date.now() + "_" + Math.floor(Math.random()*1e9)));

    window.inventory.push({
      uid,
      id, name, icon,
      qty: 1,
      equipSlot: item.equipSlot || "weapon",
      // ✅ baseAtk / enhance / atk(최종) 분리
      baseAtk: (("baseAtk" in item) ? (item.baseAtk|0) : (item.atk|0)) || 0,
      atk: (((("baseAtk" in item) ? (item.baseAtk|0) : (item.atk|0)) || 0) + (item.enhance|0 || 0)),

      def: item.def|0 || 0,
      hit: item.hit|0 || 0,
      eva: item.eva|0 || 0,
      critChance: +item.critChance || 0,
      critMult: +item.critMult || 0,
      enhance: item.enhance|0 || 0,
       fixedAtk: !!item.fixedAtk
    });
  } else {
    // ✅ 소모품 스택: 기본은 기존처럼 계속 합산
    // ✅ 단, '무기강화주문서(weapon_enforce_scroll)'만 1슬롯 최대 100개까지만 스택
    const qtyAdd = Math.max(1, item.qty|0 || 1);
    const maxStack = (id === "weapon_enforce_scroll") ? 100 : 999999999;

    let remain = qtyAdd;

    // 같은 아이템 스택에 먼저 채우기 (maxStack 미만인 슬롯)
    while (remain > 0) {
      const exist = window.inventory.find(it => it && !it.uid && ((it.id||it.name) === id) && ((it.qty|0 || 1) < maxStack));
      if (exist){
        const cur = (exist.qty|0 || 1);
        const add = Math.min(remain, maxStack - cur);
        exist.qty = cur + add;

        if (!exist.icon && icon) exist.icon = icon;
        if (!exist.name) exist.name = name;
        if (!exist.id) exist.id = id;

        remain -= add;
      } else {
        const add = Math.min(remain, maxStack);
        window.inventory.push({ id, name, icon, qty: add });
        remain -= add;
      }
    }
  }

  try{
    if (typeof renderInventoryPage === "function" && invPanel && !invPanel.classList.contains("hide")){
      renderInventoryPage();
    }
  }catch(e){}
}

// ✅ 시작 시 단검 1개 지급(중복 방지)
(function ensureStartDagger(){
  try{
    if(!window.inventory) window.inventory = [];
    const has = window.inventory.some(it => it && ((it.id === "dagger") || (it.name === "단검")));
    if(!has){
      addItemToInventory({
        id:"dagger",
        name:"단검",
        icon:"dagger.PNG",
        qty:1,
        equipSlot:"weapon",
        baseAtk:5,
        enhance:0,
        atk:5,
        fixedAtk:true
      });
    }
  }catch(e){}
})();



// ✅ 최초 게임 접속(세이브가 없는 상태)에서만 무기강화주문서 10개 지급
//    이후 재접속 시에는 남아있던 수량(세이브된 qty)을 그대로 유지합니다.
function ensureStartWeaponEnhanceScroll(){
  try{
    // ✅ '최초 1회만' 지급을 보장하기 위한 전용 플래그
    //    (세이브가 먼저 생성되는 경우가 있어 SAVE_KEY 존재여부만으로 판단하면 누락될 수 있음)
    const GIVEN_KEY = "weapon_enforce_scroll_given_v1";
    let alreadyGiven = false;
    try{ alreadyGiven = (localStorage.getItem(GIVEN_KEY) === "1"); }catch(_){}

    if(!window.inventory) window.inventory = [];

    // 현재 인벤에 주문서가 있는지 확인
    const has = window.inventory.some(it => it && !it.uid && ((it.id === "weapon_enforce_scroll") || /무기.?강화.?주문서/.test(it.name||"")));

    // ✅ 아직 한 번도 지급한 적 없고, 인벤에도 없으면 10개 지급
    if(!alreadyGiven && !has){
      addItemToInventory({
        id:"weapon_enforce_scroll",
        name:"무기강화주문서",
        icon:"enforce.PNG",
        qty:10,
        type:"consumable",
        useType:"enhanceWeaponOnly",
        desc:"무기를 강화합니다. (가격: 2만원)", price:"20000원"
      });

      // 플래그 저장 + 즉시 저장(남은 수량 유지 목적)
      try{ localStorage.setItem(GIVEN_KEY, "1"); }catch(_){}
      try{ if (typeof saveToLocal === "function") saveToLocal(); }catch(_){}
    }
  }catch(e){}
}
window.ensureStartWeaponEnhanceScroll = ensureStartWeaponEnhanceScroll;

// ✅ 최초 접속(세이브 없음) 유저에게 아쳐소환주문서 4장 지급(1회만)
function ensureStartArcherScroll4(){
  try{
    const GIVEN_KEY = "archer_scroll_given_v1";
    let alreadyGiven = false;
    try{ alreadyGiven = (localStorage.getItem(GIVEN_KEY) === "1"); }catch(_){}
    if(!window.inventory) window.inventory = [];

    const has = window.inventory.some(it => it && !it.uid && ((it.id === "archer_scroll") || /아쳐.?소환.?주문서/.test(it.name||"")));
    if(!alreadyGiven && !has){
      // 가능하면 SHOP_ITEMS 템플릿(아이콘 포함)을 복사해서 사용
      let tpl = null;
      try{
        if (typeof SHOP_ITEMS !== "undefined" && Array.isArray(SHOP_ITEMS)){
          tpl = SHOP_ITEMS.find(x => x && x.id === "archer_scroll") || null;
        }
      }catch(_){}
      const it = Object.assign({}, (tpl || { id:"archer_scroll", name:"아쳐소환주문서", desc:"", price:"", icon:"" }));
      it.qty = 4;
      it.type = it.type || "consumable";
            it.icon = "pet1.png"; // ✅ 아이콘 고정 (대표님 요청: pet1.png)
// 지급
      addItemToInventory(it);

      // 플래그 저장 + 즉시 저장
      try{ localStorage.setItem(GIVEN_KEY, "1"); }catch(_){}
      try{ if (typeof saveToLocal === "function") saveToLocal(); }catch(_){}
    }
  }catch(e){}
}
window.ensureStartArcherScroll4 = ensureStartArcherScroll4;
window.addItemToInventory = addItemToInventory;

// ✅ 최초 접속(세이브 없음)일 때만 10개 지급
try{ if (typeof window.ensureStartWeaponEnhanceScroll === 'function') window.ensureStartWeaponEnhanceScroll(); }catch(e){}
try{ if (typeof window.ensureStartArcherScroll4 === 'function') window.ensureStartArcherScroll4(); }catch(e){}
// ==============================================================================

 // 예: {name:"포션", qty:3}
let invPage = 0;

function invTotalPages(){
  return Math.max(1, Math.ceil((window.inventory.length || 0) / 25));
}

function isWeaponItem(it){
  if(!it) return false;
  if (it.equipSlot === "weapon") return true;
  if ((it.id||"") === "dagger") return true;
  if (/단검/.test(it.name||"")) return true;
  return false;
}

// ✅ 장비 슬롯 정규화(반지 등)
const EQUIP_SLOT_KEYS = ["ear","helm","neck","tee","armor","cloak","ring","belt","shield","weapon","glove","shoe"];
function normEquipSlot(slot){
  if (!slot) return "";
  const s = String(slot);
  if (s === "ring1" || s === "ring2") return "ring";
  return s;
}
function getEquipSlotOfItem(it){
  if(!it) return "";
  // 기존 무기 판정 호환
  if (typeof isWeaponItem === "function" && isWeaponItem(it)) return "weapon";
  return normEquipSlot(it.equipSlot || it.slot || it.slotType || it.type || "");
}
function isEquipableItem(it){
  const slot = getEquipSlotOfItem(it);
  return !!(slot && window.equipment && window.equipment[slot] && EQUIP_SLOT_KEYS.includes(slot));
}
function isItemEquippedAny(it){
  try{
    if(!it || !it.uid) return false;
    const eq = window.equipment;
    if(!eq) return false;
    for (const k of EQUIP_SLOT_KEYS){
      if (eq[k] && eq[k].uid && eq[k].uid === it.uid) return true;
    }
    return false;
  }catch(e){ return false; }
}
function getEquippedSlotByUid(uid){
  try{
    const eq = window.equipment;
    if(!eq || !uid) return "";
    for (const k of EQUIP_SLOT_KEYS){
      if (eq[k] && eq[k].uid && eq[k].uid === uid) return k;
    }
    return "";
  }catch(e){ return ""; }
}


function isEnhanceScrollItem(it){
  if(!it) return false;
  const id = (it.id||"");
  // 기존 강화주문서 + 신규 무기강화주문서(enforce.PNG)
  if (id === "enhance_scroll" || id === "weapon_enhance_scroll" || id === "weapon_enforce_scroll") return true;
  const nm = (it.name||"");
  if (/강화.?주문서/.test(nm)) return true;
  if (/무기.?강화.?주문서/.test(nm)) return true;
  return (it.useType === "enhanceWeapon" || it.useType === "enhanceWeaponOnly");
}

// ✅ 물약(소) 판정
function isPotionItem(it){
  try{
    if(!it) return false;
    // uid가 있으면 장비류(개별 장비) - 물약은 소모품(스택)이라 uid 없음
    if(it.uid) return false;
    const id = (it.id || it.name || "");
    return (id === "hp_potion_s" || id === "mp_potion_s");
  }catch(e){
    return false;
  }
}

// ✅ 물약 사용: HP +10 / MP +5 (최대치 초과 불가) + 소모
function usePotion(absIndex){
  try{
    if(!window.inventory || absIndex == null) return;
    const it = window.inventory[absIndex];
    if(!isPotionItem(it)) return;

    if (it.id === "hp_potion_s"){
      const before = (player && (player.hp|0)) || 0;
      const maxv = (player && (player.hpMax|0)) || before;
      const after = Math.min(maxv, before + 10);
      const gained = Math.max(0, after - before);
      if(player) player.hp = after;
      try{ showTopNotice(`hp물약(소) 사용 +${gained}`, 850); }catch(_){}
      try{ potionUseSfx.currentTime = 0; potionUseSfx.play(); }catch(_){ try{ new Audio('po.ogg').play(); }catch(__){} }
    } else if (it.id === "mp_potion_s"){
      const before = (player && (player.mp|0)) || 0;
      const maxv = (player && (player.mpMax|0)) || before;
      const after = Math.min(maxv, before + 5);
      const gained = Math.max(0, after - before);
      if(player) player.mp = after;
      try{ showTopNotice(`mp물약(소) 사용 +${gained}`, 850); }catch(_){}
      try{ potionUseSfx.currentTime = 0; potionUseSfx.play(); }catch(_){ try{ new Audio('po.ogg').play(); }catch(__){} }
    }

    // ✅ 소모(스택)
    const cur = (it.qty|0 || 1);
    it.qty = cur - 1;
    if (it.qty <= 0){
      window.inventory.splice(absIndex, 1);
    }

    invSelectedAbsIndex = -1;
    try{ renderInventoryPage(); }catch(_){}
    try{ saveToLocal?.(); }catch(_){}
  }catch(e){}
}
// ✅ 아쳐 소환 주문서 사용: 인벤에서 사용 시 펫 소환 (이미 펫 있으면 사용 불가)
function useArcherScroll(absIndex){
  try{
    if(!window.inventory || absIndex == null) return;
    const it = window.inventory[absIndex];
    if(!it || (it.id||it.name) !== "archer_scroll") return;

    // 이미 펫이 활성 상태면 사용 불가
    if (window.pet && !window.pet.deadForever && window.pet.state === "alive"){
      try{ showTopNotice("이미 펫이 있습니다.", 900); }catch(_){}
      return;
    }

    // 펫 소환 (기존 펫 오브젝트를 되살리는 방식)
    try{
      if (window.pet){
        window.pet.deadForever = false;
        window.pet.alpha = 1;
        window.pet.r = 14;
        window.pet.state = "alive";
        window.pet.hpMax = Math.max(1, Math.floor((player && (player.hpMax|0) || 30) / 3));
        window.pet.hp = window.pet.hpMax;
        window.pet.x = (player ? player.x : window.pet.x) - 48;
        window.pet.y = (player ? player.y : window.pet.y) + 34;
      }
    }catch(_){}

    try{ showTopNotice("아쳐 펫 소환!", 900); }catch(_){}

    // ✅ 성공 시에만 소모
    const cur = (it.qty|0 || 1);
    it.qty = cur - 1;
    if (it.qty <= 0){
      window.inventory.splice(absIndex, 1);
    }
    invSelectedAbsIndex = -1;
    try{ renderInventoryPage(); }catch(_){}
  }catch(e){}
}



// ✅ 강화 적용(인벤 아이템 + 장착 장비 동기화)
function applyEnhanceToWeaponByUid(targetUid, add){
  if(!targetUid) return false;
  const amt = (add|0) || 0;
  if(!amt) return false;

  // 1) 인벤 아이템 업데이트
  const inv = window.inventory || [];
  const wItem = inv.find(it => it && it.uid === targetUid);
  if(!wItem) return false;

  const baseAtk = (("baseAtk" in wItem) ? (wItem.baseAtk|0) : (wItem.atk|0)) || 0;
  wItem.baseAtk = baseAtk;
  wItem.enhance = (wItem.enhance|0) + amt;
  // ✅ atk는 '기본 공격력'로 유지하고, 강화는 enhance에만 누적 (표시용 +n이 전투공격력에 중복 반영되는 버그 방지)
  wItem.atk = (wItem.baseAtk|0);

  // 2) 장착 중이면 장비에도 반영
  try{
    const eq = window.equipment?.weapon;
    if(eq && eq.uid && eq.uid === targetUid){
      eq.baseAtk = baseAtk;
      eq.enhance = (wItem.enhance|0);
      // ✅ 장착 무기도 동일하게 baseAtk 유지
      eq.atk = (wItem.baseAtk|0);
      window.recalcCombatStats?.();
      try{ if(!document.getElementById('equipPanel')?.classList.contains('hide')) window.renderEquipPanel?.(); }catch(_){ }
    }
  }catch(_){}

  try{ saveToLocal?.(); }catch(_){}
  return true;
}

function ensureEnhanceModal(){
  if (document.getElementById("enhanceModal")) return;
  const modal = document.createElement("div");
  modal.id = "enhanceModal";
  modal.innerHTML = `
    <div id="enhanceBox" role="dialog" aria-modal="true">
      <div id="enhanceHead">
        <div class="enhHeadLeft" style="width:100%; text-align:center;">
          <div id="enhanceTitle">무기를 강화 하시겠습니까?</div>
        </div>
        <button id="enhanceClose" type="button" aria-label="닫기" title="닫기">×</button>
      </div>

      <div id="enhanceBody">
        <div id="enhanceHint">강화할 무기를 선택하세요.</div>
        <div id="enhanceGrid"></div>

        <div id="enhanceConfirm" aria-live="polite">
          <div id="enhanceQuestion">이 무기를 강화 하시겠습니까?</div>
          <div class="enhActions">
            <button id="enhYes" class="enhBtn" type="button">무기를 강화하라</button>
            <button id="enhNo" class="enhBtn" type="button">떠난다</button>
          </div>
        </div>
      </div>
    </div>
`;
  document.body.appendChild(modal);

  // 배경 클릭 닫기
  modal.addEventListener("pointerdown", (e)=>{
    if (e.target === modal) closeWeaponEnhancePanel();
  });
  modal.querySelector("#enhanceClose").addEventListener("click", closeWeaponEnhancePanel);
    modal.querySelector("#enhNo").addEventListener("click", closeWeaponEnhancePanel);

  // ✅ 드래그(마우스/터치)로 강화판넬 이동
  setupEnhanceDrag(modal);

}

function setupEnhanceDrag(modal){
  try{
    const box = modal.querySelector("#enhanceBox");
    const head = modal.querySelector("#enhanceHead");
    if(!box || !head) return;

    // 초기 위치(중앙)
    function centerBox(){
      box.style.left = "50%";
      box.style.top = "50%";
      box.style.transform = "translate(-50%, -50%)";
    }
    centerBox();

    let dragging = false;
    let offX = 0, offY = 0;

    const clamp = (v, a, b)=> Math.max(a, Math.min(b, v));

    head.addEventListener("pointerdown", (e)=>{
      // 헤더에서만 드래그 시작
      if(e.button !== undefined && e.button !== 0) return; // left click only
      e.preventDefault();
      head.setPointerCapture?.(e.pointerId);

      const r = box.getBoundingClientRect();
      dragging = true;
      box.classList.add("dragging");

      offX = e.clientX - r.left;
      offY = e.clientY - r.top;

      // 드래그 모드로 전환 (transform 제거)
      box.style.transform = "none";
      box.style.left = `${r.left}px`;
      box.style.top  = `${r.top}px`;
    });

    head.addEventListener("pointermove", (e)=>{
      if(!dragging) return;
      e.preventDefault();

      const vw = window.innerWidth;
      const vh = window.innerHeight;
      const r = box.getBoundingClientRect();

      let nx = e.clientX - offX;
      let ny = e.clientY - offY;

      // 화면 밖으로 안 나가게 클램프(약간 여유)
      const pad = 6;
      nx = clamp(nx, pad, vw - r.width - pad);
      ny = clamp(ny, pad, vh - r.height - pad);

      box.style.left = `${nx}px`;
      box.style.top  = `${ny}px`;
    });

    const endDrag = (e)=>{
      if(!dragging) return;
      dragging = false;
      box.classList.remove("dragging");
      try{ head.releasePointerCapture?.(e.pointerId); }catch(_){}
    };

    head.addEventListener("pointerup", endDrag);
    head.addEventListener("pointercancel", endDrag);

    // 창 리사이즈 시, 너무 밖으로 나가 있으면 다시 클램프
    window.addEventListener("resize", ()=>{
      if(modal.classList.contains("show")){
        const r = box.getBoundingClientRect();
        const vw = window.innerWidth;
        const vh = window.innerHeight;
        const pad = 6;
        let nx = clamp(r.left, pad, vw - r.width - pad);
        let ny = clamp(r.top,  pad, vh - r.height - pad);
        box.style.transform = "none";
        box.style.left = `${nx}px`;
        box.style.top  = `${ny}px`;
      }
    }, {passive:true});

    // 모달 열릴 때마다 중앙으로 리셋하고 싶으면 아래 주석 해제:
    // modal.addEventListener("show", centerBox);

  }catch(err){
    console.error("setupEnhanceDrag error:", err);
  }
}



// ===================== ICON RENDER HELPERS (SPRITE:*) =====================
// ✅ inventory/equip/enhance 공통: icon이 "dagger.PNG" 같은 마커일 때, <img src>로 쓰지 말고 캔버스에 직접 그려서 표시
function _isSpriteIcon(src){
  return (typeof src === "string") && src.startsWith("SPRITE:");
}
function _spriteKind(src){
  return String(src||"").split(":")[1] || "";
}
function _drawSpriteToCanvas(cnv, spriteSrc){
  try{
    if(!cnv) return;
    const kind = _spriteKind(spriteSrc);
    const ctx = cnv.getContext("2d");
    if(!ctx) return;
    const w = cnv.width || 32;
    const h = cnv.height || 32;
    ctx.imageSmoothingEnabled = false;
    ctx.clearRect(0,0,w,h);

    // ✅ 현재 게임에서 쓰는 드랍 스프라이트: itm.png + DROP.knife
    if (kind === "knife" && (typeof itmImg !== "undefined") && itmImg){
      if (itmImg.complete && itmImg.naturalWidth > 0){
        ctx.drawImage(itmImg, DROP.knife.sx, DROP.knife.sy, DROP.knife.sw, DROP.knife.sh, 0, 0, w, h);
      }else{
        // 아직 로드 전이면 로드 후 다시 그리기
        try{
          itmImg.addEventListener("load", ()=>{
            try{ _drawSpriteToCanvas(cnv, spriteSrc); }catch(_){}
            // 인벤/강화창이 열려있으면 한 번 더 리렌더(투명 방지)
            try{ if (typeof renderInventoryPage === "function") renderInventoryPage(); }catch(_){}
            try{ if (typeof rerenderEnhanceGrid === "function") rerenderEnhanceGrid(); }catch(_){}
            try{ if (typeof renderEquipPanel === "function") renderEquipPanel(); }catch(_){}
          }, {once:true});
        }catch(_){}
      }
    }
  }catch(_){}
}
function makeIconNodeForSlot(item, sizePx){
  try{
    const src = item ? (item.icon || item.iconSrc || "") : "";
    if(!_isSpriteIcon(src)){
      if(!src) return null;
      const img = document.createElement("img");
      img.src = src;
      img.alt = item?.name || "item";
      img.draggable = false;
      img.style.width = "100%";
      img.style.height = "100%";
      img.style.objectFit = "cover";
      img.onerror = ()=>{ try{ img.onerror=null; img.src = _fallbackIconDataUri(item); }catch(_){} };
      return img;
    }
    const cnv = document.createElement("canvas");
    cnv.width = sizePx || 32;
    cnv.height = sizePx || 32;
    cnv.className = "spriteIconCnv";
    cnv.style.width = "100%";
    cnv.style.height = "100%";
    cnv.style.imageRendering = "pixelated";
    cnv.style.display = "block";
    _drawSpriteToCanvas(cnv, src);
    return cnv;
  }catch(_){}
  return null;
}
// =================== /ICON RENDER HELPERS (SPRITE:*) ===================
let _enhState = { scrollAbsIndex:-1, selectedUid:null };

function rerenderEnhanceGrid(){
  try{
    const modal = document.getElementById('enhanceModal');
    if (!modal) return;
    if (!modal.classList.contains('show')) return;
    if (!_enhState) return;
    if ((_enhState.scrollAbsIndex|0) < 0) return;
    openWeaponEnhancePanel(_enhState.scrollAbsIndex|0);
  }catch(_){ }
}


function openWeaponEnhancePanel(scrollAbsIndex){
  const inv = window.inventory || [];
  const scroll = inv[scrollAbsIndex];
  if(!scroll || !isEnhanceScrollItem(scroll)) return;

  ensureEnhanceModal();
  _enhState.scrollAbsIndex = scrollAbsIndex;
  _enhState.selectedUid = null;

  const modal = document.getElementById("enhanceModal");
  const grid  = modal.querySelector("#enhanceGrid");
  const confirm = modal.querySelector("#enhanceConfirm");
  // ✅ 서브 판넬은 처음부터 보이되, 선택 전에는 버튼을 숨김
  confirm.classList.add("show");
  confirm.classList.remove("armed");
  try{ modal.querySelector("#enhanceQuestion").textContent = ""; }catch(_){ }


  grid.innerHTML = "";

  // 강화 가능한 대상: 인벤 내 '무기'만
  const weapons = inv.filter(it => it && it.uid && isWeaponItem(it));
  if (!weapons.length){
    showTopNotice?.("강화할 무기가 없습니다.");
    return;
  }

  const maxSlots = 12; // 4 x 3
  const showWeapons = weapons.slice(0, maxSlots);

  showWeapons.forEach((w)=>{
    const slot = document.createElement("div");
    slot.className = "enhWSlot";
    slot.dataset.uid = w.uid;

    try{
    const iconNode = makeIconNodeForSlot(w, 64);
    if (iconNode) slot.appendChild(iconNode);
  }catch(_){ }

    const nm = document.createElement("div");
    nm.className = "wName";
    const enh = (w.enhance|0);
    nm.textContent = (w.name||"무기");
    slot.appendChild(nm);

    // 기존 배지 스타일 재사용(우측 상단 +n)
    if ((w.enhance|0) > 0){
      const bd = document.createElement("div");
      bd.className = "enhBadge";
      bd.textContent = `+${w.enhance|0}`;
      slot.appendChild(bd);
    }

    slot.addEventListener("click", ()=>{
      // 선택 표시
      grid.querySelectorAll(".enhWSlot").forEach(el=>el.classList.remove("sel"));
      slot.classList.add("sel");
      _enhState.selectedUid = w.uid;
      confirm.classList.add("show");
      confirm.classList.add("armed");
      try{ modal.querySelector("#enhanceQuestion").textContent = "무기를 강화하시겠습니까?"; }catch(_){ }

    });

    grid.appendChild(slot);
  });

  // 빈 슬롯 채우기(4x3 유지)
  for(let i=showWeapons.length;i<maxSlots;i++){
    const empty = document.createElement("div");
    empty.className = "enhWSlot empty";
    grid.appendChild(empty);
  }


  // 네 버튼은 매번 최신 상태로 동작하도록 여기서 바인딩
  const yesBtn = modal.querySelector("#enhYes");
  yesBtn.onclick = ()=>{
    try{
      const uid = _enhState.selectedUid;
      if(!uid){
        showTopNotice?.("강화할 무기를 선택하세요.");
        return;
      }
      const inv2 = window.inventory || [];
      const scroll2 = inv2[_enhState.scrollAbsIndex];
      if(!scroll2 || !isEnhanceScrollItem(scroll2)){
        showTopNotice?.("주문서가 없습니다.");
        closeWeaponEnhancePanel();
        return;
      }

      const wItem2 = inv2.find(it => it && it.uid === uid);
      if(!wItem2){
        showTopNotice?.("강화 실패(대상을 찾지 못함)");
        return;
      }

      const curEnh = (wItem2.enhance|0);
      const nextEnh = curEnh + 1;

      // ✅ 강화 확률: +3까지 100%, +4부터 60%
      let success = true;
      if(nextEnh <= 3){
        success = true;
      }else{
        success = (Math.random() < 0.60);
      }

      let resultMsg = "";
      let resultColor = null;
      if(success){
        const ok = applyEnhanceToWeaponByUid(uid, 1);
        if(!ok){
          showTopNotice?.("강화 실패(대상을 찾지 못함)");
          return;
        }
        // ✅ 성공: 실제 강화된 수치로 표시
        let _newEnh = 0;
        try{
          const _wNow = (inv2 || window.inventory || inventory || []).find(it => it && it.uid === uid);
          _newEnh = (_wNow && (_wNow.enhance|0)) ? (_wNow.enhance|0) : (curEnh + 1);
        }catch(_){
          _newEnh = (curEnh + 1);
        }
        resultMsg = `강화성공 +${_newEnh}`;
      }else{
        // ✅ 실패(40%): '무기 파괴' 또는 '강화수치 0 초기화' (각 50%)
        const breakWeapon = (Math.random() < 0.50);

        if(breakWeapon){
          // 무기 파괴(인벤에서 제거)
          const wi = inv2.findIndex(it => it && it.uid === uid);
          if(wi >= 0) inv2.splice(wi, 1);

          // 장착 중이면 해제
          try{
            const eq = (window.equipment && window.equipment.weapon) ? window.equipment.weapon
                      : (typeof equipment !== "undefined" ? equipment.weapon : null);
            if(eq && eq.uid && eq.uid === uid){
              window.unequipWeapon?.();
            }else{
              window.recalcCombatStats?.();
      try{ if(!document.getElementById('equipPanel')?.classList.contains('hide')) window.renderEquipPanel?.(); }catch(_){ }
            }
          }catch(_){}

          resultMsg = "강화실패! (무기파괴)";
          resultColor = "rgb(255,1,1)";
        }else{
          // 강화수치 초기화(0)
          const baseAtk2 = (("baseAtk" in wItem2) ? (wItem2.baseAtk|0) : (wItem2.atk|0)) || 0;
          wItem2.baseAtk = baseAtk2;
          wItem2.enhance = 0;
          wItem2.atk = baseAtk2;

          // 장착 중이면 장착 무기도 동기화
          try{
            const eq = (window.equipment && window.equipment.weapon) ? window.equipment.weapon
                      : (typeof equipment !== "undefined" ? equipment.weapon : null);
            if(eq && eq.uid && eq.uid === uid){
              eq.baseAtk = baseAtk2;
              eq.enhance = 0;
              eq.atk = baseAtk2;
            }
            window.recalcCombatStats?.();
      try{ if(!document.getElementById('equipPanel')?.classList.contains('hide')) window.renderEquipPanel?.(); }catch(_){ }
          }catch(_){}

          resultMsg = "강화실패! (강화수치 초기화)";
          resultColor = "rgb(255,143,44)";
        }
      }

      // 주문서 차감(스택) - 성공/실패 모두 소모
      scroll2.qty = (scroll2.qty|0) - 1;
      if(scroll2.qty <= 0){
        inv2.splice(_enhState.scrollAbsIndex, 1);
      }

      invSelectedAbsIndex = -1;
      try{ saveToLocal?.(); }catch(_){}

      closeWeaponEnhancePanel();
      renderInventoryPage?.();
      showTopNotice?.(resultMsg, 850, resultColor);

      
      // ✅ 강화 실패 효과음
      if(!success){
        try{
          const sid = (String(resultMsg||"").includes("무기파괴")) ? "enhanceBreakSound" : "enhanceResetSound";
          const a = document.getElementById(sid);
          a && (a.currentTime = 0, a.play());
        }catch(e){}
      }
// ✅ 강화 성공 효과음(성공시에만)
      if(success){
        try{
          const s = document.getElementById("enhanceSuccessSound");
          s && (s.currentTime = 0, s.play());
        }catch(e){}
      }

    }catch(_){}
  };

  modal.classList.add("show");
}

function closeWeaponEnhancePanel(){
  const modal = document.getElementById("enhanceModal");
  if(modal) modal.classList.remove("show");
  _enhState.scrollAbsIndex = -1;
  _enhState.selectedUid = null;
}

function useEnhanceScroll(scrollAbsIndex){
  // ✅ 강화주문서 사용 시: '강화할 무기 선택' 패널 오픈
  openWeaponEnhancePanel(scrollAbsIndex);
}

function isSameEquippedWeapon(it){
  try{
    const w = window.equipment?.weapon;
    // ✅ 장비 착용 표시는 "uid" 기준으로만 판정 (같은 이름/ID 장비가 여러 개여도 1개만 E)
    if(!w || !w.uid || !it || !it.uid) return false;
    return w.uid === it.uid;
  }catch(e){
    return false;
  }
}
var invSelectedAbsIndex = -1;
var equipSelectedKey = ""; // e.g. 'weapon','armor','ac'


function getItemTipText(it){
  if (!it) return "";
  const baseName = it.name || "아이템";

  // ✅ 골드(금화) 툴팁: 클릭 시 노란 글씨로 "금화 n원" (n=보유 갯수)
  const _isGold = (it.id === "gold" || it.type === "gold" || /gold-?1\.(png|webp|jpg|jpeg|gif)$/i.test(it.icon||"") || /gold/i.test(it.icon||"") || baseName === "골드" || baseName === "금화");
  if (_isGold){
    const n = (typeof it.qty === "number" ? it.qty : 1);
    return `금화 ${n}원`;
  }

  // ✅ 무기(예: 단검) 툴팁: 이름(+n) + 분리선 + 공격력(최종)
  if (typeof isWeaponItem === "function" && isWeaponItem(it)){
    const baseAtk = (("baseAtk" in it) ? (+it.baseAtk||0) : (+it.atk||0));
    const enh = (+it.enhance || 0);
    const totalAtk = baseAtk + enh;

    const nameLine = (enh > 0) ? `${baseName} +${enh}` : baseName;
    return [
      nameLine,
      "──────",
      `공격력: ${baseAtk}`,
      "──────",
    "-초보자검"
    ].join("\n");
  }


  // ✅ 강화주문서 툴팁(전용 문구)
if (typeof isEnhanceScrollItem === "function" && isEnhanceScrollItem(it)) {
  return [
    baseName, // '무기강화주문서'
    "──────",
    "무기공격력 +10강화",
    "──────",
    "※주의:+3까지 안전강화"
  ].join("\n");
}


  // ✅ 그 외 아이템: desc/description/tip 우선
  const lines = [baseName];
  const desc = it.desc || it.description || it.tip || "";
  if (desc){
    lines.push("──────");
    lines.push(String(desc));
  }
  return lines.join("\n");
}



function renderInventoryPage(){
  if (!invGrid) return;
  invGrid.innerHTML = "";
  const total = invTotalPages();
  invPage = Math.max(0, Math.min(total-1, invPage));

  const start = invPage * 25;
  const end = start + 25;
  const pageItems = (window.inventory || []).slice(start, end);

  for (let i=0;i<25;i++){
    const it = pageItems[i] || null;
    const absIndex = start + i;

    const slot = document.createElement("div");
    slot.className = "invSlot " + (it ? "" : "empty");

    if (it){
      slot.title = it.name || "아이템";

      if (it.icon){
        const node = makeIconNodeForSlot(it, 32);
        if (node){
          node.style.width = "100%";
          node.style.height = "100%";
          node.style.objectFit = "cover";
          node.style.filter = "drop-shadow(0 6px 10px rgba(0,0,0,0.35))";
          slot.appendChild(node);
        } else {
          slot.textContent = it.name || "아이템";
        }
      } else {
        slot.textContent = it.name || "아이템";
      }

      if (typeof it.qty === "number" && it.qty > 1){
        const q = document.createElement("div");
        q.className = "qty";
        q.textContent = it.qty;
        slot.appendChild(q);
      }



      
      // ✅ 강화 배지(+n): 장비(enhance>0)면 아이콘 우측 상단에 표시
      if (it.uid && ((it.enhance|0) > 0)){
        const bd = document.createElement("div");
        bd.className = "enhBadge";
        bd.textContent = `+${it.enhance|0}`;
        slot.appendChild(bd);
      }

// ✅ 선택된 슬롯이면 툴팁(아이템 설명) 표시
      if (invSelectedAbsIndex === absIndex){
        const tipText = getItemTipText(it);
        if (tipText){
          const tip = document.createElement("div");
          tip.className = "itemTip";
          tip.textContent = tipText;
      // ✅ 골드(금화) 툴팁 색상: 노란색
          const __isGoldTip = (it.id === "gold" || it.type === "gold" || /gold/i.test(it.icon||"") || (it.name==="골드") || (it.name==="금화"));
          if (__isGoldTip){
            tip.style.color = "rgb(255, 220, 80)";
            tip.style.textShadow = "0 2px 10px rgba(0,0,0,0.75)";
          }
          slot.appendChild(tip);
        }
      }
      slot.addEventListener("click", (ev)=>{
        ev.preventDefault();
        invSelectedAbsIndex = (invSelectedAbsIndex === absIndex) ? -1 : absIndex;
        renderInventoryPage();
      });

      // ✅ E 표시(착용중)
      if (isItemEquippedAny(it)){
        const em = document.createElement("div");
        em.className = "equipMark";
        em.textContent = "E";
        slot.appendChild(em);
      }

      // ✅ 선택된 슬롯 + 무기면 착용/해제 버튼
      if (invSelectedAbsIndex === absIndex && isEquipableItem(it)){
        const equippedNow = isItemEquippedAny(it);
        const itemSlot = getEquipSlotOfItem(it);
        const equippedSlot = equippedNow ? getEquippedSlotByUid(it.uid) : "";
        const slotToUse = equippedSlot || itemSlot;

        const b = document.createElement("button");
        b.className = "equipBtn";
        b.type = "button";
        b.textContent = equippedNow ? "해제" : "착용";

        b.addEventListener("click", (e2)=>{
          e2.preventDefault();
          e2.stopPropagation();

          try{
            if (equippedNow){
              window.unequipSlot?.(slotToUse);
            } else {
              // ✅ 무기(예: 단검) 호환: baseAtk/enhance 분리 보정
              if (slotToUse === "weapon"){
                it.id = it.id || "dagger";
                it.name = it.name || (it.id==="dagger" ? "단검" : "무기");
                if (!("baseAtk" in it)) it.baseAtk = (+it.atk||0) || 5;
                if (!("enhance" in it)) it.enhance = 0;
                it.atk = ((it.baseAtk|0)||0) + ((it.enhance|0)||0);
                it.fixedAtk = true;
              }
              it.equipSlot = slotToUse;
              window.equipItem?.(slotToUse, it);
            }

            invSelectedAbsIndex = -1;
            renderInventoryPage();
            try{ saveToLocal?.(); }catch(_){}
          }catch(err){}
        });

        slot.appendChild(b);
      }
    }

    // ✅ 선택된 슬롯 + 강화주문서면 사용 버튼
    if (invSelectedAbsIndex === absIndex && isEnhanceScrollItem(it)){
      const ub = document.createElement("button");
      ub.className = "equipBtn";
      ub.type = "button";
      ub.textContent = "사용";
      ub.style.background = "rgba(120,220,255,0.78)";
      ub.addEventListener("click", (e2)=>{
        e2.preventDefault();
        e2.stopPropagation();
        try{ useEnhanceScroll(absIndex); }catch(_){ }
      });
      slot.appendChild(ub);
    }

    // ✅ 선택된 슬롯 + 물약이면 사용 버튼(HP/MP 회복)
    if (invSelectedAbsIndex === absIndex && isPotionItem(it)){
      const ub2 = document.createElement("button");
      ub2.className = "equipBtn";
      ub2.type = "button";
      ub2.textContent = "사용";
      ub2.style.background = "rgba(120,220,255,0.78)";
      ub2.addEventListener("click", (e2)=>{
        e2.preventDefault();
        e2.stopPropagation();
        try{ usePotion(absIndex); }catch(_){ }
      });
      slot.appendChild(ub2);
    }

    // ✅ 선택된 슬롯 + 아쳐소환주문서면 사용 버튼(펫 소환)
    if (invSelectedAbsIndex === absIndex && (it.id === "archer_scroll" || (it.name||"") === "아쳐소환주문서")){
      const ub3 = document.createElement("button");
      ub3.className = "equipBtn";
      ub3.type = "button";
      ub3.textContent = "사용";
      ub3.style.background = "rgba(180,255,180,0.78)";
      ub3.addEventListener("click", (e3)=>{
        e3.preventDefault();
        e3.stopPropagation();
        try{ useArcherScroll(absIndex); }catch(_){ }
      });
      slot.appendChild(ub3);
    }

    invGrid.appendChild(slot);
  }

  if (invPageText) invPageText.textContent = `${invPage+1} / ${total}`;
  if (invPrev){
    invPrev.disabled = (invPage <= 0);
    invPrev.style.opacity = invPrev.disabled ? 0.35 : 1;
  }
  if (invNext){
    invNext.disabled = (invPage >= total-1);
    invNext.style.opacity = invNext.disabled ? 0.35 : 1;
  }
}

function openInv(){
  // 처음 열 때는 중앙으로 배치(이미 위치가 있으면 유지)
  if(!invPanel.style.left || !invPanel.style.top){
    invPanel.classList.remove("hide");
    centerPanel(invPanel);
    invPanel.classList.add("hide");
  }
invPage = 0;
  renderInventoryPage();
  invPanel.classList.remove("hide");
}
function closeInv(){
  invPanel.classList.add("hide");
}


// ===== 패널 드래그 이동 + 화면(캔버스) 밖으로 못 나가게 클램프 =====
function clampPanelToViewport(el, x, y){
  const margin = 6;
  const vw = window.innerWidth;
  const vh = window.innerHeight;
  const rect = el.getBoundingClientRect();
  const w = rect.width, h = rect.height;
  const cx = Math.max(margin, Math.min(vw - w - margin, x));
  const cy = Math.max(margin, Math.min(vh - h - margin, y));
  return { x: cx, y: cy };
}

function centerPanel(el){
  const rect = el.getBoundingClientRect();
  const x = (window.innerWidth - rect.width) / 2;
  const y = (window.innerHeight - rect.height) / 2;
  const p = clampPanelToViewport(el, x, y);
  el.style.left = p.x + "px";
  el.style.top  = p.y + "px";
  el.style.transform = "none";
}

function makeDraggablePanel(el, opts={}){
  if(!el) return;
  if(el.__draggableBound) return;
  el.__draggableBound = true;
  const handle = opts.handleSelector ? el.querySelector(opts.handleSelector) : el;
  if(!handle) return;

  // 드래그 중에는 브라우저 기본 제스처(스크롤/드래그이미지 등) 방지
  try{ handle.style.touchAction = "none"; }catch(_){}

  let dragging = false;
  let startX = 0, startY = 0;
  let baseL = 0, baseT = 0;
  let activePointerId = null;

  const shouldIgnore = (target)=>{
    if(!target) return false;
    const tag = (target.tagName||"").toLowerCase();
    if(tag === "button" || tag === "input" || tag === "textarea" || tag === "select") return true;
    if(target.closest(".statList")) return true;
    if(target.closest(".invGrid")) return true;
    if(target.closest(".invPager")) return true;
    if(target.closest(".equipGrid")) return true;
    if(target.closest(".equipFooter")) return true;
    return false;
  };

  const cancelDrag = ()=>{
    if(!dragging) return;
    dragging = false;
    activePointerId = null;
    el.classList.remove("dragging");
  };
  // 외부에서도 강제 종료 가능하도록
  el.__cancelDrag = cancelDrag;

  const onDown = (e)=>{
    if(el.classList.contains("hide")) return;
    if(e.button != null && e.button !== 0) return; // 좌클릭만
    if(shouldIgnore(e.target)) return;

    dragging = true;
    activePointerId = (typeof e.pointerId === "number") ? e.pointerId : null;

    el.classList.add("dragging");
    const rect = el.getBoundingClientRect();
    baseL = rect.left;
    baseT = rect.top;

    const cx = (e.clientX ?? (e.touches && e.touches[0]?.clientX) ?? 0);
    const cy = (e.clientY ?? (e.touches && e.touches[0]?.clientY) ?? 0);
    startX = cx;
    startY = cy;

    el.style.transform = "none";
    el.style.left = baseL + "px";
    el.style.top  = baseT + "px";

    try{
      if(activePointerId != null) handle.setPointerCapture && handle.setPointerCapture(activePointerId);
    }catch(_){}
    e.preventDefault();
    e.stopPropagation();
  };

  const onMove = (e)=>{
    if(!dragging) return;
    const cx = (e.clientX ?? (e.touches && e.touches[0]?.clientX) ?? 0);
    const cy = (e.clientY ?? (e.touches && e.touches[0]?.clientY) ?? 0);
    const dx = cx - startX;
    const dy = cy - startY;
    const p = clampPanelToViewport(el, baseL + dx, baseT + dy);
    el.style.left = p.x + "px";
    el.style.top  = p.y + "px";
    e.preventDefault();
  };

  const onUp = (e)=>{
    if(!dragging) return;
    cancelDrag();
    try{
      const pid = (typeof e.pointerId === "number") ? e.pointerId : activePointerId;
      if(pid != null) handle.releasePointerCapture && handle.releasePointerCapture(pid);
    }catch(_){}
    e.preventDefault();
  };

  handle.addEventListener("pointerdown", onDown, {passive:false});
  window.addEventListener("pointermove", onMove, {passive:false, capture:true});
  window.addEventListener("pointerup", onUp, {passive:false, capture:true});
  window.addEventListener("pointercancel", onUp, {passive:false, capture:true});
  handle.addEventListener("lostpointercapture", cancelDrag, {passive:true});
  window.addEventListener("blur", cancelDrag, {passive:true});

  window.addEventListener("resize", ()=>{
    if(el.classList.contains("hide")) return;
    const rect = el.getBoundingClientRect();
    const p = clampPanelToViewport(el, rect.left, rect.top);
    el.style.left = p.x + "px";
    el.style.top  = p.y + "px";
    el.style.transform = "none";
  }, {passive:true});
}

// ✅ 두 패널 모두 헤더를 손잡이로 드래그 가능
makeDraggablePanel(statPanel, { handleSelector: ".statHeader" });
makeDraggablePanel(invPanel,  { handleSelector: ".statHeader" });
makeDraggablePanel(equipPanel,{ handleSelector: ".statHeader" });
invBtn?.addEventListener("click", (e)=>{
  e.preventDefault();
  try{
    if (invBtnSound){
      invBtnSound.currentTime = 0;
      invBtnSound.play().catch(()=>{});
    }
  }catch(_){}
  if (invPanel.classList.contains("hide")) openInv();
  else closeInv();
});

invPanel?.querySelector(".btn.close")?.addEventListener("click", (e)=>{
  e.preventDefault();
  try{
    if (invBtnSound){
      invBtnSound.currentTime = 0;
      invBtnSound.play().catch(()=>{});
    }
  }catch(_){}
  closeInv();
});

// ===== SHOP UI =====
const shopOpenBtn = document.getElementById("shopOpenBtn");
const shopPanel   = document.getElementById("shopPanel");
const shopList    = document.getElementById("shopList");
const shopCloseBtn= document.getElementById("shopCloseBtn");

// ✅ 상점 패널 내부 클릭은 "UI 입력"으로 고정 (월드 입력 차단)
["pointerdown","click","dblclick","contextmenu"].forEach(ev=>{
  shopPanel?.addEventListener(ev, (e)=>{ e.stopPropagation(); }, {passive:false});
});

// 간단 SVG 아이콘(data-uri)
function shopIcon(label, c1, c2){
  const svg =
`<svg xmlns="http://www.w3.org/2000/svg" width="128" height="128">
  <defs>
    <linearGradient id="g" x1="0" y1="0" x2="1" y2="1">
      <stop offset="0" stop-color="${c1}"/><stop offset="1" stop-color="${c2}"/>
    </linearGradient>
  </defs>
  <rect x="8" y="8" width="112" height="112" rx="22" fill="url(#g)"/>
  <circle cx="52" cy="54" r="22" fill="rgba(255,255,255,0.18)"/>
  <circle cx="78" cy="78" r="28" fill="rgba(0,0,0,0.10)"/>
  <text x="64" y="78" text-anchor="middle"
        font-family="system-ui,-apple-system,Segoe UI,Roboto,Noto Sans KR,sans-serif"
        font-size="54" font-weight="900" fill="rgba(255,255,255,0.92)">${label}</text>
</svg>`;
  return "data:image/svg+xml;charset=utf-8," + encodeURIComponent(svg);
}

const SHOP_ITEMS = [
  { id:"hp_potion_s", name:"hp물약", desc:"hp를 10회복한다. (가격: 20원)", price:"20원", qty:1, icon:"data:image/png;base64,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" },
  { id:"mp_potion_s", name:"mp물약", desc:"mp를 10회복한다. (가격: 20원)", price:"20원", qty:1, icon:"data:image/png;base64,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" },
  { id:"weapon_enforce_scroll", name:"무기강화주문서", desc:"무기를 강화합니다. (스택 가능) (가격: 22000원)", price:"22000원", qty:1, icon: (window.WEAPON_ENFORCE_ICON || "enforce.PNG") },
  { id:"dagger_shop", name:"단검", desc:"공격력: 5 초보자의검 (가격: 50원)", price:"50원", qty:1, icon:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAG4AAABsCAYAAACLk4fwAAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAGMlSURBVHhevb13tF3VleZLvzGqDJJuzjnneG7OOed8lRPKIpgsQGSEAoqInISQECKbIJIwwTbGNmAy5QB22a7krip3je56Xd09+o3vfd9ce997JQS2q8Mfc5x4zz1n/fac85trzb32WWmpeUhLzfUsh5b177JU3aZn0/gZsowcpGfk0vK+xvJpBciYa5mFZplZRcjKLjbLzikx8x/Pmns+J6cUObmlyM7+91tmZtHM/7X/ncX/q8+n6X/5z/vfz31v77tmFiArM98sk78pk7/Nt4w/ahqfbKSmZSI+IQXxiam8n4OU1Gyz9Mw83mbaeGrMUtPykJSUg/j4LBBcLlJTcmj8gBQCSMn8d1mKbtP0JXzjZ6bxYPAt3YOYLhM0HxwHwDcOgjMNyOxAusHUrf98oT3O5qDmePDOBOQUywl8jc2C8/9vVrb7bJkD557XwaXvPPPd9V1564DlI4O/ba6l83d/s+UggbAys+g8hJPM8ddnp9CBEhIzkJSciYSkdEJNs+fS0goILhcJCTk4S9CSk7KQxDcmJxEA3/zvM0LnlznV9IV8m4WVbqA0WLM2F9KZzPc0/74PLZfelpsXoNfJys5oubK88q+xMsKTd82Ccl6u29nn/P89F7B9N90aPELkb5yxNJngfbPZAU5oAqUx0+9ITy+wscvj79JBE59AiPS0tLQiMioguDyclcInkhMzael8kn9sXvd1Jq/0PfOrz6fxS8iznIfxi83AcnaqRwkIBySL4Yh2+mD5oco9P/tajtkssLz8MuTnl9MqaJWnWJ5nuXkVs6ByZy3PN36GBikvP2CfmZvnwm9Orvvfc+/rO/ggzXQg+SBpcyOIDtI0AhSITD5OS6GXMcJlcywy6UEZtHRFJ4ZFjUsKX0vmewqKqjA5vRLLVqxHWWUDkuhcKQQpj0ukx8XFMlQmJ/LJJP6xvI32VSizlsZ/IDvj8xYe5+Y5fknB0pFoJngMIYzbGcoHXrizXMVQJhjZuQxRBkgDpOfkRQKkgSMwWm4eodE0yA6aA1aQV4WC/Cren7U8WcEcO+11vb/AIDt4+QXODOQciAZ1DlD7fjPw9BvkfTIXPdJpaTLB0i3BmRclZyOLB3VBNkEmZyCXOS6HYVK5LiurgNCy0dzah6uuuQXHn3wBl1xxHQpKqxEdz9zH8Usm2CR+RiId7awkgUskAD74U8B99XkHU/HaQZMJGj1uxssUXvhlswSMyZxf3PKIjmYTF7ODJE+yxxbeNID0pgJ5lAY1YANbICssR2FhJQp5dBYWVqOwwFmBjI9l+Wcw/zW9z/+bwkIC5GedYgU8IGgz/9++gwOca2FZB5YH0YsGgpkpYyTJkGXq+VIb8BR6jTwzj4CzOT6pzFt5HItE3upAzuZBuWjJuTh0+HE8d+J13HjLXtQ0tCOWITQmPs0Dl2PgkmkERwUjcH+Cx301TDpoUqPppnx8c17lYPl5SknfWXaOjN5j3qQw5QZFg6OB0uM886QKDqAbSBcO5WECV87nKhw4DnphUTWKimpnrFBW/A02573Oamj8jGLe+sbHPlB9D30ffS+FWx1YJmwsUvgRwZkDKTXqUoAOWqWNXEGWRxJirryTY5ZMKPEJ6Whs7sa3L74a7/zkE7Ptuw6a58lzk/g+QVOoVChVLoxPoMclM2amJtNbJC5kBudPsxlodH+5e0amzA+FDtpsPnAhxUEr4o9UyFMIcl6lI9wGiaAsRzG0FdDkTW4QHcDCoko+ruLgVqPYrJZWR6ufsSJZyTfYnPc609/XoqSkbsb02AGtse8gKxBIfifLn8ybMh14ZhYlCFERxCKJwil/Ix8r9ynU6jmJQRMmzP8al+7+Cdzz4HG8897n+PDTX2HbzoMYGF6ILP6dBIq8LM28jXmQwJPIKjYug6oymUlPSZMfmDYD408xfQEmWLq9aharYxivZ8OhvMvPVy6cOHCCVsQfORecg+aOcBfGLJQVauCcVzhANSgp5QDTSkvraPUIBBrNSktmraS0EcXfYHr9lPeXNPCzTrUSApYJ6tz7Mn0ffTeZDjCLEPodhJfnwcvlb84luByOQToFiqAqzKawbpZCrKxuwbnrL8Jjz7yGX/zmD/jhez/HvtsfwsDoUlRUt9JLCYs8VM+l0SnimOcSqf4TGSETE3NVDggaPUUgvgLndCNcz8zLGAJUv2QzJGZb3tJR5KAJkID5IUQeNldg5OW7H+JCpLzIeY8DpcHhINFKimcHUZ4gWA5YgwErCzQhUNb8FSv9BvvKewW/TJ8za3pOViKIZgQnePwORfyehfTEAoKzXKrooINPkYMA8wkwn785X7+ZUUcwlQYkVrJyytDZM47rbtqHH77/c/zun/4HvvfeL3HT7nswPLkatY29yOdYyCMV1ZJZx8k5pDyVJ1NSGDJTClkOKEzyCYH7Yx5nHiZgp0HLIagchkBBy86R8bFB4pHnm4SHAXPQnMhQrnKe5kKV4HCQijlgNPOIUg4krYwDXFburLyiBRVmrbQ2s7KvsUDlrJ3p9TJ+RoCfVVbBz7ZbZwH+n0A5AQqid1sikDxgignShd06lzPlfYwQRTwACw1gGW8DKJQi5cGrMKmcV1hSg1Vrv43DjzyHH7z7M/ztf/r/8KNPf4crbj6I4UUbUN08iBJ+n0RGwQypUPGg+kzx4CnE2sxJAj1OpYCApVNsOHDyKB/WbDh0NjudI2huqoegpJQsNM5VjB44hUP+EF9iGzApwplcVeOg8YjWkV1KDyoNyAvkDRxEWrkAVdKqnFVWt9HaUVXdgaqqTlRWdfB5z/icb+WnWDvKq2atwrNyAtWtPk829/ly/k+BnTUH1HmuQNIs9Na7sE4rLamlpwlcOUEyB1rOC1CA9OLqa3fhuZd+gI/+6u/wm9//N/yE0K7ddS96JtagpW8Ryut7kJoZQFxCFrJU1NNB0lNYfMcnIyEumfVbKuKY304Fp7lGwTvdw7wcdrr583OybOY0M4Pn12LyNF94OBO0QqrBomJ6WEk1vcsJAsspPJJLyxSydKTTC8rpDbTyCn8wBYtWQ2A1BFbTSesiPM90v7YLlV9jFbWdqODfOdN9mgDzs91nOavkczIfoA/RhxcoF7wWD16z5338DfRGhc+8XKpdipdShVQv/3V0juCue4/h/Y9+jfc+/g2h/Xf89PO/x+XXH8DQ4s2o7ZxCbfsYCvh5Ccn5zG8soQgtOSEVSXGJiI2MRWRYNKIiEwxcgoFjTSBwGQRn8E4D93XwzgTN5TGZajIfmkLhrEkJzoiLAHMVYZV5eUVHswanvFKDJdMAckANTieqOfiymjpZN2pqZT2834Pa+l7WPbxPqz6DVdEq67tRyb+r4m01rUr3CXWuVQqeD9WzMoHzLCB4tFLB8yAKnGpEV2qonKjl769gJGjD+RduxdPPvYEPPvstPvj8b/Dxz/8j3njn57jx1gfRM7oGHcMrUdk8hBL+vrSccsp+RS+qT5ZmMZFxiAiJQPC8YIQGhSMmOsnESYITJxIlyl2e130F3Okh8lRolt8sx3l1mQ+NR5rqH+Uvv0aSKhSwQFkDYdHKG1HO/KF8pbxVVslb/lgNVqWFQAHjIBNONQfVYNV3EVI3aglCsGrr+8zqmvpPsdrmU62Gz1Uz8ctqGvk3tJoGPmZ4mrVZmOalAkjzw20ZvU/m58xSAizhAZfPEFnMcFnBiKA8mJNfxe/Qh2tv3IeTb32AT37+D8xpv8Qnv/wnvP/5P2DrtnswMLERTd2L0TW8wkJkDkVZaoZXuFOYxEUnIjo8BkHnBGH+t+YjPDTS5pOlSjXt5VQlwWUauFkvO93bsmZy2qyXCVgu1WOeQXNJWAWq6hubhvLqMJPyPCoVFqUGywWsoom3zQatkoOgfFKuHMZQ5o56Hf2ERm+q4Q+r4aDKahsJjFbHgZfVNhBUYz8amNh9q28ZRN3pxudrmwYMYB1v62m6FUBn8lhnPkiDSJsL8XSQpfoNNW3m6XkqF/h4fNE6HLjrGN775Hf49It/xg9/+mt88Ff/EW/95Etce8u96B1bj6aupWjpWYpqfp88jks682BqupvjTKD0D54fipCgUCw4Zz5CFoQgPjaBLFiME1x8QvasxwlchgfKX3aYFSQC5oXEGS9zwPKpFAukEk14+BO9KlRVh7ni2FeLymUKixWEVkHvkioUtCqKChMGyl919DIbMA2cQh+9SgPbxNsmAmOSr2/pp3Hwm93g1xNKY+vIKdbQdqrVtw4T4JBZPa2hZZiQeb+JoPk57rM8b/VgfhNIH2Ylw3Z1QxfyOfiFhLbx29fgmZfexqdf/jPe++zv8eaPv8CHP/9nfO/dv6bkP4zRxReitXcF6tsXo6lzIQo4JrnM//K06JgUREUlIJKeds635mHe2fMILQjRkVFITU4jB01CZyMmLl3g5Gmz4ORdgjUbHmeh+WHRvIxy34dWWEDpS6UolajpJ4vzXg1WStUVoEI0OW/QWgiqlUZIBFbNkFijcChgHIAaHfkMM/KMGnqSwlx9KwdWsFrpWW0DaGwjqPZh3hIArbFtGM1to2iStY/ytVlr0G3HGBo7aXOe1/vs/Qaan9XKz6FnNtD+HJAB/paisnq09ozh6pv2Mn99ip/95l/w0S/+EW9/+Ft89tf/inc++Qdcs/0BjCz6NhrpaYHaEbT1rqKHtiGf6SOTTiAgQcGROPtbQQheEIr5Z8/HgnkLCDECifGJ5JFps1N6X1x8JsUJ71g+o/ngfHPh0fM0z8tyCM2FxVJCC9CzpBQFjcKDdUoxlaKFRU/aSyWWUyX6tZeAVTMc1jAUmjF/1dbRmzQo9Ko6ApoNcQLDQRWkdg4srbmDkDpG0Nw5atak+x2jaOkYp03wuVOtSbddzpr4nmaZ95re39LOxwaSAPW/aA2tBEgzr6bV8eCR1foQGwSRxhxb3dCN/rGlOHDPUXz8i7/Dl3/3r/jol/8R73z8O3z0xX/C6z/5Na7ZcQi9E5vR0LkUNS1TPJgW87dOILugkeGxAGH0sAgKkdDQKJzDnDZPee2cBQgNDmWIjGM9R2/LzKa5qbLkZKlKrfPQu7SW5nKaEx+qzWY9TLMdEh5a4nCzADa36JlN8vLIKaBiVJFZRNVYTMWowjWgwpZhsUw5TLnMZD3lPEON5S+DpgFxA1PHI71BwOgFfphrpGlgWwiold5j1klQtGa7nUBb1zRauxZ6Ns3naLrV890L0dbD53mr1+a+r5VSvLNvsQGtZ/jUbVv3BN87bgeFPLq1a9yJHH4/fS/z1JYRiqJ+jEyuwaFjJ/ARBcgXf/df8Ovf/xs++dU/49O//hd62t9i5x2PY2D6QtS1LUFn/xr+/UKG2EGOC2u29FKEUuaHhoYiODgE8+hhf/mX83D22QsQHBRG+R9Lp8ogjzzyyCcbzaDQ61iEE1w+P0C1A/OaCRHnZX4eM6OHuXlFV0z7sx1mCo0UH0VUi4UEVhRggmboKKEAKRU0hpJyqi0VwH4NVUUZX23yXcAUknh0W65xucfylLyAgMxY48ij2giovXMS7V3O2mit3bJpDvYi2mK7be061WZf823u6wvpcQTVNUWb5kHCkMoDpb13ijZp4Jp4wMjzq+hl8tKGllH+hj6cd8H1ePMHn+NXf/Nf8dmXf8Bv/+l/4lcsrL/4+3/D57/9V+y4/Tg9bRM9bRm9jGKEt81t0ywhupCUXIzgkHiEhIYjJCQYQUHytPmENh/z54cgnEDjWXSnp2eTgeORKU4UJynyuNRUQfMWORUeBc3ztmxCs9Vob85xBtocea9bm/WgvHfAGCIpPgLyMlOJ7UzkTOI05QTlBoWZOgKbAWWmXENYHLgmhS+FMoKRtRqkKXQQUCc9x7cOWa9sEW0J2nvm2iwo3f+61wwiva6rdzG6+5fy/qTlvxaG1lZ6nqC1906zjOjn4ykDW09wl125G2+89Rk++vz3+PEHv6PU/2d88bf/hn/4zyC4/4ED9z+LiRWXokqhsYOf272cB+kYo1AXklNLMX9BHCGFEVoYvS2YsBYwTBIaazYHLYUhMsuinzSFol621jXTtCCbh7O0HO76QBw4C5H+G80cNDd1pblF52UGzs9nmvUwD2s6IzRfKTqFqITvvEvAFHaaORjOlIMEjEc/IfnWRuvoWURYi2yAbZD7lqCLpjDXqdv+Zbz1bSlBzpoen/6cD7qDEHv4t/rMDobS7v4l6B5YQmAKlWPoGiDcHv7/vkUUR2PoG1mNbbsewBvf/xk+/vwf8f7Hf48fGbh/wd/+M5jf/gX3PXIS06u2oLZtEUXRUubXpYwgU4w6vUhKKSa0WEKKoJfRmMfmzZ9v0JTfQlhwx8Yk2qSyVsUV8QROTGw9jyVDigOn2qHAQqTMgXN9Hb4pv/kz+Q6cmx0QNBWemrdTLgtUyhy0ctY2lbXMZYSmwlZ1jhK7k+/O06TomuldLQxVM8Yj3mDRm3xrN++aBSdos+CcdQ8sR1f/XJsFqftnet6H3KvX+dmtHZP2+X0sivV/JWy6BpehhUBrW8Ywvvh87L/rcbz1zhf48U//Bm/+8Eu89v2fU0l+QXD/GX/163/DA8fewKJzt6JndBM6BtbyM5ZQZE2grLoHmbmViIxJJaAwU49BUo+U++fMm49vEdwC5bXoBCrHTJvzzc1TfSwWnhNll5AVFajApZOgGlkcOBcqFR5nZva9vGY1msSIZkIMWr3N02mmwKaqPGAup816moPmajFJa9Vcfh6TlylnaMBkbQxZEhkGi+GvnYMo66B10kO6aN0caJm8RKGtk9ZF6x5c4WzAN0LyYOr+zOv2Hu81Pc/XeweWYXBopR0M+v86INoJsp4RoJHfqZnhdPHqy3DnA8/i9bd/gTcI7OT3fo6XXv+cNdsHeOvd3+DdT/8Rdx8+iXPP247mnjWoa1/Gv2V4bGV45QGZzzo2JDwBQSFRzG3hOJsiJJiFtYFjmJzP++ERsdaSp2Wx3JmlL62q+5EvALVDqEWP4FyLmYCpoUf3Z8DNiBEpRy1yVqJAYdKT+4Imb9P8ok3IMjT64fHMwHzxofDo5LtyigarnSKhgwOk0NUhLzIo9AjzFkKid8h6bKBXoEdwBmcB9Ayu9Exg5ppeW4Fegpn7Hv99PXxdHjc0vAp9+jweHD28beV3aWibRCffv2rjtTj+nbfxylt/hede/Qgnv/9LPP/qp3jqxAd4/Z2/xitv/xI373sUY8uuQPvgRrQPbELf+AUEvoLyfxxlFGOJTElnLwjDOQuCCS6U3iblGEwvE7xQipQoWyzVJL3GWyso/kqKWDgeZdYOYeAyMoodLMZT6w0URA+cVnUl/W2+kTmtUKa8phqNwDTd40OrpGKsqqOX1dPLGBZVSDtgkvea2fDUoqApPMrLPA9r5yB1ElgXc08XvclCm4BwAGe8hMB8aL0cTFkPYXR5r+u+bzN/M+e1XoKRzdz336f/I2+2/78E/Xx+aHwtvZ4Ah1dj8yU7cOzpt3Hiu5/i1e//As+d/BTPvvIJPe0jPH+SHvfKx9h555MYWXYpGnpWo3v0fILbyPy2lN62EKU1vYhLLcCC8Fh6XBTmU4gsCFqAsDACmz+P91kKhEQyRDKvpeUatBKWVJqQ19hrUkMc5ESa+83ODjBU5uMs62kkKJcAvdymJXhNEnuh8dSc5qBpVtzN5Ksuk8SnAKGX2SRuE4tUFa0qXjUbYXWYU4uWwzzpLdGhkKQ80+V5lIkIzzoZwgyMN8jyMgPnwTNIsmHeF5SvMb2nl6Kib3Q1H6/k7bl2XweGeSs/r4+f16/P7Nf/WYmBsXW49Or9ePrF9/Dymz+jx/0Yz776CZ448VM8/vxPcfzZ9/j4M0r+J9EzfR7q6F2NveeisXs1oS1jqFyCqqZxJGdXIjgqmeCiERwRQXBBWBA8nx5G+T//HFqwQVMtrTXKAOtfTcpbo5QinPXgVDBtaeJe4MoIrmAWnFSLg+Zc0rqs+EdqzhS0Ik2gWnicC03rVVobUzE9C03A6jXz0MrQ6EGTWmw2aAImwcEcRpO6s1CoXOSFRT9EdnJQNei+F1nI87zNQp9McEboQQTzdab3CJSA6UDQ5+pvDCQ/Q3lwbHKjfW533woMT2zEtTfdixOvEdQL79Lj3iGod/H4C+/jUd7KTrz+c2zb+xg6RzaguH4U5S3TqGWdVst6raZ1EcobRpBR0IDQmAycHRyFb9Gz5oXQy0IoSmih4cpp4SzAo2waSzWyZp40CS+1PtOg5IOzFReCy5kDzoVGFdoSJHJLtyRjXU2aDRE4TRRbTnPh0UFjiNQ6mU0Ga37RhyZgDI3tHjSqsxkvEzDCEjCZPMzEg2d+iPQ9TYM+E+LMOOAC4T1/JlBfZwPjazA0uR79Y2vssUD204bG1zNsL8IgvWzJysuw7dbDePL5d/HQ8bfw6DM/wrFnfoxj33kX9z/yJp588UMcfepH2HnbUxic/DYqm6cJbQqBhnGU1o+xbptENVVkXqAVkYn5mE9BojC5ICyS0EIQFEYlSa+TRUbHID4h1UKilrm03KX1SU3Gu/4bhUxN2KurTEwq6VzlDlymB04NmSb7tSzjQ9MfWk7zFaTzNn+5X96m5ZfqOs3ZaQafOc2fX9RUlc1+eOHR6jHnaQ6aq6ckyWeEhGDNAPOg+QPvwXK2Gv0aeN8s9H299VpYXIGuoRWEt9ae6+TBoc8fnFjHg4JQRwlt1eU4eO8zeJZK8dCjb+AQwT1w7E089NgP8MCj38NDj79NiD/BTbsfxcDEBcxfY6homERZwxgC9SMoqx9GWd0APa2OnpaJkKgUBEcmIIx1WVhUHILDIpjnIrFA4oQWn5hiLXflFY2oqW1HmaYIpR04zlLtinRKU2pIUiu9mpKyZ8BllyJLITKf9Zotzah/kS4qaMprmhUxT3PeprYCB85Bq5w7faXCmiLE5he9KSubS6S3zYUmL5s1hUiGKIIzted7mQ/MMwNEYL71jzhvOR3SmUye5rxsNu/ZZ9rrfI3QVm24BgfufhqPPPV93HP4VdpJetgbuOvwa7j9wZdx+Ikf4vhz72PrtkMYW3wpARFW7SgKK/pRWj2MQM0gb3tRzEiUyjENiqD0p6cFhcUgNCIOYZT6IaHRJvllMbHJHPcijnEVqglNq/qup8W1RaiN0PWH1hkLtdBrlT07t4JFvEJlDusETSAX0NtMfsrT5oZHT0FaiHTepvAoaFVamdYqtBYzBc287XRolPueCLF6jLBMNTKvOJO3EZZM4OhpGmB5SS8H9ozgeP9PhSbT3/d78GbCL/+H7ssDN118C2679zt4lJL/jkMncODe53DwgRdx6x3P4Lb7X8SD9DaFx+37H+d32ozKxikUVQ5S5o+gqLwPAd2v7kduURMSWV5FxqUhWNBCIxGiSWSzGCrJOISHxyM2NtUmPUpKqukAzaitV0tGB8fWOYXglZTS6wSPDMTCtdDXEFwlwRUSHBVkDhNjbiG9Td1Xvor0ZkX8vOZCpMtpAlZTr2UNrVMxpxGa6rMGyv0ZYDbXKE8jNBbTmt0wEWK5zAuNhGXQBukFUnQz4DxoYz44hsfTwPli40+xmc+kSZQIYAe/i8LkZdfsw12HnmdN9i7uJLQdtz2GfQS3be9x7Lr9aXrcSfO0a7cfxsDkBVSKU+ZlxZUDhNaLUt4vJ7iK6j5k59ciMobQCCosQks10YiKoofpcWgsoiKSERWZjBTWYaWEUVvThvqGboLrttSj8VVvjTSEdbqZ5xEcWQiaA1dFcEU4S8nOJT56m5ZoSNaaUueA85t4/HpNClJrUv68Y4MmiNvOIPdZVKtGk6epPrNazA+JAkWhMWMWwvicwpm8TdBkUn4adPPA002vu/f18LaTn+uAKnetwfAk89mIPGwFYem9zpP76H1jS87HdTvuxcNPvM7c9TpuJ7Sdtz+Ba3cexvYDj+GmPcfobSdw5Kl3cMOtj/B/nIeiKuYwCpC8sl6Dl1fajRLCC5T3MGrVIT4pn2ExkXmMoKJiCDCcYVHLNlEGLjoqFQnxVJD0mjpGrAaOYb0WjVn3WluElrt0K6+TszDSaQK/iDpDTbL5dKicPHpcKsHl5TA08oOKKDUL8+ltanzx2w2sZmsktGZCY16zWRGC4xEyO+8oIaLlF8r9jil62UJ6mVtKae8itG6vsKb5Mx9zc9mMecBmbIxgfHh/xLoFTXAJRHC6h+hNYytpEjLLCI23ZqvRSYEytuwCbL/tKB4/8Q4OP/kG9j/4HG7cfwzX7zlq4LbtP469d3+HSvLH2LbvOLoo+SvoafmV/cgOdKOwagDF1UMoIMDSil7mohYkpxYjOjYDYRIjkfS26FjeRhFkFHNbJAEmIDExh6VXOaoqO9DSPEJvG2S9O0Av7nUdaGqJ8MCVq+RSuyLrOpUHKssKimuoQ6qQnCZwdD2dW1bEJ4robT4066GfgdbKI0H9IG4qS9A0haWFxwYtxZinEVqnlKPqM7eUImidPZpfnJ2uch4naGcAZ6FsrocRzJ9kayjNN2Js0XlUpcsxwM8aFviBpRgcXYnhcYZM/o+BsbVYsf5q7L79OL7zyvsUIm9hz51PYNuBR7Fl2/24Yc8juHH3I9h3z3N4kGpyx/4n0DW8kYqRUp9iJI/5LLO4A8UUIiU0hcqiQIct00REpbM2SzQhEs7wGBETh1CGSpfnYhAXn0FvqTAoLRy3do5ZfYOboKim11n7YJ0DVynFLj1BlalOOLUx2gK1PI+MUtKLCS7PnWBRLGh0RZ29ImhyU2v3ZsJUI4/1M86B5nLaqHlbc4fWzRQepRw1KezVaDR5mgGjuRkPGr3N1WCz4EyQCJhnf04OkzIcGFtv9Vg/pf0Yc9eA/g/D84he1/+lrT/vBtx3+CW8/PqneOyZt7Fj7yO4addhay24esdDuGnvMea1p3D0yXew88CT6B7eROU4wWJ6CrllfchneCyo6ENhZQ8KyrsYKtuRmVuL8Mg0LAhmrRbCsCjVGE14NIXMBSH0tqgkpLPs0lg2EVRH1wTaWCZpTVItEppl0uSFNSNpBoohU53b6oJTN1ygjOHS6ypQnjNw+QWu912LouZtXoOP69V3KlKdw+ppVF+I5h+tDU6TxW1qvNGip0Kk87a5ct8Pj/40VR89rU/QmNN8UOZp/6vgWBr0DhHeyFqMEN4AxY7AjYxQSVL8DA6vwXkX3IyHjp7EiZOf4GHWZ/vueArXb3sQN2x/CNcS2rW3HsFeetqBe1/AzXuOY3rFVcgt4YA2L0Kgbhy5AXoXQ2R+OUNlRSelfw8yWa/FJORSiDCvMYeFUklGRCdQoCTwNp6hMp5QE+mR+YxeTRy3fmu7aFPLhdQ3VbganjRpIb2gSQxNZmgmSl5nvaas8UoJrpjgSghOpYHzOIHTaUwqtJXXvBMtXM++K7TVjFonaOZtrifEJoxNkLjcpjYA522uqDYF6YVHH1o/gfUTkhXRM5D+18EpBGqaanCUXsearG9gFcYIcJReODa+EZdv2YdnnvsxXnz1ExxibbaPMv+aG+/H9t3HcPUN9+HKG+/Dzjuexj1Hvkv1+DBD73ksrKcNXHHVKL2LwOhxBcxn+WWdrNnocTywY5LyGA6TmL/oYV59Fh5FYDJCi4yhgkyj7KfAUwdZmzxNjUsqlwiutUudZ8M2Peh6PAesHhY8qXd5aMDA6UQTLVg7cC7HFSrxCRpVpPU+0tPK6KbWs+9UjrqZ1ECqEGmz/NYGN34KNNci4GZEZuYeTwM3QED9VjwTyhxIPjiT+Z7pParV/hTrHaY4IayBsQ0YmdxEz2O9xsJeEK+85jY8++J7OPnWz3D4+JvYdduT2E7BcTOV4uVb78Q1Nz+InQefxL3H3sD1tx7F6OLLkFsquT9Cr2KRXTOGQoLLpYLML+siyC4UUWHHpeRhPuuyUAIKDY8iNBbaDI2q21w5kECVmcPwRmitQ+jQKnqvUokamRSl1BKhNgmOJ8dUY6vQqZpY4y2vkyCUxggwz5XQ6wRQrFLS6HG5BJfPEKlCTwVfIKDYSmiVTJLVru3bOoU9L7NWA7UXeGKkpVMqUguPS/8EcKs5qBxsb9bDBIgPTl7o12keXHvfn2B9Con0sJGF51FBruNnr8HEovOx9cY78ezLmt3/DPcffQ27COgGwrn65gdwDcPk9TsO45a9j2L/fc9TTT5MdboZNa1LkRdgjVYxguKKYeQW9xAcpX+AnlZLrwu0uCI7Ph1h0Yn0MHob1WMUxUh4pMKlmymJjktHFkstlU3qjVGLhbVgEF5b7xSa6W2tPTrwOaaabWpmyGRpZV5HcIpy6oYr1wK1By/AfKcyTd1hs+AC3lwkwZWZt7HQJjj17esoUJHt94jYAihzmmtxo7cJWu8ymzx2YVLqcVaQWIikDWqgDYwD5UIin6OkN+/xPG0uuAE+Lxtk0Tw8sd7+n14bndpgImdkkiFxehNLCBbVPDg0iTwytRE37rwPb/zwF3jlrc9w39FXcQsl/jW3HMI1LKSvueUhg3c9Ye2761ncsPsousY2USmOoqhS01fjyA9QiAT6CG8AZbVD9ECFx1ak5pQhIpZFtsIjc1lkTLwV2tGxrgwIYs0WEZ2EjOyAtamrE001rCYgbEXEA9fSQ6/rGkWrGnUFjmOrlg6FSgNHh6mgKFSHnLWFeOfoFTEqGjgLlQRXTDcsZV7T6U06S0beJmg1dWoAnW058D3OwHXL23gk0cvaCczymzc7MnftTNDkbV8FRy+bA25uqJwJmXqdps8cJpRB5rMhqUaCEji71WdPbsDA+DpMLDkPV91wEM+/+h5eeO0DPHDsJAUH4dDTrt95BFu3PYTLr7uHdjdupvS/4PJ9GF9+OYprmcsqBpFT0kNIrNEIrbSKsp+1W1ntAO93IZMlU3RCFkJYq4VGxhmoMBbYESy2rW5jGRAZm2xbZOgcPLUUaqlK310HtFb22/t4oPdx7HoZtbpHOX4T1ntjHdUcX+sxlUipV1GudsZ2awsRPB9cWnoAZxUU1bFGoChRsScVWXEGaN6UloVK9Th6s/2tPIJaKUhmwElJKkQSlg9uRpR48HTrg3O5jYAIxvLdHKD22IOn10emN6JD/SUcBD3WdNXI9AZ73ZZ8+HcSKbceOILXvvcZXnn9YzzyxJvYe8eTuJaedhVz2ZYb7sfGi/daX8jGi3bj9vtOYPNFt6KqeRpFLKiLCEq5rIhellfCQrhuCKX0tGJGoGwe4LFJuQgOj0cIvS1SqpG5LTiMdRoBLtDsCBVlamahNU01t49wLJbYwaW6VXOyBo/PtffzgO+b5LiNs9adpMJUK4cTLAqXSk1q+3BtjTrNi+GS5k8+p2eU4awiyn/LbVa3aZJzDjhNIPNDZkWJm4t0E8cMkwTXxvBo0AjMLdHQ2/hFtSgpaHPBGTSalQMeNAfO3c59LDhzTV6pdTrB8oFr1l/3BVVeuO3WB3DyzU/ww3d/haOPvY79dz6JHfsexXUMj1tvOYwLr7wDC1ddi0Wrr8XydTfg3kMnseWau9xMf/0opX4vw2EPRckAQXGwqnsRoLqTp0XFZyIojEKE3hYZk4hI5rZIepvyWjDVpFYC4pKzLHI1UeIrl6mJyc3DrrIVEK2EdPK5jn4e7AZuwsC1as3SwI2ak0ik6FQwA1ens4LExVs5YDrLyCzHWcWS/3zgir254LoJzrXUqQSQMlIbuCaQNRdprXO98jaB05dhbjNo9DQDdGZwrhxwnmTzhh40H5YACYhm7WWaEJY5aBsxufQC+396bnThJruv5249cBTf//GXeJXgHjz6Ch8/yjz3EG5kfXbR1Xdg5ebtWLTmBowtvQrrLtyNa7cdxnMvf4rLr76TdRnFSM0QUvObkV3MnFLTh6KydnpbG/Ko4uKSs83TFoRGG7To2EREUEVG0SLpZaEUKTFJWSzIa3hgDzMCLOFvZGTQATbEiDCwmnlOHueBY7hs79MEvMAx32kSg6Z+nLpGCZRBW9+0mZR6lgU16gSn9lB5EGhGpsAFJP/5oII07UR4gvNbEb4WHP+ZZvwFrp1xW9CszcCbgzwTOD9M+uWA5bQ5ZhCV6wRtYi1z1joLhz48Pdb71F9iC6J8j16bWn4hbtlzCO988Fuc+O6HOPToSew+eJzh8X4W0pT8N9yLJetuxNjyqzG56jos37QTV9xwCIcfewfPvfI5P+NCpOa12fxjJqHllLRaPtPZQnlFNSywMxAalUAhQlgMjxHyNBk9LcKWa1i7xaUhI78c1U29PMAonkb5m0f5my0Pn2vg5HFdc8FRoJwZ3JADx0hXQQYCV3YmcGWS/xQllQSnc9WsFWGOt2mmpJEFYlObTohwrdnq7LW+R0pcB46iRN7m5RpThbyd62k+OJUD+kEDhOEvcMrLbH7SBydoU+vttp+ANJvfRWCaINbzE0vVSbUMw/TAA/c+gbd+8gVeZl677+jLuHnvw9i27yhu3HMEF159EMs23YyR5VdheNnVvL8Ll97wMPY/8Boef/Ez3LT7CdS0LEd2CUMkRUhRVR8lP2s45rTK+i7nacxnwarRvPnHCN1qyYY1WxSlfxSL7KTMYpRSSEgt9oxQSY9wHLw83TdMeIMM6awzu5nnuvi9OxkqOyhQ2nsm0cmxbNVcr2ritnGGymGOOdUl62abePbAlc0Bl5XhgatgbqtimNQ5yyq4Vbn70NRaJ2gtWmfz2hCU384MTrmLAFgQ98kYJvo12EPLMMIfNDbibod5RA6O8TVBEsDRte7v5IkKkfI0Sv9+3vbxsYAOTgkiC2sOSv/EuZhcfgGl/HF62m8o+T/FHYeexw562s37HsE1Ow9h05Z9mDx3K0ZX0tMYIs+9+AC23PII7jjyPTz5ys9w58Nvorp1BTKLWJtVDvK2HZrOqmkeYchrZP1WgwX0pgh6mqCdExzKUBnuyf84hIREIZqemEoFWcxxayW0gQnmXX43W4lgBNF0Xp/qTI6Fy3VqzZB4k4jTGiXzoMoDqXTVxjSdQ9HQ7OBVUWMoXKoksGbjCuU4epzAqW4TuErSFDjNTvtn09h6G4WJ2hHcbIkKb28FQGGS+W02xy23IrhvbANFixQjPYbFcA+/4PTkMly06UJsvehSrFy0HKPD03x+Gt1DzFsENDSyjjD5twQ9NL6BoZR/N7yWOe18hlCBW4NO5ozeccr/yVXMbetw4K5H8d7Hv8N36WmHKPl3Sz3uPIwrbr4f59PTFm24AUPLr8TYuddh9cX7sHX3Yzhw6DU8+sJHuPvImxicvgQ5pf3Mb0ME1WO1mmR/OYvs2OR8yvp0hITHIS4xzQuRWqaJYa6LoqqMRVRsKpLT8pkLm9BMgdE5uJTflQfVuESTwv8qPreMv4M5XyshPIDN+JzA2TkPaq2XE2iCXuA8kaKyoK5h0FS9Og1siw/ykWllPCOzgh5XxrzG3FZl3qamVoVJH9qQB82ttwmam5Okl3mCxM9vXTyadGpszxC9YnAdQ4K8aR2hLMNywtq+dSueuOdO7LjqSiyfmsaSRSsxPs3cpRDK93b1rMCwpqwmNjEv0Ot4f5D3+yeoIulxbQNLONj8PEJ74NgJOxH+Jea0Bx5+ETv3H8O12x/CVqrH8646iIVUjMMrrsIkc9uqS/bhUgqRW+58DkeefR/3PPoWplZvRTGLbdVseYFeFFJN1jaPU0H2Ij23mgoxGbGJmfSuJJsZETDJfwHUrEhoVCISBS3QYI1ROgC1DihYMl9g9WtpiY97tJg7A04eRyGnyQqqcpnOQmpTiaWIRng6965eua5+gGmLXqfVAlOWBGeqkuDKCa6SMd3OFLXWcT9MuvU28zR+oOuJdMs2rm+EiZbAfGjd/FJaGehlSBjioCshDzKXDQ0uppctwz237sJbTzyC5x68G3u2XmHwhul5gzwih0YIbHwzRieZuwiwm387PLXZZkMGmce6OQDDizejn/ntwAPP2AmDJ974BPcyp+2+83HmtGO4knXapsv3Y5JSv3/xZQyR12AVa7ZLtz2MPQ+8ikfoaQceOollm29GZcsipBe220p2EXNbOeu1yroBZOXXISouB/OCYhFNwSFwWqYJoxDRjL8eR0QLahZyi6ptgrhX6tHLzQLmlLHyN0UVn7OQyXxvC8cSbzLWt2oAdt3bzvPsfD+1e3CsVS9brpPCZB1tu0Do/EI6l8ClZ8zxOD+/+adCWdEtb2ufnZs8FZzzNB+cjqZRCokefqFBel1vvxYzmZdYbC5fuAwP7N2D7z5yP95+6gjefPwQdm7dgkVTizAyqoVPvm+YeY0AB0bWY5TQ+llMt/N/yNt6OACjSy/E/vuewdsf/R2eOfkh7jryCnbf/RS27rif9iBWX7AdI0uvwPjKrVh+3k6su+wgtux4BHsePIkHn3oXdx/7PqHdggJ6WoFWryuV23pQ1TRC9daPTHpaeHQm67JUhsUUmyTWMo3kvz/j76BlIzOvkvmnh1FlsalHgXEiy8FzAKkkBUslwQw4z+aA6yQ4zWXaSZoE10yP88FJXcqB7HxzFuKaAithEZ4ujwuUKek5N1Q/iZ0OxRrCeZzWiwTO97i5a24C50w1lsAN6ejqXYoBQuvppQhhzhuiGFk0tRT7b7oBbx0/hA9OHMeHLzyCt555FFsvvxRTUxQqfF8PlVfv4Fr+zUbmOCdaRhZuMDU5vuwC3MI67Xvv/xbPvf4ZDh56Cdtvf8LaDbbuOoQV59+EkWWXY2jJZVhOOOsvuw2X3fww7jr2Np44+XMKkreweP3NKGtejCyGxrQi1moNQyglsEBtD3IK1eSTgfn0tLCIJNsPMox1WxjBRRFcWEQ881088x5lf065iQblKJtXlRqWqPK8Tfd9m+lY02MB9OHNgGPK0SSGVgy03MNSSxMcarqSOJHHyYEETjMoPrg0gSu1SWWCYww1cAqVHjh/sdQPlb4w8cHNzXHWyMr7AxIYlMBdBKcm0xEqwaGRRdi0eg0O79mOD156El9+/wV8+d5beOHp49i8+dvMASsMVh9zm+SzFJjmJAfpwRMsrnfedhQvsrB+4sS7uOfoSWw/+Lj1h1x2071YecHNmFh1JT3tKqw8fycu3Ho3rth2BHvvP4mjz32Mg4ffxIrzdqG8ZSmyy/qRw3yWX9mNCg5MJevT1NxyxMRnsh4TKJ3aG0twGazVWGhT6ocTWnhkEsVIOlIySijLO03OD6nWHGekUGkjJczvK0DdUtaak/U8UKvzemyqWa/RBE/LTp08yNVIpfP/WulxWu6ZC04ep71Z5N0Cp9PXin1wAYZKWzCl5KxSe4IfKnXyIT/AQqVir4VKgfMWSwXMg+Zy3EpTlmrjHhzhjxjUTAjvT1It0usG+kawedlSPHvoLvz+4x/gD3/9KX735ae45757CUflwAqCc+3gY9Ob+QNX29LM9j2HceK1D3H82bdx56EXmNOexA27jzA8HsLK825GN3Pj4vXXm6ddeM09uHHfUwyLP8DRZz/CzjtfJNDrUdKwCIU1YwQ2gLwKKkgOSBl/ZybzVHh8GkMhi2spyDiGyNAYxOqW3qb+xwhC06ZomfS0cqYSLc0MMLIMUQ1LfPXqgNOyEsEJkn9fy0v22MDRWBLoN5nxwNTJJZ29HD+VU5rMUCFOrzNwdJY6lgQ1/J7aMkTbWGmy+RRwWsKR3NTmZtXabsmEibfKPWdu0g+Tc8XJ3D7/Lh5JnfpSlO/9/JLmQfoxrMV6JwVyISaGJ7Dtqi348K2X8C9/90v86x/+Bu+//yNce+NNzGtUlZod4dE5yJJgyaotuIny/sRrn+LRZ36Iuw+/hD13Mafdch+23HQPlm24HiMMjavO244Vm7ebp10nyc+cduiJnzD/vYSF596IsqalKKweYz5TaBxGgCKkqKoDuaV1CI1LRYhaDWjRkfF2snw4i+roaIZHgoxhaIyJy+BAlZos1wD3E5rCuDytT6UKf2c3f/dcYA4a871gydtOA2fFuKbA5oLrkWNMMi0xxxFcvXZ1oNdpBkW1nK0SUIcYuCyBq3TbG6mDq0bNmXPA2UnsOmGDR4MV3YSmUmAGnOdpMoHrHmOuope5BU5BXI1Oxv02/tBuFqUDw0uxasUaHLnvLvzui0/xP//bP+IP//gbPP3kI1iznqpy0Vqbzppcdgl2H3wKjz/3AY4/8z7ufPBV7Dz4BHbe/jguvGoflq7biqmVWzC9aivWXrAH52+5i9CO4+5H3sKRp9/Dtv3PYHz5VnrWYhRWjhHUCHPZCCobRy2nZRZUIyY5C6FUiqHRcfQqNavSWFhHEWAEw2NkVBJiGUKTU1lgs+iVgBhmSFQIV1gUmH7WngOqXXnf967TzaBZqPTAMRK56S8HTidy2hodwc16HEOlPE75zfM4WyVgOispb0F6VuX/RnBMvl38Qd36wrzfp6KT9Usnk3Mbn+uymM+jdWgaF55/Ad787ov4f//ld/gv//Qlvvj0bezdu4vgVmDRKgqRvYfx1IkP8eQLn2DXwedx6x3PU5w8iQuuOoBVF9yEiZWXY3LllVi1eQcuuOIelgPfwf3H38ZxSv4dB79DT9zC/LUU5Q0LDZqWayoaRij7meOK6wgtGyFRCfQ21mgxsQTnTWERmsKkoKnVLjG5AEUseHXW7CDFhxZyBW2Qt4oK/TxQ54bEM5nzOIFz3qYwaVNffo47EzjlOILTuRhaWFVt/X8QHE2TwPSyPooNzY73sPjuIrx2Pt+pRM1k3jmwkJ43gQP7b8Vf/+I9/OE3P8Xvf/Y9vPLi47jqxhuw88DdOPb069bXeOehN5nPnsYNe57GRdfdj9EVW7Bk43VYvOE6LN1wE6686Qh23f4K7n74bTx24mPsuuNZjC27kiFxCiU14wQ3SWATqGmeQFktJX9BDeJT8xDBEKn5x+DIKN7XpLHnbcx1ghYemYz4pDzzNJ09O8DoYdD4/QVD4IYnN/GWCtjAOUV5JptRmaYqnbJUW4epSoo8qcozgVOjsVTl/xVw3Twq1YXcTy/rt4lWvi6v43PmiQovFCptnUNYsXwpXnz2KH790ev48sffwa9/9kM8/+ITePDhh/Dgkcex7/ZHsf+u57D9wDMMj/dgkWb4qRyn116DdZfsxuU3PkhoL+DhJz7AEy98bu8bmL4E1a3LUNW8CMV2Bo1yxCgq6weQU1SHyDjKfNZi0fQqNwsSRbXIsMj7kVoBsNotEfGJucwlLfzNU+63EIA8rd/LaYI1NLnBTIryTMB8+yZwmj0ROIXhdv6vU+o4D5wV4HPAaY/M/63gZNYSzi/r2g2kKqmezHSfP4RxfkCAe6fR3taBnTdfhR+9egwfvvogfvXJq/j4g5N49Nh9uO3gbThw+4PYvvshXH7tXcxpN2Fq9bWYPPdaFtHbcPWOI9hx+7N44NF38PSLP8eu257HGMOjoAXqp1DTsghVjeMoq2GdVtVtdVpsYg5BJRKMVq8lSDTTr6ksFtksrlUGhIQl2A6tJYSm2lU1mJ0IqQNOIZL5zM9pLmTqeR2QXwXm2x8D56a9NGf59eC0xKbpSNXaai/JyPzfDo4x3fMsHZk6EcOWa2gSLIOU+wOsYUYEs6sfG9Ysw+P334q3Ht+Pz995Ar//zQ/xxsuP4ODem7Fn9x5cceXNWLXuSiyUEFm9FRsvP4ALr74T25jvDj/5IzzyDIXI3icxvvQq1HesYm2mU3inUFZHL2sYRW3zKAoZ7mISsq3/MUJhkMJDm55ZePSEiWo2eVos36cjup2Sv5ciScW15bNJhUR3K1O4nFmWsoPy681ONFERrmJcxs+1uUqN4deAU/9JQ9Mw6n1wtf+nwRkoyuCR9cxt62gUK5aYqSgJbWyU4YUJeogDMjI8jfHhQdy+bQteO7obn7z5MP7L33wPf/uz7+L7hHf0wTtx0YUXYWJqFZauuhTrv70D511xG2657Wk8QCFy5Kkf44ZdxzA0dRHq2pYzPOrc66V2hqi8rYpiJLeoEXGJedCpT5HRSRYO5V1RDI1RMe42koIkKjoFiSn5KCipt74PCSu1QsjDtOIxpHlT1aaENzAhUaI8p6YlgZudXD6TacXA1udslUDdAd6yDssAN0/pwM0NlXPB1dWfDq4ZGQqVAdVx1Z0E12Vb+Gmn1Prmfqg9em5Hl7WWEZr6JzVrMgvOmaa8NGvSP0RP448UtE4emT0EZ/2UBDdsc5GabViL8cmV6O/tw3UXb8Dz9+/AT1+8F//5Fy/hv/3u+/jDF2/SA5/Hw3fdiqsvvQTr11yAy7fsxtabHsJ9R9/Bg4/9FFfc9Ahz2mUMj0toi+lt06hrX4yqplGU1/Yit7COcDIp7VMRE51KuZ/gKcdoyvwEy21qZlWrXbyglTZSGIzydyw1GEPeCrwTIxtYk/I+TaFSIsVmSzSRbFNdZ/AyzwzgVzxOoZLjaDNQdAaKk3ar48ahHQJ9cBYqGwdmcpzW5bRFSUaW1uMIrkKr3vVagxO4HgdOrQqngJO3qen1TOCWU+auwJBWBAbkdZT//MGdJlYYIpnbtOY2NMIwQ3i94xsxNLYCE2NT2LxiER7aeSXePLoLv3r9Pvz27Yfxqx88jN9/8gJ+8c4zePzevbh883m46vJbcJCq8eC9b9LzDvGzr0BV+2pUNE+zXhsnuHFUt4yhmMV1Rk4Z4hOyEKkTCcOSERPOmiySoZDhMTpKzasxCKEwCQqPR3RyHkuEetTyQNXq9eCklmQUIl0OU55yoGbNFdku752e4/wmX9+sS83ym6C5uUpND2rWyTYxoOe1EZyaY9WSbuDo9cpxc1sYKtQ0JHAVTRQnZbPgRPWPg5PH6Sg5AzjeDg4yJNL0hSVIunXU8b76KQeGGVaG+MMZLrslUoYWYsnUQnx75SLcc90FePa2LXj5jktw8r4tePPh6/H2E7vw7H3X4cYLl2LlaB8u2nghbrz+Nmw4fyc961wUVk+huG4SgYYxVLWOoaJlECX8cam5JYiKp4fFJDEEMjzK02jRvB9jz8Vbj79OfYqNz0B+Ua2tOXYPL8PI9DoMT8mTvPlHg+RuTwUnZTlr3wRurijxl3Vcn+VSlgAcU3pcG8Wadupr0eapHSMce4ZJb65S5UCFVsF1cn81Q+UMOG178WeDm5vjnClUalcemc4CdX0Xuu/6TDTN09XH3KYET08cHZnGxlUr8PD+W3Dy0B48tv0C7N3Yi0dvXoMfPnoLHt21CZcsbsBIfQYGG4uxeGQQE6OLGMLlVYMorR9Hce0Ib/kDO8dQ2tiO9KIAIhNTWVQzBMqssUdyX0szMtVohKmclphtF3holacNLqV3qWuMOVgtEgbEeZQpyFOgOS9zNgvsm8E5aP4p1Joq1EK02zpkMb1NqwNqC+F461wCfic1DdU0DJBJH2wDb4LTNsIl5QSXSXASJz44mctx6uo6tWvZ5TgH76vixMGzL8k4bgW4Z6qDrEGIOU/lwPDYKoxPLMdofz+2XrAWP33pOH795hN49Z4bsHfTCO6/eiWe3HMxtq7qxHhdKloKItEaSEF3YyUaamoZ4xtRwChRQmBlzYRXN4Sc8lYkF5QiKiUdwYQVwpAYTpmvOi08inktLtF6R0JYDoRHpdnJ7+onbaYI62OY6tNBRxCS/lKRs5CU4wTOzZDMhsivLwG+GZyECceNYVIrLAInk/hr4cHXom2KtdWIgaO3UZhU1fWaeFSY1M6EalxOzwwQHHOC7eatE+rmgmsRODUICdyUA2dLEF+vKrv5JbUGdTo4TTgP8QfrzNDBgUmMDQzh3Mkh7Lj0XHz26iP4Tz99Ed97aBf2bJ7ElkXt2DRYhdEqwiqJRUNuOFrLUtHbXI76qgBVVSXyA3XIoywurulFfnknEvhDQlRU09tCBUitczH0thgBjOJ9QhTQiCSqzEIUFDWhiZ47MLiMKpffUYPrFdYSIkOMCkM6bYu5eMCmtnxoDtwsKImRPwec8zY/v2nS3jrCtaTD3CZozYx0Ov+wVt6mnpPaHtdzooYh62ZuZDlAcOVV2ku/ywOn1YHTPc41wP4xcF0yelaXfWGnpNzJG26loJ95cGhoEZZMTOLCFVPYc8VaHLxsKd6mKPmHHzyGF2+/BjetGcXmoXosayvFeH0+esrTUZ0Vidr8ePQ0BNBUU4rKigAqq2oRqGiwvT/SM4qRkJRj/fxRcWrsYajU+llMsp2IERmj3n5ZrL2vgCVCXeMIehm6Ryc3EI4rrFWnaRlKvS5Dk5sIbpOBk2ky+avgZlXknwPO4HHstDTmvM2BU+ujwOmM1QZ1MtepZaGXbLoJzHV56fwBedwccPI4dXe5ZR2/5XwW3CSBUbIauDnLOqeAW4VOApKpBHBtaQQmIcL7I8NL6GkjuGTNUhzZdRkOXb8WO85tw4HzBvDUjk2454oVuHy6A8vbAhioyEJTXgJaitPQWpqBiqw41BTK6yrR3VqH1gbmpoYGBPILkRQRjejgcESF07tC4xAakoBwqkhZcGg0IUYSYDwSk9Og3f+aW0ZsEVOdZIMEpKm44enz6GmbOMiaOFAodCBnTODMXHkwC05y/98Bbk6OEzjVymo2bpKu8MDVEpwahQTOrsTlgws08GAluFJbj+twjUIKlVQx/pk5mnpxPScOntutdZHFaPsC/DIO3ipTin388V0svrtZy/XzdogKUrXd8PByTA1PYuPiSRzecTlevv1yPLRlEvdc2IO969tw+VgAF49W4NyOQgwEktBZnISWohRUZcXTEpjjslGeGYv6ojT01Jegv7EMoy3VWNzVhKHqYpQkRCE5JBhJrNNiCC8yjDktip6nSeP4RMQlpaKotALdveMYpOdbzqUn9amYnt6MAU0Ye951JpuFJm+bBWcCzOD5j79qfjng5zg74P0cx1BpO9Gq6FaXOD2uQdtqEVxdPeu3mh7oaid2WZiqFpfjCC5D4qSEiV2uaK159DhtOnPKRtesKbS4p5lrfwbFtS6wnlO81pdhbdLFArutn6FxfDNVIwdlkGUAoY0xz40NTmLDkoV4+NateIGy/+iWMTxz42K8tm8N9m9oxdq2ZExXx2K6LgVDValozKOH5SaitaIAzYF8lKTFo7YgDXUFKWguSUdfVS6mWgLYPNKC61eN4JqVoxipLkJBLL3r7PmI1QkY8ekIV1dWQiqyi8p4VA8wx6oFkHmWIU8z+9287aYY6WMeU4j8OpsJlaeBm/W4M0OTWU/KjMd50Dh2Sjn+tvo+OHlcvSIea7fautPA6aSPueCKA0x45S3W+qVmWMnPuV7nti10U1/+WTq2tVM/i0c780TtC/I8Nces4xeiuuxn/uBRNtBDIdI3govWrsb921mn3X0dntu5Hi/fsgzv3X8RXtq5DNtX1mBlcwIGSkPQWRSKpoIoNBQlob40G9Ul+SjKSkV6fBRykmNQmBpjYbOtNA2TTUVY11+Nrcu7cfDiZbj/qvW4eLoHDXmpiAmehwULghBLTyusonrsGUHfmHYSoqdx4IfoacNTm2x1vl9t7jYbcgbzwc3kN5mvKh2wM0FTB7O15ClMnuJts9DUAmJ9qgyVWvHWhSp8cHUcf4XKyupuMzmWLgUg06ZBluOKSnXCnHZXULOQB26Oxxk4z+P8fbm01O7A8YvQ9TsH6HEqvJnTOruXYGhgGUPjYkz2DWLT4gk8vOdqvP3obry0/zx62Xp8/OAleOvAOhxYW48rRguwojWJHhOL1qIIVGaFo6Y4FRXFusw181VoCKIjwhF8zl8iKToUuUlRqM5LxmhzKVb112LzWCOuWtqFXetGcOOaEawbbUFLeQ7ys1P5uwJo6RkkmGUMh/QSDrhymJSjm8Zyc47+9JVfdM+a4HneZsB8m1sOnBman/vVljdbAhAao5V5W9ciKknNT04xJWmaS2XAoG2SoKtz1dRSUVYRXFUXc5uWc/wzUglOOa54Bhy9jvVcDWOraogzh0rlObeVe6d3voAPrYcep52ExkZXYnpkMaZ6evHtpeM4tvsK/PixHXj/2LX46UOX4JMjV+CNvefi9nXNuHq0COs7UhkiYzFck4yeqgzUlaQhPzMBCfExzFMxtk1gUEgYUlJTkUyQIfPPxoK/PAsp0UGoZuic6KzCeVMd2NRfhQ39ldg80cSDpQfLJrowOtiDkbEJFv0rDJA8q585yyaKGfZUc2oyYNBmSubaXIgC93XQTgUnaDqbyMSan/89b1NqUYqZ8bauhQZOWxw3akst1m6NrCvrdN4GRUk1S50KQpPZpmwBXeaz0bY0yfTB6ZKW7oqIEig6ldVtrObvhudCpU6vkrqc5pdYzCNoDrgBfml5HJ8fGZjCZP8Q1o33497rNuLT5/bhyxO34KOjF+Ovjl2E79+2Bkcu6cd1EwGc35OLRbWxGKuOwXBtBjorslHJUJcWT/keHs4COpp1mJpR46gQtUNPBKIo7ZMIMCE2ClGh8+iFQahiPlzYHMCilmKs6C3HWnrh+oWdWLt4BMunpzE+usRNdDNXDU6cR7nPPEx4QwQzoslk1pean5w1PfYAnpLbfKN6nONlPjTf0wRsJv/T/hg4neTRqNSk3FZLgcjazcBVaHuoTnMs5TZt0aV91jJ1KnEJc5zORLVrhFo9p/OP+QH6EMLzL0yk68xoWkarwhYq1Z1koVITpvzSzHPDI0sxoHW2RVSMN1yIt4/ciF+f2I5fP3MpPjq0Bm/tncRDF7Zg28JyfLs3D0vrUzFeGYex2gT0V9LbclKQTYGRGBmBGHqbzvYMj6RKjE1kjaZ2cD5HiFEx9Dxt2hkaipjYaKQlxKAoKQ4dzItTrSVY0lmKlX0VPHg6sWp0CNODUxgjOJ1YMjC+iR7HOm1qM0Zoaklwe32tcMaI4S/JuBwmr/KAsdSZ6SGhqYtLG27P9TY1O3UOOmgan68Dp65wgdPlYQSuQUtpHrgaipLqahbeBKcTTUsCLrfZ5qM+uFKC05moVazMFSrLq1Wta8dXuqy26m2mUGHstcZYncfVOWngLFzK8wjQ8trgEoz3DeDciX7cfu15eOex3fjixG788qlr8MlDm/DmnoU4dlk7diwpxZrGeExVRGO0MgHjdWmEloza3ATkc/CTmM+iGRqj1XUVLVkvSDH0uCjzuihCjI1PZqEdhxhNZRFu8PwgZMTFozI3EwON5ZjursOi7losHejAyrExhs1lmKYXjTLUDTJnyYssz/HWTm02WX+aEcSsR83CMiMsATNoM+BWnwqO0JROdD6c8pvtusBxUzklgadpRJ1WpZ4Wu46dSoAG5jaqSFk181tFRQfZtNsZw3adB+2OQXAZAmc7CJU3o5LJTysFJZV9KKerVjV2ElwXc123TcFocrepjfFYe/HrjMqeCfT0T2FwcDHaGKMXDk/jomVjuH3LSnz3ga349Jlb8FdPXouPDl+CN3avJLRBbF9UiXPrYzFVFYnh8ij0V8RjsIaelhuHtJgQxNLTYiNZi6lxx2b1CUa3keoH0R4iUVZMxyVoNVur1wmI5HvCQqIQy7BakJmN+vIKdDY0Yri7iwJphPl2EpOjzL2MBsN2bt5qjDAE6ryGIXqR7QTh5apTbU4eIxQ7/dkzV1R7ZuC0lHU6OKYSCjhLKTzA/c1pZvonvRYFneRvc5NUkrqyV7V5W5ddW08nmmprLtsQj6Z91oqK6pGertUBumE5XxQ4252ULlqhFVctrNZrKyhKbB4RmrfUzImqfdtAlDmvp2sUQ72jGOsdwYqRfjxy68V4/uCF+PDJm/DlCzvx3iE+vmkad62rx1UDWVhTH0NPC8dwRRRGalPRV5OJmrwEZBJafEQoorVfCD1IzanRUUnMZ8mIjFS7QQKBpVhLeEJSBpJTshCfkI74+Axapr03IjyGeS8RGamZKMorQm1VLbrauzE8MIbRkYUYZZ4bHl1uu+nppMohKUqa9f+fDuo08/tE7b0Gj2HUs9PBSYy4+UgHztQ3wfmdXNIJ1s2lEoDiT2tvDc3yNoIzUUKnIbhKrdowEupiie6Kl/I4giusQ3qaQiXFSTlfrChvJDjer3FlQRWToxKkrpFmU2A6MjrH0NChcDmFAR5VHc29aK2uwyVrVuDw7i146b5L8c4jV+DTp27ATw5diqevn8Tta+tw9VAaoYViYWUQJqqjMFSdgM7yVIa2JGTGRSBOuYrepL5GWaQaUuVNkWqXI7yoFERGp9pcY35hFRO2wjvjfnEtdI3tlNRcemEq36NurVjEMh+mZ2TzKK1Ec3Mnunhg9Q8vpBjRZtrKXdrS16lJhbk/DZyDN9fzHDganzdhMgecedoMNM2QqGZz0HRyh7xN7SFaPqtvYm5jCaCdLnQxX13YV2dQac/KgNSkB05XwSwkuLS0UoqTkiaUlRJcma4QTKtqNKFSQ2g1tfpAChSCq28bQo3m0WwLoyH0dY9hpKMHG6ZGcHz/tfjeI7fgO3tX4IPHrsB7D1+Gx64Zx14W11cNZWFdUzgWVQVhvCoUg1Vx6KpMR3lOIpKjIwmMOY2iI5qgoglJvY3h4XEUHtobK46elgZdiV5rUEX8ro3NIyzwqRLVt8GBaGIOrqptR35JNVIzCxCbmM48SA+MTkA87+cVBBhBWtDcNUwRonqOA04xYmeOTlBw0Pv+V8G5Ytur2QTOy2mz0JjTtHSjWpjQFCZVaskhNKGvze1cmFTBzRJAfUCa0WIkFDjlNj+/FRTUIjW1hOVAMXMbB6Scbygrq+eRXMf42opaeVuddnPTieQOWh3hdQ0wTrf2o72+GWvGBnFk5xb89Ml9eOXgRnz39pX4kJL/pV3LsGdlNa4cyMbaxmhMlH2LOW0BesvD0FQUg5LMeKQnxlM5JtjJFeEUIfKoqKg0C4/q29cEcQSfT0kvsC2rtJSvOrGXpYfaINzueGqJWE5vWoJGHlDldR22ZUVqtja0TkGIQm5CGlJzSlBSzcK8l3mZ4bJnjMrRA2en/Rq8rwLz7dQw6YAZNMtxztNmoUlBaobEiREHTQulzGseNIVJpR9T7oSm7SRdCx5DJL1NgiSgGa1S7WToSgBZYUEN8vNrkJJSjLMKi+SKhMY3lbFWKCtv4B+30m01b8kPZE2ns0Z0AkILwbW1dKO3pRnrpwZwaNtFeJfq8Z0HrsTjW8dYYF+M1/asxMG19bi0Nw0bW+KxmF42UhaEwcoYtJXGoyQjFvG+lzFvqUYLi5XkVzhMo+BIZglAkDEpSNFO4cy9CikKPdoVb1Cz+rRhqkNriaAY0Ba+vWq07dWVo4ZQUdeO7IJyxCVl2Tlt2sYpJasUxZWtqGdN2t6/2JSj6jeZa7E7MzQzD9QpwAjK5iA9YG52xJf9WkVx0HTBQrWw60xTB81rTaC3CZrOjtKpbW6DUYZIihKVZ9p60oVIeZouHOE2hM3Pq0ZKMsEVFEmtEJiB00Y12jSbxlynBpVKnS9HcApR7U29aKuuxdrxbjy0/Xz85Pg2/ODei/DsdVN4e/96vLVnPe5e14oretKxoSkWK+oiMVVNBVkZzRorEWWZCUiJjkGEXWKS4ZCAQgktODYC4dr0RTP6EWotSKWnFaKEeUwrw7qem470YU0GsxbTeXTam7JviKGOhb8JDSpFyfqeIdVOCzk4Ayhi7ZOSXsTQmYmImEwkppWgMNBKuOMcdAmV1WbfDO40FekD0wmKXuOPP6VlnmbQCEwTyN5am13PldCaVVJpBUDRi3lN0HTSovM27Vaoc73bbYNXFdvu+unaT1R7ZVfZBSO0o29ychHOyi90aiVQ0oAAKZubMvmXVlFp1lOkNLAkoLps5W1/UwvWDHXhzitX4eWD38ar+9fg+ZsncXLHEnz+8JWE1oar+vOwti4Ky6ojsLA2CuM1FCIlCShLi0FqVDRiWZPFyKuoFG3/kJhoBMWE21kzaloNJbgE5rQSliiaahMI9S9KSGgTNjtThp6nNj+1QwigzmJVbeZOf1KrxAr0Dy1BK71LJ22mZ5UjJiEP0fHMlTnVqKofgE7htStXCRzDoK2j+abHc2zW02aB+RPHzvwQKenvhUiDJm9jXuPvMGhaJpMYUV7zdj9Xn49t/eSBK6MoEbjZ3OYu02LXoqXXaQd1D5ziZx1KbS9m7UbayiKc8NRRJHh1baiuqEVnXQOWdTdj16YpPL9rA17auRQvbhvDT+5ajR/dvgbHL+vHpR3pWFcXh8XlIZiuisB4bRy6AwkoT49BelQU4sLiWW8lUYiwgGb+CeNzoRQoobGRCIlmrqPcj0/JRQE9RUncNZFqJoODyzzUr7BGgFZ3mVgQuI0MleouXs/n15l36DpwQ/S+If59JwdPl5ApKG5EVq6unNzMnDIMXauun4M/wjypExWdQHHmiu9Zm9tiNxeaYPnwnMcxTM4Bp8kKFyIdNIV8d51xl9scOLePiV3yhiWAph9t63oV3bpoB4G569LK66q9a+sUattDEmUMLSHZUs2H0YpU8NlsCnMdxUpbTQWm2iqxdXkXjm5dgjf2b8APDqzBu3dvwPv3b8KjW7pxcWcsJX8kFlWEYFJGgL0VCajIjEJ6dDjiw6ggCS6KwiPCNi9TI08khUkMwjQfSRWYkJZtF0PXPsU620cDajmEeUw5yU1HaWaDg6iBHCa8YQHb4NbUKFgEVAM7yPeMEPQAP0cTBuqdcTu2a75Vc63LGGq1Q/pa/h8XFk/3Nk1j2YHwDeD0Ocq/AqYw2cHc1m4zI1O2AO2LERXZMypS8t9ym7ytwyKcIoNym3ZVMDNRUmPg7GqZurpYfiWysgJISioQOBIlzeKSKpKtQHGpuyKjtvetpxIrzy/E6pF2bNs4hO/sIqz7L8RnD12CTx/4Nt4+sBYPXtCCi7qisaTiL7CqWeExDGPV4eirjEVNbjQyY0MZHiMQpevKhLjz0CKjIszCZfQ85TYJiXzWXQ1t/ax/FnKglNfcpK21/zH89VIRynS/m6/rYkZ9w+s4sOupFAlQs/6axuJAq0lpQHOQFC1+05Kb2nJA/Jl7g2agKOll/J9ua339X97SZqS/B861IMxC888qtb4cQmvvYphUO7nltFkxImAKkSb/ldsoSFx3sruIom1rSKGoLZYVJt3FOwhOlyHLLUMOLSNDV2zMJzi7CFIliop1BasyqphK1FRSWbIuqikswnBDJfZdthyv3HWx1Wc/Z532yaFv45Vti3DX+iZc3J2ElbVBWNsWiylCG2WB3VMWhdrcCOQkhiI+IgQRoREI0+w+LYKeFsnwGB4ZSSHCojs6BQmJkvy1/IH9HBBtcrOUR7oGnAPPgdZSivVoepO/JkJscAXGrbF1DsljtG6mFgPBWElYtFFCk6fqb2guj7mZjpktrHxwBu1UcDJfnJj3nwLNzUfalJYPTaJE4Ojh5mkKkZT+5mWe9HfQ6G06H4DgpJy11mbrbRSKdjEkgpOK1JUyZ8DlOHDJ8rhcuaGuqVNUxhxHgIUBlOQWorm8AuvG+nDrhctw4jZBuxzvHToPP777XDx/wygOrKrEZX1pOLchisV1CBbXR1M9RjKnRaM6KwyZMfMQEzofEWGhBiiUFqZuq2g18ETY7L7OnElOKfA6rwbQ1TfNI5vQKEhce58GTcBcKJtrM/nHwFKw0OOsv18gbaDlsSoVXHjV1YU7tL2HeS8/g3+jM4vc7L4+U0AdQN/8UClgLjzO1mlOiMzmNN/TDJr2q6Zytbxm0NRu57zMzE7ioPSnljgdXKFB0yyJiu0q8zhdQscHl5lZ6i5Dlst6J5+wCotKUZBfirysYjSUleGS1Ytw4r7teH7/xXh530Z87/b1eHXnIhy5uAU7l+TjyuFUbO6Ix9KacIwFQjFYGomBimTUZcciOzoYMUHnICwoiMU0FSNFSFgMc1lsDEKiYhAcri1xE5GYlGcruprE1n5Wuipwz8AShrAlBMCQSM/r1GPlOBtcKUq304EbcAdFa2c6/clWqyVa6B0SHn08APrlubRugnMbDcjzHDh9nsKtzfR7oORxNnXl2VfrNEn+OUs09DRrsdOuFLpwhqyd3sZ8OgONhba/z7I8rVqFtqCx7FL3VnGZdjl3C6Xa5VyXE9C1IJTTdNE/FyYDMx5noTK3oIzgSvnmEhQXlKKCeW7N5AiOHbgWX3z3QXz02A146roJPHp5r9mB1RW4cigFG9ujMFUxDwNF52AoEIX+QBKqM2KQEUFo8+fT28IR6508GEwPC6IQCSLA+cxxQToXLTEXeSxFFD46eifRO7jU9rbUJmW9w8uYe5TDlhg4tXq7k+ClGmXa0YDg5I2CxwHXKnz3AD2Q0IbokcO0Qb7uwHmNufJUraEJlmfW6EQwvvkLoDMmAWLQPNUoYFareUW2px61rmYXoNe+ZwZNZ9toOsvbkr7OhUfNjtiVPKpcg6usmILQjGq6gMCcVduVM+Vt2bpUnFnAwCUm5hEcvSw3vxh5BUWoKC7A6vFBPHn3Nrz//B34zZv34b9+cATv3H8R7trUgr2ranFRdypWUT1OlgehM/sv0F8agf7yJFRRPSaFz0N0yAJEhgQjKiwM4QyHwaFhCOL94IhIAiS0iDjEJuUgjzG8gj9GJ1x09C3koC+zxVhtUtbjnUTim4SBNdWq53HG9FglgTP1cFofJ593Myy6pao0oSLT+xRGHTyF1D7edhO4gzdr1m7I287+FfxuAibzVCPDohMiCotuGyer1RQarVabzWtujY3g1EMicOZprNeqtM7W6mS/PI3ApOxdga3Lasp0XVSGyDx5mnc5aXpeZqYHLidXF7QtQl5+EQbam3DnjZfiB08cxE+e2oVfvLwf//3jY/jFsztw1/nd2NSWgsUVkRgPhKMrZx7a80Io+elp2ZT8sUGIDg9GGKGZhTK3EVhoWDjDJYWJeVoMohIykMO4rQsBNbFW0wkPOttn7jW9TQDw6JeCk5Kz/Z2lIM046H+mabcDuy9ovG+PBY/P6fp1Xfx/6lRTG4bfQ2Pg+pZTdMjL1JmlJa3ZNTXt7qqt51Vc+wW21KOWagya+kesW0uT9T3ezIhqNW0I5E8g64oqmnKkEFFxzdB4CjSGRwfOu+gwH2faBdwNnF6gx+UVY6CtBfuvughPH7werx+6ER8/swefPr0d373rEuxY3YoVDckYKAxDb2E4+svi0V2RggpCiw/7CxbW8wlsAYJ1YXJaaAjBUU2Gsn7TlXdtQ7O4VGRRDOkCQK09rKe02SbzmXKVcpBbw/K6pGk+QN26+ok5yIxh7s8y93faY8TuM6T6e44YHP4vbQjuNgUnQBmft/MBuxUS1W4wp89fjVNd7iRELYT601iq0QwYc5q6tVx4ZGikelRotA2xK1RgU4jYlFadd+uEyFe8TWwITFeN9q+8L4+zHKe4mZ1dglzCa6SSvGLVMjy+/0a8+9QdePvIdtx3xTRuXtWBDd1FWNyQheasUDTnRaGzIg3FaeGIDPoP+NZfnIX56r6aP4/QggxaRHiU1WyhagMPi0VMXBqy88tRwYJTZ3626Ijlkat9+DuYx7QzuMLRLDy3o7qT33ONkP8d5sPzH5u852MTG/xf7cxftg2/CQ8JED7n9YfI26xHhALK+ks190hvOx2a6jO7BhGFSI2EiPKZB025zL/oQ6mms2x9rXZmEllCxAeXS3Cq2RQiBSwzq8iuyK88Z+IkUeCy3WX4c0i1OCsPS3p78eCO6/Dyg7txz9Z1uGyqEet6yzBRm4XeQCqaCxLRGsi0Wf6w+f8PQX2LeSwU84JCEEJg4dr+NoJFthp7tDVuRAISErKQnUtoDBeK/9YrrwVZzeUx/DTzVmFI61cOnlvyV7/GmeH9+eY8VtDcYwdO4VDgCMxkvVOKTjUqPDrVKBFiMyEqqhUWdeDNeNvs3KNqtFrK/Vrf05TPfCGibXk9aG4C2QGTOW+rcNByBU2CxDmUrhidkVloJk7p6QqVduV9l/CyWQZkpWSiPCcPSwe6cfnqKZw31YU1A7VYqBMxqnPRXJSO5tIc1BRlITU2nAKEcp957JygMETHp/A+Q2MIhQgfBy0I5200YmLoaTw4NJ2jRC3VZZOvDDt27jNNua6l2+2sbgJAAL1lf7/QnTUXRv8cE3zVYf5U1dzHphS9lWpBsn5+mlON/nPTNmWm8yis49hM7RxDzGluRsSgEZhqNF89+vOP2uROE8eCZuaBc0s1/gXaVWRLjDhvk3dlkUlmViHSM/LNMjOLCK5oDji6XzaTXh7dMY9eV5Kbhc66Moy012C0tRydVfloKctDTUEmClITkBwVhoggFtchITjn7Pk46z98y/Z0DA2NZLgMxjnnBBk4rWjrNChNnGr3AC0NtVAya31K8NTq55bz5X18jgPUppkHEwEcvK+AdEWvU3l/ns1Cd/d9gIIjlej2jNQqtTuoZszrxpJiVJNwnfIYraFF1n9K24FWsK1fRIuhlVpXkxAhON6qt6ekVEKEptmRQjczks/0oavqSzH6plwmT1OIzMwqQFp6rpmuZJyWVujESWYmEx7BZXGATaTkM2xmZaEwJwNlBFVTnIW6QD5qaaW5mUiJjUJ0WAiCzzkb8/7y7Jm99+fNp3qkCAlaEEILo6cl09NK+eWbUU911UyZ3NJKaNqQWwUqj153df5hDpY6pZU3JK9noepIt9O7aFqGsd1UGc58s10L/lQz4DTvsb/rgQ4UKUU7gLwQbts8SoRodl/h0Ws1cDWZWvSZyzTn2EQvo6dZr4ikvnpFZIJGL7NNXAlNO83bwqiuqiJoRYJWS2gKkYIluS8hQhXp3boQWcADPw+paTkEl8P7AleApORcnKVkJ/cTuAwSTsspZD7KR35uHgpyspCbkYys1ETkpCcjKS4aEaFBCKEI0axICIXIvLMXYN45IVSQEiGs1YLDbF+sTMZk9bDUMkmrnmlsYnihxzW1+OtSTOqtarZVI9KQlzcIj6a6SDWSVo+1WYymkwycwpY3pdRGa6dg0HPaL0SzLl9nBnzOlJT+Tp/pf5blLZ1/zZBtM/q0RsGSxFcntz91xd9hV1XUXGM9QyLN9ktmXaaVa10O2pk8zZm2my8pdl7m8po/KyJv08S+xAjzmVQjTfcFUt6Wlp7neZvA6TbPGqMSE7NwVhqTXVoqkx/hZTIZZuaTOEuD3OwCZKRmIEGn4zIkhhBUcPACqsdzMH/eOQgNDqYQUS4LwYIFoSb5g5jbIiJi+Xk5PMJqUUNFVcsfJllsoZLwGtVurVpH0GiNBNdk4BhGvZpIu4FrY2ntDK6pMA24AGnw/VYADbie1z5YHQLqwfwm05TU6aYwaCrR83oHb8wigqBpQzR/EdRNYdHrNLuvnOaJESf5VVgLGgtrzfTPiBDXnSVozmqdmTDR7IjvXRIfTvbrNj09n56Wax6XnqHbueCyCS5Nb3IelyVwclv+cZ5iLAHERycSWhjOPmc+5tHDzp4/H2fPm4cFBjKEITII5/D5INZsIfS6hMQMHkWs1apbCa2Ttx32o1SEqm9Q7X6aArKZctZzCjn1LX0mqTUwgmrGgdJgKbdo4ATSzVB4U0vqquagC6IAyuu+zgTWvM2DNwOSZhdpUOuhdjvQEozB0nYVFB0KjarJBIvfWWcyVfEgrKT4qFRo9IpqwZJqdBfo0zX41MCqhWlBc/0itoJNk4fpeusFzG35XnEtUBkUHiqupRwz+TiN4AQqI5PCJFPw5H0Cl0dwOQ6c5TgqywzCS0sv5GN6XCZrCCXC2EzK+jjMD4rAvOBwfGtBMP7ynAWER2DzgjFvHj2Oz+tKhUnJ2cxrAfvi1fxBBo1mjUcmkQmvTker+i1069amtCJsxWuzzsnTKrEzm4nwzDxQAkYe4pkPQfCkVr/ONB0l033bkEDmPdYpTgbMByfPUj6zyWGFRm2CJmC6LJiu6aYL8ukiDn54dFJfuVyeppYDAVN9JnOr2M67CtQ3Yks0BEZAWQQlHWCwOP6ZWbrPMMn76eQgeC7POYhpaflIScknuFz8/5II4NzpTKeiAAAAAElFTkSuQmCC", equip: { isEquip:true, equipSlot:"weapon", baseAtk:5, atk:5 } },
  // 장비(비스택) 샘플
  ,{ id:"archer_scroll", name:"아쳐소환주문서", desc:"판매 1400원", price:"14000원", qty:1, icon:"pet1.png" }
];

function renderShop(){
  if(!shopList) return;
  shopList.innerHTML = "";
  SHOP_ITEMS.forEach((it)=>{
    const row = document.createElement("div");
    row.className = "shopItem";

    const iconBox = document.createElement("div");
    iconBox.className = "shopIcon";
    const img = document.createElement("img");
    img.alt = it.name;
    img.src = it.icon || "";
    iconBox.appendChild(img);

    const meta = document.createElement("div");
    meta.className = "shopMeta";
    const nm = document.createElement("div");
    nm.className = "shopName";
    nm.textContent = it.name;
    const ds = document.createElement("div");
    ds.className = "shopDesc";
    ds.textContent = it.desc || "";
    const pr = document.createElement("div");
    pr.className = "shopPrice";
    pr.textContent = `가격: ${it.price || "-"}`;
    meta.appendChild(nm);
    meta.appendChild(ds);
    meta.appendChild(pr);

    const buy = document.createElement("button");
    buy.className = "shopBuy";
    buy.type = "button";
    buy.textContent = "구입";
    buy.addEventListener("click", (e)=>{
      e.preventDefault();
      e.stopPropagation();

      // ✅ 금화(골드)로 구매 처리
      const priceN = Math.max(0, parseInt(String(it.price||"0").replace(/[^0-9]/g,""), 10) || 0);

      // 현재 보유 골드 합산
      const goldHave = (function(){
        try{
          let s = 0;
          const inv = (window.inventory || []);
          for (const g of inv){
            if (!g) continue;
            if (g.id === "gold" || g.name === "골드"){
              s += (g.qty|0) || 1;
            }
          }
          return s|0;
        }catch(_){ return 0; }
      })();

      // 부족하면 상단 알림(아이템 습득 문구와 동일 톤/크기)
      if (priceN > 0 && goldHave < priceN){
        try{
          window.showTopNotice && window.showTopNotice("금화가 모자랍니다.", 1200, "rgb(255,70,70)");
          }catch(_){}
        try{ pushInfoLogLine?.("금화가 모자랍니다."); }catch(_){}
        return;
      }

      // 골드 차감
      if (priceN > 0){
        try{
          let need = priceN|0;
          const inv = (window.inventory || []);
          for (let i=0; i<inv.length && need>0; i++){
            const g = inv[i];
            if (!g) continue;
            if (g.id === "gold" || g.name === "골드"){
              const q = (g.qty|0) || 1;
              const sub = Math.min(q, need);
              const nq = q - sub;
              need -= sub;
              if (nq <= 0){
                inv.splice(i, 1);
                i--;
              }else{
                g.qty = nq;
              }
            }
          }
        }catch(_){}
      }

      const payload = {
        id: it.id,
        name: it.name,
        icon: it.icon,
        qty: it.qty|0 || 1
      };
      if(it.equip){
        Object.assign(payload, it.equip);
        payload.qty = 1;
      }
      try{ addItemToInventory(payload); }catch(_){}
      try{ renderInventoryPage(); }catch(_){}
            try{ window.showTopNotice && window.showTopNotice("상품을 구입했습니다.", 1200, "rgb(80,255,140)"); }catch(_){}
try{
        // 화면 연출
        if (window.player){
          spawnWordText(player.x, player.y - 32, "구입!", "rgba(255, 230, 140, 0.98)");
        }
      }catch(_){}
    });

    row.appendChild(iconBox);
    row.appendChild(meta);
    row.appendChild(buy);
    shopList.appendChild(row);
  });
}

function openShop(){
  if(!shopPanel) return;

  // ✅ 인벤은 유지한 채로, 상점은 '위에' 분리되어 뜨게
  // (z-index는 CSS에서 shopPanel이 invPanel보다 크게 설정됨)
  try{ makeDraggablePanel(shopPanel, { handleSelector: '.statHeader' }); }catch(_){}
  try{ shopPanel.__cancelDrag && shopPanel.__cancelDrag(); }catch(_){}

  if(!shopPanel.style.left || !shopPanel.style.top){
    shopPanel.classList.remove("hide");
    try{ void shopPanel.offsetWidth; }catch(_){}
    try{ centerPanel(shopPanel); }catch(_){}
  }else{
    shopPanel.classList.remove("hide");
  }
  try{ renderShop(); }catch(_){}
}
function closeShop(){
  shopPanel?.classList.add("hide");
}

// 버튼 이벤트
if (shopOpenBtn){
  ["pointerdown","pointerup","click"].forEach(ev=>{
    shopOpenBtn.addEventListener(ev, (e)=>{ e.stopPropagation(); }, {passive:false});
  });
  shopOpenBtn.addEventListener("click", (e)=>{
    e.preventDefault();
    openShop();
  });
}
shopCloseBtn?.addEventListener("click", (e)=>{
  e.stopPropagation();
  e.preventDefault();
  closeShop();
});

// ===== SELL UI =====
const sellOpenBtn = document.getElementById("sellOpenBtn");
const sellPanel   = document.getElementById("sellPanel");
const sellList    = document.getElementById("sellList");
const sellCloseBtn= document.getElementById("sellCloseBtn");
const sellAllBtn  = document.getElementById("sellAllBtn");
const sellHint    = document.getElementById("sellHint");

let sellBulkMode = false;
function setSellBulkMode(on){
  sellBulkMode = !!on;
  try{ sellHint?.classList.toggle("hide", !sellBulkMode); }catch(_){ }
  try{ sellPanel?.classList.toggle("bulk", sellBulkMode); }catch(_){ }
}

// 패널 내부 클릭은 "UI 입력"으로 고정
["pointerdown","click","dblclick","contextmenu"].forEach(ev=>{
  sellPanel?.addEventListener(ev, (e)=>{ e.stopPropagation(); }, {passive:false});
});

// 드래그 이동(상점 패널과 동일 방식)
(function enableSellDrag(){
  if(!sellPanel) return;
  const head = sellPanel.querySelector(".statHeader");
  if(!head) return;

  let dragging=false, sx=0, sy=0, sl=0, st=0;

  const onDown=(e)=>{
    // 버튼 클릭은 드래그 시작 금지
    const t = e.target;
    if(t && (t.closest("button") || t.closest("input") || t.closest("a"))) return;

    dragging=true;
    sellPanel.classList.add("dragging");

    const rect = sellPanel.getBoundingClientRect();
    sl = rect.left;
    st = rect.top;

    const p = (e.touches && e.touches[0]) ? e.touches[0] : e;
    sx = p.clientX;
    sy = p.clientY;

    e.preventDefault();
  };

  const onMove=(e)=>{
    if(!dragging) return;
    const p = (e.touches && e.touches[0]) ? e.touches[0] : e;
    const dx = p.clientX - sx;
    const dy = p.clientY - sy;

    // 화면 밖으로 너무 나가지 않게 클램프
    const w = sellPanel.offsetWidth || 340;
    const h = sellPanel.offsetHeight || 420;
    const maxL = Math.max(0, window.innerWidth - w);
    const maxT = Math.max(0, window.innerHeight - h);

    const nl = Math.max(0, Math.min(maxL, sl + dx));
    const nt = Math.max(0, Math.min(maxT, st + dy));

    sellPanel.style.left = nl + "px";
    sellPanel.style.top  = nt + "px";
    sellPanel.style.transform = "none";
    e.preventDefault();
  };

  const onUp=()=>{
    if(!dragging) return;
    dragging=false;
    sellPanel.classList.remove("dragging");
  };

  head.addEventListener("pointerdown", onDown, {passive:false});
  window.addEventListener("pointermove", onMove, {passive:false});
  window.addEventListener("pointerup", onUp, {passive:true});

  // 터치 보조
  head.addEventListener("touchstart", onDown, {passive:false});
  window.addEventListener("touchmove", onMove, {passive:false});
  window.addEventListener("touchend", onUp, {passive:true});
})();

function isSellBlocked(it){
  // 장착중인 장비는 판매 불가 + 금화 판매 불가
  if(!it) return true;

  // ✅ 금화는 판매 불가
  try{
    const id = String(it.id||"").toLowerCase();
    const name = String(it.name||"");
    const icon = String(it.icon||"").toLowerCase();
    if(id === "gold" || name === "골드" || name === "금화" || icon.includes("gold-1.png")){
      return true;
    }
  }catch(_){}

  if(it.uid && typeof isItemEquippedAny === "function" && isItemEquippedAny(it)) return true;
  return false;
}

function removeInventoryItemByRef(it){
  if(!it || !window.inventory) return false;
  const inv = window.inventory;
  const idx = inv.indexOf(it);
  if(idx < 0) return false;
  inv.splice(idx, 1);
  return true;
}


function sellAmount(it, amount){
  try{
    if(!it) return;
    if(isSellBlocked(it)) return;

    // ✅ 소모품/주문서/물약 등 스택 아이템은 수량만큼 판매(감소)
    let have = (it.qty|0);
    if(!have || have < 1) have = 1;

    let n = (amount|0);
    if(!n || n < 0) n = 0;
    if(n > have) n = have;

    if(n <= 0){
      try{ window.showTopNotice && window.showTopNotice("수치변환을 먼저 해주세요.", 1200, "rgb(255,70,70)", false); }catch(_){}
      return;
    }

    // ✅ 금화 획득(판매가 * 수량)
    const price = (typeof getSellPriceValue==="function") ? (getSellPriceValue(it)|0) : 0;
    if(price > 0){
      addGoldEarn(price * n);
    }

    if(n >= have){
      // 슬롯 전체 제거
      removeInventoryItemByRef(it);
    }else{
      it.qty = have - n;
    }

    // 선택값 리셋(UI 상태)
    try{ it._sellQty = 0; }catch(_){}

    // UI 갱신
    try{ if (typeof renderInventoryPage === "function") renderInventoryPage(); }catch(_){}
    try{ renderSellList(); }catch(_){}
    try{ if (typeof saveToLocal === "function") saveToLocal(); }catch(_){}

    try{
      const msg = (n >= 2) ? `판매 x${n}!` : "판매!";
      spawnWordText(player.x, player.y - 30, msg, "rgba(255,210,120,0.98)");
    }catch(_){}
  }catch(_){}
}

function sellOneEntry(it){
  if(!it) return;
  if(isSellBlocked(it)) return;

  // ✅ 소모품(스택)은 수량 선택 기반 판매(기본: 슬롯 전체)
  if(!it.uid){
    sellAmount(it, ((it._sellQty|0) || (it.qty|0) || 1));
    return;
  }

  // ✅ 장비(단일): 1개 판매 + 골드 획득
  const price = (typeof getSellPriceValue==="function") ? (getSellPriceValue(it)|0) : 0;
  if(price > 0) addGoldEarn(price);

  removeInventoryItemByRef(it);

  // UI 갱신
  try{ if (typeof renderInventoryPage === "function") renderInventoryPage(); }catch(_){}
  try{ renderSellList(); }catch(_){}
  try{ if (typeof saveToLocal === "function") saveToLocal(); }catch(_){}

  try{ spawnWordText(player.x, player.y - 30, "판매!", "rgba(255,210,120,0.98)"); }catch(_){}
}



function itemKindKey(it){
  if(!it) return "";
  // 같은 종류 판정 키:
  // - 소모품/재화(스택/비스택): id > kind > name 순으로
  // - 장비(uid 있음): id > kind > name + 장비슬롯(equipSlot) 기준으로 묶어서 "같은 장비"로 판단
  const base = (it.baseId ?? it.id ?? it.kind ?? it.name ?? "").toString();
  if(it.uid){
    const slot = (it.equipSlot ?? it.slot ?? it.part ?? "").toString();
    return "E|" + base + "|" + slot;
  }
  return "C|" + base;
}

function sellAllSameKind(clicked){
  if(!clicked || !window.inventory) return;
  const inv = window.inventory;
  const key = itemKindKey(clicked);
  if(!key) return;

  let soldCount = 0;
  let earned = 0;

  // 역순 루프(인덱스 안전)
  for(let i = inv.length - 1; i >= 0; i--){
    const it = inv[i];
    if(!it) continue;
    if(itemKindKey(it) !== key) continue;

    // ✅ 착용중인 장비/금화 등 판매 금지
    if(isSellBlocked(it)) continue;

    const price = (typeof getSellPriceValue==="function") ? (getSellPriceValue(it)|0) : 0;

    // 스택(소모품)
    if(!it.uid){
      const q = ((it.qty|0) || 1);
      if(price>0) earned += price * q;
      inv.splice(i, 1);
      soldCount += q; // 수량 기준
      continue;
    }

    // 장비(단일)
    if(price>0) earned += price;
    inv.splice(i, 1);
    soldCount += 1;
  }

  if(soldCount <= 0) return;

  if(earned>0) addGoldEarn(earned);

  // UI 갱신
  try{ if (typeof renderInventoryPage === "function") renderInventoryPage(); }catch(_){}
  try{ renderSellList(); }catch(_){}
  try{ if (typeof saveToLocal === "function") saveToLocal(); }catch(_){}

  try{
    const msg = (soldCount >= 2) ? `일괄판매 x${soldCount}!` : "판매!";
    spawnWordText(player.x, player.y - 30, msg, "rgba(255,210,120,0.98)");
  }catch(_){}
}


function sellAll(){
  if(!window.inventory) return;

  let soldCount = 0;
  let earned = 0;

  // 역순으로 돌면서 삭제(인덱스 깨짐 방지)
  for(let i=window.inventory.length-1; i>=0; i--){
    const it = window.inventory[i];
    if(!it) continue;
    if(isSellBlocked(it)) continue;

    const price = (typeof getSellPriceValue==="function") ? (getSellPriceValue(it)|0) : 0;

    if(!it.uid){
      const q = ((it.qty|0) || 1);
      if(price>0) earned += price * q;
      soldCount += q;
    }else{
      if(price>0) earned += price;
      soldCount += 1;
    }

    window.inventory.splice(i,1);
  }

  if(earned>0) addGoldEarn(earned);

  try{ if (typeof renderInventoryPage === "function") renderInventoryPage(); }catch(_){}
  try{ renderSellList(); }catch(_){}
  try{ if (typeof saveToLocal === "function") saveToLocal(); }catch(_){}

  try{
    const msg = (soldCount >= 2) ? `일괄판매 x${soldCount}!` : "일괄판매!";
    spawnWordText(player.x, player.y - 30, msg, "rgba(255,210,120,0.98)");
  }catch(_){}
}


function getSellPriceValue(it){
  if(!it) return 0;
  const k = (typeof itemKindKey==="function" ? itemKindKey(it) : (it.id||it.kind||it.name||"")).toString().toLowerCase();
  const nm = String(it.name||"");

  // HP/MP 물약: 2원
  if(k.includes("hp_potion") || k.includes("hppotion") || k.includes("hp potion") || (nm.includes("HP") && nm.includes("물약"))) return 2;
  if(k.includes("mp_potion") || k.includes("mppotion") || k.includes("mp potion") || (nm.includes("MP") && nm.includes("물약"))) return 2;

  // 무기강화주문서: 2200원
  if(k.includes("enforce") || k.includes("weapon_enforce") || k.includes("enforce_scroll") || k.includes("enforce scroll") || k.includes("무기강화") || nm.includes("무기강화")) return 2200;

  // 단검: 5원
  if(k.includes("dagger") || k.includes("단검") || nm.includes("단검")) return 5;

  // 아쳐소환주문서: 1400원
  if(k.includes("archer_scroll") || k.includes("archerscroll") || k.includes("archer summon") || (nm.includes("아쳐") && nm.includes("소환") && nm.includes("주문서")) || (nm.includes("아처") && nm.includes("소환") && nm.includes("주문서"))) return 1400;

  // 펫소환주문서: 1400원
  if((k.includes("pet") && (k.includes("summon") || k.includes("소환"))) || (nm.includes("펫") && nm.includes("소환"))) return 1400;

  return 0;
}

function getSellPriceText(it){
  const v = getSellPriceValue(it)|0;
  if(v<=0) return "";
  return `판매 ${v}원`;
}

function addGoldEarn(amount){
  amount = amount|0;
  if(!amount || amount <= 0) return;
  if(!window.inventory) window.inventory = [];
  let g = null;
  for(const it of window.inventory){
    if(!it) continue;
    const id = String(it.id||"").toLowerCase();
    const name = String(it.name||"");
    const icon = String(it.icon||"").toLowerCase();
    if(id==="gold" || name==="골드" || name==="금화" || icon.includes("gold-1.png")){
      g = it; break;
    }
  }
  if(g){
    g.qty = ((g.qty|0) + amount);
    if(g.qty < 0) g.qty = 0;
  }else{
    try{ addItemToInventory({ id:"gold", name:"골드", icon:"gold-1.png", qty:amount }); }
    catch(_){ window.inventory.push({ id:"gold", name:"골드", icon:"gold-1.png", qty:amount }); }
  }
}


function renderSellList(){
  if(!sellList) return;
  sellList.innerHTML = "";

  const inv = window.inventory || [];
  if(inv.length === 0){
    const empty = document.createElement("div");
    empty.style.padding = "10px";
    empty.style.color = "rgba(255,255,255,0.78)";
    empty.style.fontWeight = "900";
    empty.textContent = "판매할 아이템이 없습니다.";
    sellList.appendChild(empty);
    return;
  }

  // 보기 좋게: 장비 먼저, 그 다음 소모품
  const items = inv.slice().sort((a,b)=>{
    const ae = !!(a && a.uid);
    const be = !!(b && b.uid);
    if(ae !== be) return be - ae;
    const an = (a?.name||"").toString();
    const bn = (b?.name||"").toString();
    return an.localeCompare(bn);
  });

  for(const it of items){
    if(!it) continue;

    const row = document.createElement("div");
    row.className = "sellItem";

    // ✅ 일괄판매 모드: 아이템 행을 클릭하면 바로 판매
    row.addEventListener("click", ()=>{
      if(!sellBulkMode) return;
      if(isSellBlocked(it)) return;
      sellAllSameKind(it);
    });

    const icon = document.createElement("div");
    icon.className = "sellIcon";
    if(it.icon){
      const img = document.createElement("img");
      img.src = it.icon;
      img.alt = it.name || "item";
      icon.appendChild(img);
    }else{
      icon.textContent = "■";
      icon.style.color="rgba(255,255,255,0.6)";
      icon.style.fontWeight="1000";
    }

    const meta = document.createElement("div");
    meta.className = "sellMeta";

    const nm = document.createElement("div");
    nm.className = "sellName";
    const qty = (typeof it.qty==="number" ? (it.qty|0) : 1);
    nm.textContent = (it.name || "아이템") + (qty>1 ? ` x${qty}` : "");
    meta.appendChild(nm);

    const ds = document.createElement("div");
    ds.className = "sellDesc";
    const locked = isSellBlocked(it);
    const isEquip = !!it.uid;

    if(locked){
      // ✅ 금화는 판매 불가
      try{
        const id = String(it.id||"").toLowerCase();
        const name = String(it.name||"");
        const icon = String(it.icon||"").toLowerCase();
        if(id === "gold" || name === "골드" || name === "금화" || icon.includes("gold-1.png")){
          ds.textContent = "금화는 판매할 수 없습니다.";
        }else{
          ds.textContent = "장착중인 장비는 판매할 수 없습니다.";
        }
      }catch(_){
        ds.textContent = "장착중인 장비는 판매할 수 없습니다.";
      }
    }else if(isEquip){
      const enh = (it.enhance|0) || 0;
      ds.textContent = `장비 판매\n${enh>0?`강화 +${enh}\n`:``}(${it.equipSlot||"slot"})`;
    }else{
      ds.textContent = "소모품 판매";
    }
    // ✅ 대표님 요청: 판매 패널 설명란에 판매가 표시
    try{
      const sellText = getSellPriceText(it);
      if(sellText){
        ds.textContent = `${ds.textContent}\n${sellText}`;
      }
    }catch(_){}

    meta.appendChild(ds);

    // ✅ 소모품(주문서/물약 등 스택 아이템) 판매 수량 선택(◀ n ▶)
    // - 장비(uid 있음)는 표시 안함
    // - 기본값 0(수치변환 먼저 하게)
    let qtyBox = null;
    if(!it.uid){
      try{
        if(it._sellQty == null) it._sellQty = 0;
        const have = Math.max(1, (it.qty|0) || 1);

        qtyBox = document.createElement("div");
        qtyBox.className = "sellQtyBox" + (locked ? " disabled" : "");

        const dec = document.createElement("button");
        dec.type = "button";
        dec.className = "sellQtyBtn";
        dec.textContent = "◀";

        const num = document.createElement("div");
        num.className = "sellQtyNum";
        num.textContent = String(it._sellQty|0);

        const inc = document.createElement("button");
        inc.type = "button";
        inc.className = "sellQtyBtn";
        inc.textContent = "▶";

        const sync = ()=>{
          let v = (it._sellQty|0) || 0;
          if(v < 0) v = 0;
          if(v > have) v = have;
          it._sellQty = v;
          num.textContent = String(v);
        };

        dec.addEventListener("click",(e)=>{
          e.stopPropagation();
          it._sellQty = ((it._sellQty|0) || 0) - 1;
          sync();
        });
        inc.addEventListener("click",(e)=>{
          e.stopPropagation();
          it._sellQty = ((it._sellQty|0) || 0) + 1;
          sync();
        });

        sync();

        qtyBox.appendChild(dec);
        qtyBox.appendChild(num);
        qtyBox.appendChild(inc);
      }catch(_){}
    }

    const btns = document.createElement("div");
    btns.className = "sellBtns";

    const b1 = document.createElement("button");
    b1.className = "sellBtn";
    b1.type = "button";
    b1.textContent = "판매";
    if(locked) b1.classList.add("disabled");
    b1.addEventListener("click",(e)=>{
      e.stopPropagation();
      if(locked) return;

      // ✅ 소모품(주문서/물약 등 스택 아이템)은 수량 선택(◀ n ▶) 기반 판매
      if(!it.uid){
        const n = (it._sellQty|0) || 0;
        if(n <= 0){
          try{ window.showTopNotice && window.showTopNotice("수치변환을 먼저 해주세요.", 1200, "rgb(255,70,70)", false); }catch(_){}
          return;
        }
        sellAmount(it, n);
        return;
      }

      // 장비는 1개 판매
      sellOneEntry(it);
    });

    btns.appendChild(b1);

    // ✅ 대표님 요청: 수치변환기(◀ n ▶)를 판매버튼 바로 아래에 배치(패널 크기 증가 없이 작게)
    if(qtyBox) btns.appendChild(qtyBox);

row.appendChild(icon);
    row.appendChild(meta);
    row.appendChild(btns);

    sellList.appendChild(row);
  }
}

function openSell(){
  if(!sellPanel) return;
  sellPanel.classList.remove("hide");
  setSellBulkMode(false);
  // 기본 위치가 inv와 겹치면 살짝 우측으로 오프셋
  if(!sellPanel.dataset.posInit){
    sellPanel.dataset.posInit="1";
    try{
      const r = invPanel?.getBoundingClientRect?.();
      if(r){
        const nl = Math.min(window.innerWidth - (sellPanel.offsetWidth||340), r.left + 360);
        const nt = Math.min(window.innerHeight - (sellPanel.offsetHeight||420), r.top);
        if(Number.isFinite(nl) && Number.isFinite(nt)){
          sellPanel.style.left = Math.max(0,nl) + "px";
          sellPanel.style.top  = Math.max(0,nt) + "px";
          sellPanel.style.transform="none";
        }
      }
    }catch(_){}
  }
  renderSellList();
}

function closeSell(){
  setSellBulkMode(false);
  sellPanel?.classList.add("hide");
}

sellOpenBtn?.addEventListener("click",(e)=>{
  e.stopPropagation();
  e.preventDefault();
  openSell();
});
sellCloseBtn?.addEventListener("click",(e)=>{
  e.stopPropagation();
  e.preventDefault();
  closeSell();
});
sellAllBtn?.addEventListener("click",(e)=>{
  e.stopPropagation();
  e.preventDefault();
  setSellBulkMode(!sellBulkMode);
  if(sellBulkMode){
    try{ if(sellHint) sellHint.textContent = "일괄판매할 아이템을 클릭하세요."; }catch(_){ }
  }
});

invPrev?.addEventListener("click", (e)=>{
  e.preventDefault();
  invPage = Math.max(0, invPage-1);
  renderInventoryPage();
});
invNext?.addEventListener("click", (e)=>{
  e.preventDefault();
  invPage = Math.min(invTotalPages()-1, invPage+1);
  renderInventoryPage();
});
// ====== SAVE SYSTEM (로컬 자동 저장/불러오기/내보내기/가져오기/초기화) ======
  const SAVE_KEY = "warrior_rabbit_save_v1";
  // ✅ 부팅/맵 초기화 중에는 세이브가 기존 진행도를 덮어쓰지 않도록 일시 중단 플래그
  window.__SAVE_SUSPENDED = true; // ✅ 시작 전엔 저장 금지(덮어쓰기 방지)
  const LAST_MAP_KEY = "warrior_rabbit_last_map_v1";
// ✅ 종료/새로고침 직전에도 한번 더 저장(마지막 맵/상태 보존)
  window.addEventListener('beforeunload', ()=>{ try{ if (typeof saveToLocal === 'function') saveToLocal(); }catch(_){ } });
  window.addEventListener('pagehide', ()=>{ try{ if (typeof saveToLocal === 'function') saveToLocal(); }catch(_){ } });
  document.addEventListener('visibilitychange', ()=>{ try{ if (document.visibilityState==='hidden' && typeof saveToLocal==='function') saveToLocal(); }catch(_){ } }, {passive:true});

  // ✅ 세이브 불러오기 시점(게임 로직 초기화 전)에도 안전하게 쓰기 위한 전역 레벨 상한
  window.MAX_LEVEL = 100;


// ====== JSON 치트 방지(서명/검증) ======
// ⚠️ 클라(싱글)만으로는 100% 방지는 불가하지만,
// JSON 파일을 "숫자만 바꿔서" 쉽게 조작하는 수준은 대부분 막을 수 있습니다.
const SAVE_SIGN_SECRET = "WARRIOR_RABBIT_SAVE_SECRET_v1_2026"; // 원하면 더 길게 바꿔도 됨

// 안정적인 문자열화(키 정렬) - 서명 생성/검증 시 항상 동일한 결과가 나오게 함
function stableStringify(obj){
  if (obj === null) return "null";
  const t = typeof obj;
  if (t === "number" || t === "boolean") return String(obj);
  if (t === "string") return JSON.stringify(obj);
  if (Array.isArray(obj)) {
    return "[" + obj.map(stableStringify).join(",") + "]";
  }
  if (t === "object") {
    const keys = Object.keys(obj).sort();
    return "{" + keys.map(k =>
      JSON.stringify(k) + ":" + stableStringify(obj[k])
    ).join(",") + "}";
  }
  return "";
}

// SHA-256 (sync, pure JS) -> hex
// 출처에 의존하지 않도록 파일 안에 직접 포함(경량 버전)
function sha256hex(ascii){
  function rightRotate(value, amount){ return (value>>>amount) | (value<<(32-amount)); }

  var mathPow = Math.pow;
  var maxWord = mathPow(2, 32);
  var result = "";

  var words = [];
  var asciiBitLength = ascii.length * 8;

  var hash = sha256hex.h = sha256hex.h || [];
  var k = sha256hex.k = sha256hex.k || [];
  var primeCounter = k.length;

  var isComposite = {};
  for (var candidate = 2; primeCounter < 64; candidate++){
    if (!isComposite[candidate]){
      for (var i = 0; i < 313; i += candidate){ isComposite[i] = candidate; }
      hash[primeCounter] = (mathPow(candidate, .5) * maxWord) | 0;
      k[primeCounter++] = (mathPow(candidate, 1/3) * maxWord) | 0;
    }
  }

  ascii += "\x80";
  while (ascii.length % 64 - 56) ascii += "\x00";

  for (i = 0; i < ascii.length; i++){
    var j = ascii.charCodeAt(i);
    words[i>>2] |= j << ((3 - i) % 4) * 8;
  }
  words[words.length] = ((asciiBitLength / maxWord) | 0);
  words[words.length] = (asciiBitLength);

  for (j = 0; j < words.length;){
    var w = words.slice(j, j += 16);
    var oldHash = hash.slice(0);

    for (i = 0; i < 64; i++){
      var w15 = w[i - 15], w2 = w[i - 2];

      var a = hash[0], e = hash[4];
      var temp1 = hash[7]
        + (rightRotate(e, 6) ^ rightRotate(e, 11) ^ rightRotate(e, 25))
        + ((e & hash[5]) ^ ((~e) & hash[6]))
        + k[i]
        + (w[i] = (i < 16) ? w[i] : (
            w[i - 16]
            + (rightRotate(w15, 7) ^ rightRotate(w15, 18) ^ (w15>>>3))
            + w[i - 7]
            + (rightRotate(w2, 17) ^ rightRotate(w2, 19) ^ (w2>>>10))
          ) | 0
        );

      var temp2 = (rightRotate(a, 2) ^ rightRotate(a, 13) ^ rightRotate(a, 22))
        + ((a & hash[1]) ^ (a & hash[2]) ^ (hash[1] & hash[2]));

      hash = [(temp1 + temp2) | 0].concat(hash);
      hash[4] = (hash[4] + temp1) | 0;
      hash.pop();
    }

    for (i = 0; i < 8; i++){
      hash[i] = (hash[i] + oldHash[i]) | 0;
    }
  }

  for (i = 0; i < 8; i++){
    for (j = 3; j + 1; j--){
      var b = (hash[i] >> (j * 8)) & 255;
      result += ((b < 16) ? 0 : "") + b.toString(16);
    }
  }
  return result;
}

function calcSaveSignature(saveObj){
  try{
    // sig 제외하고 서명 생성
    const clone = JSON.parse(JSON.stringify(saveObj || {}));
    delete clone.sig;
    const payload = stableStringify(clone);
    return sha256hex(SAVE_SIGN_SECRET + "|" + payload);
  }catch(e){
    return "";
  }
}

function verifySaveSignature(saveObj){
  if (!saveObj || typeof saveObj !== "object") return false;
  if (!saveObj.sig || typeof saveObj.sig !== "string") return false;
  const expected = calcSaveSignature(saveObj);
  return expected && saveObj.sig === expected;
}

        
  function buildSaveData(){
    const p = window.player || null;

    // ✅ JSON.stringify가 깨지는(순환참조/DOM객체/이미지객체 등) 케이스를 막기 위해
    //    "세이브에 필요한 필드만" 골라서 저장합니다.
    const pickItem = (it)=>{
      if(!it || typeof it !== "object") return null;
      const out = {
        uid: it.uid ?? null,
        id: it.id ?? null,
        name: it.name ?? null,
        qty: (it.qty|0) || 0,
        equipSlot: it.equipSlot ?? null,
        atk: (it.atk|0) || 0,
        baseAtk: (it.baseAtk|0) || 0,
        enhance: (it.enhance|0) || 0,
        fixedAtk: !!it.fixedAtk,
        def: (it.def|0) || 0,
        hit: (it.hit|0) || 0,
        eva: (it.eva|0) || 0,
        fixedAtk: !!it.fixedAtk,
        critChance: (typeof it.critChance==="number") ? it.critChance : undefined,
        critMult: (typeof it.critMult==="number") ? it.critMult : undefined,
        rarity: it.rarity ?? undefined,
        type: it.type ?? undefined,
        desc: it.desc ?? undefined,
      };
      // icon은 문자열만 저장(이미지 객체/캔버스 등은 저장 금지)
      if (typeof it.icon === "string") out.icon = it.icon;
      return out;
    };

    const pickEquip = (eq)=>{
      if(!eq || typeof eq !== "object") return null;
      const out = {
        uid: eq.uid ?? null,
        id: eq.id ?? null,
        name: eq.name ?? null,
        atk: (eq.atk|0) || 0,
        baseAtk: (eq.baseAtk|0) || 0,
        enhance: (eq.enhance|0) || 0,
        def: (eq.def|0) || 0,
        hit: (eq.hit|0) || 0,
        eva: (eq.eva|0) || 0,
        fixedAtk: !!eq.fixedAtk,
        critChance: (typeof eq.critChance==="number") ? eq.critChance : 0,
        critMult: (typeof eq.critMult==="number") ? eq.critMult : 0,
      };
      if (typeof eq.icon === "string") out.icon = eq.icon;
      return out;
    };

    const inv = (window.inventory && Array.isArray(window.inventory))
      ? window.inventory.map(pickItem).filter(Boolean)
      : null;

    const eq = (typeof equipment !== "undefined" && equipment) ? {
      ear:    pickEquip(equipment.ear),
      helm:   pickEquip(equipment.helm),
      neck:   pickEquip(equipment.neck),
      tee:    pickEquip(equipment.tee),
      armor:  pickEquip(equipment.armor),
      cloak:  pickEquip(equipment.cloak),
      ring:   pickEquip(equipment.ring),
      belt:   pickEquip(equipment.belt),
      shield: pickEquip(equipment.shield),
      weapon: pickEquip(equipment.weapon),
      glove:  pickEquip(equipment.glove),
      shoe:   pickEquip(equipment.shoe),

      // ✅ 구버전 호환용(저장만): accessory = neck
      accessory: pickEquip(equipment.neck),
    } : null;

    const data = {
      v: 2,
      savedAt: Date.now(),
      mapId: (typeof currentMapId !== "undefined" ? currentMapId : null),
      statPoints: (window.statPoints|0),
      statLevels: window.statLevels ? {...window.statLevels} : null,
      player: p ? {
        level: (p.level|0),
        exp: (p.exp|0),
        hp: (p.hp|0),
        mp: (p.mp|0),
        x: (typeof p.x==="number") ? p.x : undefined,
        y: (typeof p.y==="number") ? p.y : undefined,
      } : null,
      inventory: inv,
      equipment: eq,
      // ✅ 펫 영구사망 상태 저장
      pet: (typeof pet !== 'undefined' && pet) ? { deadForever: !!pet.deadForever, hp: (pet.hp|0), state: pet.state, alpha: (typeof pet.alpha==='number'?pet.alpha:1) } : null,
    };
    return data;
  }

  function applySaveData(data){
    if (!data || typeof data !== "object") return false;

    if (typeof data.statPoints === "number") window.statPoints = data.statPoints|0;
    if (data.statLevels && typeof data.statLevels === "object") window.statLevels = {...data.statLevels};

    // ✅ 장착 장비 복구(무기/방어구/악세): 공격력/방어력/E표시/장착상태가 재접속 후에도 유지되게
    try{
      if (data.equipment && typeof data.equipment === "object" && typeof equipment !== "undefined" && equipment){
        const applySlot = (slotName)=>{
          const src = data.equipment[slotName];
          const dst = equipment[slotName];
          if (!src || typeof src !== "object" || !dst || typeof dst !== "object") return;
          // dst는 const 객체이므로 "재할당"이 아니라 "필드 덮어쓰기"로 복구
          dst.uid = (src.uid ?? dst.uid ?? null);
          dst.id  = (src.id  ?? dst.id  ?? null);
          dst.name= (src.name?? dst.name?? null);
          if (typeof src.icon === "string") dst.icon = src.icon;
          if (typeof src.atk === "number") dst.atk = src.atk|0;
          if (typeof src.baseAtk === "number") dst.baseAtk = src.baseAtk|0;
          if (typeof src.enhance === "number") dst.enhance = src.enhance|0;
          if ((src.fixedAtk) || dst.fixedAtk){
            const b = (dst.baseAtk|0) || 0;
            const e = (dst.enhance|0) || 0;
            dst.atk = b + e;
          }
          if (typeof src.def === "number") dst.def = src.def|0;
          if (typeof src.hit === "number") dst.hit = src.hit|0;
          if (typeof src.eva === "number") dst.eva = src.eva|0;
          dst.fixedAtk = !!src.fixedAtk;
          if (typeof src.critChance === "number") dst.critChance = src.critChance;
          if (typeof src.critMult === "number") dst.critMult = src.critMult;
        };
        // ✅ 슬롯 전체 복구
        const _slotKeys = ["ear","helm","neck","tee","armor","cloak","ring","belt","shield","weapon","glove","shoe"];
        for (const k of _slotKeys){
          applySlot(k);
        }
        // ✅ 구세이브 호환: accessory -> neck
        if (!data.equipment.neck && data.equipment.accessory){
          try{
            const src = data.equipment.accessory;
            if (src && typeof src === "object"){
              data.equipment.neck = src;
              applySlot("neck");
            }
          }catch(_){}
        }
}
    }catch(e){}

    // ✅ 인벤토리(아이템/장비) 저장/복구: 재접속 시 E표시/장착상태 동기화
    try{
      if (Array.isArray(data.inventory)){
        // 안전하게 복사
        window.inventory = data.inventory
          .filter(it => it && typeof it === "object")
          .map(it => {
            const o = {...it};
            // ✅ 무기 강화(enhance) 세이브 마이그레이션/정규화
            if (o && o.equipSlot === "weapon") {
              if (typeof o.enhance !== "number") o.enhance = (o.enhance|0) || 0;
              if (typeof o.baseAtk !== "number" || !isFinite(o.baseAtk) || o.baseAtk <= 0) {
                // 구세이브: baseAtk가 없으면 현재 atk에서 enhance를 뺀 값(최소 0)
                const a = (o.atk|0) || 0;
                const e = (o.enhance|0) || 0;
                o.baseAtk = Math.max(0, a - e);
              }
              // fixedAtk 무기면 atk는 항상 baseAtk+enhance로 재계산
              if (o.fixedAtk) {
                o.atk = ((o.baseAtk|0) || 0) + ((o.enhance|0) || 0);
              }
            }
            return o;
          });
      }
    }catch(e){}

    // ✅ (구세이브 호환) 장착 무기가 있는데 인벤에 같은 uid가 없다면: 기존 단검/무기 아이템과 uid를 맞추거나 인벤에 생성
    try{
      if (!window.inventory) window.inventory = [];
      const w = equipment && equipment.weapon ? equipment.weapon : null;
      if (w && w.uid){
        let hasUid = window.inventory.some(it => it && it.uid === w.uid);
        if (!hasUid){
          // 1) 같은 id/name의 무기 아이템이 있으면 uid를 맞춘다(중복 생성 방지)
          let cand = window.inventory.find(it => it && it.uid && (it.equipSlot === "weapon" || it.id === w.id || it.name === w.name) && ((it.id||"") === (w.id||"") || (it.name||"") === (w.name||"")));
          if (cand){
            cand.uid = w.uid;
            hasUid = true;
          } else {
            // 2) 단검 같은 시작장비가 있을 때는 그걸 uid 매칭
            let dagger = window.inventory.find(it => it && it.uid && ((it.id === "dagger") || (it.name === "단검")) && (it.equipSlot === "weapon"));
            if (dagger){
              dagger.uid = w.uid;
              hasUid = true;
            }
          }
          // 3) 그래도 없으면, 장착 무기를 인벤에 1개 생성(구세이브에서 E표시 복구용)
          if (!hasUid){
            window.inventory.push({
              uid: w.uid,
              id: w.id || "weapon",
              name: w.name || "무기",
              icon: w.icon || null,
              qty: 1,
              equipSlot: "weapon",
              baseAtk: (w.baseAtk|0) || ((w.atk|0) || 0),
              enhance: (w.enhance|0) || 0,
              fixedAtk: !!w.fixedAtk,
              atk: (w.fixedAtk ? (((w.baseAtk|0) || ((w.atk|0)||0)) + ((w.enhance|0)||0)) : ((w.atk|0)||0)),
              def: w.def|0 || 0,
              hit: w.hit|0 || 0,
              eva: w.eva|0 || 0,
              critChance: +w.critChance || 0,
              critMult: +w.critMult || 0,
                          });
          }
        }
      }
    }catch(e){}

    if (data.equipment && typeof data.equipment === "object" && typeof equipment !== "undefined"){
      try{
        for (const k of ["ear","helm","neck","tee","armor","cloak","ring","belt","shield","weapon","glove","shoe"]){
          if (data.equipment[k]) equipment[k] = {...data.equipment[k]};
        }
        // ✅ 구세이브 호환: accessory -> neck
        if (!equipment.neck?.uid && data.equipment.accessory){
          try{ equipment.neck = {...data.equipment.accessory}; }catch(_){}
        }
      }catch(e){}
    }

    // ✅ 구버전 세이브(무기 uid/id 누락) 마이그레이션: E표시/착용판정 버그 방지
    try{
      if (equipment && equipment.weapon){
        if (!equipment.weapon.id || (equipment.weapon.id !== "fist" && !equipment.weapon.uid)){
          // 구형 세이브(무기 uid/id 누락) 보정: 맨손은 uid 없어도 유지
          equipment.weapon = { uid:null, id:"fist", name:"맨손", atk:0, fixedAtk:false, def:0, hit:0, eva:0, critChance:0.00, critMult:1.50 };
        }
      }
    }catch(e){}

    const p = window.player;
    if (p && data.player && typeof data.player === "object"){
      if (typeof data.player.level === "number") p.level = Math.max(1, Math.min((typeof MAX_LEVEL!=='undefined'?MAX_LEVEL:(window.MAX_LEVEL||100)), data.player.level|0));
      if (typeof data.player.exp === "number") p.exp = Math.max(0, data.player.exp|0);
      try{ applyPlayerStatsForLevel(); }catch(e){}
      try{ recalcCombatStats(); }catch(e){}
      if (typeof data.player.hp === "number") p.hp = Math.max(0, Math.min(p.hpMax, data.player.hp|0));
      if (typeof data.player.mp === "number") p.mp = Math.max(0, Math.min(p.mpMax, data.player.mp|0));
    }

    try{ if (typeof syncStatBtn === "function") syncStatBtn(); }catch(e){}
    
    // ✅ 로드 직후 스탯/공격력 즉시 재계산 (강화 % 적용 포함)
    try{ recalcCombatStats(); }catch(e){}
    // ✅ 인벤 UI/툴팁 배지 재렌더
    try{ if (typeof renderInventory==="function") renderInventory(); }catch(e){}

    // ✅ 펫 상태 복구(영구사망이면 재접속해도 부활 X)
    try{
      if (data.pet && typeof data.pet === 'object' && typeof pet !== 'undefined' && pet){
        if (data.pet.deadForever){
          pet.deadForever = true;
          pet.hp = 0;
          pet.state = 'dead';
          pet.alpha = 0; // 완전 소멸
        } else {
          // 구세이브 호환: deadForever 없으면 기본 false
          pet.deadForever = false;
          // ✅ 펫 체력 최대치(플레이어 기반) 재계산
          try{ pet.hpMax = Math.max(1, Math.floor((player && player.hpMax ? player.hpMax : pet.hpMax)/3)); }catch(_){ }
          if (typeof data.pet.hp === 'number') pet.hp = Math.max(0, Math.min(pet.hpMax, data.pet.hp|0));
          if (typeof data.pet.state === 'string') pet.state = data.pet.state;
          // ✅ 재접속 시 투명화 버그 방지: state/HP에 맞춰 alpha/반경 복원
          if (typeof data.pet.alpha === 'number') pet.alpha = Math.max(0, Math.min(1, +data.pet.alpha));
          else pet.alpha = (pet.state === 'alive' && pet.hp > 0) ? 1 : 0;
          if (!pet.r || pet.r < 6) pet.r = 14; // 구버전/이상값 방어
          // state가 alive인데 HP가 0이면 강제로 dead 처리
          if (pet.state === 'alive' && (pet.hp|0) <= 0){
            pet.state = 'dead';
            pet.alpha = 0;
          }
        }
      }
    }catch(e){}
// ✅ 마지막으로 머물렀던 맵 복원(재접속 시 같은 맵에서 시작)
    try{
      if (data.mapId){
        const mid = (data.mapId === "forest" || data.mapId === "field") ? data.mapId : "forest";
        // setMap이 있으면 즉시 적용(플레이어는 중앙 스폰)
        if (typeof setMap === "function") setMap(mid, "center");
        else currentMapId = mid; // (혹시 setMap이 아직 없으면) 변수만이라도 반영
      }
    }catch(e){}

    return true;
  }

  function saveToLocal(){
    try{
      if (window.__SAVE_SUSPENDED) return false;
      // ✅ 게임이 완전히 초기화/로드되기 전에는 저장 금지(빈 데이터로 기존 세이브 덮어쓰기 방지)
      if (!window.player) return false;
      const data = buildSaveData();
      if (!data || !data.player) return false; // ✅ 안전장치
      data.sig = calcSaveSignature(data);
      localStorage.setItem(SAVE_KEY, JSON.stringify(data));
      return true;
    }catch(e){
      return false;
    }
  }

  function loadFromLocal(){
  try{
    const raw = localStorage.getItem(SAVE_KEY);
    if (!raw) return false;
    const data = JSON.parse(raw);

    // ✅ 서명 검증: (구버전 세이브에는 sig가 없을 수 있으니 1회 마이그레이션 허용)
    if (data && typeof data === "object"){
      if (typeof data.sig === "string"){
        if (!verifySaveSignature(data)){
          console.warn("Save signature mismatch. Possible tampering. (Allowing load and regenerating signature)");
          try{ delete data.sig; }catch(e){}
        }
      } else {
        // 구세이브(서명 없음) -> 일단 허용하고, 즉시 서명 붙여서 다시 저장
        try{
          data.sig = calcSaveSignature(data);
          localStorage.setItem(SAVE_KEY, JSON.stringify(data));
        }catch(e){}
      }
    }

    const ok = applySaveData(data);
    // ✅ 로드 성공 시: 현재 상태로 즉시 재서명/재저장(서명 불일치/구세이브 마이그레이션 안정화)
    if (ok){
      try{
        const fresh = buildSaveData();
        fresh.sig = calcSaveSignature(fresh);
        localStorage.setItem(SAVE_KEY, JSON.stringify(fresh));
      }catch(e){}
    }
    return ok;
  }catch(e){
    return false;
  }
}

  function exportSave(){
    try{
      const data = buildSaveData();
      data.sig = calcSaveSignature(data);
      const blob = new Blob([JSON.stringify(data, null, 2)], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      const dt = new Date();
      const y = dt.getFullYear();
      const m = String(dt.getMonth()+1).padStart(2,"0");
      const d = String(dt.getDate()).padStart(2,"0");
      const hh = String(dt.getHours()).padStart(2,"0");
      const mm = String(dt.getMinutes()).padStart(2,"0");
      a.href = url;
      a.download = `save_${y}${m}${d}_${hh}${mm}.json`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
    }catch(e){}
  }

  function importSaveFromFile(file){
  return new Promise((resolve)=>{
    try{
      const r = new FileReader();
      r.onload = ()=>{
        try{
          let text = String(r.result || "");
          // ✅ BOM(﻿) 제거 + 앞뒤 공백 제거 (윈도우/편집기 저장 방식 때문에 종종 끼어있음)
          text = text.replace(/^\uFEFF/, "").trim();
          const data = JSON.parse(text);

          // ✅ 파일 가져오기는 서명(sig)이 반드시 있어야 통과 (수정/조작 방지)
          if (!verifySaveSignature(data)){
            alert("세이브 불러오기 실패: 서명(sig) 불일치 (파일이 수정되었거나, 다른 버전에서 만든 세이브일 수 있습니다)");
            resolve(false);
            return;
          }

          const ok = applySaveData(data);
          if (ok) saveToLocal();
          resolve(ok);
        }catch(e){
          console.error("Save import parse/apply error:", e);
          alert("세이브 불러오기 실패: JSON 형식이 깨졌거나 호환되지 않습니다.\n\n" + (e && e.message ? e.message : e));
          resolve(false);
        }
      };
      r.onerror = ()=>{
        alert("세이브 파일 읽기 실패(파일 권한/손상 가능)");
        resolve(false);
      };
      r.readAsText(file, "utf-8");
    }catch(e){
      alert("세이브 불러오기 처리 중 오류: " + (e && e.message ? e.message : e));
      resolve(false);
    }
  });
}


  function resetSave(){
    try{ localStorage.removeItem(SAVE_KEY); }catch(e){}
    location.reload();
  }
// (없으면 기본값으로 생성)
    if (typeof window.statLevels === "undefined") window.statLevels = { hp:0, mp:0, str:0, int:0, vit:0, agi:0, luk:0, acc:0, aspd:0, mspd:0 };
  if (typeof window.statPoints === "undefined") window.statPoints = 0;

  const statListData = [
  { id: "hp",   name: "체력",     desc: "최대체력 +1 당 3% 증가" },
  { id: "mp",   name: "마나",     desc: "최대마나 +1 당 3% 증가" },
  { id: "str",  name: "힘",       desc: "공격력 +1 당 3% 증가" },
  { id: "int",  name: "지능",     desc: "자연회복(HP/MP) +, 오토딜레이 -0.1초", max: 60 },
  { id: "vit",  name: "인내",     desc: "방어력 +1 당 3% 증가" },
  { id: "agi",  name: "민첩",     desc: "회피확률 +0.1% 증가" },
  { id: "luk",  name: "운",       desc: "크리확률 +0.1% 증가" },
  { id: "acc",  name: "명중",     desc: "명중률 +0.1% 증가" },
  { id: "aspd", name: "공격속도", desc: "공격속도 +0.1% 증가" },
  { id: "mspd", name: "이동속도", desc: "이동속도 +0.1 증가", max: 100 }
];


  let tempStatLevels = {...window.statLevels};
  let tempStatPoints = window.statPoints;
  // ✅ 패널에서 + / - 찍을 때 바로 게임 능력치에 "미리보기" 반영
  function previewApplyTempStats(){
    if (window.applyPlayerStatsForLevel) window.applyPlayerStatsForLevel(tempStatLevels);
    if (window.recalcCombatStats) window.recalcCombatStats(tempStatLevels);
  }
  function previewRevertToAppliedStats(){
    if (window.applyPlayerStatsForLevel) window.applyPlayerStatsForLevel();
    if (window.recalcCombatStats) window.recalcCombatStats();
  }


  function playStatUp(){
    try{ if(statUpSound){ statUpSound.currentTime=0; statUpSound.play().catch(()=>{});
} }catch(e){}
  }
  function playStatPlus(){
    try{ if(statPlusSound){ statPlusSound.currentTime=0; statPlusSound.play().catch(()=>{});
} }catch(e){}
  }

  function playApply(){
    try{
      if(applySound){
        applySound.currentTime = 0;
        applySound.play().catch(()=>{});
      }
    }catch(e){}
  }

  // ✅ 레벨업 사운드 (up.ogg)
  function playLevelUpSound(){
    try{
      if(levelUpSound){
        levelUpSound.currentTime = 0;
        levelUpSound.play().catch(()=>{});
      }
    }catch(e){}
  }

  function renderStatRows(){
    if(!statList) return;
    statList.innerHTML = "";
    statPointsEl.textContent = tempStatPoints;

    statListData.forEach(stat=>{
      const row = document.createElement("div");
      row.className = "statRow";
      const max = stat.max ?? Infinity;
      const now = tempStatLevels[stat.id] ?? 0;

      row.innerHTML = `
        <div class="statInfo">
          <div class="statName">${stat.name}</div>
          <div class="statDesc">${stat.desc}${max!==Infinity ? ` (최대 ${max})` : ""}</div>
        </div>
        <div class="statCtrl">
          <span class="statValue">${now}</span>
          <button class="plus" type="button">+</button>
        </div>
      `;
      const plusBtn  = row.querySelector(".plus");
      const valueSpan = row.querySelector(".statValue");

      plusBtn.onclick = (e)=>{
        e.preventDefault();
        if(tempStatPoints <= 0) return;
        if((tempStatLevels[stat.id]||0) >= max) return;
        tempStatLevels[stat.id] = (tempStatLevels[stat.id]||0)+1;
        tempStatPoints--;
        valueSpan.textContent = tempStatLevels[stat.id];
        statPointsEl.textContent = tempStatPoints;
        playStatPlus();
        previewApplyTempStats();
        // ✅ 즉시 게임에 확정 반영
        window.statLevels = {...tempStatLevels};
        window.statPoints = tempStatPoints;
        try{ saveToLocal(); }catch(e){}
      };
      statList.appendChild(row);
    });
  }

  function openStatPanel(){
    // 처음 열 때는 중앙으로 배치(이미 위치가 있으면 유지)
    if(!statPanel.style.left || !statPanel.style.top){
      statPanel.classList.remove("hide");
      centerPanel(statPanel);
      statPanel.classList.add("hide");
    }
tempStatLevels = {...window.statLevels};
    // ✅ 안전 처리: 스탯포인트가 숫자가 아니면(예: 잘못된 값/문자열/오염) 0으로 강제
    const __sp = Number.isFinite(+window.statPoints) ? (window.statPoints|0) : 0;
    window.statPoints = __sp;
    tempStatPoints = __sp;
    try{ if (statPointsEl) statPointsEl.textContent = String(__sp); }catch(_){}
    renderStatRows();
    statPanel.classList.remove("hide");
  }
  function closeStatPanel(){
    statPanel.classList.add("hide");
    // ✅ 미리보기로 바뀐 값이 있다면, 실제 적용된 스탯(window.statLevels)으로 되돌리기
    previewRevertToAppliedStats();
  }

  statBtn?.addEventListener("click", (e)=>{
    e.preventDefault();
    try{
      if (invBtnSound){
        invBtnSound.currentTime = 0;
        invBtnSound.play().catch(()=>{});
      }
    }catch(_){}
    if(statPanel.classList.contains("hide")) openStatPanel();
    else closeStatPanel();
  });

  statPanel?.querySelector(".btn.close")?.addEventListener("click", (e)=>{
    e.preventDefault();
    try{
      if (invBtnSound){
        invBtnSound.currentTime = 0;
        invBtnSound.play().catch(()=>{});
      }
    }catch(_){}
    closeStatPanel();
  });
// StatPoints가 생기면 버튼 슬라이드 인
  let statBtnShown = false;
function syncStatBtn(){
  if(!statBtn) return;
  // ✅ 스탯포인트 0이어도 버튼은 항상 보이게 고정
  statBtn.classList.add("show");
  statBtnShown = true;
}
  // 초기 반영
  syncStatBtn();
  setInterval(syncStatBtn, 250); // 0.25초마다 반영


  (() => {
  const canvas = document.getElementById('game');
  const ctx = canvas.getContext('2d');

  let DPR = 1;

  const overlay = document.getElementById('titleOverlay');
  const startBtn = document.getElementById('startBtn');
  const startHint = document.getElementById('startHint');

  let started = false;
  let assetsReady = false;

  function resize(){
    const dpr = Math.min(2, window.devicePixelRatio || 1);
    DPR = dpr;
    canvas.width = Math.floor(innerWidth * dpr);
    canvas.height = Math.floor(innerHeight * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);
    ctx.imageSmoothingEnabled = false;
  }
  addEventListener('resize', resize, {passive:true});
  resize();

  // ====== ASSETS ======

  // ====== BGM ======
  const bgm = new Audio('bgm.ogg');
  bgm.loop = true;
  bgm.volume = 0.5;


  // ====== FOOTSTEP SFX ======

  // ====== ATTACK SFX ======
  const attackSfx = new Audio('kal.ogg');
  attackSfx.volume = 0.6;

// ====== KI-HAP SFX (random shout) ======
  const kihapSfx = new Audio('kihap.wav');
  kihapSfx.volume = 0.7;


  
  // ====== PET ATTACK SHOUT SFX (10% on pet attack) ======
  const acaSfx = new Audio('aca.wav');
  acaSfx.volume = 0.7;

  // ====== ARROW FLY SFX (100% on every pet arrow shot) ======
  // 여러 발 연사 시에도 소리가 끊기지 않게 풀로 구성
  const arrowSfxPool = Array.from({length: 4}, () => {
    const a = new Audio('arrow.wav');
    a.volume = 0.7;
    return a;
  });
  let arrowSfxIdx = 0;
  function playArrowSfx(){
    const a = arrowSfxPool[arrowSfxIdx = (arrowSfxIdx + 1) % arrowSfxPool.length];
    try{ a.currentTime = 0; a.play().catch(()=>{}); }catch(e){}
  }

// ====== HIT SFX (monster hit) ======
  const hitSfx = new Audio('hit.ogg');
  hitSfx.volume = 0.6;

  // ====== CRIT SFX ======
  const critSfx = new Audio('crt.wav');
  critSfx.volume = 0.75;

// ====== RABBIT DEATH SFX ======
  const rabbitDeathSfx = new Audio('ttoki4.wav');
  rabbitDeathSfx.volume = 0.7;

  // ====== ITEM PICKUP SFX (dagger pickup) ======
  const itemPickSfx = new Audio('in.ogg');
  itemPickSfx.volume = 0.7;

  // ====== ITEM DROP SFX (monster drops loot) ======
  // (파일이 확실히 있는 in.ogg를 재사용해서 '드랍 순간'에도 소리가 100% 나게 처리)
  const itemDropSfx = new Audio('in.ogg');
  itemDropSfx.volume = 0.55;

  // ====== POTION USE SFX ======
  const potionUseSfx = new Audio('po.ogg');
  potionUseSfx.volume = 0.7;



  // ====== DEATH SFX (player death) ======
  const deathSfx = new Audio('samang.wav');
  deathSfx.volume = 0.7;

  const footstep = new Audio('balsori.ogg');
  footstep.volume = 0.45;
  let lastStepTime = 0;
  const STEP_INTERVAL = 0.28; // 발소리 간격(초)

  const heroImg = new Image(); heroImg.src = 'hero.png';

  // ====== PET (uses warrior sprite sheet from sprite_test_warrior.html) ======
  const petImg = new Image(); petImg.src = 'data:image/png;base64,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';
  const PET_FW = 50, PET_FH = 50;
  const PET_WALK_LEN = 4, PET_ATK_LEN = 4;

  const grassImg = new Image(); grassImg.src = 'grass.png';
  const rabbitImg = new Image(); rabbitImg.src = 'rabbit.png';
  const treeImg = new Image(); treeImg.src = 'tree.png'; // 투명 배경 나무 이미지
  const itmImg = new Image(); itmImg.src = 'itm.png'; // 드랍 아이템 스프라이트 시트(4x3)
  const hpPotionImg = new Image(); hpPotionImg.src = 'hp-1.png'; // HP 물약(소)
  const mpPotionImg = new Image(); mpPotionImg.src = 'mp-1.png'; // MP 물약(소)

  let loaded = 0;
  const NEED = 7;
  function onLoaded(){
    loaded++;
    if (loaded >= NEED){
      assetsReady = true;
      startBtn.disabled = false;
      startHint.textContent = "Start를 누르면 바로 시작됩니다.";
    }
  }
  heroImg.onload = onLoaded; grassImg.onload = onLoaded; rabbitImg.onload = onLoaded; treeImg.onload = onLoaded; itmImg.onload = onLoaded; hpPotionImg.onload = onLoaded; mpPotionImg.onload = onLoaded;


/* ===== GROUND DROP SYSTEM (Rabbit 3% drop) ===== */
const DROP = {
  tile: 32, // itm.png is 128x96 => 4x3 tiles of 32px
  knife: { sx: 2*32, sy: 0*32, sw: 32, sh: 32 }, // top row, 3rd sprite
  lifeSec: 90, // 바닥에 유지 시간(초)
  pickDelay: 0.18 // ✅ 드랍 직후 즉시 줍기 방지(눈에 보이게 잠깐 바닥에 남김)
};

const groundDrops = []; // {kind,x,y,t}
const pickupFx = []; // {kind,x,y,t}

// ✅ 아이템 줍기 연출: (1) 살짝 위로 + 확대 → (2) 잠깐 멈춤 → (3) 플레이어로 빨려들며 페이드아웃
function spawnPickupFx(kind, x, y){
  try{
    const o = {
      kind: kind,
      x: x, y: y,
      t: 0,
      // 타임라인(초)
      up: 0.22,
      hold: 2.00,
      fly: 0.35
    };
    pickupFx.push(o);
    return o;
  }catch(_){}
  return null;
}


function easeOutCubic(t){ return 1 - Math.pow(1 - t, 3); }

function updatePickupFx(dt){
  for(let i=pickupFx.length-1;i>=0;i--){
    const fx = pickupFx[i];
    fx.t += dt;
    const total = fx.up + fx.hold + fx.fly;
    if (fx.t >= total){
      pickupFx.splice(i,1);
    }
  }
}

function drawPickupFx(camX, camY){
  if (!pickupFx.length) return;

  for(const fx of pickupFx){
    const t = fx.t;
    const t0 = fx.up;
    const t1 = fx.up + fx.hold;
    const t2 = fx.up + fx.hold + fx.fly;

    let wx = fx.x;
    let wy = fx.y;
    let scale = 1.0;
    let alpha = 1.0;

    if (t <= t0){
      // up + scale
      const p = easeOutCubic(Math.max(0, t / t0));
      wy = fx.y - 18 * p;
      scale = 1.0 + 0.55 * p;
    } else if (t <= t1){
      // hold (2초 정지: 확대된 상태 유지)
      wy = fx.y - 18;
      scale = 1.55;
    } else {
      // fly to player + fade
      const p = Math.max(0, Math.min(1, (t - t1) / (fx.fly || 0.001)));
      const e = easeOutCubic(p);

      const tx = (player ? player.x : fx.x);
      const ty = (player ? (player.y - (player.r||0) - 6) : fx.y);

      wx = (fx.x) + (tx - fx.x) * e;
      wy = (fx.y - 18) + (ty - (fx.y - 18)) * e;

      // 살짝 더 커졌다가 줄며 사라지는 느낌
      scale = 1.55 + (0.10 * (1 - e)) - (0.35 * e);
      alpha = 1.0 - e;
    }

    const px = Math.round(wx - camX);
    const py = Math.round(wy - camY);

    ctx.save();
    ctx.globalAlpha = clamp(alpha, 0, 1);
    ctx.imageSmoothingEnabled = false;

    const dw = DROP.tile * scale;
    const dh = DROP.tile * scale;

    if (fx.kind === "knife"){
      if (!(itmImg.complete && itmImg.naturalWidth > 0)){ ctx.restore(); continue; }
      const {sx,sy,sw,sh} = DROP.knife;
      ctx.drawImage(itmImg, sx, sy, sw, sh, px - dw/2, py - dh/2, dw, dh);
    } else if (fx.kind === "hp_potion_s"){
      if (hpPotionImg && hpPotionImg.complete && hpPotionImg.naturalWidth > 0){
        ctx.drawImage(hpPotionImg, px - dw/2, py - dh/2, dw, dh);
      }else{
        // 이미지가 없을 때도 눈에 보이게(디버그/보정)
        ctx.fillStyle = "rgba(30,220,80,0.90)";
        ctx.fillRect(px - dw/2, py - dh/2, dw, dh);
        ctx.fillStyle = "rgba(0,0,0,0.85)";
        ctx.font = "bold 10px system-ui, -apple-system, 'Segoe UI', Roboto, 'Noto Sans KR', sans-serif";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText("HP", px, py);
      }
    } else if (fx.kind === "mp_potion_s"){
      if (mpPotionImg && mpPotionImg.complete && mpPotionImg.naturalWidth > 0){
        ctx.drawImage(mpPotionImg, px - dw/2, py - dh/2, dw, dh);
      }else{
        // 이미지가 없을 때도 눈에 보이게(디버그/보정)
        ctx.fillStyle = "rgba(30,220,80,0.90)";
        ctx.fillRect(px - dw/2, py - dh/2, dw, dh);
        ctx.fillStyle = "rgba(0,0,0,0.85)";
        ctx.font = "bold 10px system-ui, -apple-system, 'Segoe UI', Roboto, 'Noto Sans KR', sans-serif";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText("MP", px, py);
      }
    }

    ctx.restore();
  }
}

// ✅ canvas toDataURL을 쓰면(특히 GitHub Pages/타 도메인에서 이미지 로딩 시) "tainted canvas" 에러로 게임이 멈출 수 있어서
//    인벤 아이콘은 "dagger.PNG" 마커로 처리하고, UI에서 작은 캔버스에 직접 그려서 표시합니다.

function spawnGroundKnife(x, y){
  // 약간 랜덤으로 흩뿌리기(겹침 방지)
  const ox = (Math.random()*14 - 7);
  const oy = (Math.random()*10 - 5);
  groundDrops.push({ kind:"knife", x: x + ox, y: y + oy, t: 0 });
}

function spawnGroundKnife(x, y){
  // 약간 랜덤으로 흩뿌리기(겹침 방지)
  const ox = (Math.random()*14 - 7);
  const oy = (Math.random()*10 - 5);
  groundDrops.push({ kind:"knife", x: x + ox, y: y + oy, t: 0 });
}

function spawnGroundHpPotionS(x, y){
  const ox = (Math.random()*14 - 7);
  const oy = (Math.random()*10 - 5);
  groundDrops.push({ kind:"hp_potion_s", x: x + ox, y: y + oy, t: 0 });
}
function spawnGroundMpPotionS(x, y){
  const ox = (Math.random()*14 - 7);
  const oy = (Math.random()*10 - 5);
  groundDrops.push({ kind:"mp_potion_s", x: x + ox, y: y + oy, t: 0 });
}


function updateGroundDrops(dt){
  // 시간 흐름/수명
  for (let i = groundDrops.length-1; i >= 0; i--){
    const d = groundDrops[i];
    d.t += dt;
    if (d.t >= DROP.lifeSec){
      groundDrops.splice(i, 1);
    }
  }

  // 줍기(플레이어/펫 근접)
  function _pickupFor(actor){
    try{
      if (!actor || actor.state !== "alive") return;
      const pickR = ((actor.r||0) + 14);
      const pickR2 = pickR * pickR;
      for (let i = groundDrops.length-1; i >= 0; i--){
            const d = groundDrops[i];
            // ✅ 드랍 직후에는 잠깐 줍기 불가(드랍이 보이게)
            if ((d.t||0) < (DROP.pickDelay||0)) continue;
            const dx = d.x - actor.x, dy = d.y - actor.y;

            if (dx*dx + dy*dy > pickR2) continue;

            // ====== 인벤 반영 ======
            let pickedName = "";
            if (d.kind === "knife"){
              pickedName = "단검";

              // ✅ 장비류는 uid를 줘서 스택/겹침 방지(각각 한 칸)
              const uid = "drop_" + Date.now().toString(36) + "_" + Math.random().toString(36).slice(2,7);
              addItemToInventory({
                id: "dagger",
                name: "단검",
                icon:"dagger.PNG",
                qty: 1,
                uid,
                equipSlot: "weapon",
                baseAtk: 5,
                enhance: 0,
                atk: 5,
                fixedAtk: true
              });

              // ✅ 안전장치: 어떤 이유로든 addItemToInventory가 누락되면 직접 인벤에 한 번 더 넣어준다(중복 방지)
              try{
                const _hasUid = (window.inventory||[]).some(it => it && it.uid === uid);
                if(!_hasUid){
                  window.inventory = window.inventory || [];
                  window.inventory.push({
                    uid,
                    id:"dagger", name:"단검", icon:"dagger.PNG", qty:1,
                    equipSlot:"weapon",
                    baseAtk:5, enhance:0, atk:5, fixedAtk:true
                  });
                }
              }catch(_){}
            } else if (d.kind === "hp_potion_s"){
              pickedName = "hp물약(소)";
              addItemToInventory({ id:"hp_potion_s", name:"hp물약(소)", icon:"data:image/png;base64,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", qty:1 });
            } else if (d.kind === "mp_potion_s"){
              pickedName = "mp물약(소)";
              addItemToInventory({ id:"mp_potion_s", name:"mp물약(소)", icon:"data:image/png;base64,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", qty:1 });
            } else {
              // 알 수 없는 드랍은 무시
              continue;
            }

            // ====== 줍기 연출/사운드 ======
            try{
              itemPickSfx.currentTime = 0;
              itemPickSfx.play();
            }catch(_){ }

            let _fx=null;
            try{ _fx = spawnPickupFx(d.kind, d.x, d.y); }catch(_){ _fx=null; }

            // 인벤: 새로 들어온 아이템이 있는 페이지로 자동 이동(바로 눈에 보이게)
            try{
              if (typeof invPage !== "undefined" && window.inventory && window.inventory.length>0){
                invPage = Math.floor((window.inventory.length-1)/25);
              }
            }catch(_){}

            // 인벤 UI 즉시 갱신(열려있으면 바로 보임)
            try{ if (typeof renderInventoryPage === "function") renderInventoryPage(); }catch(_){}

            // 알림은 연출이 끝난 뒤(확대/정지/흡수 후)에 띄우기
            try{
              const delay = (_fx && (_fx.up!=null) && (_fx.hold!=null) && (_fx.fly!=null))
                ? Math.round((_fx.up + _fx.hold + _fx.fly) * 1000)
                : 0;

              setTimeout(()=>{
                try{ pushInfoLogLine?.(pickedName + " 습득"); }catch(_){ }
                try{
                  if (pickedName === "단검" || pickedName === "hp물약(소)" || pickedName === "mp물약(소)"){
                    // ✅ 단검/물약은 동일한 상단 "아이템 습득" 문구 스타일로
                    const _html = '<span class="pickup-dagger">' + pickedName + '</span> <span class="pickup-rest">아이템 습득</span>';
                    window.showTopNotice && window.showTopNotice(_html, 1200, null, true);
                  } else {
                    window.showTopNotice && window.showTopNotice(pickedName + " 습득", 1200, null, true);
                  }
                }catch(__){}
              }, delay);
            }catch(_){}

            // 바닥에서 제거
            groundDrops.splice(i, 1);
          }
  
    }catch(_){}
  }

  // 플레이어 먼저
  if (typeof player !== "undefined" && player) _pickupFor(player);

  // ✅ 모든 펫들도 바닥 아이템을 우선적으로 주워서 플레이어 인벤에 넣는다
  try{
    const _pets = [];
    if (Array.isArray(window.pets)) _pets.push(...window.pets);
    if (typeof window.pet !== "undefined" && window.pet) _pets.push(window.pet);
    if (typeof pet !== "undefined" && pet) _pets.push(pet);
    const uniq = _pets.filter((p,idx)=>p && _pets.indexOf(p)===idx);
    for (const p of uniq){
      // 펫이 살아있을 때만
      if (!p || p.state !== "alive") continue;
      _pickupFor(p);
    }
  }catch(_){}

}

function drawGroundDrops(camX, camY){
  for (const d of groundDrops){
    if (d.kind === "knife"){
      if (!(itmImg.complete && itmImg.naturalWidth > 0)) continue;
      const {sx,sy,sw,sh} = DROP.knife;
      const x = Math.round(d.x - camX - DROP.tile/2);
      const y = Math.round(d.y - camY - DROP.tile/2);
      ctx.drawImage(itmImg, sx, sy, sw, sh, x, y, DROP.tile, DROP.tile);

      // ✅ 드랍 아이템 이름(작게)
      ctx.save();
      ctx.font = "11px system-ui, -apple-system, 'Noto Sans KR', sans-serif";
      ctx.textAlign = "center";
      ctx.textBaseline = "bottom";
      const tx = x + DROP.tile/2;
      const ty = y - 2;
      ctx.lineWidth = 3;
      ctx.strokeStyle = "rgba(0,0,0,0.85)";
      ctx.fillStyle = "rgba(255,255,255,0.95)";
      ctx.strokeText("단검", tx, ty);
      ctx.fillText("단검", tx, ty);
      ctx.restore();
      continue;
    }

    // ✅ HP/MP 물약(소) 드랍
    if (d.kind === "hp_potion_s"){
      if (!(hpPotionImg && hpPotionImg.complete && hpPotionImg.naturalWidth > 0)) continue;
      const w = DROP.tile, h = DROP.tile;
      const x = Math.round(d.x - camX - w/2);
      const y = Math.round(d.y - camY - h/2);
      try{
      if (hpPotionImg && hpPotionImg.complete && hpPotionImg.naturalWidth > 0){
        ctx.drawImage(hpPotionImg, x, y, w, h);
      }else{
        ctx.fillStyle = "rgba(30,220,80,0.90)";
        ctx.fillRect(x, y, w, h);
        ctx.fillStyle = "rgba(0,0,0,0.85)";
        ctx.font = "bold 10px system-ui, -apple-system, 'Segoe UI', Roboto, 'Noto Sans KR', sans-serif";
        ctx.textAlign = "center";
        ctx.textBaseline = "middle";
        ctx.fillText("HP", x + w/2, y + h/2);
      }
    }catch(_e){
      ctx.fillStyle = "rgba(30,220,80,0.90)";
      ctx.fillRect(x, y, w, h);
    }
ctx.save();
      ctx.font = "11px system-ui, -apple-system, 'Noto Sans KR', sans-serif";
      ctx.textAlign = "center";
      ctx.textBaseline = "bottom";
      const tx = x + w/2;
      const ty = y - 2;
      ctx.lineWidth = 3;
      ctx.strokeStyle = "rgba(0,0,0,0.85)";
      ctx.fillStyle = "rgba(255,255,255,0.95)";
      ctx.strokeText("hp물약(소)", tx, ty);
      ctx.fillText("hp물약(소)", tx, ty);
      ctx.restore();
      continue;
    }
    if (d.kind === "mp_potion_s"){
      const w = DROP.tile, h = DROP.tile;
      const x = Math.round(d.x - camX - w/2);
      const y = Math.round(d.y - camY - h/2);

      try{
        if (mpPotionImg && mpPotionImg.complete && mpPotionImg.naturalWidth > 0){
          ctx.drawImage(mpPotionImg, x, y, w, h);
        }else{
          ctx.fillStyle = "rgba(30,220,80,0.90)";
          ctx.fillRect(x, y, w, h);
          ctx.fillStyle = "rgba(0,0,0,0.85)";
          ctx.font = "bold 10px system-ui, -apple-system, 'Segoe UI', Roboto, 'Noto Sans KR', sans-serif";
          ctx.textAlign = "center";
          ctx.textBaseline = "middle";
          ctx.fillText("MP", x + w/2, y + h/2);
        }
      }catch(_e){
        ctx.fillStyle = "rgba(30,220,80,0.90)";
        ctx.fillRect(x, y, w, h);
      }
ctx.save();
      ctx.font = "11px system-ui, -apple-system, 'Noto Sans KR', sans-serif";
      ctx.textAlign = "center";
      ctx.textBaseline = "bottom";
      const tx = x + w/2;
      const ty = y - 2;
      ctx.lineWidth = 3;
      ctx.strokeStyle = "rgba(0,0,0,0.85)";
      ctx.fillStyle = "rgba(255,255,255,0.95)";
      ctx.strokeText("mp물약(소)", tx, ty);
      ctx.fillText("mp물약(소)", tx, ty);
      ctx.restore();
      continue;
    }
  }
}


  function onAssetError(name){
    return () => alert(name + " 파일을 찾을 수 없습니다. 이 html과 같은 폴더에 두고 파일명을 정확히 맞춰주세요.");
  }
  heroImg.onerror = onAssetError('hero.png');
  grassImg.onerror = onAssetError('grass.png');
  rabbitImg.onerror = onAssetError('rabbit.png');
  treeImg.onerror = onAssetError('tree.png');

  itmImg.onerror = onAssetError('itm.png');
  hpPotionImg.onerror = onAssetError('hp-1.png');
  mpPotionImg.onerror = onAssetError('mp-1.png');
  // ====== UTILS ======
  const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));
  const rand = (a,b)=>a+Math.random()*(b-a);
  const dist2 = (ax,ay,bx,by)=>{const dx=ax-bx,dy=ay-by;return dx*dx+dy*dy;};


  // ====== LEVEL SYSTEM (Lv1->100, target ~2 months) ======
  const MAX_LEVEL = 100;

  // EXP needed to go from 'level' to 'level+1'
  // ✅ Must satisfy: needExp(1) = 30 (대표님 확정값)
  function needExp(level){
    level = Math.max(1, Math.min(MAX_LEVEL, level|0));
    if (level <= 30){
      const L = level - 1;
      return Math.floor(30 + 7*L + 1*(L*L));
    } else if (level <= 70){
      const L = level - 30;
      return Math.floor(1200 + 60*L + 6*(L*L));
    } else {
        // ✅ 접촉이 풀리면(특히 치명타 넉백 이후) 'attack' 상태로 방황하지 않게 즉시 추적으로 복귀
        if (rb.state === 'attack'){
          if (dd <= d2) rb.state = 'chase';
          else { rb.state = 'wander'; pickWander(rb); }
        }
const L = level - 70;
      return Math.floor(15000 + 900*L + 90*(L*L) + 4*(L*L*L));
    }
  }

  // Player stat scaling (Lv1 fixed: HP50 / MP20 / DMG2)
  
  // ====== 스탯 분배(Stat Panel) -> 실제 전투/이동/최대HP/MP 반영 ======
  // window.statLevels 기준으로 최종 보너스를 계산합니다.
  function calcStatBonus(levelsOverride){
    const lv = levelsOverride || window.statLevels || {};
    const n = (k)=> (lv[k]|0);

    const hp  = n("hp");
    const mp  = n("mp");
    const str = n("str");
    const intl= n("int");
    const vit = n("vit");
    const agi = n("agi");
    const luk = n("luk");
    const acc = n("acc");
    const aspd= n("aspd");
    const mspd= n("mspd");

    // ✅ 설명 문구 그대로 반영
    // - hp: +10, mp:+5, str:+3, vit:+1
    // - agi/luk/acc: +0.1% (확률 단위) -> 내부 구현은 hit/eva가 '포인트'라서 0.05포인트(=0.1%*2% 기준)로 환산
    // - aspd: 공격속도 +0.1% => atkInterval을 (1-0.001*aspd) 배
    // - int: 회복속도 -0.1초 => 자동사냥 딜레이(autoDelayTime) 감소로 연결
    // - mspd: 이동속도 +0.1 (player.speed에 가산)
    const bonus = {
      hpMul: 1 + hp * 0.03,
      hpMaxAdd: hp * 5,
      mpMul: 1 + mp * 0.03,
      mpMaxAdd: mp * 3,
      atkMul: 1 + str * 0.03,
      atkAdd: str * 1,
      defMul: 1 + vit * 0.03,
      defAdd: vit * 1,
      mdefMul: 1 + intl * 0.03,
      mdefAdd: intl * 1,
      hitAdd: acc * 0.05,
      evaAdd: agi * 0.05,
      critChanceAdd: luk * 0.001,
      critMultAdd: agi * 0.01,
      atkIntervalMul: Math.max(0.10, 1 - aspd * 0.001),
      speedAdd: mspd * 0.1,
      hpRegenAdd: intl * 0.03,
      mpRegenAdd: intl * 0.05,
      autoDelayTime: Math.max(0.10, 1.0 - intl * 0.1),
    };
    return bonus;
  }
function applyPlayerStatsForLevel(levelsOverride){
    const lv = player.level|0;

    const prevHpMax = player.hpMax || 0;
    const prevMpMax = player.mpMax || 0;

    // ✅ Lv1 fixed: HP50 / MP20 (레벨 기본치)
    const baseHpMax = 50 + 5*(lv-1);
    const baseMpMax = 20 + 2*(lv-1);

    const b = calcStatBonus(levelsOverride);

    player.hpMax = Math.floor(baseHpMax * (b.hpMul ?? 1)) + (b.hpMaxAdd || 0);
    player.mpMax = Math.floor(baseMpMax * (b.mpMul ?? 1)) + (b.mpMaxAdd || 0);

    // ✅ 체력/마나 스탯으로 "최대치가 늘어난 만큼" 현재치도 같이 증가
    const hpDelta = player.hpMax - prevHpMax;
    const mpDelta = player.mpMax - prevMpMax;
    if (hpDelta > 0) player.hp += hpDelta;
    if (mpDelta > 0) player.mp += mpDelta;

    // 자동사냥 딜레이(회복속도) 반영
    player.autoDelayTime = b.autoDelayTime;

    // ✅ 자연회복(초당) : 지능(int)이 직접 증가시킴
    // 기본값은 너무 과하지 않게, 지능 1당 HP +0.03 / MP +0.05 (초당)
    const baseHpRegenPS = 0.25;
    const baseMpRegenPS = 0.35;
    player.hpRegenPS = baseHpRegenPS + (b.hpRegenAdd || 0);
    player.mpRegenPS = baseMpRegenPS + (b.mpRegenAdd || 0);

    // ✅ EXP needed for next level (Lv1 => 30)
    player.expMax = needExp(lv);

    // clamp current values
    player.hp = Math.min(player.hp, player.hpMax);
    player.mp = Math.min(player.mp, player.mpMax);
    player.exp = Math.max(0, player.exp|0);
  }

  // ====== EQUIPMENT STATS (item-only combat stats) ======
  // 레벨업으로 변하는 것: HP/MP/EXP(필요치)만
  // 아이템으로 변하는 것: atk/def/hit/eva/critChance/critMult
  const BASE_EQUIP_DEFAULTS = {
    ear:    { uid:null, id:"none",  name:"없음", atk:0, def:0, mdef:0, hit:0, eva:0, critChance:0.00, critMult:0.00 },
    helm:   { uid:null, id:"none",  name:"없음", atk:0, def:0, mdef:0, hit:0, eva:0, critChance:0.00, critMult:0.00 },
    neck:   { uid:null, id:"none",  name:"없음", atk:0, def:0, mdef:0, hit:0, eva:0, critChance:0.00, critMult:0.00 },
    tee:    { uid:null, id:"none",  name:"없음", atk:0, def:0, mdef:0, hit:0, eva:0, critChance:0.00, critMult:0.00 },

    // ✅ '갑옷 슬롯'은 기본 표기만 있고(툴팁/아이콘 X), 실제 착용시 uid가 생김
    armor:  { uid:null, id:"cloth", name:"갑옷", atk:0, def:0, mdef:0, hit:0, eva:0, critChance:0.00, critMult:0.00 },

    cloak:  { uid:null, id:"none",  name:"없음", atk:0, def:0, mdef:0, hit:0, eva:0, critChance:0.00, critMult:0.00 },
    ring:   { uid:null, id:"none",  name:"없음", atk:0, def:0, mdef:0, hit:0, eva:0, critChance:0.00, critMult:0.00 },
    belt:   { uid:null, id:"none",  name:"없음", atk:0, def:0, mdef:0, hit:0, eva:0, critChance:0.00, critMult:0.00 },
    shield: { uid:null, id:"none",  name:"없음", atk:0, def:0, mdef:0, hit:0, eva:0, critChance:0.00, critMult:0.00 },

    // ✅ 무기 슬롯 기본: 맨손 (툴팁/아이콘 X)
    weapon: { uid:null, id:"fist",  name:"맨손", atk:0, baseAtk:0, enhance:0, fixedAtk:false, def:0, mdef:0, hit:0, eva:0, critChance:0.00, critMult:1.50 },

    glove:  { uid:null, id:"none",  name:"없음", atk:0, def:0, mdef:0, hit:0, eva:0, critChance:0.00, critMult:0.00 },
    shoe:   { uid:null, id:"none",  name:"없음", atk:0, def:0, mdef:0, hit:0, eva:0, critChance:0.00, critMult:0.00 },
  };

  // 레벨업으로 변하는 것: HP/MP/EXP(필요치)만
  // 아이템으로 변하는 것: atk/def/hit/eva/critChance/critMult
  const equipment = {
    ear:    {...BASE_EQUIP_DEFAULTS.ear},
    helm:   {...BASE_EQUIP_DEFAULTS.helm},
    neck:   {...BASE_EQUIP_DEFAULTS.neck},
    tee:    {...BASE_EQUIP_DEFAULTS.tee},
    armor:  {...BASE_EQUIP_DEFAULTS.armor},
    cloak:  {...BASE_EQUIP_DEFAULTS.cloak},
    ring:   {...BASE_EQUIP_DEFAULTS.ring},
    belt:   {...BASE_EQUIP_DEFAULTS.belt},
    shield: {...BASE_EQUIP_DEFAULTS.shield},
    weapon: {...BASE_EQUIP_DEFAULTS.weapon},
    glove:  {...BASE_EQUIP_DEFAULTS.glove},
    shoe:   {...BASE_EQUIP_DEFAULTS.shoe},
  };

  function recalcCombatStats(levelsOverride){
    const b = calcStatBonus(levelsOverride);

    // ✅ 대표님 요청: 최종 공격력 = (내 공격력) + (장비 공격력 합)
    const BASE_PLAYER_ATK = (player.baseAtkBase != null) ? (player.baseAtkBase|0) : 8;
    player.baseAtkBase = BASE_PLAYER_ATK;

    // ✅ 장비 공격력(강화 반영): baseAtk + enhance*10 (고정 수치)
    const _atkBase = (obj)=> (("baseAtk" in (obj||{})) ? (+obj.baseAtk||0) : (+obj.atk||0));
    const _atkWithEnhFlat = (obj)=>{
      if (!obj) return 0;
      const base = _atkBase(obj);
      if (!base) return 0;
      const enh = (+obj.enhance||0);
      return base + (enh * 10);
    };

    const SLOT_KEYS = ["ear","helm","neck","tee","armor","cloak","ring","belt","shield","weapon","glove","shoe"];

    let eqAtk=0, eqDef=0, eqMdef=0, eqHit=0, eqEva=0, eqCritChance=0;

    // ✅ 치명타 배수: 기본은 무기(또는 1.50), 나머지는 합산(add)
    const w = equipment.weapon || {};
    const baseMult = (w && w.critMult && w.critMult > 0) ? w.critMult : 1.50;
    let addMult = 0;

    for (const k of SLOT_KEYS){
      const it = equipment[k];
      if (!it) continue;

      // ✅ 기본(빈) 장비는 스탯에 포함하지 않음
      const isEmpty = !it.uid || String(it.id||"") === "none" || (k==="weapon" && String(it.id||"")==="fist") || (k==="armor" && String(it.id||"")==="cloth");
      if (isEmpty) continue;

      eqAtk += _atkWithEnhFlat(it);
      eqDef += (it.def||0);
      eqMdef += (it.mdef||0);
      eqHit += (it.hit||0);
      eqEva += (it.eva||0);
      eqCritChance += (it.critChance||0);

      if (k !== "weapon"){
        addMult += (it.critMult||0);
      }
    }

    const myAtk = Math.floor((BASE_PLAYER_ATK + (b.atkAdd||0)) * (b.atkMul ?? 1));
    player.atk = Math.max(0, myAtk + eqAtk);

    player.def = Math.floor((eqDef + (b.defAdd||0)) * (b.defMul ?? 1));

    // ✅ 마법방어(지능 스탯 + 장비 mdef 지원)
    player.mdef = Math.floor((eqMdef + (b.mdefAdd||0)) * (b.mdefMul ?? 1));
    player.hit = eqHit + b.hitAdd;
    player.eva = eqEva + b.evaAdd;

    // 공격속도/이동속도(스탯) 반영
    const baseAtkInterval = 0.55;
    player.atkInterval = Math.max(0.10, baseAtkInterval * b.atkIntervalMul);
    player.speed = R.speedChase + b.speedAdd;

    // 확률/배수는 합산 후 안전 범위로 클램프
    player.critChance = Math.max(0, Math.min(0.95, eqCritChance + (b.critChanceAdd||0)));
    player.critMult = Math.max(1.10, Math.min(3.00, baseMult + addMult + (b.critMultAdd||0)));

    // 기존 코드 호환용
    player.dmg = player.atk;
  }

function equipItem(slot, item){
    if (!equipment[slot] || !item) return;

    // ✅ 장비는 개별 인스턴스(uid)까지 저장해야 인벤에서 정확히 1개만 E 표시됨
    equipment[slot] = {
      uid: item.uid || null,
      id: item.id || item.name || "item",
      name: item.name || "아이템",
      // ✅ baseAtk / enhance / atk(최종) 분리
      baseAtk: (("baseAtk" in item) ? (item.baseAtk|0) : (item.atk|0)) || 0,
      enhance: (item.enhance|0) || 0,
      // atk는 baseAtk로 유지(강화는 enhance로만 관리, 최종공격력은 recalcCombatStats에서 합산)
      atk: (("baseAtk" in item) ? (item.baseAtk|0) : (item.atk|0)) || 0,
      fixedAtk: !!item.fixedAtk,
      def: item.def||0,
      hit: item.hit||0,
      eva: item.eva||0,
      critChance: item.critChance||0,
      critMult: item.critMult||0,
      enhance: item.enhance|0 || 0,
    };

    // uid가 없다면(구형 데이터/예외) 무기 착용 상태를 맨손으로 되돌려 버그 방지
    if (slot === "weapon" && (!equipment.weapon.id || (equipment.weapon.id !== "fist" && !equipment.weapon.uid))){
      // 구형/예외 데이터 방어: "맨손(fist)"은 uid가 없어도 정상 케이스
      equipment.weapon = { uid:null, id:"fist", name:"맨손", atk:0, fixedAtk:false, def:0, hit:0, eva:0, critChance:0.00, critMult:1.50 };
    }
    playEquipSound();


    recalcCombatStats();
    try{ saveToLocal(); }catch(e){}
  }


  // ✅ 장비 해제(기본값으로 복귀)
  function unequipSlot(slot){
    try{
      if (!slot || !equipment[slot] || !BASE_EQUIP_DEFAULTS[slot]) return;
      equipment[slot] = { ...BASE_EQUIP_DEFAULTS[slot] };
      playEquipSound();
      window.equipment = equipment;
      recalcCombatStats();
      try{ saveToLocal(); }catch(_){}
    }catch(e){}
  }

  // ✅ (호환) 무기 해제
  function unequipWeapon(){ unequipSlot("weapon"); }

// 전역 노출(인벤 UI에서 사용)
  window.equipment = equipment;
  window.equipItem = equipItem;
  window.unequipSlot = unequipSlot;
  window.unequipWeapon = unequipWeapon;
  window.recalcCombatStats = recalcCombatStats;

  // 명중/회피 판정: hit-eva 기반 (튜닝 쉬움)
  function rollHit(attackerHit, defenderEva){
    // base 85% + (hit-eva)*2% (최소 10%, 최대 95%)
    const p = Math.max(0.10, Math.min(0.95, 0.85 + (attackerHit - defenderEva) * 0.02));
    return Math.random() < p;
  }
  function rollCrit(chance){
    return Math.random() < Math.max(0, Math.min(0.95, chance||0));
  }
  function calcDamageWithCrit(atk, def, critChance, critMult){
    let dmg = Math.max(1, (atk||0) - (def||0));
    const isCrit = rollCrit(critChance);
    if (isCrit){
      const mult = (critMult||1.5);
      // ✅ 체감용: 크리면 최소 +1 보정 (낮은 데미지에서도 확실히 달라짐)
      dmg = Math.max(dmg + 1, Math.floor(dmg * mult));
    }
    return { dmg, isCrit };
  }

  // 기존 호환용: dmg만 필요한 곳은 이걸 써도 됨
  function calcDamage(atk, def, critChance, critMult){
    return calcDamageWithCrit(atk, def, critChance, critMult).dmg;
  }


  function levelUpOnce(){
    if ((player.level|0) >= MAX_LEVEL){
      player.level = MAX_LEVEL;
      player.exp = Math.min(player.exp, player.expMax);
      return false;
    }
    player.level += 1;

    // ✅ 레벨업 연출: 머리 위 '레벨업' 텍스트 + 파티클
    try{ spawnLevelUpBurst(player.x, player.y - 48); }catch(e){}

        // ✅ 레벨업 사운드
    try{ playLevelUpSound(); }catch(e){}
// 스탯 분배용 포인트 지급 (레벨업마다 1포인트)
    window.statPoints = (window.statPoints|0) + 1;
    try{ if(typeof syncStatBtn === "function") syncStatBtn(); }catch(e){}
    // ✅ (실시간) 스탯분배 판넬이 열려있을 때 레벨업으로 포인트가 늘면, 판넬의 임시 포인트도 같이 증가
    try{
      if(typeof statPanel !== "undefined" && statPanel && !statPanel.classList.contains("hide")){
        // 레벨업 1회당 +1
        if(typeof tempStatPoints !== "undefined"){
          tempStatPoints = (tempStatPoints|0) + 1;
        }
        if(typeof renderStatRows === "function") renderStatRows();
      }
    }catch(_e){}
    applyPlayerStatsForLevel();
    recalcCombatStats();

    // 레벨업 보상: 풀회복
    player.hp = player.hpMax;
    player.mp = player.mpMax;
    try{ saveToLocal(); }catch(e){}
    return true;
  }

  // Rabbit stats (✅ fixed - no scaling by player level)
  // 토끼가 플레이어 레벨에 따라 강해지지 않도록 고정 스탯으로 변경했습니다.
  // 원하는 난이도면 여기 숫자만 조절하면 됩니다.
  const RABBIT_FIXED_LEVEL = 1;
  const RABBIT_FIXED_HP   = 14; // 기본 10보다 약간 여유 (원하면 10~20 사이로 조절)
  const RABBIT_FIXED_ATK  = 1;
  const RABBIT_FIXED_DEF  = 0;
  const RABBIT_FIXED_EXP  = 6;

  function makeRabbitStats(mobLevel){
    // mobLevel 인자는 호환용(무시)
    const level = RABBIT_FIXED_LEVEL;
    const hpMax = RABBIT_FIXED_HP;
    const atk   = RABBIT_FIXED_ATK;
    const def   = RABBIT_FIXED_DEF;
    const expGive = RABBIT_FIXED_EXP;
    return { level, hpMax, atk, def, dmg: atk, expGive };
  }

  function rollRabbitLevel(){
    // ✅ 항상 고정 레벨 (플레이어 레벨 연동 제거)
    return RABBIT_FIXED_LEVEL;
  }
// ====== TREES (맵 바깥 장식용) ======
  const TREES_N = 30;
  const trees = [];
  const TREE_SIZE = 96; // 나무 그려질 크기
  const OUT_MARGIN = 120; // 맵 바깥 여유

  function resolveCircle(a,b,minDist){
    const dx = b.x-a.x, dy = b.y-a.y;
    const d = Math.hypot(dx,dy);
    if (d === 0 || d >= minDist) return false;
    const nx = dx/d, ny = dy/d;
    const push = (minDist - d)/2;
    a.x -= nx*push; a.y -= ny*push;
    b.x += nx*push; b.y += ny*push;
    return true;
  }

  // ✅ 플레이어만 밀어내는 원형 충돌(몹이 도망가는 것처럼 보이는 현상 방지)
  // mover(플레이어)만 위치를 보정하고, obstacle(몹)은 그대로 둡니다.
  function resolveCircleStatic(mover, obstacle, minDist){
    const dx = mover.x - obstacle.x;
    const dy = mover.y - obstacle.y;
    const d = Math.hypot(dx, dy);
    if (d === 0 || d >= minDist) return false;
    const nx = dx / d, ny = dy / d;
    const push = (minDist - d);
    mover.x += nx * push;
    mover.y += ny * push;
    return true;
  }


  function vecToDir(vx,vy){
    if (Math.abs(vx) > Math.abs(vy)) return vx>0 ? DIR.RIGHT : DIR.LEFT;
    return vy>0 ? DIR.DOWN : DIR.UP;
  }

  function drawHpBar(screenX, screenY, w, h, ratio, fill){
    ctx.fillStyle = "rgba(0,0,0,0.6)";
    ctx.fillRect(screenX, screenY, w, h);
    ctx.fillStyle = fill;
    ctx.fillRect(screenX, screenY, Math.max(0, Math.min(1, ratio))*w, h);
  }

  // ====== MAP ======
  let MAP_W = 700, MAP_H = 700;
  const TILE = 64;

  // ====== SPRITE ======
  const HERO_FW = 50, HERO_FH = 50;
  const WALK_START = 0, WALK_LEN = 4;
  const ATK_START  = 4, ATK_LEN  = 4;
  const DIR = { DOWN:0, LEFT:1, RIGHT:2, UP:3 };

  // ====== RABBITS ======
  let RABBITS_N = 10;
  

/* ===== 2-FRAME PORTAL ANIMATION (1212.png) ===== */
const portalImg = new Image();
portalImg.src = "1212.png"; // ✅ 대표님 첨부 2프레임 시트

// ✅ 포탈 스프라이트 기본(2프레임)
const PORTAL = {
  frameCount: 2,
  fps: 2,          // 초당 2프레임(느긋한 깜빡임)
  frame: 0,
  acc: 0,
  fw: 0,
  fh: 0,
  scale: 1
};

// ✅ 2맵 전환 시스템(속삭임 숲속 ↔ 고요한 들판)
let currentMapId = "forest";
let grassTint = "forest"; // 배경 톤만 살짝 다르게(맵 구분용)

// ✅ 맵별 몹 구성(대표님 요청)
// - forest(속삭임 숲속): 토끼 10, 고양이 2
// - field (고요한 들판): 고양이 10
const MAP_MOBS = {
  forest: { rabbits: 10, cats: 2 },
  field:  { rabbits: 0,  cats: 10 }
};
// 맵 표시 이름
function mapTitleFor(id){
  return (id === "field") ? "- 고요한 들판 -" : "- 속삭임 숲속 -";
}


// 현재 맵 기준으로 몹을 "리셋 + 정확한 수량"으로 맞춤
function applyMapMobs(){
  const cfg = MAP_MOBS[currentMapId] || {rabbits: 10, cats: 2};

  // 토끼
  try{
    RABBITS_N = cfg.rabbits|0;
    if (typeof spawnRabbits === "function") spawnRabbits();
    else rabbits.length = 0;
  }catch(e){
    try{ rabbits.length = 0; }catch(_){}
  }

  // 고양이
  try{
    cats.length = 0;
    if (typeof spawnCats === "function") spawnCats(cfg.cats|0, window.player || player);
  }catch(e){
    try{ cats.length = 0; }catch(_){}
  }
}
// 포탈은 '현재 맵'에서 1개만 활성(맵 양쪽 끝)
const ACTIVE_PORTAL = {
  x: 0,
  y: 0,
  targetMap: "field",
  spawnSide: "left" // targetMap에서 어디로 떨어질지
};

// ✅ 자동사냥 중 포탈 이동 금지 경고(일반 문구)
let portalBlockMsgT = 0; // seconds
function showPortalBlockMsg(){
  portalBlockMsgT = 1.25; // 잠깐 경고 노출
}


// 포탈 위치 갱신(현재 맵 기준)
function syncActivePortal(){
  // 포탈 스프라이트가 아직 로딩 전이어도 '맵 상태(타겟/잔디톤/스폰사이드)'는 반드시 반영되게!
  // (모바일에서 로딩 타이밍이 느리면, 예전 코드처럼 return 되어 맵 복구가 안 된 것처럼 보일 수 있음)
  const baseW = (PORTAL.fw > 0 ? PORTAL.fw : 32); // fallback frame width
  const w = baseW * PORTAL.scale;
  const pad = 6;
  ACTIVE_PORTAL.y = MAP_H / 2;

  if(currentMapId === "forest"){
    // ✅ 속삭임 숲속: 우측 포탈 → 고요한 들판(좌측)
    ACTIVE_PORTAL.x = MAP_W - w/2 - pad;
    ACTIVE_PORTAL.targetMap = "field";
    ACTIVE_PORTAL.spawnSide = "left";
    grassTint = "forest";
  }else{
    // ✅ 고요한 들판: 좌측 포탈 → 속삭임 숲속(우측)
    ACTIVE_PORTAL.x = w/2 + pad;
    ACTIVE_PORTAL.targetMap = "forest";
    ACTIVE_PORTAL.spawnSide = "right";
    grassTint = "field";
  }
}

// 맵 적용 + (선택) 스폰 위치 지정
function setMap(nextMapId, spawnSide){
  currentMapId = nextMapId;

  // ✅ 마지막 맵을 별도 키로도 즉시 저장(세이브가 깨져도 맵은 복구되게)
  try{ localStorage.setItem(LAST_MAP_KEY, currentMapId); }catch(_){}

  // ✅ 맵 이름 연출(중앙 연출)
  try{
    if(nextMapId === "forest") window.showMapName && window.showMapName(mapTitleFor(window.currentMapId || currentMapId));
    else window.showMapName && window.showMapName("- 고요한 들판 -");
  }catch(_){}

  // ✅ 나무는 맵마다 다르게 (맵 바뀔 때마다 새로 뽑기)
  try{ spawnTrees(); }catch(_){}

  // 포탈 위치 갱신
  syncActivePortal();

  // ✅ 스폰(포탈 밟으면 targetMap의 지정 사이드로 뿅!)
//    ⚠️ 도착 직후 포탈과 겹치면 다시 되돌아가는 "왔다리 갔다리"가 생길 수 있어서,
//    포탈 충돌 범위 밖(포탈 앞쪽)으로 충분히 떨어뜨려 스폰합니다.
  if (spawnSide){
    const pw = (PORTAL.fw > 0 ? (PORTAL.fw * PORTAL.scale) : 120);
    // 포탈 판정에 쓰는 값(pw*0.38 + r)보다 더 크게(여유 마진 포함)
    const safeInset = (pw * 0.38) + player.r + 18;

    if (spawnSide === "left"){
      // 좌측 포탈(도착 맵의 좌측)에 닿지 않게 → 포탈 오른쪽(맵 안쪽)으로 스폰
      player.x = ACTIVE_PORTAL.x + safeInset;
      player.y = MAP_H/2;
    } else if (spawnSide === "right"){
      // 우측 포탈(도착 맵의 우측)에 닿지 않게 → 포탈 왼쪽(맵 안쪽)으로 스폰
      player.x = ACTIVE_PORTAL.x - safeInset;
      player.y = MAP_H/2;
    } else if (spawnSide === "center"){
      player.x = MAP_W/2;
      player.y = MAP_H/2;
    }

    // 안전 클램프(맵 밖으로 안 나가게)
    player.x = Math.max(player.r + 4, Math.min(MAP_W - player.r - 4, player.x));
    player.y = Math.max(player.r + 4, Math.min(MAP_H - player.r - 4, player.y));
  }


  // ✅ 맵별 몹 리셋/스폰(플레이어 위치 이동 후에 실행해야 맵 한쪽으로 몰리지 않음)
  try{ applyMapMobs(); }catch(_){}

  // 포탈 연속 발동 방지(짧은 쿨)
  player.portalLock = 0.85;

  // ✅ 맵 이동 직후 즉시 저장(종료 직전에 저장 실패해도 맵은 남도록)
  try{ if (typeof saveToLocal === "function") saveToLocal(); }catch(_){}
}

portalImg.addEventListener("load", ()=>{
  const w = (portalImg.naturalWidth || portalImg.width);
  const h = (portalImg.naturalHeight || portalImg.height);
  PORTAL.fw = Math.floor(w / PORTAL.frameCount);
  PORTAL.fh = Math.floor(h);

  // 최초 포탈 위치 세팅
  syncActivePortal();
});

/* ===== CAT MONSTER INTEGRATION (SAFE ADD) ===== */
const catImg = new Image();
catImg.src = "cat.png";

const C = {
  cols: 4, rows: 4,
  fw: 0, fh: 0,
  r: 14,

  // 이동/AI (토끼 AI 구조와 동일)
  speedWander: 0.42,
  speedChase:  0.72,
  detectRadius: 130,
  giveUpRadius: 170,
  wanderChangeMin: 0.7,
  wanderChangeMax: 1.8,
  animFPS: 8,

  // 공격
  dmg: 1,
  atkInterval: 0.95
};


// ⏱ 고양이 리스폰 시간(초) - 여기 숫자만 바꾸면 됨
const CAT_RESPAWN_SEC = 10;
// ✅ 고양이 스프라이트 프레임 크기 자동 계산(4x4)
catImg.addEventListener("load", ()=>{
  try{
    C.fw = Math.floor((catImg.naturalWidth || catImg.width) / C.cols);
    C.fh = Math.floor((catImg.naturalHeight || catImg.height) / C.rows);
  }catch(_){}
});


const cats = [];
function spawnCats(n=2, anchor){
  // ✅ player 선언 전에 호출돼도 안 터지게 안전 처리
  const pl = anchor || window.player || null;
  const baseX = pl ? pl.x : (MAP_W/2);
  const baseY = pl ? pl.y : (MAP_H/2);

  for(let i=0;i<n;i++){
    // ✅ 토끼 스탯의 2배(HP/공격력)
    const _rbSt = (typeof makeRabbitStats === 'function') ? makeRabbitStats(1) : {hpMax:14, atk:1, def:0, dmg:1};
    const _catHpMax = (_rbSt.hpMax||10) * 2;
    const _catDmg   = (_rbSt.atk||_rbSt.dmg||1) * 2;
    const _catDef   = (_rbSt.def||0);

    cats.push({
      x: (currentMapId === "field") ? rand(24, MAP_W-24) : clamp(baseX + (Math.random()*260-130), 24, MAP_W-24),
      y: (currentMapId === "field") ? rand(24, MAP_H-24) : clamp(baseY + (Math.random()*260-130), 24, MAP_H-24),

      // (현재는 토끼처럼 죽음/리스폰까지 붙이지 않고, 배회/추격/공격만)
      hp: _catHpMax,
      hpMax: _catHpMax,

      vx: 0, vy: 1,
      dir: DIR.DOWN,
      frame: Math.floor(Math.random()*4),
      tAnim: 0,

      state: "wander",
      tWander: rand(C.wanderChangeMin, C.wanderChangeMax),
      atk: _catDmg,
      dmg: _catDmg,
      def: _catDef,
      atkCooldown: rand(0, C.atkInterval),

      expGive: 10,

      alpha: 1,
      respawnT: 0,
      kind: 'cat'
    });

    // 시작 배회 방향 세팅
    pickCatWander(cats[cats.length-1]);
  }
}

// ✅ player 준비된 뒤 한 번만 스폰
function ensureCats(){
  if (cats.length) return;
  spawnCats(2, window.player);
}
function pickCatWander(c){
  const a = Math.random()*Math.PI*2;
  c.vx = Math.cos(a);
  c.vy = Math.sin(a);
  c.tWander = rand(C.wanderChangeMin, C.wanderChangeMax);
}

function animateCatWalk(c, dt){
  c.tAnim += dt;
  if (c.tAnim >= 1/C.animFPS){
    c.tAnim = 0;
    c.frame = (c.frame + 1) % 4;
  }
}

function catAttack(c, targetIsPet){
  const tgt = (targetIsPet && pet && !pet.deadForever && pet.state === 'alive') ? pet : player;
  if (tgt === player){
    if (typeof player === "undefined") return;
    if (player.state !== 'alive') return;
  } else {
    if (!pet || pet.state !== 'alive') return;
  }
  if (c.atkCooldown > 0) return;
  c.atkCooldown = C.atkInterval;

  const tgtEva = (tgt.eva||0);
  if (!rollHit(c.hit||0, tgtEva)){
    try{ spawnWordText(tgt.x, tgt.y - 24, "회피", "rgba(170, 255, 120, 0.98)"); }catch(_){}
    return;
  }
  const taken = calcDamage((c.atk || c.dmg || C.dmg || 0), (tgt.def||0), c.critChance||0, c.critMult||1.5);

  if (tgt === player){
    player.hp = Math.max(0, player.hp - taken);
    try{ spawnDmgText(player.x, player.y - 22, taken, "rgb(255,70,70)", false); }catch(_){}
    try{ spawnBlood(player.x, player.y - 6); }catch(_){}
    if (player.hp <= 0){
      player.hp = 0;
      player.state = 'dead';
      try{ deathSfx.currentTime = 0; deathSfx.play().catch(()=>{}); }catch(e){}
    }
  } else {
    petTakeDamage(taken);
  }
}

function updateCats(dt){
  if (typeof player === "undefined") return;

  const d2 = C.detectRadius*C.detectRadius;
  const g2 = C.giveUpRadius*C.giveUpRadius;
  const contact2 = (player.r + C.r) * (player.r + C.r);

  for(const c of cats){
    // 초기값 보정(구버전 저장 데이터 대비)
    if (c.vx === undefined){ c.vx = 0; c.vy = 1; }
    if (c.tAnim === undefined) c.tAnim = 0;
    if (c.tWander === undefined) c.tWander = rand(C.wanderChangeMin, C.wanderChangeMax);
    if (!c.state || c.state === "idle") c.state = "wander";
    if (c.atkCooldown === undefined) c.atkCooldown = rand(0, C.atkInterval);

    // ✅ 죽은 고양이: 페이드아웃 + 리스폰 타이머만 처리하고 로직 스킵
    if (c.state === 'dead'){
      // 페이드아웃
      c.alpha = Math.max(0, (c.alpha ?? 1) - 1.4 * dt);

      // ⚠️ respawnT가 0/undefined로 들어오면 즉시 리스폰되는 버그 방지
      // (죽는 순간에는 반드시 CAT_RESPAWN_SEC로 세팅되어야 함)
      if (c.respawnT == null || c.respawnT <= 0){
        c.respawnT = CAT_RESPAWN_SEC;
      }

      // 타이머 감소
      c.respawnT -= dt;

      // 타이머 끝나면 랜덤 리스폰
      if (c.respawnT <= 0){
        c.x = rand(C.r, MAP_W - C.r);
        c.y = rand(C.r, MAP_H - C.r);

        c.hp = c.hpMax;
        c.state = 'wander';
        c.alpha = 1;

        // 리스폰 직후 공격 딜레이 약간 랜덤(자연스럽게)
        c.atkCooldown = rand(0, C.atkInterval);

        // 배회 방향/목표 재설정
        pickCatWander(c);

        // 다음 사망 때를 위해 초기화
        c.respawnT = 0;
      }
      continue;
    }

    c.atkCooldown = Math.max(0, c.atkCooldown - dt);

    c.petAggroT = Math.max(0, (c.petAggroT||0) - dt);
    const petAlive = (pet && pet.state === 'alive');
    const ddPlayer0 = dist2(c.x, c.y, player.x, player.y);
    const ddPet0 = petAlive ? dist2(c.x, c.y, pet.x, pet.y) : 1e18;
    const nearPet0 = petAlive && (ddPet0 <= d2);
    const usePet = petAlive && (c.petAggroT > 0 || (nearPet0 && ddPet0 <= ddPlayer0));
    const tx = usePet ? pet.x : player.x;
    const ty = usePet ? pet.y : player.y;
    const tr = usePet ? (pet.r||14) : player.r;

    const dd = dist2(c.x, c.y, tx, ty);
    const touching = dd <= ((C.r + tr) * (C.r + tr));

    if (touching){
      // 이동은 멈추지만 걷기 모션은 유지(토끼와 동일)
      c.state = "attack";
      c.vx = 0; c.vy = 0;

      // 플레이어 바라보기
      c.dir = vecToDir(tx - c.x, ty - c.y);

      animateCatWalk(c, dt);
      catAttack(c, usePet);
    } else {
      if (c.state === "wander" && dd <= d2) c.state = "chase";
      if (c.state === "chase" && dd >= g2){ c.state = "wander"; pickCatWander(c); }

      let mvx=0, mvy=0, spd=0;

      if (c.state === "chase"){
        const dx = tx - c.x, dy = ty - c.y;
        const len = Math.hypot(dx,dy) || 1;
        mvx = dx/len; mvy = dy/len; spd = C.speedChase;
      } else {
        c.tWander -= dt;
        if (c.tWander <= 0) pickCatWander(c);
        mvx = c.vx; mvy = c.vy; spd = C.speedWander;
      }

      c.x += mvx*spd;
      c.y += mvy*spd;

      c.x = clamp(c.x, C.r, MAP_W-C.r);
      c.y = clamp(c.y, C.r, MAP_H-C.r);

      const moving = (Math.abs(mvx)+Math.abs(mvy))>0.01;
      if (moving) c.dir = vecToDir(mvx,mvy);

      if (moving) animateCatWalk(c, dt);
      else c.frame = 0;
    }
  }

  // 고양이끼리 분리
  for (let i=0;i<cats.length;i++){
    const a = cats[i];
    for (let j=i+1;j<cats.length;j++){
      const b = cats[j];
      if (a.state === 'dead' || b.state === 'dead') continue;
      resolveCircle(a,b,C.r*2);
      a.x = clamp(a.x, C.r, MAP_W-C.r); a.y = clamp(a.y, C.r, MAP_H-C.r);
      b.x = clamp(b.x, C.r, MAP_W-C.r); b.y = clamp(b.y, C.r, MAP_H-C.r);
    }
  }

  // 플레이어-고양이 분리
  for (const c of cats){
    if (c.state === 'dead') continue; // ✅ 죽자마자 충돌 제거
    resolveCircleStatic(player, c, player.r + C.r);
    player.x = clamp(player.x, player.r, MAP_W-player.r);
    player.y = clamp(player.y, player.r, MAP_H-player.r);
    c.x = clamp(c.x, C.r, MAP_W-C.r);
    c.y = clamp(c.y, C.r, MAP_H-C.r);
  }
}

function drawCat(c, camX, camY){
  if(!(catImg.complete && (catImg.naturalWidth>0 || catImg.width>0))) return;
  if(!C.fw || !C.fh) return;

  // ✅ 화면에 그릴 크기를 토끼/플레이어 시트(50x50) 기준으로 키움
  const dw = HERO_FW;
  const dh = HERO_FH;

  const col = Math.floor(c.frame);
  const row = c.dir;

  const sx = c.x - camX - dw/2;
  const sy = c.y - camY - dh/2;

  ctx.save();
  ctx.globalAlpha = c.alpha;

  ctx.drawImage(
    catImg,
    col*C.fw,
    row*C.fh,
    C.fw, C.fh,
    Math.round(sx), Math.round(sy),
    dw, dh
  );

  // ✅ 고양이 닉네임 + HP바 (토끼와 동일한 스타일)
  ctx.font = "bold 11px system-ui, -apple-system, 'Segoe UI', sans-serif";
  ctx.textAlign = "center";
  ctx.textBaseline = "bottom";

  // 그림자
  ctx.fillStyle = "rgba(0,0,0,0.6)";
  ctx.fillText(
    "고양이",
    Math.round(c.x - camX),
    Math.round(c.y - camY - dh/2 + 28)
  );

  // 본문 텍스트
  ctx.fillStyle = "#ffffff";
  ctx.fillText(
    "고양이",
    Math.round(c.x - camX),
    Math.round(c.y - camY - dh/2 + 28)
  );

  if ((c.state !== 'respawn') && c.alpha > 0){
    const bw = 22, bh = 4;
    const bx = (c.x - camX) - bw/2;
    const by = (c.y - camY) - dh/2 - bh + 13;
    drawHpBar(bx, by, bw, bh, c.hp/c.hpMax, "rgba(255,120,120,1)");
  }

  ctx.restore();
}

const rabbits = [];

  const R = {
    cols: 4, rows: 4,
    fw: 0, fh: 0,
    speedWander: 0.4,
    speedChase:  0.7,
    detectRadius: 130,
    giveUpRadius: 170,
    wanderChangeMin: 0.7,
    wanderChangeMax: 1.8,
    animFPS: 8,
    r: 14,
    hpMax: 10,
    dmg: 1,
    atkInterval: 0.9,
    fadeSpeed: 0.67,
    respawnDelay: 10,
    expGive: 6
  };

  function pickWander(rb){
    const a = Math.random()*Math.PI*2;
    rb.vx = Math.cos(a);
    rb.vy = Math.sin(a);
    rb.tWander = rand(R.wanderChangeMin, R.wanderChangeMax);
  }

  function newRabbit(){
    const mobLv = rollRabbitLevel();
    const st = makeRabbitStats(mobLv);
    const rb = {
      x: rand(20, MAP_W-20),
      y: rand(20, MAP_H-20),
      vx: 0, vy: 0,
      dir: DIR.DOWN,
      frame: Math.floor(Math.random()*4),
      tAnim: 0,
      state: 'wander',
      tWander: rand(R.wanderChangeMin, R.wanderChangeMax),
      level: st.level,
      hpMax: st.hpMax,
      hp: st.hpMax,
      atk: st.atk,
      def: st.def,
      dmg: st.dmg,
      atkCooldown: rand(0, R.atkInterval),
      alpha: 1,
      expGive: st.expGive,
      respawnT: 0,
      kbVx: 0,
      kbVy: 0,
      kbT: 0
    };
    pickWander(rb);
    return rb;
  }

  function spawnRabbits(){
    rabbits.length = 0;
    for (let i=0;i<RABBITS_N;i++) rabbits.push(newRabbit());
  }

  function rabbitRespawn(rb){
    rb.x = rand(20, MAP_W-20);
    rb.y = rand(20, MAP_H-20);
    const mobLv = rollRabbitLevel();
    const st = makeRabbitStats(mobLv);
    rb.level = st.level;
    rb.hpMax = st.hpMax;
    rb.atk = st.atk;
    rb.def = st.def;
    rb.dmg = st.dmg;
    rb.expGive = st.expGive;
    rb.hp = rb.hpMax;
    rb.alpha = 1;
    rb.state = 'wander';
    rb.atkCooldown = rand(0, R.atkInterval);
    pickWander(rb);
  }

  // ====== PLAYER ======
  const player = {
    x: MAP_W/2, y: MAP_H/2,
    r: 16,
    dir: DIR.DOWN,
    walkFrame: 0,
    atkFrame: 0,
    animT: 0,
    attacking: false,
    level: 1,
    hpMax: 50,
    hp: 50,
    mpMax: 20,
    mp: 20,
    expMax: 30,
    exp: 0,
    // 전투 스탯(아이템 합산)
    atk: 2,
    def: 0,
    hit: 0,
    eva: 0,
    critChance: 0,
    critMult: 1.5,
    speed: R.speedChase,
    alpha: 1,
    state: 'alive',
    respawnT: 0,
    respawnDelay: 2,

    atkCooldown: 0,
    atkInterval: 0.55,
    dmg: 2,
    auto: false,
    autoDelay: 0,        // 자동사냥 지연 타이머
    autoDelayTime: 1.0,
  };


  // ====== PET AI (follow + ranged bow) ======
  const pet = {
    
    deadForever: true, // ✅ 영구 사망(재접속/재시작해도 부활 X)
x: player.x - 48,
    y: player.y + 34,
    r: 14,
    hpMax: Math.max(1, Math.floor(player.hpMax/3)),
    hp: Math.max(1, Math.floor(player.hpMax/3)),
    def: 0,
    eva: 0,
    alpha: 0,
    state: 'dead', // alive | deadHold | dead
    deadHoldT: 0,
    dir: DIR.DOWN,
    walkFrame: 0,
    atkFrame: 0,
    animT: 0,
    attacking: false,
    atkT: 0,
    atkCd: 0,
    // follow orbit
    orbitAng: Math.random() * Math.PI * 2,
    orbitR: 62,
    // target
    target: null,
    targetLockT: 0
  };
  // ✅ expose pet globally so UI/inventory code outside IIFE can control it
  window.pet = pet;


  const petArrows = []; // {x,y,vx,vy,t,life,trailX,trailY,target}

  function awardExp(g){
    const _g = (g|0);
    if (_g <= 0) return;
    player.exp += _g;
    try{ if(_g>0) pushInfoLogLine?.(`${_g} 경험치를 습득했습니다.`); }catch(_){}
    while (player.expMax > 0 && player.exp >= player.expMax){
      player.exp -= player.expMax;
      if (!levelUpOnce()) break;
    }
  }

  function nearestMob(px, py, maxR){
    let best = null, bestD2 = maxR*maxR;
    // rabbits
    for (const m of rabbits){
      if (!m || m.hp <= 0) continue;
      if (m.state === 'dead' || m.state === 'respawn') continue;
      const dx = m.x - px, dy = m.y - py;
      const d2 = dx*dx + dy*dy;
      if (d2 < bestD2){
        bestD2 = d2;
        best = m;
      }
    }
    // cats
    for (const m of cats){
      if (!m || m.hp <= 0) continue;
      if (m.state === 'dead' || m.state === 'respawn') continue;
      const dx = m.x - px, dy = m.y - py;
      const d2 = dx*dx + dy*dy;
      if (d2 < bestD2){
        bestD2 = d2;
        best = m;
      }
    }
    return best;
  }

  function petMobDie(m){
    // keep existing game rules: cats use CAT_RESPAWN_SEC, rabbits use R.respawnSec
    if (m.kind === 'cat'){
      if (m.state !== 'dead'){
        m.state = 'dead';
        try{ sndCatDie.currentTime = 0; sndCatDie.play().catch(()=>{}); }catch(e){}
        // ✅ 고양이 처치 보상: 골드 10개 즉시 인벤 지급
        try{
          addItemToInventory({ id:"gold", name:"골드", icon:"gold-1.png", qty:10 });
        }catch(e){}
        awardExp(m.expGive ?? 10);
        m.alpha = 1;
        m.respawnT = CAT_RESPAWN_SEC;
        m.vx = 0; m.vy = 0;
        m.atkCooldown = 9999;
      }
      return;
    }

    // rabbit (or default mob)
    if (m.state !== 'dead'){
      m.state = 'dead';
      // ✅ 토끼 드랍: 단검 3% + HP/MP 물약(소) 각각 4%
      if (m.kind !== 'cat' && Math.random() < 0.03){
        try{
          // ✅ 아이템 드랍 순간 사운드
          try{ itemDropSfx.currentTime = 0; itemDropSfx.play().catch(()=>{}); }catch(_e){}
          spawnGroundKnife(m.x, m.y);
        }catch(e){}
      }
      if (m.kind !== 'cat' && Math.random() < 0.04){
        try{
          try{ itemDropSfx.currentTime = 0; itemDropSfx.play().catch(()=>{}); }catch(_e){}
          spawnGroundHpPotionS(m.x, m.y);
        }catch(e){}
      }
      if (m.kind !== 'cat' && Math.random() < 0.04){
        try{
          try{ itemDropSfx.currentTime = 0; itemDropSfx.play().catch(()=>{}); }catch(_e){}
          spawnGroundMpPotionS(m.x, m.y);
        }catch(e){}
      }
      try{ sndRabbitDie.currentTime = 0; sndRabbitDie.play().catch(()=>{}); }catch(e){}
        // ✅ 토끼 처치 보상: 골드 5개 즉시 인벤 지급
        try{
          addItemToInventory({ id:"gold", name:"골드", icon:"gold-1.png", qty:5 });
        }catch(e){}
    }
    awardExp(m.expGive || R.expGive || 0);
    m.alpha = 1;
    m.respawnT = R.respawnSec;
    m.atkCooldown = 9999;
  }

  function petHitMob(m, dmg){
    if (!m || m.hp <= 0) return;
    const d = Math.max(1, dmg|0);
    m.hp = Math.max(0, (m.hp|0) - d);
    try{ spawnDmgText(m.x, m.y - 8, d, "#FFE650", false); }catch(_){}
    // ✅ 펫 화살 피격음도 플레이어와 동일하게
    try{ hitSfx.currentTime = 0; hitSfx.play().catch(()=>{}); }catch(e){}
    // ✅ 50% 확률로 펫을 어그로 타겟으로 전환(잠깐)
    if (m.hp > 0 && pet && pet.state === 'alive' && Math.random() < 0.50){
      m.petAggroT = 3.5; // seconds
    }
    if (m.hp <= 0){
      petMobDie(m);
    }
  }

  function spawnPetArrow(tx, ty, target){
    // ✅ 화살 발사 사운드(100%)
    try{ playArrowSfx(); }catch(e){}
    const ax = pet.x;
    const ay = pet.y - 10;
    const dx = tx - ax, dy = ty - ay;
    const dist = Math.max(1, Math.hypot(dx, dy));
    const spd = 420;
    const vx = (dx / dist) * spd;
    const vy = (dy / dist) * spd;

    petArrows.push({
      x: ax, y: ay,
      vx, vy,
      ang: Math.atan2(vy, vx),
      len: 16,
      t: 0,
      life: Math.min(0.8, dist / spd + 0.15),
      trailX: ax,
      trailY: ay,
      target: target || null
    });
  }

  function updatePetArrows(dt){
    
    if (pet && pet.deadForever) return;
for (let i=petArrows.length-1;i>=0;i--){
      const a = petArrows[i];
      a.t += dt;
      a.trailX = a.x;
      a.trailY = a.y;
      a.x += a.vx * dt;
      a.y += a.vy * dt;

      // hit check (simple radius)
      const trg = a.target;
      if (trg && trg.hp > 0 && trg.state !== 'dead' && trg.state !== 'respawn'){
        const dx = trg.x - a.x, dy = (trg.y - 10) - a.y;
        if (dx*dx + dy*dy <= (trg.r ? (trg.r*trg.r) : 16*16)){
          // damage on impact
          // ✅ 20% 확률 MISS (펫 공격만)
          if (Math.random() < 0.20){
            try{ spawnWordText(trg.x, (trg.y-26), "MISS", "rgba(255,245,140,0.98)"); }catch(_){}
            petArrows.splice(i,1);
            continue;
          }
          try{ spawnBlood(trg.x, (trg.y-10), 1.0); }catch(_){ }
          petHitMob(trg, 4);
          petArrows.splice(i,1);
          continue;
        }
      }

      if (a.t >= a.life){
        petArrows.splice(i,1);
      }
    }
  }

  function drawPetArrows(camX, camY){
    if (!petArrows.length) return;

    ctx.save();
    ctx.globalAlpha = 0.95 * (pet.alpha ?? 1);

    // trail
    ctx.lineWidth = 1.5;
    ctx.strokeStyle = "rgba(255,255,255,0.35)";
    for (const a of petArrows){
      const x1 = a.trailX - camX, y1 = a.trailY - camY;
      const x2 = a.x - camX,     y2 = a.y - camY;
      ctx.beginPath();
      ctx.moveTo(x1, y1);
      ctx.lineTo(x2, y2);
      ctx.stroke();
    }

    // arrow body (long projectile)
    for (const a of petArrows){
      const x = a.x - camX, y = a.y - camY;
      const ang = (a.ang != null) ? a.ang : Math.atan2(a.vy || 0, a.vx || 1);
      const len = a.len || 16;

      ctx.save();
      ctx.translate(x, y);
      ctx.rotate(ang);

      // shaft
      ctx.lineWidth = 3;
      ctx.strokeStyle = "rgba(245,245,245,0.95)";
      ctx.beginPath();
      ctx.moveTo(-len, 0);
      ctx.lineTo(-3, 0);
      ctx.stroke();

      // head
      ctx.fillStyle = "rgba(255,255,255,0.95)";
      ctx.beginPath();
      ctx.moveTo(0, 0);
      ctx.lineTo(-7, 3.2);
      ctx.lineTo(-7, -3.2);
      ctx.closePath();
      ctx.fill();

      // tiny fletching
      ctx.strokeStyle = "rgba(255,255,255,0.75)";
      ctx.lineWidth = 2;
      ctx.beginPath();
      ctx.moveTo(-len, 0);
      ctx.lineTo(-len + 4, 2.4);
      ctx.moveTo(-len, 0);
      ctx.lineTo(-len + 4, -2.4);
      ctx.stroke();

      ctx.restore();
    }

    ctx.restore();
  }

  function updatePet(dt){
    // ✅ 펫 스탯(공격/HP) 동기화
    syncPetStats();
    // ✅ 영구사망 펫은 어떤 경우에도 다시 살아나지 않음
    if (pet.deadForever){
      // 소환 전(또는 영구사망) 상태: 펫 로직 완전 중지
      return;
      if (pet.state === 'alive') pet.state = 'dead';
      pet.hp = 0;
    }
    if (pet.state === 'deadHold'){
      pet.deadHoldT -= dt;
      // 죽는 동안은 움직임/공격 정지
      if (pet.deadHoldT <= 0) pet.state = 'dead';
      return;
    }
    if (pet.state === 'dead'){
      pet.alpha = Math.max(0, (pet.alpha ?? 1) - R.fadeSpeed * dt);
      return;
    }
    // basic animation clocks
    const WALK_FPS = 8;
    const ATK_FPS  = 10;
    const preX = pet.x, preY = pet.y;

    // ✅ leash: 너무 멀어지면 타겟을 끊고 플레이어를 따라감
    const LEASH_DIST = 220;   // 이 거리보다 멀어지면 강제 복귀
    const dpX = player.x - pet.x, dpY = player.y - pet.y;
    const dp = Math.hypot(dpX, dpY);
    if (dp > LEASH_DIST){
      pet.target = null;
      pet.targetLockT = 0;
      pet.attacking = false;
      pet.atkFrame = 0;
    }

    // target acquire (locks briefly to avoid flicker)
    if (!pet.target || pet.target.hp <= 0 || pet.target.state === 'dead' || pet.target.state === 'respawn'){
      pet.target = null;
      pet.targetLockT = 0;
    }
    if (!pet.target){
      const m = nearestMob(player.x, player.y, 260);
      if (m){
        pet.target = m;
        pet.targetLockT = 0.4;
      }
    } else {
      pet.targetLockT = Math.max(0, pet.targetLockT - dt);
      if (pet.targetLockT <= 0){
        // allow retarget if something closer appears
        const m = nearestMob(player.x, player.y, 260);
        if (m) pet.target = m;
      }
    }

    // movement goal
    let gx, gy, speed;

    // ✅ 펫: 주변에 드롭 아이템이 있으면 전투/추종보다 아이템 줍기 우선
    let _loot = null;
    try{
      if (typeof groundDrops !== "undefined" && groundDrops && groundDrops.length && (typeof dp === "number" ? dp <= 180 : true)){
        const maxSeek = 280; // 탐색 반경
        const maxSeek2 = maxSeek * maxSeek;
        let bestD2 = 1e18;
        for (const d of groundDrops){
          if (!d) continue;
          if ((d.t||0) < (DROP.pickDelay||0)) continue; // 드랍 직후 딜레이 존중
          const dx = d.x - pet.x, dy = d.y - pet.y;
          const dd = dx*dx + dy*dy;
          if (dd <= maxSeek2 && dd < bestD2){
            bestD2 = dd;
            _loot = d;
          }
        }
      }
    }catch(_){ _loot = null; }


    if (pet.target){
      // ✅ 전투 중이라도 플레이어가 멀어지면 바로 복귀(따라다니기 우선)
      const lpX = player.x - pet.x, lpY = player.y - pet.y;
      const lp = Math.hypot(lpX, lpY);
      if (lp > 160){
        pet.target = null;
        pet.targetLockT = 0;
        pet.attacking = false;
        pet.atkFrame = 0;
      }
    }
    if (_loot){
      // looting move (드랍 위치로 이동) - 실제 줍기는 updateGroundDrops에서 처리
      gx = _loot.x; gy = _loot.y;
      const dx = gx - pet.x, dy = gy - pet.y;
      const d = Math.max(1, Math.hypot(dx, dy));
      speed = player.speed * 1.05;

      pet.x = clamp(pet.x + (dx/d) * speed * (dt*60), 0, MAP_W);
      pet.y = clamp(pet.y + (dy/d) * speed * (dt*60), 0, MAP_H);

      if (Math.abs(dx) > Math.abs(dy)) pet.dir = (dx >= 0) ? DIR.RIGHT : DIR.LEFT;
      else pet.dir = (dy >= 0) ? DIR.DOWN : DIR.UP;

    } else if (pet.target){
      const m = pet.target;
      const dx = m.x - pet.x, dy = m.y - pet.y;
      const d = Math.max(1, Math.hypot(dx, dy));

      // keep distance
      const minD = 90, maxD = 180;
      let mvx = 0, mvy = 0;

      if (d < minD){
        mvx = -dx / d;
        mvy = -dy / d;
        speed = player.speed;
      } else if (d > maxD){
        mvx = dx / d;
        mvy = dy / d;
        speed = player.speed;
      } else {
        // strafe a little while shooting
        const px = -dy / d, py = dx / d;
        const s = Math.sin(performance.now()/300);
        mvx = px * s;
        mvy = py * s;
        speed = player.speed;
      }

      pet.x = clamp(pet.x + mvx * speed * (dt*60), 0, MAP_W);
      pet.y = clamp(pet.y + mvy * speed * (dt*60), 0, MAP_H);

      // facing
      if (Math.abs(dx) > Math.abs(dy)) pet.dir = (dx >= 0) ? DIR.RIGHT : DIR.LEFT;
      else pet.dir = (dy >= 0) ? DIR.DOWN : DIR.UP;

      // attack
      pet.atkCd = Math.max(0, pet.atkCd - dt);
      const canShoot = (d <= maxD + 10);
      if (canShoot && pet.atkCd <= 0){
        pet.attacking = true;
        pet.atkT = 0;
        pet.atkFrame = 0;
        pet.atkCd = 1.70; // ✅ 펫 공격속도 50% 감소(공격 간격 2배)

        // ✅ 펫 공격 시도 순간 10% 확률로 기합음(aca.wav)
        try{
          if (Math.random() < 0.10){ acaSfx.currentTime = 0; acaSfx.play().catch(()=>{}); }
        }catch(e){}

        spawnPetArrow(m.x, m.y - 10, m);
      }

    } else {
      // follow / orbit player
      pet.orbitAng += dt * 0.9;
      pet.orbitR += Math.sin(performance.now()/520) * 0.04;
      const ox = Math.cos(pet.orbitAng) * pet.orbitR;
      const oy = Math.sin(pet.orbitAng) * (pet.orbitR * 0.55);

      gx = player.x + ox;
      gy = player.y + oy;

      const dx = gx - pet.x, dy = gy - pet.y;
      const d = Math.max(1, Math.hypot(dx, dy));

      const followFar = 150;
      speed = player.speed;

      pet.x = clamp(pet.x + (dx/d) * speed * (dt*60), 0, MAP_W);
      pet.y = clamp(pet.y + (dy/d) * speed * (dt*60), 0, MAP_H);

      if (Math.abs(dx) > Math.abs(dy)) pet.dir = (dx >= 0) ? DIR.RIGHT : DIR.LEFT;
      else pet.dir = (dy >= 0) ? DIR.DOWN : DIR.UP;

      pet.attacking = false;
      pet.atkFrame = 0;
    }

    // animation
    if (pet.attacking){
      pet.atkT += dt;
      if (pet.atkT >= 1/ATK_FPS){
        pet.atkT = 0;
        pet.atkFrame = (pet.atkFrame + 1) % PET_ATK_LEN;
        if (pet.atkFrame === 0) pet.attacking = false;
      }
    } else {
      // ✅ 이번 프레임에서 '실제로 이동했는지' 기준으로 걷기 모션
      const mv2 = (pet.x - preX)**2 + (pet.y - preY)**2;

      if (mv2 > 0.01){
        pet.animT += dt;
        if (pet.animT >= 1/WALK_FPS){
          pet.animT = 0;
          pet.walkFrame = (pet.walkFrame + 1) % PET_WALK_LEN;
        }
      } else {
        pet.walkFrame = 0;
        pet.animT = 0;
      }
    }
  }

  function drawPet(camX, camY){
    
    if (!pet || pet.deadForever || pet.state !== 'alive') return;
if (!(petImg.complete && petImg.naturalWidth>0)) return;

    const fw = PET_FW, fh = PET_FH;
    const col = pet.attacking ? pet.atkFrame : pet.walkFrame;
    const row = pet.attacking ? (pet.dir + 4) : pet.dir;

    const dw = HERO_FW, dh = HERO_FH;
    const sx = pet.x - camX - dw/2;
    const sy = pet.y - camY - dh/2;

    ctx.save();
    ctx.imageSmoothingEnabled = false;
    ctx.globalAlpha = 0.95 * (pet.alpha ?? 1);
    ctx.drawImage(petImg, col*fw, row*fh, fw, fh, Math.round(sx), Math.round(sy), dw, dh);
    // ✅ 펫 HP(머리 위, 연두색 HP바 - 플레이어와 동일 스타일)
  // ✅ 펫 HP + 이름
if (pet.state === 'alive'){
  const bw = 22, bh = 4;
  const bx = (pet.x - camX) - bw/2;
  const by = (pet.y - camY) - dh/2 - bh + 13;

  // 🔹 펫 이름 텍스트 (HP바 바로 위)
  ctx.font = "bold 10px system-ui, sans-serif";

  ctx.textAlign = "center";
  ctx.fillStyle = "#ffffff";

  ctx.fillText("(펫)아쳐", bx + bw/2, by - 4);

  // 🔹 HP바
  drawHpBar(
    bx, by, bw, bh,
    (pet.hpMax>0)?(pet.hp/pet.hpMax):0,
    "rgba(150,255,150,1)"
  );
}

ctx.restore();
  }

  // ✅ 세이브/로드 시스템에서 참조할 수 있도록 전역에 연결
  window.player = player;

  // expose for HUD updater (outside IIFE)
  window.player = player;
    try{ if (typeof ensureCats==='function') ensureCats(); }catch(e){}
// ✅ expose stat appliers for UI code outside this IIFE
  window.applyPlayerStatsForLevel = applyPlayerStatsForLevel;
  window.recalcCombatStats = recalcCombatStats;
  window.calcStatBonus = calcStatBonus;
  // ✅ (안전장치) 세이브 로드보다 먼저 '마지막 맵' 키가 있으면 우선 반영
  //    - 모바일에서 beforeunload가 안 뜨거나 세이브가 꼬여도, 마지막 맵은 복구되게
  try{
    const lm = localStorage.getItem(LAST_MAP_KEY);
    if (lm === "forest" || lm === "field"){ 
      if (typeof setMap === "function") setMap(lm, "center");
      else currentMapId = lm;
    }
  }catch(_){ }






  // ✅ 로컬 자동 불러오기(있으면 진행 상태 복원)
  try{ loadFromLocal(); }catch(e){}

  // ✅ 최초 접속(로드 포함) 시 자동사냥은 기본 OFF. Auto 버튼으로만 토글.
  try{ player.auto = false; window.autoHunt = false; }catch(_){}


  // ✅ 자동 저장: 맵/레벨/스탯/인벤 등 진행상태를 주기적으로 로컬에 저장
  try{
    const AUTOSAVE_MS = 4000;
    if (!window.__autosaveTimer){
      window.__autosaveTimer = setInterval(()=>{ try{ saveToLocal(); }catch(e){} }, AUTOSAVE_MS);
    }
    // 탭 전환/종료 시에도 저장(모바일에서도 pagehide/visibilitychange가 더 잘 잡힘)
    if (!window.__autosaveHooks){
      window.__autosaveHooks = true;
      addEventListener("beforeunload", ()=>{ try{ saveToLocal(); }catch(e){} });
      addEventListener("pagehide", ()=>{ try{ saveToLocal(); }catch(e){} });
      document.addEventListener("visibilitychange", ()=>{ if (document.hidden){ try{ saveToLocal(); }catch(e){} }});
    }
  }catch(_){}



  // init stats (Lv1 fixed) + item-only combat stats
  applyPlayerStatsForLevel();
  recalcCombatStats();
  player.hp = player.hpMax;
  player.mp = player.mpMax;

  const keys = Object.create(null);
  let manualMove = false;

  addEventListener('keydown', (e) => {
    if (!started) return; // 타이틀 화면에선 입력 막기
    keys[e.key] = true;
    if (['ArrowUp','ArrowDown','ArrowLeft','ArrowRight','w','a','s','d','W','A','S','D'].includes(e.key)) manualMove = true;
    if (e.key === ' ') { e.preventDefault(); tryPlayerAttack(); }
  }, {passive:false});
  addEventListener('keyup', (e) => {
    if (!started) return;
    keys[e.key] = false;
    manualMove = (keys['ArrowUp']||keys['ArrowDown']||keys['ArrowLeft']||keys['ArrowRight']||
                  keys['w']||keys['a']||keys['s']||keys['d']||keys['W']||keys['A']||keys['S']||keys['D']) || false;
  }, {passive:true});


// ====== VIRTUAL JOYSTICK (touch + mouse: 아무 곳이나 누르면 생성) ======
const joy = {
  active:false,
  pointerId:null,
  baseX:0, baseY:0,
  knobX:0, knobY:0,
  vx:0, vy:0,
  mag:0,
  radius:60,
  deadZone:0.12, // 0~1 (작을수록 민감)
  downT:0,
  moved:false,
};

const joyEl = document.getElementById('joy');
const joyBaseEl = document.getElementById('joyBase');
const joyKnobEl = document.getElementById('joyKnob');

function isUIHit(target){
  // 채팅 HUD/타이틀 버튼 등 UI 클릭은 조이스틱 방해하지 않게 예외 처리
  return !!(target && (target.closest('#chatToggleBtn') || target.closest('#twChatHud') || target.closest('#titleOverlay') || target.closest('.startBtn') || target.closest('#statBtn') || target.closest('#statPanel') || target.closest('#invBtn') || target.closest('#invPanel') || target.closest('#equipStatusBtn') || target.closest('#equipPanel') || target.closest('#enhanceModal') || target.closest('#enhanceBackdrop')));
}

function showJoy(x, y){
  joy.radius = (innerWidth <= 520) ? 54 : 60;
  joy.baseX = x; joy.baseY = y;
  joy.knobX = x; joy.knobY = y;
  joy.vx = 0; joy.vy = 0; joy.mag = 0;
  joy.downT = performance.now();
  joy.moved = false;

  joyBaseEl.style.left = x + 'px';
  joyBaseEl.style.top  = y + 'px';
  joyKnobEl.style.left = x + 'px';
  joyKnobEl.style.top  = y + 'px';
  joyBaseEl.style.display = 'block';
  joyKnobEl.style.display = 'block';
}

function hideJoy(){
  joy.active = false;
  joy.pointerId = null;
  joy.vx = joy.vy = joy.mag = 0;
  joyBaseEl.style.display = 'none';
  joyKnobEl.style.display = 'none';
}

function moveJoy(x, y){
  const dx = x - joy.baseX;
  const dy = y - joy.baseY;
  const d = Math.hypot(dx, dy) || 1;
  const clamped = Math.min(joy.radius, d);
  const nx = dx / d;
  const ny = dy / d;

  joy.knobX = joy.baseX + nx * clamped;
  joy.knobY = joy.baseY + ny * clamped;

  joyKnobEl.style.left = joy.knobX + 'px';
  joyKnobEl.style.top  = joy.knobY + 'px';

  joy.vx = nx;
  joy.vy = ny;
  joy.mag = clamp(clamped / joy.radius, 0, 1);
  if (clamped > 6) joy.moved = true;
}

// 포인터 이벤트(모바일 터치 + PC 마우스) 통합
addEventListener('pointerdown', (e) => {
  if (!started) return;              // 타이틀 화면에서는 무시(버튼 클릭용)
  const _hitEl = document.elementFromPoint(e.clientX, e.clientY) || e.target;
  if (isUIHit(_hitEl)) return;     // UI 위에서는 무시 (pointer-capture 대비)
  if (e.button != null && e.button !== 0) return; // 마우스 좌클릭만

  joy.active = true;
  joy.pointerId = e.pointerId;
  showJoy(e.clientX, e.clientY);

  // 캔버스 드래그/텍스트 선택 방지
  try { canvas.setPointerCapture(e.pointerId); } catch(_){}
  e.preventDefault();
}, {passive:false});

addEventListener('pointermove', (e) => {
  if (!joy.active) return;
  if (joy.pointerId !== e.pointerId) return;
  moveJoy(e.clientX, e.clientY);
  e.preventDefault();
}, {passive:false});

function joyUpCommon(e){
  if (!joy.active) return;
  if (joy.pointerId !== e.pointerId) return;

  const held = performance.now() - joy.downT;

  // ✅ 짧게 탭(드래그 거의 없음) = 공격(기존 touchstart 공격을 대체)
  if (!joy.moved && held < 220){
    tryPlayerAttack();
  }

  hideJoy();
  e.preventDefault();
}

addEventListener('pointerup', joyUpCommon, {passive:false});
addEventListener('pointercancel', joyUpCommon, {passive:false});

// ====== CAMERA ======
  function camera(){
    const vw = innerWidth, vh = innerHeight;
    let camX = player.x - vw/2, camY = player.y - vh/2;
    camX = (MAP_W <= vw) ? (MAP_W - vw)/2 : Math.max(0, Math.min(MAP_W - vw, camX));
    camY = (MAP_H <= vh) ? (MAP_H - vh)/2 : Math.max(0, Math.min(MAP_H - vh, camY));
    return {camX, camY, vw, vh};
  }

  // ====== PARTICLES (피 튐) ======
  const particles = [];
  function spawnBlood(px, py, boost=1){
    const count = Math.max(1, Math.round(14 * (boost||1)));
    for (let i=0;i<count;i++){
      const a = Math.random()*Math.PI*2;
      const sp = rand(40, 130);
      particles.push({
        x: px, y: py,
        vx: Math.cos(a)*sp,
        vy: Math.sin(a)*sp,
        life: rand(0.25, 0.55),
        t: 0,
        r: rand(1.5, 3.2)
      });
    }
  }
  function updateParticles(dt){
    for (let i=particles.length-1;i>=0;i--){
      const p = particles[i];
      p.t += dt;
      p.vy += 220*dt;
      p.x += p.vx*dt;
      p.y += p.vy*dt;
      if (p.t >= p.life) particles.splice(i,1);
    }
  }
  function drawParticles(camX, camY){
    ctx.save();
    for (const p of particles){
      const a = 1 - (p.t / p.life);
      ctx.globalAlpha = Math.max(0, a);
      ctx.fillStyle = "rgba(255,70,70,1)";
      ctx.beginPath();
      ctx.arc(p.x - camX, p.y - camY, p.r, 0, Math.PI*2);
      ctx.fill();
    }
    ctx.restore();
  }

  // ====== DAMAGE TEXT PARTICLES (떠오르는 수치) ======
  const dmgTexts = [];
  function spawnDmgText(wx, wy, value, color, isCrit=false){
    const v = Math.max(0, value|0);
    dmgTexts.push({
      x: wx,
      y: wy,
      vy: -rand(42, 78),          // 위로
      vx: rand(-10, 10),          // 살짝 흔들
      t: 0,
      life: isCrit ? 0.55 : 0.75, // ✅ 크리는 더 빨리 사라짐
      value: v,
      color,
      isCrit,
      // ✅ 크리 수치: 처음에 크게 '팍' → 빠르게 줄어들도록 시작 스케일을 크게
      scale: isCrit ? 2.15 : 1.0,
    });
  }

function updateDmgTexts(dt){
    for (let i=dmgTexts.length-1;i>=0;i--){
      const d = dmgTexts[i];
      d.t += dt;

      // ✅ 크리 수치: 빠르게 줄어들며 안정
      if (d.isCrit){
        const target = 0.88;
        d.scale += (target - d.scale) * (1 - Math.pow(0.00001, dt));
      } else {
        d.scale += (1.0 - d.scale) * (1 - Math.pow(0.00001, dt)); // pop->settle
      }

      d.x += d.vx * dt;
      d.y += d.vy * dt;
      d.vy += 55 * dt;
      d.vx *= (1 - 3.2*dt);
      if (d.t >= d.life) dmgTexts.splice(i,1);
    }
  }

function drawDmgTexts(camX, camY){
    ctx.save();
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";

    for (const d of dmgTexts){
      const p = d.t / d.life;
      const a = 1 - p;

      const sx = d.x - camX;
      const sy = d.y - camY;

      // 살짝 "팡" 튀는 느낌
      const pop = d.isCrit ? ((p < 0.10) ? (1.0 + (0.10 - p) * 6.8) : 1.0)
                        : ((p < 0.12) ? (1.0 + (0.12 - p) * 3.4) : 1.0);

      ctx.globalAlpha = Math.max(0, a);

      const base = d.isCrit ? 18 : 15;
      const size = Math.round(base * d.scale * pop);
      ctx.font = `800 ${size}px system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", sans-serif`;

      const text = String(d.value);

      // outline
      ctx.lineWidth = d.isCrit ? 6 : 5;
      ctx.strokeStyle = "rgba(0,0,0,0.60)";
      ctx.strokeText(text, sx, sy);

      // fill
      ctx.fillStyle = d.isCrit ? "rgba(255, 70, 70, 0.98)" : (d.color || "rgba(255,230,120,0.98)");
      ctx.fillText(text, sx, sy);
    }

    ctx.restore();
  }


  // ====== FLOAT WORD PARTICLES (MISS/회피) ======
  const wordTexts = [];
  function spawnWordText(wx, wy, text, color){
    wordTexts.push({
      x: wx,
      y: wy,
      text: String(text || ""),
      t: 0,
      life: 0.55,
      color: color || "rgba(200,200,200,0.95)",
      scale: 0.75,      // 시작 작게
      grow: 2.2,        // 점점 커짐
      vy: -12,          // 거의 제자리(살짝 위)
      vx: rand(-6, 6),
    });
  }
  function updateWordTexts(dt){
    for (let i=wordTexts.length-1;i>=0;i--){
      const w = wordTexts[i];
      w.t += dt;
      w.x += w.vx * dt;
      w.y += w.vy * dt;
      w.vx *= (1 - 3.0*dt);
      w.scale += w.grow * dt; // 점점 커짐
      if (w.t >= w.life) wordTexts.splice(i,1);
    }
  }
  function drawWordTexts(camX, camY){
    ctx.save();
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    for (const w of wordTexts){
      const p = w.t / w.life;
      const a = 1 - p;
      const sx = w.x - camX;
      const sy = w.y - camY;

      ctx.globalAlpha = Math.max(0, a);
      ctx.font = `900 ${Math.round(16 * w.scale)}px system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", sans-serif`;

      // outline
      ctx.lineWidth = 5;
      ctx.strokeStyle = "rgba(0,0,0,0.60)";
      ctx.strokeText(w.text, sx, sy);

      // fill
      ctx.fillStyle = w.color;
      ctx.fillText(w.text, sx, sy);
    }
    ctx.restore();
  }
  // ====== 레벨업 텍스트/파티클 (머리 위에서 '레벨업' 팡! 흩어짐) ======
  const levelUpBursts = [];   // 큰 텍스트 1개(팡)
  const levelUpSparks = [];   // 주변 스파크(흩어짐)

  function spawnLevelUpBurst(wx, wy){
    // 메인 텍스트
    levelUpBursts.push({
      x: wx,
      y: wy,
      t: 0,
      life: 0.75,
      vx: rand(-8, 8),
      vy: rand(-32, -22),
      rot: rand(-0.12, 0.12),
      wobble: rand(8, 14), // 살짝 흔들림(도)
    });

    // 스파크 파티클
    const n = 26;
    for(let i=0;i<n;i++){
      const ang = rand(0, Math.PI*2);
      const sp  = rand(70, 190);
      levelUpSparks.push({
        x: wx,
        y: wy,
        vx: Math.cos(ang)*sp,
        vy: Math.sin(ang)*sp - rand(40, 120),
        t: 0,
        life: rand(0.55, 0.95),
        g: rand(220, 360),
        size: rand(1.6, 3.6),
        rot: rand(-3.14, 3.14),
        vr: rand(-6, 6),
        // 밝은 스파크 톤(랜덤)
        col: (Math.random()<0.5)
          ? `rgba(${(220+rand(0,35))|0}, ${(180+rand(0,55))|0}, ${(60+rand(0,80))|0}, 1)`
          : `rgba(${(120+rand(0,80))|0}, ${(200+rand(0,55))|0}, ${(255)|0}, 1)`
      });
    }
  }

  function updateLevelUpFx(dt){
    // bursts
    for(let i=levelUpBursts.length-1;i>=0;i--){
      const b = levelUpBursts[i];
      b.t += dt;
      b.x += b.vx * dt;
      b.y += b.vy * dt;
      b.vy += 60 * dt; // 살짝 중력
      if (b.t >= b.life) levelUpBursts.splice(i,1);
    }
    // sparks
    for(let i=levelUpSparks.length-1;i>=0;i--){
      const s = levelUpSparks[i];
      s.t += dt;
      s.x += s.vx * dt;
      s.y += s.vy * dt;
      s.vy += s.g * dt;
      s.rot += s.vr * dt;
      // 공기 저항(살짝)
      s.vx *= Math.pow(0.18, dt);
      s.vy *= Math.pow(0.65, dt);
      if (s.t >= s.life) levelUpSparks.splice(i,1);
    }
  }

  function drawLevelUpFx(camX, camY){
    // sparks 먼저
    ctx.save();
    for(const s of levelUpSparks){
      const p = s.t / s.life;
      const a = Math.max(0, 1 - p);
      const sx = s.x - camX;
      const sy = s.y - camY;

      ctx.globalAlpha = a;
      ctx.translate(sx, sy);
      ctx.rotate(s.rot);

      ctx.fillStyle = s.col;
      // 작은 다이아/막대 느낌
      const w = s.size * 2.0;
      const h = s.size * 0.9;
      ctx.fillRect(-w*0.5, -h*0.5, w, h);

      ctx.setTransform(1,0,0,1,0,0);
    }
    ctx.restore();

    // 큰 텍스트
    ctx.save();
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    for(const b of levelUpBursts){
      const p = b.t / b.life;                // 0..1
      const a = Math.max(0, 1 - p);

      // 팡! 커졌다가 살짝 줄어드는 이징
      const pop = (p < 0.22)
        ? (p/0.22)                 // 0->1
        : (1 - (p-0.22)/0.78)*0.18; // 1->0.82쯤
      const scale = 0.55 + 1.55 * pop;

      const sx = b.x - camX;
      const sy = b.y - camY;

      ctx.save();
      ctx.translate(sx, sy);

      // 흔들림
      const wob = Math.sin(b.t * 18) * (b.wobble * (1 - p));
      ctx.rotate(b.rot + wob * Math.PI/180);

      ctx.globalAlpha = a;

      const fontPx = Math.round(46 * scale);
      ctx.font = `900 ${fontPx}px system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", sans-serif`;

      // 아웃라인 + 글로우 느낌
      ctx.lineWidth = Math.max(3, fontPx * 0.10);
      ctx.strokeStyle = "rgba(0,0,0,0.70)";
      ctx.fillStyle = "rgba(255,235,120,0.98)";
      ctx.shadowColor = "rgba(255,230,120,0.55)";
      ctx.shadowBlur = 18;

      ctx.strokeText("레벨업", 0, 0);
      ctx.fillText("레벨업", 0, 0);

      ctx.restore();
    }
    ctx.restore();
  }


  // ====== CRIT TEXT POP (치명타) ======
  const critTexts = [];
  function spawnCritText(wx, wy, text="치명타"){
    critTexts.push({
      x: wx,
      y: wy,
      text: String(text||"치명타"),
      t: 0,
      life: 0.35,     // ✅ 더 짧게(빠르게 팍!)
      scale: 0.22,    // ✅ 더 작게 시작했다가 팍!
      vx: rand(-8, 8),
      vy: -14
    });
  }
  function updateCritTexts(dt){
    for (let i=critTexts.length-1;i>=0;i--){
      const c = critTexts[i];
      c.t += dt;
      c.x += c.vx * dt;
      c.y += c.vy * dt;
      c.vx *= (1 - 3.6*dt);
      // 빠르게 커졌다가 살짝 안정
      const p = c.t / c.life;
      const target = (p < 0.10) ? 1.60 : 0.85;
      c.scale += (target - c.scale) * (1 - Math.pow(0.00001, dt));
      if (c.t >= c.life) critTexts.splice(i,1);
    }
  }
  function drawCritTexts(camX, camY){
    ctx.save();
    ctx.textAlign = "center";
    ctx.textBaseline = "middle";
    for (const c of critTexts){
      const p = c.t / c.life;
      const a = 1 - p;
      const sx = c.x - camX;
      const sy = c.y - camY;

      // 초반 팍! 확대
      const pop = (p < 0.08) ? (1.0 + (0.08 - p) * 11.0) : 1.0;

      ctx.globalAlpha = Math.max(0, a);
      const size = Math.round(22 * c.scale * pop); // 여기 숫자 줄이면 전체 글자 크기 작아짐
      ctx.font = `900 ${size}px system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", sans-serif`;

      // outline
      ctx.lineWidth = 7;
      ctx.strokeStyle = "rgba(0,0,0,0.65)";
      ctx.strokeText(c.text, sx, sy);

      // fill (진한 빨간색)
      ctx.fillStyle = "rgba(255, 90, 210, 0.98)"; // ✅ 분홍색 톤
      ctx.fillText(c.text, sx, sy);
    }
    ctx.restore();
  }


  // ====== COMBAT HELPERS ======
  function nearestAliveRabbit(){
    // ✅ 토끼 + 고양이 중에서 가장 가까운 '살아있는 몹'을 찾는다
    let best = null;
    let bestD = Infinity;
    for (const m of [...rabbits, ...cats]){
      if (!m) continue;
      if (m.hp <= 0) continue;
      if (m.state === 'dead' || m.state === 'respawn') continue;
      const d = dist2(player.x, player.y, m.x, m.y);
      if (d < bestD){ bestD = d; best = m; }
    }
    return best;
  }

  const CONTACT = player.r + R.r + 1;
  const CONTACT2 = CONTACT * CONTACT;


  // ====== TWITCH CHAT: 전투 중 자동 투명 (깜빡임 방지 버전) ======
  const twitchChatWrapEl = document.getElementById('twitchChatWrap');

  // ✅ 히스테리시스(지연) 파라미터
  const CHAT_FADE_IN_DELAY   = 0.12; // 전투 시작 판정이 연속으로 유지되면 ON
  const CHAT_FADE_OUT_HOLD   = 0.60; // 전투가 끝나도 잠깐 유지 후 OFF
  const CHAT_TOGGLE_COOLDOWN = 0.12; // 토글 최소 간격

  let _chatCombatOn = false;
  let _combatSeenT = 0;         // 전투가 "연속으로" 감지된 시간
  let _noCombatT = 0;           // 전투가 "연속으로" 감지되지 않은 시간
  let _toggleCooldownT = 0;     // 토글 쿨다운

  function applyChatCombatFade(on){
    if (!twitchChatWrapEl) return;
    // ✅ 어떤 경우에도 combatFade는 사용하지 않음
    twitchChatWrapEl.classList.remove('combatFade');
  }

  // 매 프레임 호출: inCombat 신호를 부드럽게(지연/유지) 처리
  function updateChatCombatFade(inCombat, dt){ /* disabled */ }

  function tryPlayerAttack(){
    if (player.state !== 'alive') return;
    if (player.atkCooldown > 0) return;

    for (const rb of [...rabbits, ...cats]){
      if (rb.hp <= 0 || rb.state === 'dead' || rb.state === 'respawn') continue;
      const d = dist2(player.x, player.y, rb.x, rb.y);
      const rr = (rb.kind === 'cat') ? C.r : R.r;
      const contact2 = (player.r + rr + 1) * (player.r + rr + 1);
      if (d <= contact2){
        // ✅ 공격 대상(몹) 방향을 바라보고 공격 모션 시작
        player.dir = vecToDir(rb.x - player.x, rb.y - player.y);

        player.attacking = true;
        player.atkFrame = 0;
        player.animT = 0;
        player.atkCooldown = player.atkInterval;

        // ✅ MP 소모: 칼질 공격 시 -1
        if (typeof player.mp === "number"){
          // ✅ MP가 0이면 공격 불가
          const _mpBefore = (player.mp||0);
          if (_mpBefore <= 0){
            player.mpLocked = true;
            try{ showTopNotice('마나가 모자랍니다.', 850, '#ff3b3b'); }catch(_){ }
            return;
          }
          player.mp = Math.max(0, _mpBefore - 1);
        }

        // ✅ 공격 시도 순간: 항상 공격음, 10% 확률로 기합(kihap.wav) (명중/미스와 무관)
        try{ attackSfx.currentTime = 0; attackSfx.play().catch(()=>{}); }catch(e){}
        // ✅ 공격 시도 순간: 50% 확률로 기합(kihap.wav) (명중/미스와 무관)
        if (Math.random() < 0.50){
          try{ kihapSfx.currentTime = 0; kihapSfx.play().catch(()=>{}); }catch(e){}
        }


        if (!rollHit(player.hit||0, rb.eva||0)){
          // ✅ MISS 파티클(몬스터 몸에서 점점 커지며 사라짐)
          spawnWordText(rb.x, rb.y - 18, "MISS", "rgba(180, 235, 255, 0.98)");
          return;
        }
        const res = calcDamageWithCrit(player.atk||0, rb.def||0, player.critChance||0, player.critMult||1.5);
        const dealt = res.dmg;
        const isCrit = !!res.isCrit;
        rb.hp -= dealt;

        // ✅ 몹 피격 수치 파티클(팍 + 위로)
        spawnDmgText(
          rb.x, rb.y - 18,
          dealt,
          isCrit ? "rgba(255, 70, 70, 0.98)" : "rgba(255,235,120,0.98)",
          isCrit
        );

        // ✅ 크리 연출: 치명타 텍스트 + 피 더 많이 + 순간 넉백 + 크리 사운드
        if (isCrit){
          spawnCritText(rb.x, rb.y - 34, "치명타");

          // ✅ 히트스톱(0.05초)
          hitStopT = Math.max(hitStopT, 0.05);

          // ✅ 피 더 많이(치명타)
          spawnBlood(rb.x, rb.y, 3.2);

          // ✅ 넉백 제거: 사냥 흐름 방해 방지 (치명타는 텍스트/피/사운드만)

          try{
            critSfx.currentTime = 0;
            critSfx.play().catch(()=>{});
}catch(e){}
        } else {
          spawnBlood(rb.x, rb.y, 1.0);
        }

        // ✅ 몹 피격 효과음
        try{
          hitSfx.currentTime = 0;
          hitSfx.play().catch(()=>{});
}catch(e){}
        if (rb.hp <= 0){
          rb.hp = 0;
          if (rb.state !== 'dead'){
            rb.state = 'dead';
            // ✅ 토끼 몹 사망 시 3% 확률로 단검 아이콘 드랍(바닥)
            if (rb.kind !== 'cat' && Math.random() < 0.03){
              try{
              // ✅ 아이템 드랍 순간 사운드
              try{ itemDropSfx.currentTime = 0; itemDropSfx.play().catch(()=>{}); }catch(_e){}
              spawnGroundKnife(rb.x, rb.y);
            }catch(e){}
            }
            // ✅ 토끼 드랍: HP/MP 물약(소) 각각 4%
            if (rb.kind !== 'cat' && Math.random() < 0.04){
              try{
                try{ itemDropSfx.currentTime = 0; itemDropSfx.play().catch(()=>{}); }catch(_e){}
                spawnGroundHpPotionS(rb.x, rb.y);
              }catch(e){}
            }
            if (rb.kind !== 'cat' && Math.random() < 0.04){
              try{
                try{ itemDropSfx.currentTime = 0; itemDropSfx.play().catch(()=>{}); }catch(_e){}
                spawnGroundMpPotionS(rb.x, rb.y);
              }catch(e){}
            }

            // ✅ 몹 사망 사운드 (토끼 / 고양이 분리)
            if (rb.kind === 'cat'){
              try{ sndCatDie.currentTime = 0; sndCatDie.play().catch(()=>{}); }catch(e){}
        // ✅ 고양이 처치 보상: 골드 10개 즉시 인벤 지급
        try{
          addItemToInventory({ id:"gold", name:"골드", icon:"gold-1.png", qty:10 });
        }catch(e){}
            } else {
              try{ sndRabbitDie.currentTime = 0; sndRabbitDie.play().catch(()=>{}); }catch(e){}
        // ✅ 토끼 처치 보상: 골드 5개 즉시 인벤 지급
        try{
          addItemToInventory({ id:"gold", name:"골드", icon:"gold-1.png", qty:5 });
        }catch(e){}
            }
          }

          // ✅ EXP 획득 (몹마다 expGive 만큼)
          player.exp += (rb.expGive || R.expGive || 0);

          
          try{ const _g = (rb.expGive || R.expGive || 0); if(_g>0) pushInfoLogLine?.(`${_g} 경험치 습득`); }catch(_){ }
// ✅ 레벨업: EXP가 최대치를 넘으면 레벨 증가 (초과분 이월) (최대 Lv100)
          while (player.expMax > 0 && player.exp >= player.expMax){
            player.exp -= player.expMax;
            if (!levelUpOnce()){
              break;
            }
          }


          // ✅ 토끼 사망 효과음
          try{
            rabbitDeathSfx.currentTime = 0;
            rabbitDeathSfx.play().catch(()=>{});
}catch(e){}


        } else {
          rb.state = 'attack';
        }
        return;
      }
    }

    // ✅ 고양이도 몹으로 인식해서 공격 대상에 포함
    const CAT_CONTACT = player.r + C.r + 1;
    const CAT_CONTACT2 = CAT_CONTACT * CAT_CONTACT;

    for (const c of cats){
      if (c.hp <= 0) continue;
      if (c.state === 'dead' || c.state === 'respawn') continue;
      const d = dist2(player.x, player.y, c.x, c.y);
      if (d <= CAT_CONTACT2){
        player.dir = vecToDir(c.x - player.x, c.y - player.y);

        player.attacking = true;
        player.atkFrame = 0;
        player.animT = 0;
        player.atkCooldown = player.atkInterval;

        // ✅ MP 소모: 칼질 공격 시 -1
        if (typeof player.mp === "number"){
          // ✅ MP가 0이면 공격 불가
          const _mpBefore = (player.mp||0);
          if (_mpBefore <= 0){
            player.mpLocked = true;
            try{ showTopNotice('마나가 모자랍니다.', 850, '#ff3b3b'); }catch(_){ }
            return;
          }
          player.mp = Math.max(0, _mpBefore - 1);
        }

        if (!rollHit(player.hit||0, c.eva||0)){
          spawnWordText(c.x, c.y - 18, "MISS", "rgba(180, 235, 255, 0.98)");
          return;
        }

        const res = calcDamageWithCrit(player.atk||0, c.def||0, player.critChance||0, player.critMult||1.5);
        const dealt = res.dmg;
        const isCrit = !!res.isCrit;
        c.hp -= dealt;

        spawnDmgText(
          c.x, c.y - 18,
          dealt,
          isCrit ? "rgba(255, 70, 70, 0.98)" : "rgba(255,235,120,0.98)",
          isCrit
        );

        if (isCrit){
          spawnCritText(c.x, c.y - 34, "치명타");
          hitStopT = Math.max(hitStopT, 0.05);
          spawnBlood(c.x, c.y, 3.2);
          try{ critSfx.currentTime = 0; critSfx.play().catch(()=>{}); }catch(e){}
        } else {
          spawnBlood(c.x, c.y, 1.0);
        }

        try{ hitSfx.currentTime = 0; hitSfx.play().catch(()=>{}); }catch(e){}
        try{ attackSfx.currentTime = 0; attackSfx.play().catch(()=>{}); }catch(e){}

        // ✅ 공격 시도 순간: 50% 확률로 기합(kihap.wav) (명중/미스와 무관)
        if (Math.random() < 0.50){
          try{ kihapSfx.currentTime = 0; kihapSfx.play().catch(()=>{}); }catch(e){}
        }

        // ✅ 고양이 사망 처리(페이드아웃 + ⏱리스폰 타이머 시작)
        if (c.hp <= 0){
          c.hp = 0;

          // 이미 dead면 중복 세팅 방지
          if (c.state !== 'dead'){
            c.state = 'dead';
    sndCatDie.currentTime = 0;
    sndCatDie.play().catch(()=>{});
            // ✅ 고양이 처치 보상: 골드 10개 즉시 인벤 지급
            try{
              addItemToInventory({ id:"gold", name:"골드", icon:"gold-1.png", qty:10 });
            }catch(e){}
            // ✅ 고양이 EXP 보상(토끼와 다르게)
            const _g = (c.expGive ?? 10);
            player.exp += _g;
            try{ if(_g>0) pushInfoLogLine?.(`${_g} 경험치를 습득했습니다.`); }catch(_){}

            // ✅ 레벨업 처리(토끼와 동일하게 초과분 이월)
            while (player.expMax > 0 && player.exp >= player.expMax){
              player.exp -= player.expMax;
              if (!levelUpOnce()){
                break;
              }
            }

            c.alpha = 1;                 // 죽는 순간 1에서 시작 → updateCats에서 페이드아웃
            c.respawnT = CAT_RESPAWN_SEC; // ⏱ 리스폰 시간(초)
            c.vx = 0; c.vy = 0;           // 죽은 동안 이동 정지(없어도 되지만 안전)
            c.atkCooldown = 9999;         // 죽은 동안 공격 금지(안전)
          }
        } else {
          c.state = 'attack';
        }

return;
      }
    }
  }

  
  // ====== PET HP / DAMAGE ======
  function syncPetStats(){
    // 플레이어 최대 HP 변화에 따라 펫 HP도 1/3로 동기화(비율 유지)
    const desiredMax = Math.max(1, Math.floor((player.hpMax||1)/3));
    if ((pet.hpMax|0) !== desiredMax){
      const oldMax = Math.max(1, pet.hpMax|0);
      const pct = Math.max(0, Math.min(1, (pet.hp||0) / oldMax));
      pet.hpMax = desiredMax;
      pet.hp = Math.max(0, Math.min(desiredMax, Math.round(desiredMax * pct)));
    }
  }

  function petDie(){
    if (!pet || pet.state !== 'alive') return;
    // ✅ 영구 사망 플래그(이후 절대 부활하지 않음)
    pet.deadForever = true;
    pet.hp = 0;
    pet.state = 'deadHold';
    pet.deadHoldT = 0.65;      // 잠깐 멈췄다가
    pet.alpha = 1;
    pet.attacking = false;
    pet.atkFrame = 0;
    pet.walkFrame = 0;
    try{ spawnBlood(pet.x, pet.y - 6, 1.15); }catch(_){}
 
    try{ saveToLocal(); }catch(e){}
  }

  function petTakeDamage(dmg){
  if (!pet || pet.state !== 'alive') return;

  pet.hp = Math.max(0, (pet.hp||0) - dmg);

  try{
    spawnDmgText(pet.x, pet.y - 22, dmg, "rgb(255,70,70)", false);
  }catch(_){}

 if (pet.hp <= 0){
  pet.hp = 0;
  petDie();
  try{ petDieSfx.currentTime = 0; petDieSfx.play().catch(()=>{}); }catch(e){}
}

}


function rabbitAttack(rb, targetIsPet){
    const tgt = (targetIsPet && pet && !pet.deadForever && pet.state === 'alive') ? pet : player;
    if (tgt === player){
      if (player.state !== 'alive') return;
    } else {
      if (pet.state !== 'alive') return;
    }
    if (rb.atkCooldown > 0) return;
    rb.atkCooldown = R.atkInterval;

    // 명중/회피
    const tgtEva = (tgt.eva||0);
    if (!rollHit(rb.hit||0, tgtEva)){
      try{
        spawnWordText(tgt.x, tgt.y - 24, "회피", "rgba(170, 255, 120, 0.98)");
      }catch(_){}
      return;
    }

    const taken = calcDamage((rb.atk || rb.dmg || R.dmg || 0), (tgt.def||0), rb.critChance||0, rb.critMult||1.5);

    if (tgt === player){
      player.hp = Math.max(0, player.hp - taken);
      try{ spawnDmgText(player.x, player.y - 22, taken, "rgb(255,70,70)", false); }catch(_){}
      try{ spawnBlood(player.x, player.y - 6); }catch(_){}
      if (player.hp <= 0){
        player.hp = 0;
        player.state = 'dead';
        try{ deathSfx.currentTime = 0; deathSfx.play().catch(()=>{}); }catch(e){}
      }
    } else {
      petTakeDamage(taken);
    }
  }

  // ====== UPDATE ======
  function updatePlayer(dt){
    if (player.state === 'dead'){
      player.alpha = Math.max(0, player.alpha - R.fadeSpeed * dt);
      if (player.alpha <= 0){
        player.state = 'respawn';
        player.respawnT = player.respawnDelay;
      }
      return;
    }
    if (player.state === 'respawn'){
      player.respawnT -= dt;

      if (player.respawnT <= 0){
        player.state = 'alive';
        applyPlayerStatsForLevel();
        recalcCombatStats();
        player.alpha = 1;
        player.hp = player.hpMax;
        player.mp = player.mpMax;
        player.x = MAP_W/2;
        player.y = MAP_H/2;

        player.dir = DIR.DOWN;   // 항상 아래 방향으로 스폰

        player.attacking = false;
        player.atkCooldown = 0;

        player.auto = false;                 // 즉시 자동사냥 OFF
        player.autoDelay = player.autoDelayTime; // 1초 카운트 시작
      }
      return;
    }

    player.atkCooldown = Math.max(0, player.atkCooldown - dt);

    // ✅ 자연회복 (HP/MP) — 지능(int) 스탯이 직접 영향
    // hpRegenPS / mpRegenPS 값은 applyPlayerStatsForLevel()에서 매번 갱신됨
    if (player.state === 'alive'){
      const hpR = (player.hpRegenPS || 0);
      const mpR = (player.mpRegenPS || 0);
      if (hpR > 0 && player.hp < player.hpMax) player.hp = Math.min(player.hpMax, player.hp + hpR * dt);
      if (mpR > 0 && player.mp < player.mpMax) player.mp = Math.min(player.mpMax, player.mp + mpR * dt);
    }

    // ✅ MP 0이면 이동/행동 정지 + 상단 알림
    try{
      const _mpNow = (player && typeof player.mp === 'number') ? (player.mp|0) : 0;
      if (_mpNow <= 0){
        if (!player.mpLocked){
          player.mpLocked = true;
          try{ showTopNotice('마나가 모자랍니다.', 850, '#ff3b3b'); }catch(_){ }
        }
      } else {
        if (player.mpLocked) player.mpLocked = false;
      }
    }catch(_){ }


    
let mvx = 0, mvy = 0;
let moving = false;

// 1) 키보드 이동 (기존)
if (manualMove){
  if (keys['ArrowUp'] || keys['w'] || keys['W'])    { mvy -= 1; moving = true; }
  if (keys['ArrowDown'] || keys['s'] || keys['S']) { mvy += 1; moving = true; }
  if (keys['ArrowLeft'] || keys['a'] || keys['A']) { mvx -= 1; moving = true; }
  if (keys['ArrowRight'] || keys['d'] || keys['D']){ mvx += 1; moving = true; }
  const len = Math.hypot(mvx,mvy) || 1;
  mvx /= len; mvy /= len;
  if (moving && !player.attacking) player.dir = vecToDir(mvx,mvy);

// 2) 가상 조이스틱 이동 (모바일/PC 공용)
} else if (joy.active && joy.mag > joy.deadZone){
  mvx = joy.vx * joy.mag;
  mvy = joy.vy * joy.mag;
  moving = true;
  if (!player.attacking) player.dir = vecToDir(mvx,mvy);

// 3) 자동사냥 이동
} else if (player.auto){
      const target = nearestAliveRabbit();
      if (target){
        const dx = target.x - player.x, dy = target.y - player.y;
        const d = Math.hypot(dx,dy) || 1;
        const nx = dx/d, ny = dy/d;

        // ✅ 타겟이 토끼/고양이인지에 따라 접촉 판정 거리 조정
        const tr = (target.kind === 'cat') ? C.r : R.r;
        const contact2 = (player.r + tr + 1) * (player.r + tr + 1);

        if (d*d <= contact2 * 1.05){
          mvx = 0; mvy = 0;
          moving = false;
          tryPlayerAttack();
        } else {
          mvx = nx; mvy = ny;
          moving = true;
          if (!player.attacking) player.dir = vecToDir(mvx,mvy);
        }
      }
    }

    // ✅ MP가 0이면 그 자리에서 멈춤(이동 입력 무시)
    if (player && player.mpLocked){
      // ✅ MP 0이면 완전 멍(Idle) 상태: 이동/공격/공격모션 전부 차단
      mvx = 0; mvy = 0; moving = false;
      player.attacking = false;
      player.atkFrame = 0;
      // (선택) 공격 쿨타임은 그대로 두되, 모션만 즉시 끊음
    }

    const spd = player.attacking ? player.speed * 0.35 : player.speed;
    player.x += mvx * spd;
    player.y += mvy * spd;

    player.x = clamp(player.x, player.r, MAP_W - player.r);
    player.y = clamp(player.y, player.r, MAP_H - player.r);


    // ====== PORTAL TOUCH → MAP TRANSITION ======
    // 포탈 연속 진입 방지 쿨타임
    if (player.portalLock == null) player.portalLock = 0;
    if (player.portalLock > 0) player.portalLock = Math.max(0, player.portalLock - dt);

    // 포탈 닿으면 맵 이동
    if (player.portalLock <= 0 && PORTAL.fw > 0){
      const pw = PORTAL.fw * PORTAL.scale;
      const ph = PORTAL.fh * PORTAL.scale;

      // 플레이어(원) vs 포탈(사각) 간단 겹침 판정
      const dx = Math.abs(player.x - ACTIVE_PORTAL.x);
      const dy = Math.abs(player.y - ACTIVE_PORTAL.y);

      const hitX = dx <= (pw*0.38 + player.r);
      const hitY = dy <= (ph*0.38 + player.r);

      if (hitX && hitY){
        // ✅ 자동사냥 중에는 포탈 이동 금지 + 경고 문구
        const autoOn = (!!player.auto) || (!!window.autoHunt);
        if (autoOn){
          showPortalBlockMsg();
        } else {
          // ✅ 현재 맵에 따라 목표 맵/스폰 사이드가 결정됨
          setMap(ACTIVE_PORTAL.targetMap, ACTIVE_PORTAL.spawnSide);
        }
      }
    }

    player.animT += dt;

    if (player.attacking){
      if (player.animT >= 1/14){
        player.animT = 0;
        player.atkFrame++;
        if (player.atkFrame >= ATK_LEN){
          player.attacking = false;
          player.atkFrame = 0;
        }
      }
    } else if (moving){
      if (player.animT >= 1/10){
        player.animT = 0;
        player.walkFrame = (player.walkFrame + 1) % WALK_LEN;
      }

      // ✅ 발소리 재생 (이동 중 일정 간격)
      const now = performance.now() / 1000;
      if (now - lastStepTime > STEP_INTERVAL){
        try{
          footstep.currentTime = 0;
          footstep.play().catch(()=>{});
}catch(e){}
        lastStepTime = now;
      }

    } else {
      player.walkFrame = 0;
    }
  }

  function animateRabbitWalk(rb, dt){
    rb.tAnim += dt;
    if (rb.tAnim >= 1/R.animFPS){
      rb.tAnim = 0;
      rb.frame = (rb.frame + 1) % 4;
    }
  }

  function updateRabbits(dt){
  updateCats(dt);
    const d2 = R.detectRadius*R.detectRadius;
    const g2 = R.giveUpRadius*R.giveUpRadius;

    for (const rb of rabbits){
      if (rb.state === 'respawn'){
        rb.respawnT -= dt;
        if (rb.respawnT <= 0) rabbitRespawn(rb);
        continue;
      }

      if (rb.state === 'dead'){
        rb.alpha = Math.max(0, rb.alpha - R.fadeSpeed * dt);
        if (rb.alpha <= 0){
          rb.state = 'respawn';
          rb.respawnT = R.respawnDelay;
        }
        continue;
      }

      rb.atkCooldown = Math.max(0, rb.atkCooldown - dt);

      rb.petAggroT = Math.max(0, (rb.petAggroT||0) - dt);
      const petAlive = (pet && pet.state === 'alive');
      const ddPlayer0 = dist2(rb.x, rb.y, player.x, player.y);
      const ddPet0 = petAlive ? dist2(rb.x, rb.y, pet.x, pet.y) : 1e18;
      const nearPet0 = petAlive && (ddPet0 <= d2);
      const usePet = petAlive && (rb.petAggroT > 0 || (nearPet0 && ddPet0 <= ddPlayer0));
      const tx = usePet ? pet.x : player.x;
      const ty = usePet ? pet.y : player.y;
      const tr = usePet ? (pet.r||14) : player.r;

      const dd = dist2(rb.x, rb.y, tx, ty);
      const touching = dd <= ((R.r + tr) * (R.r + tr));

      if (touching){
        // 이동은 멈추지만 스프라이트 걷기 모션은 계속
        rb.state = 'attack';
        rb.vx = 0; rb.vy = 0;

        // 방향은 플레이어를 바라보게
        rb.dir = vecToDir(tx - rb.x, ty - rb.y);

        // 모션 계속
        animateRabbitWalk(rb, dt);

        rabbitAttack(rb, usePet);
      } else {
        if (rb.state === 'wander' && (usePet || dd <= d2)) rb.state = 'chase';
        if (!usePet && rb.state === 'chase' && dd >= g2) { rb.state = 'wander'; pickWander(rb); }

        let mvx=0, mvy=0, spd=0;

        if (rb.state === 'chase'){
          const dx = tx - rb.x, dy = ty - rb.y;
          const len = Math.hypot(dx,dy) || 1;
          mvx = dx/len; mvy = dy/len; spd = R.speedChase;
        } else {
          rb.tWander -= dt;
          if (rb.tWander <= 0) pickWander(rb);
          mvx = rb.vx; mvy = rb.vy; spd = R.speedWander;
        }

        rb.x += mvx*spd;
        rb.y += mvy*spd;

        rb.x = clamp(rb.x, R.r, MAP_W-R.r);
        rb.y = clamp(rb.y, R.r, MAP_H-R.r);

        const moving = (Math.abs(mvx)+Math.abs(mvy))>0.01;
        if (moving) rb.dir = vecToDir(mvx,mvy);

        if (moving) animateRabbitWalk(rb, dt);
        else rb.frame = 0;
      }
    }

    // 토끼끼리 분리
    for (let i=0;i<rabbits.length;i++){
      const a = rabbits[i];
      if (a.state === 'dead' || a.state === 'respawn') continue;
      for (let j=i+1;j<rabbits.length;j++){
        const b = rabbits[j];
        if (b.state === 'dead' || b.state === 'respawn') continue;
        resolveCircle(a,b,R.r*2);
        a.x = clamp(a.x, R.r, MAP_W-R.r); a.y = clamp(a.y, R.r, MAP_H-R.r);
        b.x = clamp(b.x, R.r, MAP_W-R.r); b.y = clamp(b.y, R.r, MAP_H-R.r);
      }
    }

    // 플레이어-토끼 분리
    for (const rb of rabbits){
      if (rb.state === 'dead' || rb.state === 'respawn') continue;
      resolveCircleStatic(player, rb, player.r + R.r);
      player.x = clamp(player.x, player.r, MAP_W-player.r);
      player.y = clamp(player.y, player.r, MAP_H-player.r);
      rb.x = clamp(rb.x, R.r, MAP_W-R.r);
      rb.y = clamp(rb.y, R.r, MAP_H-R.r);
    }
  }

  // ====== DRAW ======

  function drawPortal(portal, camX, camY){
    if (!(portalImg.complete && portalImg.naturalWidth>0 && PORTAL.fw>0)) return;

    // 월드 -> 스크린
    const w = PORTAL.fw * PORTAL.scale;
    const h = PORTAL.fh * PORTAL.scale;
    const sx = (portal.x - camX) - w/2;
    const sy = (portal.y - camY) - h/2;

    ctx.save();
    ctx.imageSmoothingEnabled = false; // 픽셀 느낌 유지
    ctx.drawImage(
      portalImg,
      PORTAL.frame * PORTAL.fw, 0, PORTAL.fw, PORTAL.fh,
      Math.round(sx), Math.round(sy), Math.round(w), Math.round(h)
    );
    ctx.restore();
  }

  function drawGrass(camX, camY, vw, vh){
    const startTX = Math.floor(camX / TILE);
    const startTY = Math.floor(camY / TILE);
    const endTX = Math.ceil((camX + vw) / TILE);
    const endTY = Math.ceil((camY + vh) / TILE);

    for (let ty = startTY; ty < endTY; ty++){
      for (let tx = startTX; tx < endTX; tx++){
        const wx = tx*TILE, wy = ty*TILE;
        ctx.drawImage(grassImg, 0, 0, grassImg.width, grassImg.height,
                      wx - camX, wy - camY, TILE, TILE);
      }
    }
  }

  function drawRabbit(rb, camX, camY){
    if (!(rabbitImg.complete && rabbitImg.naturalWidth>0)) return;

    const col = rb.frame;
    const row = rb.dir;
    const sx = rb.x - camX - R.fw/2;
    const sy = rb.y - camY - R.fh/2;

    ctx.save();
    ctx.globalAlpha = rb.alpha;

    ctx.drawImage(rabbitImg, col*R.fw, row*R.fh, R.fw, R.fh,
                  Math.round(sx), Math.round(sy), R.fw, R.fh);

    
    // ✅ 토끼 닉네임 표시 (머리 위)
    ctx.font = "bold 11px system-ui, -apple-system, 'Segoe UI', sans-serif";
    ctx.textAlign = "center";
    ctx.textBaseline = "bottom";

    // 그림자
    ctx.fillStyle = "rgba(0,0,0,0.6)";
    ctx.fillText(
      "토끼",
      Math.round(rb.x - camX),
    Math.round(rb.y - camY - R.fh/2 + 28)
    );

    // 본문 텍스트
    ctx.fillStyle = "#ffffff";
    ctx.fillText(
      "토끼",
      Math.round(rb.x - camX),
     Math.round(rb.y - camY - R.fh/2 + 28)
    );
// HP바 딱 붙게
    if (rb.state !== 'respawn' && rb.alpha > 0){
    ctx.fillStyle = "#ffffff";
      

      const bw = 22, bh = 4;
      const bx = (rb.x - camX) - bw/2;
      const by = (rb.y - camY) - R.fh/2 - bh + 13;
      drawHpBar(bx, by, bw, bh, rb.hp/rb.hpMax, "rgba(255,120,120,1)");
    }

    ctx.restore();
  }

  function drawPlayer(camX, camY){
    if (!(heroImg.complete && heroImg.naturalWidth>0)) return;

    const col = player.attacking ? (ATK_START + player.atkFrame) : (WALK_START + player.walkFrame);
    const sx = player.x - camX - HERO_FW/2;
    const sy = player.y - camY - HERO_FH/2;

    ctx.save();
    ctx.globalAlpha = player.alpha;

    ctx.drawImage(heroImg, col*HERO_FW, player.dir*HERO_FH, HERO_FW, HERO_FH,
                  Math.round(sx), Math.round(sy), HERO_FW, HERO_FH);

    if (player.state !== 'respawn' && player.alpha > 0){
      const bw = 28, bh = 5;
      const bx = (player.x - camX) - bw/2;
      const by = (player.y - camY) - HERO_FH/2 - bh - 1;

      // ▶ Level text above HP bar
      ctx.font = "bold 11px system-ui, -apple-system, 'Segoe UI', sans-serif";
      ctx.textAlign = "center";
      ctx.textBaseline = "bottom";
      ctx.fillStyle = "rgba(0,0,0,0.6)";
      ctx.fillText(`Lv: ${player.level}`, Math.round(player.x - camX), Math.round(by - 4));
      ctx.fillStyle = "#ffffff";
      ctx.fillText(`Lv: ${player.level}`, Math.round(player.x - camX), Math.round(by - 5));

      drawHpBar(bx, by, bw, bh, player.hp/player.hpMax, "rgba(150,255,150,1)");
    }

    ctx.restore();
  }

  function drawTrees(camX, camY){
    if (!(treeImg.complete && treeImg.naturalWidth > 0)) return;
    for (const t of trees){
      ctx.drawImage(
        treeImg,
        t.x - camX - TREE_SIZE/2,
        t.y - camY - TREE_SIZE,
        TREE_SIZE,
        TREE_SIZE
      );
    }
  }

  
  // ====== UI LIVE REFRESH ======
  // 장비/스탯 패널이 열려있는 동안, 무기 장착표시/하단 스탯 수치가 닫았다-열지 않아도 실시간 갱신되도록
  let _uiRefreshAcc = 0;
  let _sellInvSig = "";
  let _sellBulkHintActive = false; // (안전) 일괄선택 안내가 떠있는지

  function updateUiPanelsLive(rawDt){
    _uiRefreshAcc += rawDt;
    if (_uiRefreshAcc < 0.15) return; // 150ms마다(가벼운 폴링)
    _uiRefreshAcc = 0;

    try{
      if (typeof equipPanel !== "undefined" && equipPanel && !equipPanel.classList.contains("hide")){
        // ✅ 장비/스탯 패널 하단 수치 + 무기 슬롯 아이콘/배지까지 갱신
        renderEquipPanel();
      }
    }catch(_){}

    
    try{
      // ✅ 스탯 분배 패널이 열려 있을 때: DOM을 통째로 다시 그리면(=renderStatRows) 터치/클릭이 끊길 수 있어서
      // 여기서는 '남은 포인트 텍스트 + 버튼 활성화'만 가볍게 동기화한다.
      if (typeof statPanel !== "undefined" && statPanel && !statPanel.classList.contains("hide")){
        try{ if (typeof statPointsEl !== "undefined" && statPointsEl) statPointsEl.textContent = tempStatPoints; }catch(_){}
        try{ syncStatBtn(); }catch(_){}
      }
    }catch(_){}

    // ✅ 판매 패널이 열려 있을 때: 인벤 변화(획득/판매/장착/해제/드랍 등)를 실시간 반영
    try{
      if (typeof sellPanel !== "undefined" && sellPanel && !sellPanel.classList.contains("hide")){
        // 인벤 상태 시그니처(종류/수량/착용여부/강화 등)가 바뀌면 목록만 다시 렌더
        const invArr = (typeof inventory !== "undefined" && Array.isArray(inventory)) ? inventory : [];
        const sig = invArr.map(it=>{
          if(!it) return "";
          const nm = it.name ?? it.n ?? it.title ?? "";
          const typ = it.type ?? it.kind ?? it.slot ?? it.cat ?? "";
          const qty = it.qty ?? it.count ?? it.stack ?? 1;
          const eq  = (it.equipped || it.eq || it.isEquipped) ? 1 : 0;
          const enh = it.enh ?? it.enhance ?? it.plus ?? it.up ?? 0;
          const uid = it.uid ?? it.id ?? it.key ?? "";
          return `${uid}|${nm}|${typ}|${qty}|${eq}|${enh}`;
        }).join(";;");
        if (sig !== _sellInvSig){
          _sellInvSig = sig;
          try{ if (typeof renderSellList === "function") renderSellList(); else if (typeof renderSellPanel === "function") renderSellPanel(); }catch(_){}
        }
      }
    }catch(_){}

}

// ====== LOOP ======
  let last = performance.now();


  let hitStopT = 0; // ✅ 히트스톱 타이머(초)
  function startGame(){
    if (started) return;
    started = true;

    R.fw = Math.floor(rabbitImg.naturalWidth / R.cols);
    R.fh = Math.floor(rabbitImg.naturalHeight / R.rows);
    // ✅ 최초 시작 시에도 '현재 맵' 몹 구성을 정확히 반영
    try{ applyMapMobs(); }catch(_){ spawnRabbits(); }
    spawnTrees();

    last = performance.now();
    requestAnimationFrame(loop);
  }

  function loop(t){
    const rawDt = Math.min(0.05, (t-last)/1000);
    last = t;

    
    // ====== PORTAL ANIM UPDATE ======
    // 히트스톱/전투 여부와 상관없이 자연스럽게 깜빡이게 rawDt로 업데이트
    if (PORTAL.fw > 0){
      PORTAL.acc += rawDt;
      const step = 1 / (PORTAL.fps || 2);
      while (PORTAL.acc >= step){
        PORTAL.acc -= step;
        PORTAL.frame = (PORTAL.frame + 1) % PORTAL.frameCount;
      }
    }
// ✅ 히트스톱: 잠깐(0.05초) 시간 정지(업데이트 0으로)
    if (hitStopT > 0){
      hitStopT = Math.max(0, hitStopT - rawDt);
    }
    const dt = (hitStopT > 0) ? 0 : rawDt;

    // ✅ 경고 문구는 히트스톱과 무관하게 자연스럽게 감소
    if (portalBlockMsgT > 0) portalBlockMsgT = Math.max(0, portalBlockMsgT - rawDt);

    updatePlayer(dt);
    updatePet(dt);

    // 자동사냥 지연 처리
    if (player.autoDelay > 0){
      player.autoDelay -= dt;
      if (player.autoDelay <= 0){
        player.auto = true; // 1초 후 자동사냥 ON
      }
    }


    updateRabbits(dt);
    updatePetArrows(dt);
    updateParticles(dt);
    updateDmgTexts(dt);
    updateWordTexts(dt);
    updateCritTexts(dt);
    updateLevelUpFx(dt);
    updateGroundDrops(dt);

    updatePickupFx(dt);

    // 전투 판정: 플레이어가 살아있고, 접촉 거리 내 살아있는 토끼가 있거나 플레이어가 공격 모션이면 전투로 간주
    let inCombat = false;
    if (player.state === 'alive'){
      if (player.attacking) {
        inCombat = true;
      } else {
        for (const rb of rabbits){
          if (rb.state === 'dead' || rb.state === 'respawn' || rb.hp <= 0) continue;
          const dx = rb.x - player.x, dy = rb.y - player.y;
          if (dx*dx + dy*dy <= CONTACT2 * 1.05){ inCombat = true; break; }
        }
      }
    }
    applyChatCombatFade(false);

    // ✅ 패널 UI 실시간 리프레쉬
    updateUiPanelsLive(rawDt);

    updateHud();

    draw();
    requestAnimationFrame(loop);
  }

  function spawnTrees(){
    trees.length = 0;

    const MIN_TREE_DIST = TREE_SIZE * 0.75;
    const MAX_TRIES_PER_TREE = 80;

    function pickPosOutside(){
      let x, y;
      const side = Math.floor(Math.random()*4); // 0~3

      if (side === 0) { // 위
        x = rand(-OUT_MARGIN, MAP_W + OUT_MARGIN);
        y = rand(-OUT_MARGIN, -20);
      } else if (side === 1) { // 아래
        x = rand(-OUT_MARGIN, MAP_W + OUT_MARGIN);
        y = rand(MAP_H + 20, MAP_H + OUT_MARGIN);
      } else if (side === 2) { // 왼쪽
        x = rand(-OUT_MARGIN, -20);
        y = rand(-OUT_MARGIN, MAP_H + OUT_MARGIN);
      } else { // 오른쪽
        x = rand(MAP_W + 20, MAP_W + OUT_MARGIN);
        y = rand(-OUT_MARGIN, MAP_H + OUT_MARGIN);
      }
      return {x, y};
    }

    function isFarEnough(x, y){
      for (const t of trees){
        const dx = x - t.x, dy = y - t.y;
        if (dx*dx + dy*dy < MIN_TREE_DIST*MIN_TREE_DIST) return false;
      }
      return true;
    }

    for (let i=0;i<TREES_N;i++){
      let placed = false;

      for (let tries=0; tries<MAX_TRIES_PER_TREE; tries++){
        const p = pickPosOutside();
        if (isFarEnough(p.x, p.y)){
          trees.push(p);
          placed = true;
          break;
        }
      }
      if (!placed) trees.push(pickPosOutside());
    }
  }

  function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);
    const {camX, camY, vw, vh} = camera();

    drawGrass(camX, camY, vw, vh);
    drawGroundDrops(camX, camY);

    // ✅ 맵 구분용 살짝 톤(속삭임 숲속=조금 어둡게 / 고요한 들판=조금 밝게)
    ctx.save();
    if (grassTint === "forest"){
      ctx.globalAlpha = 0.10;
      ctx.fillStyle = "rgba(0,0,0,1)";
      ctx.fillRect(0,0,canvas.width,canvas.height);
    }else{
      ctx.globalAlpha = 0.08;
      ctx.fillStyle = "rgba(255,255,255,1)";
      ctx.fillRect(0,0,canvas.width,canvas.height);
    }
    ctx.restore();
    drawPortal(ACTIVE_PORTAL, camX, camY);

    ctx.save();
    ctx.globalAlpha = 0.5;
    ctx.lineWidth = 2;
    ctx.strokeStyle = "#7CFC00";
    const radius = 24; // 모서리 둥글기
    ctx.beginPath();
    ctx.roundRect(-camX, -camY, MAP_W, MAP_H, radius);
    ctx.stroke();
    ctx.restore();

    const drawList = [];
    for (const rb of rabbits) drawList.push({y: rb.y, type:'rb', ref: rb});
        for (const c of cats) drawList.push({y: c.y, type:'cat', ref: c});
drawList.push({y: player.y, type:'pl', ref: player});
    drawList.push({y: pet.y, type:'pet', ref: pet});
    drawList.sort((a,b)=>a.y-b.y);

    for (const it of drawList){
      if (it.type === 'rb') drawRabbit(it.ref, camX, camY);
      else if (it.type === 'cat') drawCat(it.ref, camX, camY);
      else if (it.type === 'pet') drawPet(camX, camY);
      else drawPlayer(camX, camY);
    }

    drawPetArrows(camX, camY);
    drawParticles(camX, camY);
    drawPickupFx(camX, camY);
    drawDmgTexts(camX, camY);
    drawCritTexts(camX, camY);
    drawWordTexts(camX, camY);
    drawTrees(camX, camY);
    drawLevelUpFx(camX, camY);

    // ✅ 자동사냥 중 포탈 밟을 때 경고 문구(일반 문구 - 효과 없음, 화면 상단 '맵 안쪽' 고정)
    if (portalBlockMsgT > 0){
      // ✅ 화면(=현재 카메라 뷰) 상단에서 '조금 아래'에 고정 표시 (플레이어 따라다니지 않음)
      // 이 게임은 월드 렌더링을 (x-camX) 방식으로 그리기 때문에,
      // UI 텍스트는 '화면 좌표'로 찍어야 실제로 보입니다.
      const viewW = canvas.width / DPR;
      const viewH = canvas.height / DPR;
      const msgX = viewW/2;
      const msgY = Math.max(70, Math.min(130, viewH*0.14));
ctx.save();
      ctx.font = "700 18px system-ui, -apple-system, Segoe UI, Roboto, sans-serif";
      ctx.textAlign = "center";
      ctx.textBaseline = "top";
      ctx.fillStyle = "rgb(255, 60, 60)";
      ctx.shadowColor = "rgba(0,0,0,0.55)";
      ctx.shadowBlur = 6;
      ctx.fillText("자동사냥시 포탈 이동 금지", msgX, msgY);
      ctx.restore();
    }

  }

  // ====== START BUTTON: overlay hide + fullscreen + game start ======
  async function goFullscreen(){
    try{
      // 모바일/데스크탑 모두 대응
      if (!document.fullscreenElement){
        await document.documentElement.requestFullscreen({ navigationUI: "hide" }).catch(()=>{});
      }
    }catch(e){}
  }

  startBtn.disabled = true;
  startHint.textContent = "리소스 로딩 중... (hero/grass/rabbit/tree)";

  startBtn.addEventListener('click', async () => {
    // ✅ 대표님 요청: 시작 시 "마지막 맵"은 startGame 전에 미리 결정하고,
// 레벨/스탯/아이템 등 "플레이어 진행도"는 startGame(플레이어 생성) 이후에 불러옵니다.
// (이렇게 해야 startGame 내부의 기본값(레벨1 등)이 로드값을 다시 덮어쓰지 않습니다)
let __savedMapId = null;
try{
  const __raw = localStorage.getItem(SAVE_KEY);
  if (__raw){
    const __data = JSON.parse(__raw);
    // 서명(sig) 검증(있으면) — 조작/호환 문제 방지
    if (__data && typeof __data === "object" && typeof __data.sig === "string"){
      if (typeof verifySaveSignature === "function" && !verifySaveSignature(__data)){
        console.warn("Save signature mismatch. Possible tampering.");
      } else {
        __savedMapId = (__data.mapId === "forest" || __data.mapId === "field") ? __data.mapId : null;
      }
    } else {
      // 구세이브(서명 없음) — 맵만은 일단 적용
      __savedMapId = (__data && (__data.mapId === "forest" || __data.mapId === "field")) ? __data.mapId : null;
    }
  }
}catch(e){}

if (__savedMapId){
  try{
    // startGame이 참조하는 맵 변수/전역을 미리 맞춰둠
    if (typeof currentMapId !== "undefined") currentMapId = __savedMapId;
    window.currentMapId = __savedMapId;
    if (typeof window.currentMap !== "undefined") window.currentMap = __savedMapId;
  }catch(e){}
}

    
    // ✅ SFX 언락(모바일에서 레벨업/기합 등이 무음으로 막히는 경우 방지)
    // - 사용자 클릭 이벤트(지금 이 순간) 안에서 아주 짧게 play→pause 해서 오디오를 "활성화"합니다.
    function __unlockAudio(a){
      try{
        if(!a) return;
        const wasMuted = a.muted;
        a.muted = true;
        const p = a.play();
        if(p && typeof p.then === "function"){
          p.then(()=>{ try{ a.pause(); a.currentTime = 0; }catch(_){ } a.muted = wasMuted; })
           .catch(()=>{ a.muted = wasMuted; });
        }else{
          try{ a.pause(); a.currentTime = 0; }catch(_){}
          a.muted = wasMuted;
        }
      }catch(_){}
    }
    try{
      __unlockAudio(attackSfx);
      __unlockAudio(kihapSfx);
      __unlockAudio(acaSfx);
      __unlockAudio(hitSfx);
      __unlockAudio(critSfx);
      __unlockAudio(rabbitDeathSfx);
      __unlockAudio(deathSfx);
      __unlockAudio(footstep);
      __unlockAudio(levelUpSound);
    }catch(_){}
// ✅ BGM 시작 (모바일/PC 사용자 클릭 이벤트 내)
    try{
      bgm.currentTime = 0;
      bgm.play().catch(()=>{});
}catch(e){}

    // 1) 전체화면 시도
    await goFullscreen();

    // 2) 바로 리사이즈 (주소창/안전영역 변화 대응)
    setTimeout(resize, 50);
    setTimeout(resize, 250);

    // 3) 타이틀 화면 제거
    overlay.style.display = "none";
    applyChatCombatFade(false);

    // 4) 로딩이 끝났으면 시작, 아니면 로딩 완료 즉시 시작
    if (assetsReady){
      window.__SAVE_SUSPENDED = true;
      startGame();
      // ✅ startGame이 기본값을 세팅한 뒤, 로컬 세이브를 적용 (레벨/스탯/아이템/마지막 맵)
      try{
        if (typeof loadFromLocal === "function") loadFromLocal();
        try{ if (typeof window.ensureStartWeaponEnhanceScroll === 'function') window.ensureStartWeaponEnhanceScroll(); }catch(e){}
try{ if (typeof window.ensureStartArcherScroll4 === 'function') window.ensureStartArcherScroll4(); }catch(e){}
if (typeof applyPlayerStatsForLevel === "function") applyPlayerStatsForLevel();
        if (typeof recalcCombatStats === "function") recalcCombatStats();
      }catch(e){
                console.warn("Auto-load after startGame failed:", e);
      }
      // ✅ 로드가 끝나면 세이브를 다시 활성화(초기화 덮어쓰기 방지)
      window.__SAVE_SUSPENDED = false;
      try{ if (typeof saveToLocal === "function") saveToLocal(); }catch(_){ }
          try{ if(!window.__mapNameShown){ window.__mapNameShown=true; setTimeout(()=>{ try{ window.showMapName && window.showMapName(mapTitleFor(window.currentMapId || currentMapId)); }catch(e){} }, 180); } }catch(e){}} else {
      startHint.textContent = "로딩이 끝나면 자동으로 시작됩니다...";
      const wait = setInterval(() => {
        if (assetsReady){
          clearInterval(wait);
          window.__SAVE_SUSPENDED = true;
          startGame();
      // ✅ startGame이 기본값을 세팅한 뒤, 로컬 세이브를 적용 (레벨/스탯/아이템/마지막 맵)
      try{
        if (typeof loadFromLocal === "function") loadFromLocal();
        try{ if (typeof window.ensureStartWeaponEnhanceScroll === 'function') window.ensureStartWeaponEnhanceScroll(); }catch(e){}
try{ if (typeof window.ensureStartArcherScroll4 === 'function') window.ensureStartArcherScroll4(); }catch(e){}
if (typeof applyPlayerStatsForLevel === "function") applyPlayerStatsForLevel();
        if (typeof recalcCombatStats === "function") recalcCombatStats();
      }catch(e){
                console.warn("Auto-load after startGame failed:", e);
      }
      // ✅ 로드가 끝나면 세이브를 다시 활성화(초기화 덮어쓰기 방지)
      window.__SAVE_SUSPENDED = false;
      try{ if (typeof saveToLocal === "function") saveToLocal(); }catch(_){ }
          try{ if(!window.__mapNameShown){ window.__mapNameShown=true; setTimeout(()=>{ try{ window.showMapName && window.showMapName(mapTitleFor(window.currentMapId || currentMapId)); }catch(e){} }, 180); } }catch(e){}}
      }, 60);
    }
  }, {passive:true});

  // ESC로 전체화면이 풀려도 게임은 계속 (원하면 여기서 처리 가능)
})();

  
  // ====== TWITCH CHAT HUD ======
  // ※ file:// 로 직접 열면 Twitch가 parent 파라미터 때문에 차단될 수 있어요.
  //    GitHub Pages/서버에서 열면 정상 동작합니다.
  const TWITCH_CHANNEL = "lastkan1111"; // ✅ 여기 채널명만 바꾸면 됩니다.

  function initTwitchChat(){
    const frame = document.getElementById('twChatFrame');
    if (!frame) return;

    const parents = [];
    const h = location.hostname;

    if (h) parents.push(h);
    // 로컬 개발 보강 (file:// 로 열면 호스트가 비어 CSP에 걸립니다)
    parents.push('localhost', '127.0.0.1');

    const parentParams = parents
      .filter((v,i,a)=>v && a.indexOf(v)===i)
      .map(p => `parent=${encodeURIComponent(p)}`)
      .join('&');

    frame.src = `https://www.twitch.tv/embed/${encodeURIComponent(TWITCH_CHANNEL)}/chat?${parentParams}&darkpopout`;
  }


// ====== TWITCH CHAT HUD RESIZE (drag the corner) ======
(function enableChatResize(){
  const hud = document.getElementById('twChatHud');
  const handle = document.getElementById('twResizeHandle');
  if (!hud) return;

  // ✅ 대표님 요청: 채팅창 크기 "드래그 리사이즈" 완전 비활성화
  // - 리사이즈 핸들 숨김
  // - 과거 저장된 width/height(로컬스토리지) 제거
  // - inline width/height 제거해서 CSS 기본값/반응형만 적용
  try{
    if (handle){
      handle.style.display = 'none';
      handle.style.pointerEvents = 'none';
    }
  }catch(_){}

  try{
    localStorage.removeItem('twChatHud_w');
    localStorage.removeItem('twChatHud_h');
  }catch(_){}

  try{
    hud.style.width = '';
    hud.style.height = '';
  }catch(_){}

// ====== CHAT TOGGLE (fold/unfold with scale+fade) ======
(function enableChatToggle(){
  const hud = document.getElementById('twChatHud');
  const btn = document.getElementById('chatToggleBtn');
  if (!hud || !btn) return;

  const KEY = 'twChatHud_collapsed';

  function setCollapsed(collapsed){
    hud.classList.toggle('collapsed', !!collapsed);
    btn.setAttribute('aria-pressed', String(!collapsed));
    btn.textContent = collapsed ? '채팅 열기' : '채팅 접기';
    // ✅ 정보판넬(infoLogPanel): 채팅이 "열려있을 때" 숨기고, "접혔을 때"만 표시
    try{
      const info = document.getElementById('infoLogPanel');
      if (info){
        info.style.display = collapsed ? '' : 'none';
      }
    }catch(_){}

    try{ localStorage.setItem(KEY, collapsed ? '1' : '0'); }catch(_){}
  }

  // load saved state
  try{
    const saved = localStorage.getItem(KEY);
    if (saved === '1') setCollapsed(true);
  }catch(_){}

  // ✅ 저장값이 없더라도(기본=열림) 정보판넬 표시 상태를 항상 동기화
  try{ setCollapsed(hud.classList.contains('collapsed')); }catch(_){}

  // click toggles
  btn.addEventListener('click', (e) => {
    const nowCollapsed = !hud.classList.contains('collapsed');
    setCollapsed(nowCollapsed);
    e.preventDefault();
    e.stopPropagation(); // ✅ 조이스틱/캔버스 입력으로 안넘김
  }, {passive:false});

  // ensure button always above, even if fullscreen changes
  document.addEventListener('fullscreenchange', () => {
    btn.style.zIndex = '12000';
  }, {passive:true});
})();

})();

  if (document.readyState === "loading") {
    document.addEventListener("DOMContentLoaded", initTwitchChat);
  } else {
    initTwitchChat();
  }


function updateHud(){
  const hpFill=document.getElementById('hpFill');
  const mpFill=document.getElementById('mpFill');
  const hpText=document.getElementById('hpText');
  const mpText=document.getElementById('mpText');
    const expFill=document.getElementById('expFill');
  const expText=document.getElementById('expText');
if(!hpFill||!mpFill||!hpText||!mpText||!window.player) return;
  const player = window.player;
  const hpR=player.hpMax?(Math.max(0,Math.min(player.hpMax||0,+player.hp||0))/player.hpMax):0;
  const mpR=player.mpMax?(Math.max(0,Math.min(player.mpMax||0,+player.mp||0))/player.mpMax):0;
  hpFill.style.transform=`scaleX(${Math.max(0,Math.min(1,hpR))})`;
  mpFill.style.transform=`scaleX(${Math.max(0,Math.min(1,mpR))})`;
    const hpNow = Math.max(0, Math.min(player.hpMax||0, +player.hp||0));
  const mpNow = Math.max(0, Math.min(player.mpMax||0, +player.mp||0));
  hpText.textContent=`${Math.floor(hpNow)}/${Math.floor(player.hpMax||0)}`;
  mpText.textContent=`${Math.floor(mpNow)}/${Math.floor(player.mpMax||0)}`;

  if(expFill && expText){
    const expR=player.expMax?player.exp/player.expMax:0;
    expFill.style.transform=`scaleX(${Math.max(0,Math.min(1,expR))})`;
    expText.textContent=`${Math.floor(Math.max(0,+player.exp||0))}/${Math.floor(player.expMax||0)}`;
  }}
</script>

<script>
/* ================================
   ✅ PWA Install Button (Android Chrome)
   - HTTPS 또는 localhost 에서만 install prompt가 뜹니다.
   - iOS Safari는 beforeinstallprompt 미지원 (안내만 가능)
================================ */
(function(){
  const btn = document.getElementById('pwaInstallBtn');
  if(!btn) return;

  // 이미 설치(standalone)면 버튼 숨김
  const isStandalone = () => (window.matchMedia && window.matchMedia('(display-mode: standalone)').matches) || window.navigator.standalone;
  if (isStandalone()){
    btn.style.display = 'none';
    return;
  }

  // Service Worker 등록 (PWA 조건 충족)
  if ('serviceWorker' in navigator){
    navigator.serviceWorker.register('./sw.js').catch(()=>{});
  }

  let deferredPrompt = null;

  window.addEventListener('beforeinstallprompt', (e) => {
    // 크롬 기본 미니배너 막고, 우리가 만든 버튼으로 제어
    e.preventDefault();
    deferredPrompt = e;
    btn.style.display = 'flex';
  });

  window.addEventListener('appinstalled', () => {
    deferredPrompt = null;
    btn.style.display = 'none';
    try{ if (typeof spawnWordText === 'function') spawnWordText(player?.x||0, (player?.y||0)-34, "설치 완료!", "rgba(61,255,146,0.98)"); }catch(_){}
  });

  btn.addEventListener('click', async () => {
    if(!deferredPrompt){
      // 조건 미충족(HTTPS/manifest/sw/아이콘/브라우저 등)
      try{ alert("설치가 아직 준비되지 않았어요.

✅ Android Chrome + HTTPS(또는 localhost)에서 접속했는지 확인해 주세요."); }catch(_){}
      return;
    }
    btn.style.display = 'none';
    deferredPrompt.prompt();
    try{
      const choice = await deferredPrompt.userChoice;
      // accepted / dismissed
      deferredPrompt = null;
      // dismissed면 다시 보여주기(조금 후)
      if(choice && choice.outcome === 'dismissed'){
        setTimeout(()=>{ if(!isStandalone()) btn.style.display='flex'; }, 1200);
      }
    }catch(_){
      deferredPrompt = null;
    }
  });
})();
</script>

</body>
</html>